{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Sande/OneDrive/Documents/GitHub/botbrains/botbrains-nextjs/src/lib/firebase.ts"],"sourcesContent":["'use client';\r\n\r\nimport { initializeApp } from 'firebase/app';\r\nimport { getAuth } from 'firebase/auth';\r\nimport { initializeFirestore, persistentLocalCache, persistentMultipleTabManager } from 'firebase/firestore';\r\n\r\nconst firebaseConfig = {\r\n    apiKey: process.env.NEXT_PUBLIC_FIREBASE_API_KEY,\r\n    authDomain: process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,\r\n    projectId: process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,\r\n    storageBucket: process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,\r\n    messagingSenderId: process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,\r\n    appId: process.env.NEXT_PUBLIC_FIREBASE_APP_ID\r\n};\r\n\r\nconst app = initializeApp(firebaseConfig);\r\nexport const auth = getAuth(app);\r\n\r\n// Initialize Firestore with persistent cache (modern syntax)\r\nexport const db = initializeFirestore(app, {\r\n    localCache: persistentLocalCache({\r\n        tabManager: persistentMultipleTabManager()\r\n    })\r\n});\r\n"],"names":[],"mappings":";;;;;;AAOY;AALZ;AAAA;AACA;AAAA;AACA;AAAA;AAJA;;;;AAMA,MAAM,iBAAiB;IACnB,MAAM;IACN,UAAU;IACV,SAAS;IACT,aAAa;IACb,iBAAiB;IACjB,KAAK;AACT;AAEA,MAAM,MAAM,IAAA,2MAAa,EAAC;AACnB,MAAM,OAAO,IAAA,+LAAO,EAAC;AAGrB,MAAM,KAAK,IAAA,gNAAmB,EAAC,KAAK;IACvC,YAAY,IAAA,iNAAoB,EAAC;QAC7B,YAAY,IAAA,yNAA4B;IAC5C;AACJ"}},
    {"offset": {"line": 43, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Sande/OneDrive/Documents/GitHub/botbrains/botbrains-nextjs/src/lib/profileStorage.ts"],"sourcesContent":["import { db } from './firebase';\r\nimport { collection, doc, getDoc, getDocs, setDoc, updateDoc, deleteDoc, query, where, writeBatch } from 'firebase/firestore';\r\nimport type { Profile, ProfilePreferences } from '@/types';\r\n\r\nconst COLLECTION = 'profiles';\r\n\r\n/**\r\n * Generate a unique ID\r\n */\r\nfunction generateId(): string {\r\n    return `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\r\n}\r\n\r\n/**\r\n * Create a new profile\r\n */\r\nexport async function createProfile(\r\n    googleId: string,\r\n    email: string,\r\n    name: string,\r\n    avatar?: string\r\n): Promise<Profile> {\r\n    const now = new Date().toISOString();\r\n    const id = generateId();\r\n\r\n    const profile: Profile = {\r\n        id,\r\n        googleId,\r\n        email,\r\n        name,\r\n        avatar,\r\n        preferences: {\r\n            theme: 'dark',\r\n            language: 'en',\r\n            animations: true,\r\n        },\r\n        created_at: now,\r\n        updated_at: now,\r\n    };\r\n\r\n    await setDoc(doc(db, COLLECTION, id), profile);\r\n    return profile;\r\n}\r\n\r\n/**\r\n * Get a profile by ID\r\n */\r\nexport async function getProfile(id: string): Promise<Profile | undefined> {\r\n    const docRef = doc(db, COLLECTION, id);\r\n    const docSnap = await getDoc(docRef);\r\n\r\n    if (docSnap.exists()) {\r\n        return docSnap.data() as Profile;\r\n    }\r\n    return undefined;\r\n}\r\n\r\n/**\r\n * Get a profile by Google ID\r\n */\r\nexport async function getProfileByGoogleId(googleId: string): Promise<Profile | undefined> {\r\n    const q = query(collection(db, COLLECTION), where('googleId', '==', googleId));\r\n    const querySnapshot = await getDocs(q);\r\n\r\n    if (!querySnapshot.empty) {\r\n        return querySnapshot.docs[0].data() as Profile;\r\n    }\r\n    return undefined;\r\n}\r\n\r\n/**\r\n * Get all profiles\r\n */\r\nexport async function getAllProfiles(): Promise<Profile[]> {\r\n    const querySnapshot = await getDocs(collection(db, COLLECTION));\r\n    return querySnapshot.docs.map(doc => doc.data() as Profile);\r\n}\r\n\r\n/**\r\n * Update a profile\r\n */\r\nexport async function updateProfile(\r\n    id: string,\r\n    updates: Partial<Omit<Profile, 'id' | 'googleId' | 'created_at'>>\r\n): Promise<void> {\r\n    const docRef = doc(db, COLLECTION, id);\r\n    await updateDoc(docRef, {\r\n        ...updates,\r\n        updated_at: new Date().toISOString(),\r\n    });\r\n}\r\n\r\n/**\r\n * Delete a profile\r\n * Note: Firestore doesn't automatically cascade deletes. \r\n * We need to manually delete associated data.\r\n */\r\nexport async function deleteProfile(id: string): Promise<void> {\r\n    const batch = writeBatch(db);\r\n\r\n    // Get all associated workspaces\r\n    const workspacesQuery = query(collection(db, 'workspaces'), where('profileId', '==', id));\r\n    const workspacesSnap = await getDocs(workspacesQuery);\r\n    const workspaceIds = workspacesSnap.docs.map(doc => doc.id);\r\n\r\n    // Delete workspaces\r\n    workspacesSnap.docs.forEach(doc => {\r\n        batch.delete(doc.ref);\r\n    });\r\n\r\n    // Delete prompts, categories, keywords for each workspace\r\n    // Note: Doing this in one batch might hit the 500 ops limit if massive.\r\n    // For a simple migration we do it sequentially if needed, but for now let's try to batch what we can.\r\n    // Ideally we should query ALL items by workspaceId first.\r\n\r\n    for (const workspaceId of workspaceIds) {\r\n        // Delete prompts\r\n        const promptsQ = query(collection(db, 'prompts'), where('workspaceId', '==', workspaceId));\r\n        const promptsSnap = await getDocs(promptsQ);\r\n        promptsSnap.forEach(d => deleteDoc(d.ref)); // Delete individually to avoid complex batch logic for now\r\n\r\n        // Delete categories\r\n        const catsQ = query(collection(db, 'categories'), where('workspaceId', '==', workspaceId));\r\n        const catsSnap = await getDocs(catsQ);\r\n        catsSnap.forEach(d => deleteDoc(d.ref));\r\n\r\n        // Delete keywords\r\n        const keywordsQ = query(collection(db, 'keywords'), where('workspaceId', '==', workspaceId));\r\n        const keywordsSnap = await getDocs(keywordsQ);\r\n        keywordsSnap.forEach(d => deleteDoc(d.ref));\r\n    }\r\n\r\n    // Commit workspace deletes\r\n    await batch.commit();\r\n\r\n    // Finally delete the profile\r\n    await deleteDoc(doc(db, COLLECTION, id));\r\n}\r\n\r\n/**\r\n * Update profile preferences\r\n */\r\nexport async function updateProfilePreferences(\r\n    id: string,\r\n    preferences: Partial<ProfilePreferences>\r\n): Promise<void> {\r\n    const profile = await getProfile(id);\r\n    if (!profile) {\r\n        throw new Error('Profile not found');\r\n    }\r\n\r\n    await updateProfile(id, {\r\n        preferences: {\r\n            ...profile.preferences,\r\n            ...preferences,\r\n        },\r\n    });\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 169, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Sande/OneDrive/Documents/GitHub/botbrains/botbrains-nextjs/src/store/useProfileStore.ts"],"sourcesContent":["import { create } from 'zustand';\r\nimport type { Profile, ProfilePreferences } from '@/types';\r\nimport {\r\n    getAllProfiles,\r\n    getProfile,\r\n    getProfileByGoogleId,\r\n    createProfile,\r\n    updateProfile,\r\n    updateProfilePreferences,\r\n    deleteProfile,\r\n} from '@/lib/profileStorage';\r\n\r\ninterface ProfileStore {\r\n    // State\r\n    currentProfile: Profile | null;\r\n    profiles: Profile[];\r\n    isAuthenticated: boolean;\r\n    isLoading: boolean;\r\n\r\n    // Actions\r\n    loadProfiles: () => Promise<void>;\r\n    setCurrentProfile: (profile: Profile | null) => void;\r\n    switchProfile: (profileId: string) => Promise<void>;\r\n    createNewProfile: (googleId: string, email: string, name: string, avatar?: string) => Promise<Profile>;\r\n    updateCurrentProfile: (updates: Partial<Omit<Profile, 'id' | 'googleId' | 'created_at'>>) => Promise<void>;\r\n    updatePreferences: (preferences: Partial<ProfilePreferences>) => Promise<void>;\r\n    deleteCurrentProfile: () => Promise<void>;\r\n    logout: () => void;\r\n    getOrCreateProfile: (googleId: string, email: string, name: string, avatar?: string) => Promise<Profile>;\r\n}\r\n\r\nexport const useProfileStore = create<ProfileStore>((set, get) => ({\r\n    // Initial state\r\n    currentProfile: null,\r\n    profiles: [],\r\n    isAuthenticated: false,\r\n    isLoading: false,\r\n\r\n    // Load all profiles\r\n    loadProfiles: async () => {\r\n        set({ isLoading: true });\r\n        try {\r\n            const profiles = await getAllProfiles();\r\n            set({ profiles, isLoading: false });\r\n        } catch (error) {\r\n            console.error('Failed to load profiles:', error);\r\n            set({ isLoading: false });\r\n        }\r\n    },\r\n\r\n    // Set current profile\r\n    setCurrentProfile: (profile) => {\r\n        set({\r\n            currentProfile: profile,\r\n            isAuthenticated: profile !== null,\r\n        });\r\n    },\r\n\r\n    // Switch to a different profile\r\n    switchProfile: async (profileId) => {\r\n        try {\r\n            const profile = await getProfile(profileId);\r\n            if (profile) {\r\n                get().setCurrentProfile(profile);\r\n            } else {\r\n                throw new Error('Profile not found');\r\n            }\r\n        } catch (error) {\r\n            console.error('Failed to switch profile:', error);\r\n            throw error;\r\n        }\r\n    },\r\n\r\n    // Create a new profile\r\n    createNewProfile: async (googleId, email, name, avatar) => {\r\n        try {\r\n            const profile = await createProfile(googleId, email, name, avatar);\r\n            set(state => ({\r\n                profiles: [...state.profiles, profile],\r\n            }));\r\n            return profile;\r\n        } catch (error) {\r\n            console.error('Failed to create profile:', error);\r\n            throw error;\r\n        }\r\n    },\r\n\r\n    // Update current profile\r\n    updateCurrentProfile: async (updates) => {\r\n        const { currentProfile } = get();\r\n        if (!currentProfile) {\r\n            throw new Error('No profile is currently active');\r\n        }\r\n\r\n        try {\r\n            await updateProfile(currentProfile.id, updates);\r\n            const updatedProfile = await getProfile(currentProfile.id);\r\n            if (updatedProfile) {\r\n                set(state => ({\r\n                    currentProfile: updatedProfile,\r\n                    profiles: state.profiles.map(p =>\r\n                        p.id === currentProfile.id ? updatedProfile : p\r\n                    ),\r\n                }));\r\n            }\r\n        } catch (error) {\r\n            console.error('Failed to update profile:', error);\r\n            throw error;\r\n        }\r\n    },\r\n\r\n    // Update preferences\r\n    updatePreferences: async (preferences) => {\r\n        const { currentProfile } = get();\r\n        if (!currentProfile) {\r\n            throw new Error('No profile is currently active');\r\n        }\r\n\r\n        try {\r\n            await updateProfilePreferences(currentProfile.id, preferences);\r\n            const updatedProfile = await getProfile(currentProfile.id);\r\n            if (updatedProfile) {\r\n                set(state => ({\r\n                    currentProfile: updatedProfile,\r\n                    profiles: state.profiles.map(p =>\r\n                        p.id === currentProfile.id ? updatedProfile : p\r\n                    ),\r\n                }));\r\n            }\r\n        } catch (error) {\r\n            console.error('Failed to update preferences:', error);\r\n            throw error;\r\n        }\r\n    },\r\n\r\n    // Delete current profile\r\n    deleteCurrentProfile: async () => {\r\n        const { currentProfile } = get();\r\n        if (!currentProfile) {\r\n            throw new Error('No profile is currently active');\r\n        }\r\n\r\n        try {\r\n            await deleteProfile(currentProfile.id);\r\n            set(state => ({\r\n                currentProfile: null,\r\n                isAuthenticated: false,\r\n                profiles: state.profiles.filter(p => p.id !== currentProfile.id),\r\n            }));\r\n        } catch (error) {\r\n            console.error('Failed to delete profile:', error);\r\n            throw error;\r\n        }\r\n    },\r\n\r\n    // Logout\r\n    logout: () => {\r\n        set({\r\n            currentProfile: null,\r\n            isAuthenticated: false,\r\n        });\r\n    },\r\n\r\n    // Get existing profile or create new one\r\n    getOrCreateProfile: async (googleId, email, name, avatar) => {\r\n        try {\r\n            // Try to find existing profile\r\n            let profile = await getProfileByGoogleId(googleId);\r\n\r\n            if (!profile) {\r\n                // Create new profile\r\n                profile = await get().createNewProfile(googleId, email, name, avatar);\r\n            } else {\r\n                // Update profile list if needed\r\n                const profiles = await getAllProfiles();\r\n                set({ profiles });\r\n            }\r\n\r\n            return profile;\r\n        } catch (error) {\r\n            console.error('Failed to get or create profile:', error);\r\n            throw error;\r\n        }\r\n    },\r\n}));\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 332, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Sande/OneDrive/Documents/GitHub/botbrains/botbrains-nextjs/src/lib/workspaceStorage.ts"],"sourcesContent":["import { db } from './firebase';\r\nimport { collection, doc, getDoc, getDocs, setDoc, updateDoc, deleteDoc, query, where, writeBatch } from 'firebase/firestore';\r\nimport type { Workspace, WorkspaceSettings } from '@/types';\r\n\r\nconst COLLECTION = 'workspaces';\r\n\r\n/**\r\n * Generate a unique ID\r\n */\r\nfunction generateId(): string {\r\n    return `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\r\n}\r\n\r\n/**\r\n * Create a new workspace\r\n */\r\nexport async function createWorkspace(\r\n    profileId: string,\r\n    name: string,\r\n    icon: string = 'üíº',\r\n    color: string = '#6366f1',\r\n    description: string = ''\r\n): Promise<Workspace> {\r\n    const now = new Date().toISOString();\r\n    const id = generateId();\r\n\r\n    const workspace: Workspace = {\r\n        id,\r\n        profileId,\r\n        name,\r\n        icon,\r\n        color,\r\n        description,\r\n        settings: {\r\n            autoBackup: true,\r\n            backupFrequency: 'daily',\r\n            viewPreferences: {\r\n                defaultView: 'card',\r\n                sortBy: 'updated',\r\n            },\r\n        },\r\n        isDefault: false,\r\n        created_at: now,\r\n        updated_at: now,\r\n    };\r\n\r\n    await setDoc(doc(db, COLLECTION, id), workspace);\r\n    return workspace;\r\n}\r\n\r\n/**\r\n * Get a workspace by ID\r\n */\r\nexport async function getWorkspace(id: string): Promise<Workspace | undefined> {\r\n    const docRef = doc(db, COLLECTION, id);\r\n    const docSnap = await getDoc(docRef);\r\n\r\n    if (docSnap.exists()) {\r\n        return docSnap.data() as Workspace;\r\n    }\r\n    return undefined;\r\n}\r\n\r\n/**\r\n * Get all workspaces for a profile\r\n */\r\nexport async function getWorkspacesByProfile(profileId: string): Promise<Workspace[]> {\r\n    const q = query(collection(db, COLLECTION), where('profileId', '==', profileId));\r\n    const querySnapshot = await getDocs(q);\r\n    return querySnapshot.docs.map(doc => doc.data() as Workspace);\r\n}\r\n\r\n/**\r\n * Get Default Workspace for a profile\r\n */\r\nexport async function getDefaultWorkspace(profileId: string): Promise<Workspace | undefined> {\r\n    const q = query(\r\n        collection(db, COLLECTION),\r\n        where('profileId', '==', profileId),\r\n        where('isDefault', '==', true)\r\n    );\r\n    const querySnapshot = await getDocs(q);\r\n\r\n    if (!querySnapshot.empty) {\r\n        return querySnapshot.docs[0].data() as Workspace;\r\n    }\r\n    return undefined;\r\n}\r\n\r\n/**\r\n * Update a workspace\r\n */\r\nexport async function updateWorkspace(\r\n    id: string,\r\n    updates: Partial<Omit<Workspace, 'id' | 'profileId' | 'created_at'>>\r\n): Promise<void> {\r\n    const docRef = doc(db, COLLECTION, id);\r\n    await updateDoc(docRef, {\r\n        ...updates,\r\n        updated_at: new Date().toISOString(),\r\n    });\r\n}\r\n\r\n/**\r\n * Update workspace settings\r\n */\r\nexport async function updateWorkspaceSettings(\r\n    id: string,\r\n    settings: Partial<WorkspaceSettings>\r\n): Promise<void> {\r\n    const workspace = await getWorkspace(id);\r\n    if (!workspace) throw new Error('Workspace not found');\r\n\r\n    await updateWorkspace(id, {\r\n        settings: {\r\n            ...workspace.settings,\r\n            ...settings,\r\n        },\r\n    });\r\n}\r\n\r\n/**\r\n * Set a workspace as default\r\n */\r\nexport async function setDefaultWorkspace(id: string): Promise<void> {\r\n    const workspace = await getWorkspace(id);\r\n    if (!workspace) throw new Error('Workspace not found');\r\n\r\n    const batch = writeBatch(db);\r\n\r\n    // Get all workspaces for this profile\r\n    const workspaces = await getWorkspacesByProfile(workspace.profileId);\r\n\r\n    // Set all to non-default\r\n    workspaces.forEach(w => {\r\n        const ref = doc(db, COLLECTION, w.id);\r\n        batch.update(ref, { isDefault: false });\r\n    });\r\n\r\n    // Set target to default\r\n    const targetRef = doc(db, COLLECTION, id);\r\n    batch.update(targetRef, { isDefault: true });\r\n\r\n    await batch.commit();\r\n}\r\n\r\n/**\r\n * Delete a workspace\r\n */\r\nexport async function deleteWorkspace(id: string): Promise<void> {\r\n    // Delete associated data first\r\n    // Note: This is simplified. In a robust system we'd batch or use cloud functions.\r\n\r\n    // Delete prompts\r\n    const promptsQ = query(collection(db, 'prompts'), where('workspaceId', '==', id));\r\n    const promptsSnap = await getDocs(promptsQ);\r\n    promptsSnap.forEach(d => deleteDoc(d.ref));\r\n\r\n    // Delete categories\r\n    const catsQ = query(collection(db, 'categories'), where('workspaceId', '==', id));\r\n    const catsSnap = await getDocs(catsQ);\r\n    catsSnap.forEach(d => deleteDoc(d.ref));\r\n\r\n    // Delete keywords\r\n    const keywordsQ = query(collection(db, 'keywords'), where('workspaceId', '==', id));\r\n    const keywordsSnap = await getDocs(keywordsQ);\r\n    keywordsSnap.forEach(d => deleteDoc(d.ref));\r\n\r\n    // Delete workspace\r\n    await deleteDoc(doc(db, COLLECTION, id));\r\n}\r\n\r\n/**\r\n * Update last backup timestamp\r\n */\r\nexport async function updateLastBackup(id: string): Promise<void> {\r\n    const docRef = doc(db, COLLECTION, id);\r\n    await updateDoc(docRef, {\r\n        lastBackupAt: new Date().toISOString(),\r\n    });\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 477, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Sande/OneDrive/Documents/GitHub/botbrains/botbrains-nextjs/src/store/useWorkspaceStore.ts"],"sourcesContent":["import { create } from 'zustand';\r\nimport type { Workspace, WorkspaceSettings } from '@/types';\r\nimport {\r\n    createWorkspace,\r\n    getWorkspace,\r\n    getWorkspacesByProfile,\r\n    getDefaultWorkspace,\r\n    updateWorkspace,\r\n    updateWorkspaceSettings,\r\n    setDefaultWorkspace,\r\n    deleteWorkspace,\r\n    updateLastBackup,\r\n} from '@/lib/workspaceStorage';\r\n\r\ninterface WorkspaceStore {\r\n    // State\r\n    currentWorkspace: Workspace | null;\r\n    workspaces: Workspace[];\r\n    isLoading: boolean;\r\n\r\n    // Actions\r\n    loadWorkspaces: (profileId: string) => Promise<void>;\r\n    setCurrentWorkspace: (workspace: Workspace | null) => void;\r\n    switchWorkspace: (workspaceId: string) => Promise<void>;\r\n    createNewWorkspace: (\r\n        profileId: string,\r\n        name: string,\r\n        icon?: string,\r\n        color?: string,\r\n        description?: string\r\n    ) => Promise<Workspace>;\r\n    updateCurrentWorkspace: (updates: Partial<Omit<Workspace, 'id' | 'profileId' | 'created_at'>>) => Promise<void>;\r\n    updateSettings: (settings: Partial<WorkspaceSettings>) => Promise<void>;\r\n    setAsDefault: (workspaceId: string) => Promise<void>;\r\n    deleteWorkspaceById: (workspaceId: string) => Promise<void>;\r\n    loadDefaultWorkspace: (profileId: string) => Promise<void>;\r\n    markBackupComplete: (workspaceId: string) => Promise<void>;\r\n}\r\n\r\nexport const useWorkspaceStore = create<WorkspaceStore>((set, get) => ({\r\n    // Initial state\r\n    currentWorkspace: null,\r\n    workspaces: [],\r\n    isLoading: false,\r\n\r\n    // Load all workspaces for a profile\r\n    loadWorkspaces: async (profileId) => {\r\n        set({ isLoading: true });\r\n        try {\r\n            const workspaces = await getWorkspacesByProfile(profileId);\r\n            set({ workspaces, isLoading: false });\r\n        } catch (error) {\r\n            console.error('Failed to load workspaces:', error);\r\n            set({ isLoading: false });\r\n        }\r\n    },\r\n\r\n    // Set current workspace\r\n    setCurrentWorkspace: (workspace) => {\r\n        set({ currentWorkspace: workspace });\r\n    },\r\n\r\n    // Switch to a different workspace\r\n    switchWorkspace: async (workspaceId) => {\r\n        try {\r\n            const workspace = await getWorkspace(workspaceId);\r\n            if (workspace) {\r\n                get().setCurrentWorkspace(workspace);\r\n            } else {\r\n                throw new Error('Workspace not found');\r\n            }\r\n        } catch (error) {\r\n            console.error('Failed to switch workspace:', error);\r\n            throw error;\r\n        }\r\n    },\r\n\r\n    // Create a new workspace\r\n    createNewWorkspace: async (profileId, name, icon, color, description) => {\r\n        try {\r\n            const workspace = await createWorkspace(profileId, name, icon, color, description);\r\n            set(state => ({\r\n                workspaces: [...state.workspaces, workspace],\r\n            }));\r\n            return workspace;\r\n        } catch (error) {\r\n            console.error('Failed to create workspace:', error);\r\n            throw error;\r\n        }\r\n    },\r\n\r\n    // Update current workspace\r\n    updateCurrentWorkspace: async (updates) => {\r\n        const { currentWorkspace } = get();\r\n        if (!currentWorkspace) {\r\n            throw new Error('No workspace is currently active');\r\n        }\r\n\r\n        try {\r\n            await updateWorkspace(currentWorkspace.id, updates);\r\n            const updatedWorkspace = await getWorkspace(currentWorkspace.id);\r\n            if (updatedWorkspace) {\r\n                set(state => ({\r\n                    currentWorkspace: updatedWorkspace,\r\n                    workspaces: state.workspaces.map(w =>\r\n                        w.id === currentWorkspace.id ? updatedWorkspace : w\r\n                    ),\r\n                }));\r\n            }\r\n        } catch (error) {\r\n            console.error('Failed to update workspace:', error);\r\n            throw error;\r\n        }\r\n    },\r\n\r\n    // Update workspace settings\r\n    updateSettings: async (settings) => {\r\n        const { currentWorkspace } = get();\r\n        if (!currentWorkspace) {\r\n            throw new Error('No workspace is currently active');\r\n        }\r\n\r\n        try {\r\n            await updateWorkspaceSettings(currentWorkspace.id, settings);\r\n            const updatedWorkspace = await getWorkspace(currentWorkspace.id);\r\n            if (updatedWorkspace) {\r\n                set(state => ({\r\n                    currentWorkspace: updatedWorkspace,\r\n                    workspaces: state.workspaces.map(w =>\r\n                        w.id === currentWorkspace.id ? updatedWorkspace : w\r\n                    ),\r\n                }));\r\n            }\r\n        } catch (error) {\r\n            console.error('Failed to update settings:', error);\r\n            throw error;\r\n        }\r\n    },\r\n\r\n    // Set workspace as default\r\n    setAsDefault: async (workspaceId) => {\r\n        try {\r\n            await setDefaultWorkspace(workspaceId);\r\n            const workspace = await getWorkspace(workspaceId);\r\n            const { currentWorkspace } = get();\r\n\r\n            if (workspace) {\r\n                set(state => ({\r\n                    workspaces: state.workspaces.map(w => ({\r\n                        ...w,\r\n                        isDefault: w.id === workspaceId,\r\n                    })),\r\n                    currentWorkspace: currentWorkspace?.id === workspaceId ? workspace : currentWorkspace,\r\n                }));\r\n            }\r\n        } catch (error) {\r\n            console.error('Failed to set default workspace:', error);\r\n            throw error;\r\n        }\r\n    },\r\n\r\n    // Delete a workspace\r\n    deleteWorkspaceById: async (workspaceId) => {\r\n        try {\r\n            await deleteWorkspace(workspaceId);\r\n            const { currentWorkspace } = get();\r\n\r\n            set(state => ({\r\n                workspaces: state.workspaces.filter(w => w.id !== workspaceId),\r\n                currentWorkspace: currentWorkspace?.id === workspaceId ? null : currentWorkspace,\r\n            }));\r\n        } catch (error) {\r\n            console.error('Failed to delete workspace:', error);\r\n            throw error;\r\n        }\r\n    },\r\n\r\n    // Load default workspace for a profile\r\n    loadDefaultWorkspace: async (profileId) => {\r\n        console.log('üè¢ loadDefaultWorkspace called for profile:', profileId);\r\n        set({ isLoading: true });\r\n        try {\r\n            const workspace = await getDefaultWorkspace(profileId);\r\n            if (workspace) {\r\n                console.log('‚úÖ Found existing default workspace:', workspace.id, workspace.name);\r\n                set({\r\n                    currentWorkspace: workspace,\r\n                    isLoading: false,\r\n                });\r\n            } else {\r\n                console.log('‚ö†Ô∏è  No default workspace found - creating new one');\r\n                // If no default workspace exists, create one AND mark it as default\r\n                const newWorkspace = await createWorkspace(\r\n                    profileId,\r\n                    'My Workspace',\r\n                    'üíº',\r\n                    '#6366f1'\r\n                );\r\n                console.log('üíæ Created new workspace:', newWorkspace.id);\r\n\r\n                // CRITICAL FIX: Mark the newly created workspace as default\r\n                await setDefaultWorkspace(newWorkspace.id);\r\n                console.log('‚úÖ Set new workspace as default');\r\n\r\n                // Fetch the updated workspace with isDefault: true\r\n                const updatedWorkspace = await getWorkspace(newWorkspace.id);\r\n\r\n                set({\r\n                    currentWorkspace: updatedWorkspace || newWorkspace,\r\n                    workspaces: [updatedWorkspace || newWorkspace],\r\n                    isLoading: false,\r\n                });\r\n                console.log('‚úÖ Default workspace loaded:', updatedWorkspace?.id);\r\n            }\r\n        } catch (error) {\r\n            console.error('‚ùå Failed to load default workspace:', error);\r\n            set({ isLoading: false });\r\n        }\r\n    },\r\n\r\n    // Mark backup as complete\r\n    markBackupComplete: async (workspaceId) => {\r\n        try {\r\n            await updateLastBackup(workspaceId);\r\n            const updatedWorkspace = await getWorkspace(workspaceId);\r\n            const { currentWorkspace } = get();\r\n\r\n            if (updatedWorkspace) {\r\n                set(state => ({\r\n                    workspaces: state.workspaces.map(w =>\r\n                        w.id === workspaceId ? updatedWorkspace : w\r\n                    ),\r\n                    currentWorkspace: currentWorkspace?.id === workspaceId ? updatedWorkspace : currentWorkspace,\r\n                }));\r\n            }\r\n        } catch (error) {\r\n            console.error('Failed to mark backup complete:', error);\r\n            throw error;\r\n        }\r\n    },\r\n}));\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 683, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Sande/OneDrive/Documents/GitHub/botbrains/botbrains-nextjs/src/lib/storage.ts"],"sourcesContent":["import { db } from './firebase';\r\nimport { collection, doc, getDoc, getDocs, setDoc, updateDoc, deleteDoc, query, where, orderBy, writeBatch } from 'firebase/firestore';\r\nimport type { Prompt, SearchFilters } from '@/types';\r\n\r\nconst COLLECTION = 'prompts';\r\n\r\n/**\r\n * Generate a unique ID for prompts\r\n */\r\nfunction generateId(): string {\r\n    return `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\r\n}\r\n\r\n/**\r\n * Create a new prompt\r\n */\r\nexport async function createPrompt(\r\n    data: Omit<Prompt, 'id' | 'created_at' | 'updated_at' | 'order'>,\r\n    workspaceId?: string\r\n): Promise<Prompt> {\r\n    console.log('üíæ createPrompt called with workspaceId:', workspaceId);\r\n    console.log('üìù Prompt data:', { title: data.title, type: data.type });\r\n\r\n    try {\r\n        const now = new Date().toISOString();\r\n\r\n        // Find max order to append\r\n        let maxOrder = -1;\r\n        let q = query(collection(db, COLLECTION), orderBy('order', 'desc'));\r\n        if (workspaceId) {\r\n            // Composite index might be needed: workspaceId + order\r\n            // Fallback: simplified logic for now: query all in workspace, find max.\r\n            q = query(collection(db, COLLECTION), where('workspaceId', '==', workspaceId));\r\n            const snap = await getDocs(q);\r\n            if (!snap.empty) {\r\n                // Determine max in memory to avoid index issues during migration\r\n                const orders = snap.docs.map(d => (d.data() as Prompt).order || 0);\r\n                maxOrder = Math.max(...orders);\r\n            }\r\n        } else {\r\n            // Global max (if no workspace? Prompts should have workspaceId)\r\n            const snap = await getDocs(query(collection(db, COLLECTION), orderBy('order', 'desc'))); // limit(1) requires index\r\n            if (!snap.empty) {\r\n                maxOrder = (snap.docs[0].data() as Prompt).order;\r\n            }\r\n        }\r\n\r\n        const id = generateId();\r\n        const prompt: Prompt = {\r\n            ...data,\r\n            workspaceId,\r\n            id,\r\n            created_at: now,\r\n            updated_at: now,\r\n            order: maxOrder >= 0 ? maxOrder + 1 : 0, // Ensure we handle -1 case properly\r\n        };\r\n\r\n        console.log('üíæ Saving prompt to Firestore:', { id, order: prompt.order, workspaceId });\r\n        await setDoc(doc(db, COLLECTION, id), prompt);\r\n        console.log('‚úÖ Prompt saved successfully to Firestore');\r\n        return prompt;\r\n    } catch (error) {\r\n        console.error('‚ùå Failed to create prompt:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * Get a single prompt by ID\r\n */\r\nexport async function getPrompt(id: string): Promise<Prompt | undefined> {\r\n    const docRef = doc(db, COLLECTION, id);\r\n    const docSnap = await getDoc(docRef);\r\n\r\n    if (docSnap.exists()) {\r\n        return docSnap.data() as Prompt;\r\n    }\r\n    return undefined;\r\n}\r\n\r\n/**\r\n * Get all prompts ordered by the order field\r\n * Optionally filter by workspace\r\n */\r\nexport async function getAllPrompts(workspaceId?: string): Promise<Prompt[]> {\r\n    console.log('üîç getAllPrompts called with workspaceId:', workspaceId);\r\n\r\n    let q;\r\n    if (workspaceId) {\r\n        // Query by workspace only (no order) to avoid composite index requirement\r\n        q = query(collection(db, COLLECTION), where('workspaceId', '==', workspaceId));\r\n    } else {\r\n        // Fetch ALL prompts without any orderBy to avoid index issues\r\n        // We'll sort in memory instead - this handles undefined order values gracefully\r\n        q = query(collection(db, COLLECTION));\r\n    }\r\n\r\n    try {\r\n        const querySnapshot = await getDocs(q);\r\n        console.log(`üìä Retrieved ${querySnapshot.size} prompts from Firestore`);\r\n        const prompts = querySnapshot.docs.map(doc => doc.data() as Prompt);\r\n        console.log('üìã Prompts after mapping:', prompts.length);\r\n\r\n        // Sort in memory by order (handles undefined values gracefully)\r\n        return prompts.sort((a, b) => (a.order || 0) - (b.order || 0));\r\n    } catch (e: any) {\r\n        console.error('‚ùå getAllPrompts failed:', e);\r\n        throw e;\r\n    }\r\n}\r\n\r\n/**\r\n * Update an existing prompt\r\n */\r\nexport async function updatePrompt(\r\n    id: string,\r\n    updates: Partial<Omit<Prompt, 'id' | 'created_at'>>\r\n): Promise<void> {\r\n    const docRef = doc(db, COLLECTION, id);\r\n    await updateDoc(docRef, {\r\n        ...updates,\r\n        updated_at: new Date().toISOString(),\r\n    });\r\n}\r\n\r\n/**\r\n * Delete a prompt\r\n */\r\nexport async function deletePrompt(id: string): Promise<void> {\r\n    await deleteDoc(doc(db, COLLECTION, id));\r\n}\r\n\r\n/**\r\n * Track prompt usage - increment usage count and update last used timestamp\r\n */\r\nexport async function trackPromptUsage(id: string): Promise<void> {\r\n    const docRef = doc(db, COLLECTION, id);\r\n    const promptDoc = await getDoc(docRef);\r\n\r\n    if (promptDoc.exists()) {\r\n        const currentUsageCount = (promptDoc.data() as Prompt).usageCount || 0;\r\n        await updateDoc(docRef, {\r\n            usageCount: currentUsageCount + 1,\r\n            lastUsedAt: new Date().toISOString(),\r\n            updated_at: new Date().toISOString(),\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * Toggle favorite status of a prompt\r\n */\r\nexport async function toggleFavorite(id: string): Promise<void> {\r\n    const docRef = doc(db, COLLECTION, id);\r\n    const promptDoc = await getDoc(docRef);\r\n\r\n    if (promptDoc.exists()) {\r\n        const currentFavorite = (promptDoc.data() as Prompt).isFavorite || false;\r\n        await updateDoc(docRef, {\r\n            isFavorite: !currentFavorite,\r\n            updated_at: new Date().toISOString(),\r\n        });\r\n    }\r\n}\r\n\r\n\r\n/**\r\n * Search prompts with filters\r\n */\r\nexport async function searchPrompts(\r\n    queryText: string,\r\n    filters: SearchFilters = {},\r\n    workspaceId?: string\r\n): Promise<Prompt[]> {\r\n    // Firestore search is limited. We will fetch relevant prompts and filter in memory.\r\n    // This maintains the previous logic's capability without requiring Algolia/Typesense yet.\r\n\r\n    // 1. Base fetch\r\n    let collectionData: Prompt[] = await getAllPrompts(workspaceId);\r\n\r\n    // 2. Apply filters (Memory)\r\n    if (filters.type) {\r\n        collectionData = collectionData.filter(p => p.type === filters.type);\r\n    }\r\n    if (filters.category) {\r\n        collectionData = collectionData.filter(p => p.category === filters.category);\r\n    }\r\n    if (filters.tags && filters.tags.length > 0) {\r\n        collectionData = collectionData.filter(p =>\r\n            p.tags.some(tag => filters.tags!.includes(tag))\r\n        );\r\n    }\r\n    if (filters.keywords && filters.keywords.length > 0) {\r\n        collectionData = collectionData.filter(p =>\r\n            p.keywords?.some(kw => filters.keywords!.includes(kw))\r\n        );\r\n    }\r\n    if (filters.minRating !== undefined && filters.minRating > 0) {\r\n        collectionData = collectionData.filter(p => p.performance.rating >= filters.minRating!);\r\n    }\r\n    if (filters.favorites) {\r\n        collectionData = collectionData.filter(p => p.isFavorite === true);\r\n    }\r\n\r\n    // 3. Apply text search\r\n    if (queryText.trim()) {\r\n        const lowerQuery = queryText.toLowerCase();\r\n        collectionData = collectionData.filter(p =>\r\n            p.title.toLowerCase().includes(lowerQuery) ||\r\n            p.prompt_template.toLowerCase().includes(lowerQuery) ||\r\n            p.tags.some(tag => tag.toLowerCase().includes(lowerQuery)) ||\r\n            p.keywords?.some(kw => kw.toLowerCase().includes(lowerQuery)) ||\r\n            p.category.toLowerCase().includes(lowerQuery)\r\n        );\r\n    }\r\n\r\n    return collectionData;\r\n}\r\n\r\n/**\r\n * Reorder prompts (for drag-and-drop)\r\n */\r\nexport async function reorderPrompts(promptIds: string[]): Promise<void> {\r\n    const batch = writeBatch(db);\r\n\r\n    promptIds.forEach((id, index) => {\r\n        const docRef = doc(db, COLLECTION, id);\r\n        batch.update(docRef, { order: index });\r\n    });\r\n\r\n    await batch.commit();\r\n}\r\n\r\n/**\r\n * Export all prompts as JSON string\r\n */\r\nexport async function exportAllPrompts(): Promise<string> {\r\n    const prompts = await getAllPrompts();\r\n    return JSON.stringify(prompts, null, 2);\r\n}\r\n\r\n/**\r\n * Import prompts from JSON string\r\n */\r\nexport async function importPrompts(jsonString: string): Promise<number> {\r\n    try {\r\n        const prompts = JSON.parse(jsonString) as Prompt[];\r\n\r\n        if (!Array.isArray(prompts)) {\r\n            throw new Error('Invalid JSON format: expected an array');\r\n        }\r\n\r\n        // Firestore batch limit is 500. For large imports we need to chunk results.\r\n        const chunks = [];\r\n        for (let i = 0; i < prompts.length; i += 400) {\r\n            chunks.push(prompts.slice(i, i + 400));\r\n        }\r\n\r\n        // We aren't clearing existing prompts because \"clear()\" is expensive in Firestore (read + delete).\r\n        // User logic might expect clear.\r\n        // For now, let's just ADD new ones.\r\n\r\n        for (const chunk of chunks) {\r\n            const batch = writeBatch(db);\r\n            for (const prompt of chunk) {\r\n                // Ensure unique ID if they clash or let Firestore overwrite?\r\n                // Using setDoc will overwrite if ID exists.\r\n                const docRef = doc(db, COLLECTION, prompt.id || generateId());\r\n                batch.set(docRef, prompt);\r\n            }\r\n            await batch.commit();\r\n        }\r\n\r\n        return prompts.length;\r\n    } catch (error) {\r\n        console.error('Import failed:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * Duplicate a prompt\r\n */\r\nexport async function duplicatePrompt(id: string): Promise<Prompt> {\r\n    const original = await getPrompt(id);\r\n    if (!original) {\r\n        throw new Error('Prompt not found');\r\n    }\r\n\r\n    const { id: _, created_at: __, updated_at: ___, order: ____, ...data } = original;\r\n\r\n    return createPrompt({\r\n        ...data,\r\n        title: `${original.title} (Copy)`,\r\n    }, original.workspaceId);\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 927, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Sande/OneDrive/Documents/GitHub/botbrains/botbrains-nextjs/src/lib/composition.ts"],"sourcesContent":["import type { Prompt } from '@/types';\r\nimport { getPrompt, getAllPrompts } from './storage';\r\n\r\nexport class CompositionService {\r\n    /**\r\n     * Resolve the final template content by composing a prompt with its parents\r\n     */\r\n    static async resolveTemplate(promptId: string): Promise<string> {\r\n        // We need to fetch the prompt first\r\n        const prompt = await getPrompt(promptId);\r\n        if (!prompt) return '';\r\n\r\n        return this.resolvePromptContent(prompt);\r\n    }\r\n\r\n    /**\r\n     * Recursive helper to resolve content given a prompt object\r\n     */\r\n    private static async resolvePromptContent(prompt: Prompt): Promise<string> {\r\n        // Base case: no parent\r\n        if (!prompt.parentId) {\r\n            return prompt.prompt_template || '';\r\n        }\r\n\r\n        // Fetch parent\r\n        const parent = await getPrompt(prompt.parentId);\r\n\r\n        // If parent not found (deleted?), treat as standalone\r\n        if (!parent) {\r\n            return prompt.prompt_template || '';\r\n        }\r\n\r\n        // Recursively resolve parent's content\r\n        const parentContent = await this.resolvePromptContent(parent);\r\n        const childContent = prompt.prompt_template || '';\r\n\r\n        // Compose based on mode\r\n        const mode = prompt.compositionMode || 'inherit';\r\n\r\n        switch (mode) {\r\n            case 'inherit':\r\n                // Parent + newline + Child\r\n                return `${parentContent}\\n\\n${childContent}`;\r\n\r\n            case 'extend':\r\n                // Replace {{@prompt:parent-id}} placeholder\r\n                if (childContent.includes(`{{@prompt:${parent.id}}}`)) {\r\n                    return childContent.replace(new RegExp(`\\\\{\\\\{@prompt:${parent.id}\\\\}\\\\}`, 'g'), parentContent);\r\n                }\r\n                // Fallback: return child content\r\n                return childContent;\r\n\r\n            case 'standalone':\r\n            default:\r\n                return childContent;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Detect if setting newParentId as parent of promptId would create a circular reference\r\n     */\r\n    static async detectCircularReference(promptId: string, newParentId: string): Promise<boolean> {\r\n        // Walk up from newParentId. If we hit promptId, it's a cycle.\r\n        let currentId: string | null | undefined = newParentId;\r\n        const visited = new Set<string>();\r\n\r\n        // Set a max depth safety to prevent infinite loops in the checker itself\r\n        const MAX_STEPS = 100;\r\n        let steps = 0;\r\n\r\n        while (currentId && steps < MAX_STEPS) {\r\n            if (currentId === promptId) {\r\n                return true; // Cycle detected\r\n            }\r\n\r\n            if (visited.has(currentId)) {\r\n                return true; // Cycle in existing chain detected\r\n            }\r\n            visited.add(currentId);\r\n\r\n            const parent: Prompt | undefined = await getPrompt(currentId);\r\n            currentId = parent?.parentId;\r\n            steps++;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Calculate depth of a prompt (0 = root)\r\n     * Used to enforce strict depth limit\r\n     */\r\n    static async getPromptDepth(promptId: string): Promise<number> {\r\n        let depth = 0;\r\n        let currentId: string | null | undefined = promptId;\r\n        const visited = new Set<string>(); // Safety check\r\n\r\n        while (currentId) {\r\n            const prompt = await getPrompt(currentId);\r\n            if (!prompt || !prompt.parentId) {\r\n                break;\r\n            }\r\n\r\n            // Safety: if we somehow have a cycle that wasn't caught, break\r\n            if (visited.has(currentId)) break;\r\n            visited.add(currentId);\r\n\r\n            currentId = prompt.parentId;\r\n            depth++;\r\n\r\n            if (depth > 20) break; // Hard safety limit\r\n        }\r\n\r\n        return depth;\r\n    }\r\n\r\n    /**\r\n     * Get parent candidates for a prompt (filtering out self and descendants)\r\n     */\r\n    static async getEligibleParents(promptId: string | null, workspaceId: string): Promise<Prompt[]> {\r\n        console.log(`üîç [CompositionService] getEligibleParents called with promptId: ${promptId}, workspaceId: ${workspaceId}`);\r\n        const allPrompts = await getAllPrompts(workspaceId);\r\n        console.log(`üîç [CompositionService] Found ${allPrompts.length} prompts in workspace ${workspaceId}`);\r\n\r\n        if (!promptId) {\r\n            console.log('üîç [CompositionService] Returning all prompts (new prompt mode)');\r\n            return allPrompts; // New prompt can pick anyone\r\n        }\r\n\r\n        // Exclude self\r\n        const candidates = allPrompts.filter(p => p.id !== promptId);\r\n\r\n        // Exclude descendants (BFS or DFS)\r\n        const childrenMap = new Map<string, string[]>();\r\n        allPrompts.forEach(p => {\r\n            if (p.parentId) {\r\n                const list = childrenMap.get(p.parentId) || [];\r\n                list.push(p.id);\r\n                childrenMap.set(p.parentId, list);\r\n            }\r\n        });\r\n\r\n        const descendants = new Set<string>();\r\n        const queue = [promptId];\r\n\r\n        while (queue.length > 0) {\r\n            const current = queue.shift()!;\r\n            descendants.add(current);\r\n            const children = childrenMap.get(current) || [];\r\n            children.forEach(c => {\r\n                if (!descendants.has(c)) {\r\n                    queue.push(c);\r\n                }\r\n            });\r\n        }\r\n\r\n        return candidates.filter(p => !descendants.has(p.id));\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AACA;;AAEO,MAAM;IACT;;KAEC,GACD,aAAa,gBAAgB,QAAgB,EAAmB;QAC5D,oCAAoC;QACpC,MAAM,SAAS,MAAM,IAAA,4JAAS,EAAC;QAC/B,IAAI,CAAC,QAAQ,OAAO;QAEpB,OAAO,IAAI,CAAC,oBAAoB,CAAC;IACrC;IAEA;;KAEC,GACD,aAAqB,qBAAqB,MAAc,EAAmB;QACvE,uBAAuB;QACvB,IAAI,CAAC,OAAO,QAAQ,EAAE;YAClB,OAAO,OAAO,eAAe,IAAI;QACrC;QAEA,eAAe;QACf,MAAM,SAAS,MAAM,IAAA,4JAAS,EAAC,OAAO,QAAQ;QAE9C,sDAAsD;QACtD,IAAI,CAAC,QAAQ;YACT,OAAO,OAAO,eAAe,IAAI;QACrC;QAEA,uCAAuC;QACvC,MAAM,gBAAgB,MAAM,IAAI,CAAC,oBAAoB,CAAC;QACtD,MAAM,eAAe,OAAO,eAAe,IAAI;QAE/C,wBAAwB;QACxB,MAAM,OAAO,OAAO,eAAe,IAAI;QAEvC,OAAQ;YACJ,KAAK;gBACD,2BAA2B;gBAC3B,OAAO,GAAG,cAAc,IAAI,EAAE,cAAc;YAEhD,KAAK;gBACD,4CAA4C;gBAC5C,IAAI,aAAa,QAAQ,CAAC,CAAC,UAAU,EAAE,OAAO,EAAE,CAAC,EAAE,CAAC,GAAG;oBACnD,OAAO,aAAa,OAAO,CAAC,IAAI,OAAO,CAAC,cAAc,EAAE,OAAO,EAAE,CAAC,MAAM,CAAC,EAAE,MAAM;gBACrF;gBACA,iCAAiC;gBACjC,OAAO;YAEX,KAAK;YACL;gBACI,OAAO;QACf;IACJ;IAEA;;KAEC,GACD,aAAa,wBAAwB,QAAgB,EAAE,WAAmB,EAAoB;QAC1F,8DAA8D;QAC9D,IAAI,YAAuC;QAC3C,MAAM,UAAU,IAAI;QAEpB,yEAAyE;QACzE,MAAM,YAAY;QAClB,IAAI,QAAQ;QAEZ,MAAO,aAAa,QAAQ,UAAW;YACnC,IAAI,cAAc,UAAU;gBACxB,OAAO,MAAM,iBAAiB;YAClC;YAEA,IAAI,QAAQ,GAAG,CAAC,YAAY;gBACxB,OAAO,MAAM,mCAAmC;YACpD;YACA,QAAQ,GAAG,CAAC;YAEZ,MAAM,SAA6B,MAAM,IAAA,4JAAS,EAAC;YACnD,YAAY,QAAQ;YACpB;QACJ;QAEA,OAAO;IACX;IAEA;;;KAGC,GACD,aAAa,eAAe,QAAgB,EAAmB;QAC3D,IAAI,QAAQ;QACZ,IAAI,YAAuC;QAC3C,MAAM,UAAU,IAAI,OAAe,eAAe;QAElD,MAAO,UAAW;YACd,MAAM,SAAS,MAAM,IAAA,4JAAS,EAAC;YAC/B,IAAI,CAAC,UAAU,CAAC,OAAO,QAAQ,EAAE;gBAC7B;YACJ;YAEA,+DAA+D;YAC/D,IAAI,QAAQ,GAAG,CAAC,YAAY;YAC5B,QAAQ,GAAG,CAAC;YAEZ,YAAY,OAAO,QAAQ;YAC3B;YAEA,IAAI,QAAQ,IAAI,OAAO,oBAAoB;QAC/C;QAEA,OAAO;IACX;IAEA;;KAEC,GACD,aAAa,mBAAmB,QAAuB,EAAE,WAAmB,EAAqB;QAC7F,QAAQ,GAAG,CAAC,CAAC,iEAAiE,EAAE,SAAS,eAAe,EAAE,aAAa;QACvH,MAAM,aAAa,MAAM,IAAA,gKAAa,EAAC;QACvC,QAAQ,GAAG,CAAC,CAAC,8BAA8B,EAAE,WAAW,MAAM,CAAC,sBAAsB,EAAE,aAAa;QAEpG,IAAI,CAAC,UAAU;YACX,QAAQ,GAAG,CAAC;YACZ,OAAO,YAAY,6BAA6B;QACpD;QAEA,eAAe;QACf,MAAM,aAAa,WAAW,MAAM,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;QAEnD,mCAAmC;QACnC,MAAM,cAAc,IAAI;QACxB,WAAW,OAAO,CAAC,CAAA;YACf,IAAI,EAAE,QAAQ,EAAE;gBACZ,MAAM,OAAO,YAAY,GAAG,CAAC,EAAE,QAAQ,KAAK,EAAE;gBAC9C,KAAK,IAAI,CAAC,EAAE,EAAE;gBACd,YAAY,GAAG,CAAC,EAAE,QAAQ,EAAE;YAChC;QACJ;QAEA,MAAM,cAAc,IAAI;QACxB,MAAM,QAAQ;YAAC;SAAS;QAExB,MAAO,MAAM,MAAM,GAAG,EAAG;YACrB,MAAM,UAAU,MAAM,KAAK;YAC3B,YAAY,GAAG,CAAC;YAChB,MAAM,WAAW,YAAY,GAAG,CAAC,YAAY,EAAE;YAC/C,SAAS,OAAO,CAAC,CAAA;gBACb,IAAI,CAAC,YAAY,GAAG,CAAC,IAAI;oBACrB,MAAM,IAAI,CAAC;gBACf;YACJ;QACJ;QAEA,OAAO,WAAW,MAAM,CAAC,CAAA,IAAK,CAAC,YAAY,GAAG,CAAC,EAAE,EAAE;IACvD;AACJ"}},
    {"offset": {"line": 1065, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Sande/OneDrive/Documents/GitHub/botbrains/botbrains-nextjs/src/store/usePromptStore.ts"],"sourcesContent":["import { create } from 'zustand';\r\nimport type { Prompt, SearchFilters } from '@/types';\r\nimport {\r\n    getAllPrompts,\r\n    createPrompt as dbCreatePrompt,\r\n    updatePrompt as dbUpdatePrompt,\r\n    deletePrompt as dbDeletePrompt,\r\n    searchPrompts,\r\n    reorderPrompts as dbReorderPrompts,\r\n    duplicatePrompt as dbDuplicatePrompt,\r\n    toggleFavorite as dbToggleFavorite,\r\n    trackPromptUsage as dbTrackPromptUsage,\r\n} from '@/lib/storage';\r\nimport { CompositionService } from '@/lib/composition';\r\n\r\ninterface PromptStore {\r\n    // State\r\n    prompts: Prompt[];\r\n    selectedPrompt: Prompt | null;\r\n    currentWorkspaceId: string | null;   // Current workspace context\r\n    searchQuery: string;\r\n    filters: SearchFilters;\r\n    viewMode: 'card' | 'list';\r\n    isLoading: boolean;\r\n\r\n    // Actions\r\n    setWorkspace: (workspaceId: string | null) => void;\r\n    loadPrompts: (workspaceId?: string) => Promise<void>;\r\n    refreshPrompts: () => Promise<void>;\r\n    createPrompt: (data: Omit<Prompt, 'id' | 'created_at' | 'updated_at' | 'order'>) => Promise<Prompt>;\r\n    updatePrompt: (id: string, updates: Partial<Prompt>) => Promise<void>;\r\n    deletePrompt: (id: string) => Promise<void>;\r\n    duplicatePrompt: (id: string) => Promise<void>;\r\n    selectPrompt: (prompt: Prompt | null) => void;\r\n    setSearchQuery: (query: string) => void;\r\n    setFilters: (filters: SearchFilters) => void;\r\n    setViewMode: (mode: 'card' | 'list') => void;\r\n    reorderPrompts: (promptIds: string[]) => Promise<void>;\r\n    searchAndFilter: () => Promise<void>;\r\n    // Analytics & Favorites\r\n    toggleFavorite: (id: string) => Promise<void>;\r\n    trackUsage: (id: string) => Promise<void>;\r\n\r\n    // Composition\r\n    resolveTemplate: (id: string) => Promise<string>;\r\n    setParent: (childId: string, parentId: string | null) => Promise<void>;\r\n}\r\n\r\nexport const usePromptStore = create<PromptStore>((set, get) => ({\r\n    // Initial state\r\n    prompts: [],\r\n    selectedPrompt: null,\r\n    currentWorkspaceId: null,  // No workspace selected initially\r\n    searchQuery: '',\r\n    filters: {},\r\n    viewMode: 'card',\r\n    isLoading: false,\r\n\r\n    // Set current workspace\r\n    setWorkspace: (workspaceId) => {\r\n        set({ currentWorkspaceId: workspaceId });\r\n        // Reload prompts for new workspace\r\n        if (workspaceId) {\r\n            get().loadPrompts(workspaceId);\r\n        } else {\r\n            set({ prompts: [] });\r\n        }\r\n    },\r\n\r\n    // Load all prompts (optionally for a specific workspace)\r\n    loadPrompts: async (workspaceId) => {\r\n        const wsId = workspaceId || get().currentWorkspaceId;\r\n        set({ isLoading: true });\r\n        try {\r\n            const prompts = await getAllPrompts(wsId || undefined);\r\n            set({ prompts, isLoading: false });\r\n        } catch (error) {\r\n            console.error('Failed to load prompts:', error);\r\n            set({ isLoading: false });\r\n        }\r\n    },\r\n\r\n    // Refresh prompts (re-fetch from DB)\r\n    refreshPrompts: async () => {\r\n        await get().loadPrompts();\r\n    },\r\n\r\n    // Create a new prompt\r\n    createPrompt: async (data) => {\r\n        const { currentWorkspaceId } = get();\r\n        console.log('üè™ Store: Creating prompt', data);\r\n        const prompt = await dbCreatePrompt(data, currentWorkspaceId || undefined);\r\n        console.log('üè™ Store: Prompt created, adding to state', prompt);\r\n        set(state => ({ prompts: [...state.prompts, prompt] }));\r\n        console.log('üè™ Store: State updated');\r\n        return prompt;\r\n    },\r\n\r\n    // Update a prompt\r\n    updatePrompt: async (id, updates) => {\r\n        await dbUpdatePrompt(id, updates);\r\n        set(state => ({\r\n            prompts: state.prompts.map(p =>\r\n                p.id === id ? { ...p, ...updates, updated_at: new Date().toISOString() } : p\r\n            ),\r\n            selectedPrompt: state.selectedPrompt?.id === id\r\n                ? { ...state.selectedPrompt, ...updates, updated_at: new Date().toISOString() }\r\n                : state.selectedPrompt,\r\n        }));\r\n    },\r\n\r\n    // Delete a prompt\r\n    deletePrompt: async (id) => {\r\n        await dbDeletePrompt(id);\r\n        set(state => ({\r\n            prompts: state.prompts.filter(p => p.id !== id),\r\n            selectedPrompt: state.selectedPrompt?.id === id ? null : state.selectedPrompt,\r\n        }));\r\n    },\r\n\r\n    // Duplicate a prompt\r\n    duplicatePrompt: async (id) => {\r\n        const duplicate = await dbDuplicatePrompt(id);\r\n        set(state => ({ prompts: [...state.prompts, duplicate] }));\r\n    },\r\n\r\n    // Select a prompt\r\n    selectPrompt: (prompt) => {\r\n        set({ selectedPrompt: prompt });\r\n    },\r\n\r\n    // Set search query\r\n    setSearchQuery: (query) => {\r\n        set({ searchQuery: query });\r\n    },\r\n\r\n    // Set filters\r\n    setFilters: (filters) => {\r\n        set({ filters });\r\n    },\r\n\r\n    // Set view mode\r\n    setViewMode: (mode) => {\r\n        set({ viewMode: mode });\r\n    },\r\n\r\n    // Reorder prompts\r\n    reorderPrompts: async (promptIds) => {\r\n        await dbReorderPrompts(promptIds);\r\n        await get().loadPrompts();\r\n    },\r\n\r\n    // Search and filter prompts\r\n    searchAndFilter: async () => {\r\n        set({ isLoading: true });\r\n        try {\r\n            const { searchQuery, filters, currentWorkspaceId } = get();\r\n            const results = await searchPrompts(searchQuery, filters, currentWorkspaceId || undefined);\r\n            set({ prompts: results, isLoading: false });\r\n        } catch (error) {\r\n            console.error('Search failed:', error);\r\n            set({ isLoading: false });\r\n        }\r\n    },\r\n\r\n    // Toggle favorite status\r\n    toggleFavorite: async (id) => {\r\n        // Optimistic update\r\n        set(state => ({\r\n            prompts: state.prompts.map(p =>\r\n                p.id === id ? { ...p, isFavorite: !p.isFavorite } : p\r\n            ),\r\n        }));\r\n\r\n        try {\r\n            await dbToggleFavorite(id);\r\n        } catch (error) {\r\n            console.error('Failed to toggle favorite:', error);\r\n            // Revert on error\r\n            await get().loadPrompts();\r\n        }\r\n    },\r\n\r\n    trackUsage: async (id) => {\r\n        // Optimistic update\r\n        const now = new Date().toISOString();\r\n        set(state => ({\r\n            prompts: state.prompts.map(p =>\r\n                p.id === id\r\n                    ? { ...p, usageCount: (p.usageCount || 0) + 1, lastUsedAt: now }\r\n                    : p\r\n            ),\r\n        }));\r\n\r\n        try {\r\n            await dbTrackPromptUsage(id);\r\n        } catch (error) {\r\n            console.error('Failed to track usage:', error);\r\n            // Revert on error\r\n            await get().loadPrompts();\r\n        }\r\n    },\r\n\r\n    // Resolve template with parents\r\n    resolveTemplate: async (id) => {\r\n        return await CompositionService.resolveTemplate(id);\r\n    },\r\n\r\n    // Set parent with validation\r\n    setParent: async (childId, parentId) => {\r\n        if (parentId) {\r\n            // Check for circular reference\r\n            const isCircular = await CompositionService.detectCircularReference(childId, parentId);\r\n            if (isCircular) {\r\n                throw new Error('Circular reference detected: A prompt cannot be its own ancestor.');\r\n            }\r\n\r\n            // Check depth limit\r\n            const depth = await CompositionService.getPromptDepth(parentId);\r\n            if (depth >= 10) {\r\n                throw new Error('Depth limit exceeded: Maximum 10 levels of inheritance allowed.');\r\n            }\r\n        }\r\n\r\n        await get().updatePrompt(childId, { parentId });\r\n    },\r\n}));\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1283, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Sande/OneDrive/Documents/GitHub/botbrains/botbrains-nextjs/src/services/googleAuth.ts"],"sourcesContent":["import { auth } from '../lib/firebase';\r\nimport { GoogleAuthProvider, signInWithPopup, signOut as firebaseSignOut } from 'firebase/auth';\r\n\r\nconst SCOPES = [\r\n    'https://www.googleapis.com/auth/userinfo.profile',\r\n    'https://www.googleapis.com/auth/userinfo.email',\r\n    'https://www.googleapis.com/auth/drive.file',\r\n];\r\n\r\nclass GoogleAuthService {\r\n    async init(): Promise<void> {\r\n        // Firebase handles initialization automatically\r\n        return Promise.resolve();\r\n    }\r\n\r\n    async signIn(): Promise<any> {\r\n        try {\r\n            const provider = new GoogleAuthProvider();\r\n            SCOPES.forEach(scope => provider.addScope(scope));\r\n\r\n            const result = await signInWithPopup(auth, provider);\r\n            const user = result.user;\r\n\r\n            // Get the Google Access Token (for Drive API)\r\n            const credential = GoogleAuthProvider.credentialFromResult(result);\r\n            const accessToken = credential?.accessToken;\r\n\r\n            if (accessToken) {\r\n                this.storeToken(accessToken);\r\n            }\r\n\r\n            return {\r\n                id: user.uid,\r\n                email: user.email,\r\n                name: user.displayName,\r\n                picture: user.photoURL,\r\n                accessToken: accessToken // Return this for immediate use if needed\r\n            };\r\n        } catch (error: any) {\r\n            console.error('‚ùå Firebase Sign-in Error:', error);\r\n            throw {\r\n                type: 'tokenFailed',\r\n                idpId: 'google',\r\n                error: error.message || 'server_error'\r\n            };\r\n        }\r\n    }\r\n\r\n    async signOut(): Promise<void> {\r\n        try {\r\n            await firebaseSignOut(auth);\r\n            localStorage.removeItem('google_access_token');\r\n            localStorage.removeItem('google_token_expiry');\r\n        } catch (error) {\r\n            console.error('Error signing out:', error);\r\n        }\r\n    }\r\n\r\n    // Helper to store access token manually if we need to pass it to GAPI later\r\n    // Note: Firebase manages its own ID tokens, but for Drive API we need the OAuth access token\r\n    private storeToken(token: string) {\r\n        // Expire in 1 hour (standard Google token life)\r\n        const expiresIn = 3600;\r\n        const expiryDate = new Date().getTime() + expiresIn * 1000;\r\n\r\n        localStorage.setItem('google_access_token', token);\r\n        localStorage.setItem('google_token_expiry', expiryDate.toString());\r\n    }\r\n\r\n    getAccessToken(): string | null {\r\n        const token = localStorage.getItem('google_access_token');\r\n        const expiry = localStorage.getItem('google_token_expiry');\r\n\r\n        if (!token || !expiry) return null;\r\n\r\n        if (new Date().getTime() > parseInt(expiry)) {\r\n            // Token expired. With Firebase, we might need to force a re-auth or use silent upgrade\r\n            // For now, return null to force re-login flow if strictly needed for Drive\r\n            return null;\r\n        }\r\n\r\n        return token;\r\n    }\r\n\r\n    // Helper to wait for Firebase to initialize valid auth state\r\n    private waitForAuth(): Promise<any> {\r\n        return new Promise((resolve) => {\r\n            const unsubscribe = auth.onAuthStateChanged((user) => {\r\n                unsubscribe();\r\n                resolve(user);\r\n            });\r\n        });\r\n    }\r\n\r\n    async isAuthenticated(): Promise<boolean> {\r\n        const user = await this.waitForAuth();\r\n        return !!user;\r\n    }\r\n\r\n    async getCurrentUser(): Promise<any> {\r\n        const user = await this.waitForAuth();\r\n        if (!user) return null;\r\n\r\n        return {\r\n            id: user.uid,\r\n            email: user.email,\r\n            name: user.displayName,\r\n            picture: user.photoURL\r\n        };\r\n    }\r\n}\r\n\r\n// Export singleton instance with the name expected by consumers\r\nexport const googleAuth = new GoogleAuthService();\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AAAA;;;AAEA,MAAM,SAAS;IACX;IACA;IACA;CACH;AAED,MAAM;IACF,MAAM,OAAsB;QACxB,gDAAgD;QAChD,OAAO,QAAQ,OAAO;IAC1B;IAEA,MAAM,SAAuB;QACzB,IAAI;YACA,MAAM,WAAW,IAAI,0MAAkB;YACvC,OAAO,OAAO,CAAC,CAAA,QAAS,SAAS,QAAQ,CAAC;YAE1C,MAAM,SAAS,MAAM,IAAA,uMAAe,EAAC,wJAAI,EAAE;YAC3C,MAAM,OAAO,OAAO,IAAI;YAExB,8CAA8C;YAC9C,MAAM,aAAa,0MAAkB,CAAC,oBAAoB,CAAC;YAC3D,MAAM,cAAc,YAAY;YAEhC,IAAI,aAAa;gBACb,IAAI,CAAC,UAAU,CAAC;YACpB;YAEA,OAAO;gBACH,IAAI,KAAK,GAAG;gBACZ,OAAO,KAAK,KAAK;gBACjB,MAAM,KAAK,WAAW;gBACtB,SAAS,KAAK,QAAQ;gBACtB,aAAa,YAAY,0CAA0C;YACvE;QACJ,EAAE,OAAO,OAAY;YACjB,QAAQ,KAAK,CAAC,6BAA6B;YAC3C,MAAM;gBACF,MAAM;gBACN,OAAO;gBACP,OAAO,MAAM,OAAO,IAAI;YAC5B;QACJ;IACJ;IAEA,MAAM,UAAyB;QAC3B,IAAI;YACA,MAAM,IAAA,+LAAe,EAAC,wJAAI;YAC1B,aAAa,UAAU,CAAC;YACxB,aAAa,UAAU,CAAC;QAC5B,EAAE,OAAO,OAAO;YACZ,QAAQ,KAAK,CAAC,sBAAsB;QACxC;IACJ;IAEA,4EAA4E;IAC5E,6FAA6F;IACrF,WAAW,KAAa,EAAE;QAC9B,gDAAgD;QAChD,MAAM,YAAY;QAClB,MAAM,aAAa,IAAI,OAAO,OAAO,KAAK,YAAY;QAEtD,aAAa,OAAO,CAAC,uBAAuB;QAC5C,aAAa,OAAO,CAAC,uBAAuB,WAAW,QAAQ;IACnE;IAEA,iBAAgC;QAC5B,MAAM,QAAQ,aAAa,OAAO,CAAC;QACnC,MAAM,SAAS,aAAa,OAAO,CAAC;QAEpC,IAAI,CAAC,SAAS,CAAC,QAAQ,OAAO;QAE9B,IAAI,IAAI,OAAO,OAAO,KAAK,SAAS,SAAS;YACzC,uFAAuF;YACvF,2EAA2E;YAC3E,OAAO;QACX;QAEA,OAAO;IACX;IAEA,6DAA6D;IACrD,cAA4B;QAChC,OAAO,IAAI,QAAQ,CAAC;YAChB,MAAM,cAAc,wJAAI,CAAC,kBAAkB,CAAC,CAAC;gBACzC;gBACA,QAAQ;YACZ;QACJ;IACJ;IAEA,MAAM,kBAAoC;QACtC,MAAM,OAAO,MAAM,IAAI,CAAC,WAAW;QACnC,OAAO,CAAC,CAAC;IACb;IAEA,MAAM,iBAA+B;QACjC,MAAM,OAAO,MAAM,IAAI,CAAC,WAAW;QACnC,IAAI,CAAC,MAAM,OAAO;QAElB,OAAO;YACH,IAAI,KAAK,GAAG;YACZ,OAAO,KAAK,KAAK;YACjB,MAAM,KAAK,WAAW;YACtB,SAAS,KAAK,QAAQ;QAC1B;IACJ;AACJ;AAGO,MAAM,aAAa,IAAI"}},
    {"offset": {"line": 1391, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Sande/OneDrive/Documents/GitHub/botbrains/botbrains-nextjs/src/lib/db.ts"],"sourcesContent":["'use client';\r\n\r\nimport Dexie, { type EntityTable } from 'dexie';\r\nimport type { Prompt, Category, Keyword, Profile, Workspace, GlobalVariableDefault } from '@/types';\r\n\r\n// Define database class\r\nclass BotBrainsDB extends Dexie {\r\n    prompts!: EntityTable<Prompt, 'id'>;\r\n    categories!: EntityTable<Category, 'id'>;\r\n    keywords!: EntityTable<Keyword, 'id'>;\r\n    profiles!: EntityTable<Profile, 'id'>;\r\n    workspaces!: EntityTable<Workspace, 'id'>;\r\n    globalVariableDefaults!: EntityTable<GlobalVariableDefault, 'id'>;\r\n\r\n    constructor() {\r\n        super('BotBrainsDB');\r\n\r\n        // Schema version 1 - initial\r\n        this.version(1).stores({\r\n            prompts: 'id, type, category, *tags, created_at, updated_at, order',\r\n        });\r\n\r\n        // Schema version 2 - add keywords support and new tables\r\n        this.version(2).stores({\r\n            prompts: 'id, type, category, *tags, *keywords, created_at, updated_at, order',\r\n            categories: 'id, name',\r\n            keywords: 'id, name',\r\n        });\r\n\r\n        // Schema version 3 - add Profile and Workspace support\r\n        this.version(3).stores({\r\n            prompts: 'id, workspaceId, type, category, *tags, *keywords, created_at, updated_at, order',\r\n            categories: 'id, workspaceId, name',\r\n            keywords: 'id, workspaceId, name',\r\n            profiles: 'id, googleId, email',\r\n            workspaces: 'id, profileId, name, isDefault',\r\n        });\r\n\r\n        // Schema version 4 - add Analytics and Favorites support\r\n        this.version(4).stores({\r\n            prompts: 'id, workspaceId, type, category, *tags, *keywords, created_at, updated_at, order, isFavorite, usageCount',\r\n            categories: 'id, workspaceId, name',\r\n            keywords: 'id, workspaceId, name',\r\n            profiles: 'id, googleId, email',\r\n            workspaces: 'id, profileId, name, isDefault',\r\n        });\r\n\r\n        // Schema version 5 - add Global Variable Defaults\r\n        this.version(5).stores({\r\n            prompts: 'id, workspaceId, type, category, *tags, *keywords, created_at, updated_at, order, isFavorite, usageCount',\r\n            categories: 'id, workspaceId, name',\r\n            keywords: 'id, workspaceId, name',\r\n            profiles: 'id, googleId, email',\r\n            workspaces: 'id, profileId, name, isDefault',\r\n            globalVariableDefaults: 'id, variableName',\r\n        });\r\n\r\n        // Schema version 6 - add content composition fields\r\n        this.version(6).stores({\r\n            prompts: 'id, workspaceId, type, category, *tags, *keywords, created_at, updated_at, order, isFavorite, usageCount, parentId, compositionMode',\r\n            categories: 'id, workspaceId, name',\r\n            keywords: 'id, workspaceId, name',\r\n            profiles: 'id, googleId, email',\r\n            workspaces: 'id, profileId, name, isDefault',\r\n            globalVariableDefaults: 'id, variableName',\r\n        });\r\n    }\r\n}\r\n\r\n// Create singleton instance\r\nexport const db = new BotBrainsDB();\r\n\r\n// Initialize database - only run in browser\r\nexport async function initDatabase() {\r\n    if (typeof window === 'undefined') {\r\n        console.log('‚è≠Ô∏è  Skipping database initialization on server');\r\n        return;\r\n    }\r\n\r\n    try {\r\n        await db.open();\r\n        console.log('‚úÖ Database initialized');\r\n    } catch (error) {\r\n        console.error('‚ùå Failed to initialize database:', error);\r\n        throw error;\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAEA;AAFA;;AAKA,wBAAwB;AACxB,MAAM,oBAAoB,gLAAK;IAC3B,QAAoC;IACpC,WAAyC;IACzC,SAAsC;IACtC,SAAsC;IACtC,WAA0C;IAC1C,uBAAkE;IAElE,aAAc;QACV,KAAK,CAAC;QAEN,6BAA6B;QAC7B,IAAI,CAAC,OAAO,CAAC,GAAG,MAAM,CAAC;YACnB,SAAS;QACb;QAEA,yDAAyD;QACzD,IAAI,CAAC,OAAO,CAAC,GAAG,MAAM,CAAC;YACnB,SAAS;YACT,YAAY;YACZ,UAAU;QACd;QAEA,uDAAuD;QACvD,IAAI,CAAC,OAAO,CAAC,GAAG,MAAM,CAAC;YACnB,SAAS;YACT,YAAY;YACZ,UAAU;YACV,UAAU;YACV,YAAY;QAChB;QAEA,yDAAyD;QACzD,IAAI,CAAC,OAAO,CAAC,GAAG,MAAM,CAAC;YACnB,SAAS;YACT,YAAY;YACZ,UAAU;YACV,UAAU;YACV,YAAY;QAChB;QAEA,kDAAkD;QAClD,IAAI,CAAC,OAAO,CAAC,GAAG,MAAM,CAAC;YACnB,SAAS;YACT,YAAY;YACZ,UAAU;YACV,UAAU;YACV,YAAY;YACZ,wBAAwB;QAC5B;QAEA,oDAAoD;QACpD,IAAI,CAAC,OAAO,CAAC,GAAG,MAAM,CAAC;YACnB,SAAS;YACT,YAAY;YACZ,UAAU;YACV,UAAU;YACV,YAAY;YACZ,wBAAwB;QAC5B;IACJ;AACJ;AAGO,MAAM,KAAK,IAAI;AAGf,eAAe;IAClB;;IAKA,IAAI;QACA,MAAM,GAAG,IAAI;QACb,QAAQ,GAAG,CAAC;IAChB,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,oCAAoC;QAClD,MAAM;IACV;AACJ"}},
    {"offset": {"line": 1475, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Sande/OneDrive/Documents/GitHub/botbrains/botbrains-nextjs/src/hooks/useToast.ts"],"sourcesContent":["import { create } from 'zustand';\r\n\r\nexport type ToastType = 'success' | 'error' | 'info';\r\n\r\nexport interface Toast {\r\n    id: string;\r\n    message: string;\r\n    type: ToastType;\r\n}\r\n\r\ninterface ToastStore {\r\n    toasts: Toast[];\r\n    addToast: (message: string, type: ToastType) => void;\r\n    removeToast: (id: string) => void;\r\n}\r\n\r\nexport const useToastStore = create<ToastStore>((set) => ({\r\n    toasts: [],\r\n\r\n    addToast: (message, type) => {\r\n        const id = Date.now().toString();\r\n        set((state) => ({\r\n            toasts: [...state.toasts, { id, message, type }],\r\n        }));\r\n\r\n        // Auto-remove after 3 seconds\r\n        setTimeout(() => {\r\n            set((state) => ({\r\n                toasts: state.toasts.filter((t) => t.id !== id),\r\n            }));\r\n        }, 3000);\r\n    },\r\n\r\n    removeToast: (id) => {\r\n        set((state) => ({\r\n            toasts: state.toasts.filter((t) => t.id !== id),\r\n        }));\r\n    },\r\n}));\r\n\r\n// Convenience hook\r\nexport function useToast() {\r\n    const addToast = useToastStore((state) => state.addToast);\r\n\r\n    return {\r\n        success: (message: string) => addToast(message, 'success'),\r\n        error: (message: string) => addToast(message, 'error'),\r\n        info: (message: string) => addToast(message, 'info'),\r\n    };\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;;AAgBO,MAAM,gBAAgB,IAAA,4KAAM,EAAa,CAAC,MAAQ,CAAC;QACtD,QAAQ,EAAE;QAEV,UAAU,CAAC,SAAS;YAChB,MAAM,KAAK,KAAK,GAAG,GAAG,QAAQ;YAC9B,IAAI,CAAC,QAAU,CAAC;oBACZ,QAAQ;2BAAI,MAAM,MAAM;wBAAE;4BAAE;4BAAI;4BAAS;wBAAK;qBAAE;gBACpD,CAAC;YAED,8BAA8B;YAC9B,WAAW;gBACP,IAAI,CAAC,QAAU,CAAC;wBACZ,QAAQ,MAAM,MAAM,CAAC,MAAM,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;oBAChD,CAAC;YACL,GAAG;QACP;QAEA,aAAa,CAAC;YACV,IAAI,CAAC,QAAU,CAAC;oBACZ,QAAQ,MAAM,MAAM,CAAC,MAAM,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;gBAChD,CAAC;QACL;IACJ,CAAC;AAGM,SAAS;;IACZ,MAAM,WAAW;4CAAc,CAAC,QAAU,MAAM,QAAQ;;IAExD,OAAO;QACH,SAAS,CAAC,UAAoB,SAAS,SAAS;QAChD,OAAO,CAAC,UAAoB,SAAS,SAAS;QAC9C,MAAM,CAAC,UAAoB,SAAS,SAAS;IACjD;AACJ;GARgB;;QACK"}},
    {"offset": {"line": 1534, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Sande/OneDrive/Documents/GitHub/botbrains/botbrains-nextjs/src/components/ui/Toast.tsx"],"sourcesContent":["import { X, CheckCircle, AlertCircle, Info } from 'lucide-react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { useToastStore } from '@/hooks/useToast';\r\n\r\nconst iconMap = {\r\n    success: CheckCircle,\r\n    error: AlertCircle,\r\n    info: Info,\r\n};\r\n\r\nconst colorMap = {\r\n    success: 'border-success/30 bg-success/5',\r\n    error: 'border-danger/30 bg-danger/5',\r\n    info: 'border-accent-primary/30 bg-accent-primary/5',\r\n};\r\n\r\nconst textColorMap = {\r\n    success: 'text-success',\r\n    error: 'text-danger',\r\n    info: 'text-accent-primary',\r\n};\r\n\r\nexport function ToastContainer() {\r\n    const toasts = useToastStore((state) => state.toasts);\r\n    const removeToast = useToastStore((state) => state.removeToast);\r\n\r\n    return (\r\n        <div className=\"fixed bottom-4 right-4 z-[100] space-y-3 pointer-events-none\">\r\n            <AnimatePresence>\r\n                {toasts.map((toast) => {\r\n                    const Icon = iconMap[toast.type];\r\n                    return (\r\n                        <motion.div\r\n                            key={toast.id}\r\n                            initial={{ opacity: 0, x: 100, scale: 0.8 }}\r\n                            animate={{ opacity: 1, x: 0, scale: 1 }}\r\n                            exit={{ opacity: 0, x: 50, scale: 0.9 }}\r\n                            transition={{ duration: 0.2 }}\r\n                            className=\"pointer-events-auto\"\r\n                        >\r\n                            <div className={`\r\n                                relative overflow-hidden\r\n                                bg-card border rounded-xl\r\n                                shadow-xl\r\n                                min-w-[320px] max-w-[400px]\r\n                                ${colorMap[toast.type]}\r\n                            `}>\r\n                                <div className=\"p-4 flex items-start gap-3\">\r\n                                    <Icon className={`w-5 h-5 flex-shrink-0 ${textColorMap[toast.type]}`} />\r\n                                    <p className=\"text-sm flex-1\">{toast.message}</p>\r\n                                    <button\r\n                                        onClick={() => removeToast(toast.id)}\r\n                                        className=\"text-secondary hover:text-primary transition-colors\"\r\n                                    >\r\n                                        <X className=\"w-4 h-4\" />\r\n                                    </button>\r\n                                </div>\r\n\r\n                                {/* Progress bar */}\r\n                                <motion.div\r\n                                    className={`absolute bottom-0 left-0 h-1 ${textColorMap[toast.type]}`}\r\n                                    style={{ backgroundColor: 'currentColor', opacity: 0.5 }}\r\n                                    initial={{ width: '100%' }}\r\n                                    animate={{ width: '0%' }}\r\n                                    transition={{ duration: 3, ease: 'linear' }}\r\n                                />\r\n                            </div>\r\n                        </motion.div>\r\n                    );\r\n                })}\r\n            </AnimatePresence>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;;;;;;AAEA,MAAM,UAAU;IACZ,SAAS,oQAAW;IACpB,OAAO,6PAAW;IAClB,MAAM,oOAAI;AACd;AAEA,MAAM,WAAW;IACb,SAAS;IACT,OAAO;IACP,MAAM;AACV;AAEA,MAAM,eAAe;IACjB,SAAS;IACT,OAAO;IACP,MAAM;AACV;AAEO,SAAS;;IACZ,MAAM,SAAS,IAAA,mKAAa;gDAAC,CAAC,QAAU,MAAM,MAAM;;IACpD,MAAM,cAAc,IAAA,mKAAa;qDAAC,CAAC,QAAU,MAAM,WAAW;;IAE9D,qBACI,oNAAC;QAAI,WAAU;kBACX,cAAA,oNAAC,sOAAe;sBACX,OAAO,GAAG,CAAC,CAAC;gBACT,MAAM,OAAO,OAAO,CAAC,MAAM,IAAI,CAAC;gBAChC,qBACI,oNAAC,8NAAM,CAAC,GAAG;oBAEP,SAAS;wBAAE,SAAS;wBAAG,GAAG;wBAAK,OAAO;oBAAI;oBAC1C,SAAS;wBAAE,SAAS;wBAAG,GAAG;wBAAG,OAAO;oBAAE;oBACtC,MAAM;wBAAE,SAAS;wBAAG,GAAG;wBAAI,OAAO;oBAAI;oBACtC,YAAY;wBAAE,UAAU;oBAAI;oBAC5B,WAAU;8BAEV,cAAA,oNAAC;wBAAI,WAAW,CAAC;;;;;gCAKb,EAAE,QAAQ,CAAC,MAAM,IAAI,CAAC,CAAC;4BAC3B,CAAC;;0CACG,oNAAC;gCAAI,WAAU;;kDACX,oNAAC;wCAAK,WAAW,CAAC,sBAAsB,EAAE,YAAY,CAAC,MAAM,IAAI,CAAC,EAAE;;;;;;kDACpE,oNAAC;wCAAE,WAAU;kDAAkB,MAAM,OAAO;;;;;;kDAC5C,oNAAC;wCACG,SAAS,IAAM,YAAY,MAAM,EAAE;wCACnC,WAAU;kDAEV,cAAA,oNAAC,2NAAC;4CAAC,WAAU;;;;;;;;;;;;;;;;;0CAKrB,oNAAC,8NAAM,CAAC,GAAG;gCACP,WAAW,CAAC,6BAA6B,EAAE,YAAY,CAAC,MAAM,IAAI,CAAC,EAAE;gCACrE,OAAO;oCAAE,iBAAiB;oCAAgB,SAAS;gCAAI;gCACvD,SAAS;oCAAE,OAAO;gCAAO;gCACzB,SAAS;oCAAE,OAAO;gCAAK;gCACvB,YAAY;oCAAE,UAAU;oCAAG,MAAM;gCAAS;;;;;;;;;;;;mBA/B7C,MAAM,EAAE;;;;;YAoCzB;;;;;;;;;;;AAIhB;GAnDgB;;QACG,mKAAa;QACR,mKAAa;;;KAFrB"}},
    {"offset": {"line": 1707, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Sande/OneDrive/Documents/GitHub/botbrains/botbrains-nextjs/app/providers.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useEffect, useState, ReactNode } from 'react';\r\nimport { useProfileStore } from '@/store/useProfileStore';\r\nimport { useWorkspaceStore } from '@/store/useWorkspaceStore';\r\nimport { usePromptStore } from '@/store/usePromptStore';\r\nimport { googleAuth } from '@/services/googleAuth';\r\nimport { initDatabase } from '@/lib/db';\r\nimport { ToastContainer } from '@/components/ui/Toast';\r\n\r\ninterface ProvidersProps {\r\n    children: ReactNode;\r\n}\r\n\r\nexport function Providers({ children }: ProvidersProps) {\r\n    const [isCheckingAuth, setIsCheckingAuth] = useState(true);\r\n    const [initError, setInitError] = useState<string | null>(null);\r\n    const { currentProfile, setCurrentProfile, loadProfiles, getOrCreateProfile } = useProfileStore();\r\n    const { loadWorkspaces, loadDefaultWorkspace, currentWorkspace } = useWorkspaceStore();\r\n    const { setWorkspace } = usePromptStore();\r\n\r\n    // Initialize database on mount\r\n    useEffect(() => {\r\n        const initApp = async () => {\r\n            try {\r\n                // Initialize database first\r\n                await initDatabase();\r\n\r\n                // Load all profiles\r\n                await loadProfiles();\r\n\r\n                // Check if user is authenticated with Google\r\n                const isAuth = await googleAuth.isAuthenticated();\r\n\r\n                if (isAuth) {\r\n                    const user = await googleAuth.getCurrentUser();\r\n                    if (user) {\r\n                        // Get or create profile\r\n                        const profile = await getOrCreateProfile(\r\n                            user.id,\r\n                            user.email,\r\n                            user.name,\r\n                            user.picture\r\n                        );\r\n\r\n                        setCurrentProfile(profile);\r\n\r\n                        // Load workspaces for this profile\r\n                        await loadWorkspaces(profile.id);\r\n\r\n                        // Load or create default workspace\r\n                        await loadDefaultWorkspace(profile.id);\r\n                    }\r\n                }\r\n            } catch (error) {\r\n                console.error('App initialization failed:', error);\r\n                setInitError(error instanceof Error ? error.message : 'Failed to initialize app');\r\n            } finally {\r\n                setIsCheckingAuth(false);\r\n            }\r\n        };\r\n\r\n        initApp();\r\n    }, [loadProfiles, getOrCreateProfile, setCurrentProfile, loadWorkspaces, loadDefaultWorkspace]);\r\n\r\n    // Update prompt workspace when workspace changes\r\n    useEffect(() => {\r\n        if (currentWorkspace) {\r\n            setWorkspace(currentWorkspace.id);\r\n        }\r\n    }, [currentWorkspace, setWorkspace]);\r\n\r\n    // Show loading while checking auth\r\n    if (isCheckingAuth) {\r\n        return (\r\n            <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-dark-900 via-dark-800 to-dark-900\">\r\n                <div className=\"text-center\">\r\n                    <div className=\"w-16 h-16 mx-auto mb-4 rounded-2xl bg-gradient-to-br from-primary-500 to-accent-500 flex items-center justify-center animate-pulse\">\r\n                        <span className=\"text-3xl\">üß†</span>\r\n                    </div>\r\n                    <p className=\"text-secondary\">Loading...</p>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // Show error if initialization failed\r\n    if (initError) {\r\n        return (\r\n            <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-dark-900 via-dark-800 to-dark-900 p-4\">\r\n                <div className=\"max-w-md w-full bg-dark-800/50 backdrop-blur-sm border border-dark-700 rounded-2xl p-8 shadow-2xl text-center\">\r\n                    <div className=\"w-16 h-16 mx-auto mb-4 rounded-2xl bg-gradient-to-br from-red-500 to-orange-500 flex items-center justify-center\">\r\n                        <span className=\"text-3xl\">‚ö†Ô∏è</span>\r\n                    </div>\r\n                    <h1 className=\"text-2xl font-bold text-white mb-2\">Initialization Error</h1>\r\n                    <p className=\"text-secondary mb-6\">Failed to load the application</p>\r\n                    <div className=\"bg-dark-900/50 rounded-lg p-3 mb-6\">\r\n                        <p className=\"text-sm font-mono text-red-400\">{initError}</p>\r\n                    </div>\r\n                    <button\r\n                        onClick={() => window.location.reload()}\r\n                        className=\"w-full px-6 py-3 bg-gradient-to-r from-primary-500 to-accent-500 text-white rounded-lg font-semibold hover:from-primary-600 hover:to-accent-600 transition-all\"\r\n                    >\r\n                        Reload Page\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <>\r\n            {children}\r\n            <ToastContainer />\r\n        </>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;AARA;;;;;;;;AAcO,SAAS,UAAU,EAAE,QAAQ,EAAkB;;IAClD,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,gMAAQ,EAAC;IACrD,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,gMAAQ,EAAgB;IAC1D,MAAM,EAAE,cAAc,EAAE,iBAAiB,EAAE,YAAY,EAAE,kBAAkB,EAAE,GAAG,IAAA,4KAAe;IAC/F,MAAM,EAAE,cAAc,EAAE,oBAAoB,EAAE,gBAAgB,EAAE,GAAG,IAAA,gLAAiB;IACpF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAA,0KAAc;IAEvC,+BAA+B;IAC/B,IAAA,iMAAS;+BAAC;YACN,MAAM;+CAAU;oBACZ,IAAI;wBACA,4BAA4B;wBAC5B,MAAM,IAAA,0JAAY;wBAElB,oBAAoB;wBACpB,MAAM;wBAEN,6CAA6C;wBAC7C,MAAM,SAAS,MAAM,qKAAU,CAAC,eAAe;wBAE/C,IAAI,QAAQ;4BACR,MAAM,OAAO,MAAM,qKAAU,CAAC,cAAc;4BAC5C,IAAI,MAAM;gCACN,wBAAwB;gCACxB,MAAM,UAAU,MAAM,mBAClB,KAAK,EAAE,EACP,KAAK,KAAK,EACV,KAAK,IAAI,EACT,KAAK,OAAO;gCAGhB,kBAAkB;gCAElB,mCAAmC;gCACnC,MAAM,eAAe,QAAQ,EAAE;gCAE/B,mCAAmC;gCACnC,MAAM,qBAAqB,QAAQ,EAAE;4BACzC;wBACJ;oBACJ,EAAE,OAAO,OAAO;wBACZ,QAAQ,KAAK,CAAC,8BAA8B;wBAC5C,aAAa,iBAAiB,QAAQ,MAAM,OAAO,GAAG;oBAC1D,SAAU;wBACN,kBAAkB;oBACtB;gBACJ;;YAEA;QACJ;8BAAG;QAAC;QAAc;QAAoB;QAAmB;QAAgB;KAAqB;IAE9F,iDAAiD;IACjD,IAAA,iMAAS;+BAAC;YACN,IAAI,kBAAkB;gBAClB,aAAa,iBAAiB,EAAE;YACpC;QACJ;8BAAG;QAAC;QAAkB;KAAa;IAEnC,mCAAmC;IACnC,IAAI,gBAAgB;QAChB,qBACI,oNAAC;YAAI,WAAU;sBACX,cAAA,oNAAC;gBAAI,WAAU;;kCACX,oNAAC;wBAAI,WAAU;kCACX,cAAA,oNAAC;4BAAK,WAAU;sCAAW;;;;;;;;;;;kCAE/B,oNAAC;wBAAE,WAAU;kCAAiB;;;;;;;;;;;;;;;;;IAI9C;IAEA,sCAAsC;IACtC,IAAI,WAAW;QACX,qBACI,oNAAC;YAAI,WAAU;sBACX,cAAA,oNAAC;gBAAI,WAAU;;kCACX,oNAAC;wBAAI,WAAU;kCACX,cAAA,oNAAC;4BAAK,WAAU;sCAAW;;;;;;;;;;;kCAE/B,oNAAC;wBAAG,WAAU;kCAAqC;;;;;;kCACnD,oNAAC;wBAAE,WAAU;kCAAsB;;;;;;kCACnC,oNAAC;wBAAI,WAAU;kCACX,cAAA,oNAAC;4BAAE,WAAU;sCAAkC;;;;;;;;;;;kCAEnD,oNAAC;wBACG,SAAS,IAAM,OAAO,QAAQ,CAAC,MAAM;wBACrC,WAAU;kCACb;;;;;;;;;;;;;;;;;IAMjB;IAEA,qBACI;;YACK;0BACD,oNAAC,6KAAc;;;;;;;AAG3B;GAtGgB;;QAGoE,4KAAe;QAC5B,gLAAiB;QAC3D,0KAAc;;;KAL3B"}},
    {"offset": {"line": 1932, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Sande/OneDrive/Documents/GitHub/botbrains/botbrains-nextjs/src/components/ui/Button.tsx"],"sourcesContent":["import { type ButtonHTMLAttributes, forwardRef } from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { Loader2 } from 'lucide-react';\r\n\r\nexport interface ButtonProps extends ButtonHTMLAttributes<HTMLButtonElement> {\r\n    variant?: 'primary' | 'secondary' | 'ghost' | 'danger';\r\n    size?: 'sm' | 'md' | 'lg';\r\n    isLoading?: boolean;\r\n}\r\n\r\nexport const Button = forwardRef<HTMLButtonElement, ButtonProps>(\r\n    ({ variant = 'primary', size = 'md', isLoading, className = '', children, disabled, ...props }, ref) => {\r\n        const baseStyles = `\r\n            inline-flex items-center justify-center gap-2 \r\n            font-medium rounded-md text-sm\r\n            transition-all duration-300 ease-out\r\n            focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 focus:ring-offset-background\r\n            disabled:opacity-50 disabled:cursor-not-allowed\r\n            relative overflow-hidden\r\n        `;\r\n\r\n        const variants = {\r\n            primary: `\r\n                bg-primary\r\n                hover:bg-primary/90\r\n                text-primary-foreground\r\n                shadow-md hover:shadow-lg\r\n                before:absolute before:inset-0 before:bg-gradient-to-br before:from-white/20 before:to-transparent before:opacity-0 hover:before:opacity-100 before:transition-opacity before:duration-300\r\n            `,\r\n            secondary: `\r\n                bg-secondary\r\n                hover:bg-secondary/80\r\n                text-secondary-foreground\r\n                border border-border\r\n                shadow-sm hover:shadow-md\r\n                hover:border-border/80\r\n            `,\r\n            ghost: `\r\n                hover:bg-muted\r\n                text-muted-foreground\r\n                hover:text-foreground\r\n                hover:shadow-sm\r\n            `,\r\n            danger: `\r\n                bg-destructive\r\n                hover:bg-destructive/90\r\n                text-destructive-foreground\r\n                shadow-md hover:shadow-lg\r\n            `,\r\n        };\r\n\r\n        const sizeStyles = {\r\n            sm: 'px-3 py-1.5 text-xs',\r\n            md: 'px-4 py-2',\r\n            lg: 'px-6 py-3 text-base',\r\n        };\r\n\r\n        const MotionButton = motion.button;\r\n\r\n        return (\r\n            <MotionButton\r\n                ref={ref}\r\n                whileHover={!disabled && !isLoading ? { y: -2, scale: 1.02 } : {}}\r\n                whileTap={!disabled && !isLoading ? { scale: 0.98, y: 0 } : {}}\r\n                transition={{ \r\n                    type: \"spring\",\r\n                    stiffness: 400,\r\n                    damping: 17\r\n                }}\r\n                className={`${baseStyles} ${variants[variant]} ${sizeStyles[size]} ${className}`}\r\n                disabled={disabled || isLoading}\r\n                {...(props as any)}\r\n            >\r\n                {isLoading && <Loader2 className=\"w-4 h-4 animate-spin\" />}\r\n                {children}\r\n            </MotionButton>\r\n        );\r\n    }\r\n);\r\n\r\nButton.displayName = 'Button';\r\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;;;;;AAQO,MAAM,uBAAS,IAAA,kMAAU,OAC5B,CAAC,EAAE,UAAU,SAAS,EAAE,OAAO,IAAI,EAAE,SAAS,EAAE,YAAY,EAAE,EAAE,QAAQ,EAAE,QAAQ,EAAE,GAAG,OAAO,EAAE;IAC5F,MAAM,aAAa,CAAC;;;;;;;QAOpB,CAAC;IAED,MAAM,WAAW;QACb,SAAS,CAAC;;;;;;YAMV,CAAC;QACD,WAAW,CAAC;;;;;;;YAOZ,CAAC;QACD,OAAO,CAAC;;;;;YAKR,CAAC;QACD,QAAQ,CAAC;;;;;YAKT,CAAC;IACL;IAEA,MAAM,aAAa;QACf,IAAI;QACJ,IAAI;QACJ,IAAI;IACR;IAEA,MAAM,eAAe,8NAAM,CAAC,MAAM;IAElC,qBACI,oNAAC;QACG,KAAK;QACL,YAAY,CAAC,YAAY,CAAC,YAAY;YAAE,GAAG,CAAC;YAAG,OAAO;QAAK,IAAI,CAAC;QAChE,UAAU,CAAC,YAAY,CAAC,YAAY;YAAE,OAAO;YAAM,GAAG;QAAE,IAAI,CAAC;QAC7D,YAAY;YACR,MAAM;YACN,WAAW;YACX,SAAS;QACb;QACA,WAAW,GAAG,WAAW,CAAC,EAAE,QAAQ,CAAC,QAAQ,CAAC,CAAC,EAAE,UAAU,CAAC,KAAK,CAAC,CAAC,EAAE,WAAW;QAChF,UAAU,YAAY;QACrB,GAAI,KAAK;;YAET,2BAAa,oNAAC,sPAAO;gBAAC,WAAU;;;;;;YAChC;;;;;;;AAGb;;AAGJ,OAAO,WAAW,GAAG"}},
    {"offset": {"line": 2034, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Sande/OneDrive/Documents/GitHub/botbrains/botbrains-nextjs/src/components/ErrorBoundary.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { Component, type ErrorInfo, type ReactNode } from 'react';\r\nimport { AlertTriangle, RefreshCw } from 'lucide-react';\r\nimport { Button } from '@/components/ui/Button';\r\n\r\ninterface Props {\r\n    children?: ReactNode;\r\n}\r\n\r\ninterface State {\r\n    hasError: boolean;\r\n    error: Error | null;\r\n    errorInfo: ErrorInfo | null;\r\n}\r\n\r\nexport class ErrorBoundary extends Component<Props, State> {\r\n    public state: State = {\r\n        hasError: false,\r\n        error: null,\r\n        errorInfo: null,\r\n    };\r\n\r\n    public static getDerivedStateFromError(error: Error): State {\r\n        return { hasError: true, error, errorInfo: null };\r\n    }\r\n\r\n    public componentDidCatch(error: Error, errorInfo: ErrorInfo) {\r\n        console.error('‚ùå ErrorBoundary caught an error:', error, errorInfo);\r\n        this.setState({\r\n            error,\r\n            errorInfo,\r\n        });\r\n    }\r\n\r\n    private handleReload = () => {\r\n        window.location.reload();\r\n    };\r\n\r\n    private handleReset = () => {\r\n        this.setState({\r\n            hasError: false,\r\n            error: null,\r\n            errorInfo: null,\r\n        });\r\n    };\r\n\r\n    public render() {\r\n        if (this.state.hasError) {\r\n            return (\r\n                <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-dark-900 via-dark-800 to-dark-900 p-4\">\r\n                    <div className=\"max-w-2xl w-full bg-dark-800/50 backdrop-blur-sm border border-dark-700 rounded-2xl p-8 shadow-2xl\">\r\n                        <div className=\"flex items-center gap-4 mb-6\">\r\n                            <div className=\"w-16 h-16 rounded-2xl bg-gradient-to-br from-red-500 to-orange-500 flex items-center justify-center flex-shrink-0\">\r\n                                <AlertTriangle className=\"w-8 h-8 text-white\" />\r\n                            </div>\r\n                            <div>\r\n                                <h1 className=\"text-2xl font-bold text-white mb-1\">Something went wrong</h1>\r\n                                <p className=\"text-secondary\">The application encountered an unexpected error</p>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"bg-dark-900/50 rounded-xl p-4 mb-6 border border-dark-700\">\r\n                            <p className=\"text-sm font-mono text-red-400 mb-2\">\r\n                                {this.state.error?.toString()}\r\n                            </p>\r\n                            {this.state.errorInfo && (\r\n                                <details className=\"mt-4\">\r\n                                    <summary className=\"text-sm font-semibold text-secondary cursor-pointer hover:text-primary transition-colors\">\r\n                                        Technical Details\r\n                                    </summary>\r\n                                    <pre className=\"mt-2 text-xs text-secondary overflow-auto max-h-64 p-2 bg-dark-800/50 rounded\">\r\n                                        {this.state.errorInfo.componentStack}\r\n                                    </pre>\r\n                                </details>\r\n                            )}\r\n                        </div>\r\n\r\n                        <div className=\"flex gap-3\">\r\n                            <Button\r\n                                onClick={this.handleReload}\r\n                                className=\"flex-1\"\r\n                            >\r\n                                <RefreshCw className=\"w-4 h-4 mr-2\" />\r\n                                Reload Page\r\n                            </Button>\r\n                            <Button\r\n                                onClick={this.handleReset}\r\n                                variant=\"ghost\"\r\n                                className=\"flex-1\"\r\n                            >\r\n                                Try Again\r\n                            </Button>\r\n                        </div>\r\n\r\n                        <div className=\"mt-6 p-4 bg-dark-900/30 border border-dark-700/50 rounded-lg\">\r\n                            <p className=\"text-sm text-secondary\">\r\n                                <strong className=\"text-white\">Tips:</strong>\r\n                            </p>\r\n                            <ul className=\"mt-2 space-y-1 text-sm text-secondary ml-4 list-disc\">\r\n                                <li>Try refreshing the page</li>\r\n                                <li>Check your internet connection</li>\r\n                                <li>Clear browser cache and reload</li>\r\n                                <li>Check console for more details (F12)</li>\r\n                            </ul>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            );\r\n        }\r\n\r\n        return this.props.children;\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AACA;AAJA;;;;;AAgBO,MAAM,sBAAsB,iMAAS;IACjC,QAAe;QAClB,UAAU;QACV,OAAO;QACP,WAAW;IACf,EAAE;IAEF,OAAc,yBAAyB,KAAY,EAAS;QACxD,OAAO;YAAE,UAAU;YAAM;YAAO,WAAW;QAAK;IACpD;IAEO,kBAAkB,KAAY,EAAE,SAAoB,EAAE;QACzD,QAAQ,KAAK,CAAC,oCAAoC,OAAO;QACzD,IAAI,CAAC,QAAQ,CAAC;YACV;YACA;QACJ;IACJ;IAEQ,eAAe;QACnB,OAAO,QAAQ,CAAC,MAAM;IAC1B,EAAE;IAEM,cAAc;QAClB,IAAI,CAAC,QAAQ,CAAC;YACV,UAAU;YACV,OAAO;YACP,WAAW;QACf;IACJ,EAAE;IAEK,SAAS;QACZ,IAAI,IAAI,CAAC,KAAK,CAAC,QAAQ,EAAE;YACrB,qBACI,oNAAC;gBAAI,WAAU;0BACX,cAAA,oNAAC;oBAAI,WAAU;;sCACX,oNAAC;4BAAI,WAAU;;8CACX,oNAAC;oCAAI,WAAU;8CACX,cAAA,oNAAC,mQAAa;wCAAC,WAAU;;;;;;;;;;;8CAE7B,oNAAC;;sDACG,oNAAC;4CAAG,WAAU;sDAAqC;;;;;;sDACnD,oNAAC;4CAAE,WAAU;sDAAiB;;;;;;;;;;;;;;;;;;sCAItC,oNAAC;4BAAI,WAAU;;8CACX,oNAAC;oCAAE,WAAU;8CACR,IAAI,CAAC,KAAK,CAAC,KAAK,EAAE;;;;;;gCAEtB,IAAI,CAAC,KAAK,CAAC,SAAS,kBACjB,oNAAC;oCAAQ,WAAU;;sDACf,oNAAC;4CAAQ,WAAU;sDAA2F;;;;;;sDAG9G,oNAAC;4CAAI,WAAU;sDACV,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,cAAc;;;;;;;;;;;;;;;;;;sCAMpD,oNAAC;4BAAI,WAAU;;8CACX,oNAAC,sKAAM;oCACH,SAAS,IAAI,CAAC,YAAY;oCAC1B,WAAU;;sDAEV,oNAAC,uPAAS;4CAAC,WAAU;;;;;;wCAAiB;;;;;;;8CAG1C,oNAAC,sKAAM;oCACH,SAAS,IAAI,CAAC,WAAW;oCACzB,SAAQ;oCACR,WAAU;8CACb;;;;;;;;;;;;sCAKL,oNAAC;4BAAI,WAAU;;8CACX,oNAAC;oCAAE,WAAU;8CACT,cAAA,oNAAC;wCAAO,WAAU;kDAAa;;;;;;;;;;;8CAEnC,oNAAC;oCAAG,WAAU;;sDACV,oNAAC;sDAAG;;;;;;sDACJ,oNAAC;sDAAG;;;;;;sDACJ,oNAAC;sDAAG;;;;;;sDACJ,oNAAC;sDAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;QAM5B;QAEA,OAAO,IAAI,CAAC,KAAK,CAAC,QAAQ;IAC9B;AACJ"}}]
}