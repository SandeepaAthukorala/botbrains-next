module.exports=[54799,(a,b,c)=>{b.exports=a.x("crypto",()=>require("crypto"))},47844,(a,b,c)=>{"use strict";var d,e,f;Object.defineProperty(c,"__esModule",{value:!0}),c.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=c.DEFAULT_MAX_SEND_MESSAGE_LENGTH=c.Propagate=c.LogVerbosity=c.Status=void 0,function(a){a[a.OK=0]="OK",a[a.CANCELLED=1]="CANCELLED",a[a.UNKNOWN=2]="UNKNOWN",a[a.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",a[a.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",a[a.NOT_FOUND=5]="NOT_FOUND",a[a.ALREADY_EXISTS=6]="ALREADY_EXISTS",a[a.PERMISSION_DENIED=7]="PERMISSION_DENIED",a[a.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",a[a.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",a[a.ABORTED=10]="ABORTED",a[a.OUT_OF_RANGE=11]="OUT_OF_RANGE",a[a.UNIMPLEMENTED=12]="UNIMPLEMENTED",a[a.INTERNAL=13]="INTERNAL",a[a.UNAVAILABLE=14]="UNAVAILABLE",a[a.DATA_LOSS=15]="DATA_LOSS",a[a.UNAUTHENTICATED=16]="UNAUTHENTICATED"}(d||(c.Status=d={})),function(a){a[a.DEBUG=0]="DEBUG",a[a.INFO=1]="INFO",a[a.ERROR=2]="ERROR",a[a.NONE=3]="NONE"}(e||(c.LogVerbosity=e={})),function(a){a[a.DEADLINE=1]="DEADLINE",a[a.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",a[a.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",a[a.CANCELLATION=8]="CANCELLATION",a[a.DEFAULTS=65535]="DEFAULTS"}(f||(c.Propagate=f={})),c.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1,c.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4194304},5365,(a,b,c)=>{b.exports=a.x("process",()=>require("process"))},85223,a=>{a.v({name:"@grpc/grpc-js",version:"1.9.15",description:"gRPC Library for Node - pure JS implementation",homepage:"https://grpc.io/",repository:"https://github.com/grpc/grpc-node/tree/master/packages/grpc-js",main:"build/src/index.js",engines:{node:"^8.13.0 || >=10.10.0"},keywords:[],author:{name:"Google Inc."},types:"build/src/index.d.ts",license:"Apache-2.0",devDependencies:{"@types/gulp":"^4.0.6","@types/gulp-mocha":"0.0.32","@types/lodash":"^4.14.186","@types/mocha":"^5.2.6","@types/ncp":"^2.0.1","@types/pify":"^3.0.2","@types/semver":"^7.3.9","@typescript-eslint/eslint-plugin":"^5.59.11","@typescript-eslint/parser":"^5.59.11","@typescript-eslint/typescript-estree":"^5.59.11","clang-format":"^1.0.55",eslint:"^8.42.0","eslint-config-prettier":"^8.8.0","eslint-plugin-node":"^11.1.0","eslint-plugin-prettier":"^4.2.1",execa:"^2.0.3",gulp:"^4.0.2","gulp-mocha":"^6.0.0",lodash:"^4.17.4",madge:"^5.0.1","mocha-jenkins-reporter":"^0.4.1",ncp:"^2.0.0",pify:"^4.0.1",prettier:"^2.8.8",rimraf:"^3.0.2",semver:"^7.3.5","ts-node":"^10.9.1",typescript:"^5.1.3"},contributors:[{name:"Google Inc."}],scripts:{build:"npm run compile",clean:"rimraf ./build",compile:"tsc -p .",format:'clang-format -i -style="{Language: JavaScript, BasedOnStyle: Google, ColumnLimit: 80}" src/*.ts test/*.ts',lint:"eslint src/*.ts test/*.ts",prepare:"npm run generate-types && npm run compile",test:"gulp test",check:"npm run lint",fix:"eslint --fix src/*.ts test/*.ts",pretest:"npm run generate-types && npm run generate-test-types && npm run compile",posttest:"npm run check && madge -c ./build/src","generate-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --includeDirs proto/ --include-dirs test/fixtures/ -O src/generated/ --grpcLib ../index channelz.proto","generate-test-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --include-dirs test/fixtures/ -O test/generated/ --grpcLib ../../src/index test_service.proto"},dependencies:{"@grpc/proto-loader":"^0.7.8","@types/node":">=12.12.47"},files:["src/**/*.ts","build/src/**/*.{js,d.ts,js.map}","proto/*.proto","LICENSE","deps/envoy-api/envoy/api/v2/**/*.proto","deps/envoy-api/envoy/config/**/*.proto","deps/envoy-api/envoy/service/**/*.proto","deps/envoy-api/envoy/type/**/*.proto","deps/udpa/udpa/**/*.proto","deps/googleapis/google/api/*.proto","deps/googleapis/google/rpc/*.proto","deps/protoc-gen-validate/validate/**/*.proto"]})},48520,(a,b,c)=>{"use strict";var d,e,f,g;Object.defineProperty(c,"__esModule",{value:!0}),c.isTracerEnabled=c.trace=c.log=c.setLoggerVerbosity=c.setLogger=c.getLogger=void 0;let h=a.r(47844),i=a.r(5365),j=a.r(85223).version,k={error:(a,...b)=>{console.error("E "+a,...b)},info:(a,...b)=>{console.error("I "+a,...b)},debug:(a,...b)=>{console.error("D "+a,...b)}},l=h.LogVerbosity.ERROR;switch((null!=(e=null!=(d=process.env.GRPC_NODE_VERBOSITY)?d:process.env.GRPC_VERBOSITY)?e:"").toUpperCase()){case"DEBUG":l=h.LogVerbosity.DEBUG;break;case"INFO":l=h.LogVerbosity.INFO;break;case"ERROR":l=h.LogVerbosity.ERROR;break;case"NONE":l=h.LogVerbosity.NONE}c.getLogger=()=>k,c.setLogger=a=>{k=a},c.setLoggerVerbosity=a=>{l=a},c.log=(a,...b)=>{let c;if(a>=l){switch(a){case h.LogVerbosity.DEBUG:c=k.debug;break;case h.LogVerbosity.INFO:c=k.info;break;case h.LogVerbosity.ERROR:c=k.error}c||(c=k.error),c&&c.bind(k)(...b)}};let m=null!=(g=null!=(f=process.env.GRPC_NODE_TRACE)?f:process.env.GRPC_TRACE)?g:"",n=new Set,o=new Set;for(let a of m.split(","))a.startsWith("-")?o.add(a.substring(1)):n.add(a);let p=n.has("all");function q(a,b,d){r(b)&&(0,c.log)(a,new Date().toISOString()+" | v"+j+" "+i.pid+" | "+b+" | "+d)}function r(a){return!o.has(a)&&(p||n.has(a))}c.trace=q,c.isTracerEnabled=r},78711,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.getErrorCode=c.getErrorMessage=void 0,c.getErrorMessage=function(a){return a instanceof Error?a.message:String(a)},c.getErrorCode=function(a){return"object"==typeof a&&null!==a&&"code"in a&&"number"==typeof a.code?a.code:null}},92240,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Metadata=void 0;let d=a.r(48520),e=a.r(47844),f=a.r(78711),g=/^[0-9a-z_.-]+$/,h=/^[ -~]*$/;function i(a){return g.test(a)}function j(a){return h.test(a)}function k(a){return a.endsWith("-bin")}function l(a){return!a.startsWith("grpc-")}function m(a){return a.toLowerCase()}function n(a,b){if(!i(a))throw Error('Metadata key "'+a+'" contains illegal characters');if(null!=b)if(k(a)){if(!Buffer.isBuffer(b))throw Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(b))throw Error("keys that don't end with '-bin' must have String values");if(!j(b))throw Error('Metadata string value "'+b+'" contains illegal characters')}}class o{constructor(a={}){this.internalRepr=new Map,this.options=a}set(a,b){n(a=m(a),b),this.internalRepr.set(a,[b])}add(a,b){n(a=m(a),b);let c=this.internalRepr.get(a);void 0===c?this.internalRepr.set(a,[b]):c.push(b)}remove(a){a=m(a),this.internalRepr.delete(a)}get(a){return a=m(a),this.internalRepr.get(a)||[]}getMap(){let a={};for(let[b,c]of this.internalRepr)if(c.length>0){let d=c[0];a[b]=Buffer.isBuffer(d)?Buffer.from(d):d}return a}clone(){let a=new o(this.options),b=a.internalRepr;for(let[a,c]of this.internalRepr){let d=c.map(a=>Buffer.isBuffer(a)?Buffer.from(a):a);b.set(a,d)}return a}merge(a){for(let[b,c]of a.internalRepr){let a=(this.internalRepr.get(b)||[]).concat(c);this.internalRepr.set(b,a)}}setOptions(a){this.options=a}getOptions(){return this.options}toHttp2Headers(){let a={};for(let[b,c]of this.internalRepr)a[b]=c.map(p);return a}toJSON(){let a={};for(let[b,c]of this.internalRepr)a[b]=c;return a}static fromHttp2Headers(a){let b=new o;for(let c of Object.keys(a)){if(":"===c.charAt(0))continue;let g=a[c];try{k(c)?Array.isArray(g)?g.forEach(a=>{b.add(c,Buffer.from(a,"base64"))}):void 0!==g&&(l(c)?g.split(",").forEach(a=>{b.add(c,Buffer.from(a.trim(),"base64"))}):b.add(c,Buffer.from(g,"base64"))):Array.isArray(g)?g.forEach(a=>{b.add(c,a)}):void 0!==g&&b.add(c,g)}catch(b){let a=`Failed to add metadata entry ${c}: ${g}. ${(0,f.getErrorMessage)(b)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,d.log)(e.LogVerbosity.ERROR,a)}}return b}}c.Metadata=o;let p=a=>Buffer.isBuffer(a)?a.toString("base64"):a},32375,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.CallCredentials=void 0;let d=a.r(92240);function e(a){return"getRequestHeaders"in a&&"function"==typeof a.getRequestHeaders}class f{static createFromMetadataGenerator(a){return new h(a)}static createFromGoogleCredential(a){return f.createFromMetadataGenerator((b,c)=>{let f;(f=e(a)?a.getRequestHeaders(b.service_url):new Promise((c,d)=>{a.getRequestMetadata(b.service_url,(a,b)=>{a?d(a):b?c(b):d(Error("Headers not set by metadata plugin"))})})).then(a=>{let b=new d.Metadata;for(let c of Object.keys(a))b.add(c,a[c]);c(null,b)},a=>{c(a)})})}static createEmpty(){return new i}}c.CallCredentials=f;class g extends f{constructor(a){super(),this.creds=a}async generateMetadata(a){let b=new d.Metadata;for(let c of(await Promise.all(this.creds.map(b=>b.generateMetadata(a)))))b.merge(c);return b}compose(a){return new g(this.creds.concat([a]))}_equals(a){return this===a||a instanceof g&&this.creds.every((b,c)=>b._equals(a.creds[c]))}}class h extends f{constructor(a){super(),this.metadataGenerator=a}generateMetadata(a){return new Promise((b,c)=>{this.metadataGenerator(a,(a,d)=>{void 0!==d?b(d):c(a)})})}compose(a){return new g([this,a])}_equals(a){return this===a||a instanceof h&&this.metadataGenerator===a.metadataGenerator}}class i extends f{generateMetadata(a){return Promise.resolve(new d.Metadata)}compose(a){return a}_equals(a){return a instanceof i}}},55004,(a,b,c)=>{b.exports=a.x("tls",()=>require("tls"))},22734,(a,b,c)=>{b.exports=a.x("fs",()=>require("fs"))},13043,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.getDefaultRootsData=c.CIPHER_SUITES=void 0;let d=a.r(22734);c.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;let e=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,f=null;c.getDefaultRootsData=function(){return e?(null===f&&(f=d.readFileSync(e)),f):null}},48728,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ChannelCredentials=void 0;let d=a.r(55004),e=a.r(32375),f=a.r(13043);function g(a,b){if(a&&!(a instanceof Buffer))throw TypeError(`${b}, if provided, must be a Buffer.`)}class h{constructor(a){this.callCredentials=a||e.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(a,b,c,e){var h;if(g(a,"Root certificate"),g(b,"Private key"),g(c,"Certificate chain"),b&&!c)throw Error("Private key must be given with accompanying certificate chain");if(!b&&c)throw Error("Certificate chain must be given with accompanying private key");return new j((0,d.createSecureContext)({ca:null!=(h=null!=a?a:(0,f.getDefaultRootsData)())?h:void 0,key:null!=b?b:void 0,cert:null!=c?c:void 0,ciphers:f.CIPHER_SUITES}),null!=e?e:{})}static createFromSecureContext(a,b){return new j(a,null!=b?b:{})}static createInsecure(){return new i}}c.ChannelCredentials=h;class i extends h{constructor(a){super(a)}compose(a){throw Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(a){return a instanceof i}}class j extends h{constructor(a,b){super(),this.secureContext=a,this.verifyOptions=b,this.connectionOptions={secureContext:a},(null==b?void 0:b.checkServerIdentity)&&(this.connectionOptions.checkServerIdentity=b.checkServerIdentity)}compose(a){return new k(this,this.callCredentials.compose(a))}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(a){return this===a||a instanceof j&&this.secureContext===a.secureContext&&this.verifyOptions.checkServerIdentity===a.verifyOptions.checkServerIdentity}}class k extends h{constructor(a,b){super(b),this.channelCredentials=a}compose(a){let b=this.callCredentials.compose(a);return new k(this.channelCredentials,b)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(a){return this===a||a instanceof k&&this.channelCredentials._equals(a.channelCredentials)&&this.callCredentials._equals(a.callCredentials)}}},53590,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.validateLoadBalancingConfig=c.getFirstUsableConfig=c.isLoadBalancerNameRegistered=c.createLoadBalancer=c.registerDefaultLoadBalancerType=c.registerLoadBalancerType=c.createChildChannelControlHelper=void 0,c.createChildChannelControlHelper=function(a,b){var c,d,e,f,g,h,i,j,k,l;return{createSubchannel:null!=(d=null==(c=b.createSubchannel)?void 0:c.bind(b))?d:a.createSubchannel.bind(a),updateState:null!=(f=null==(e=b.updateState)?void 0:e.bind(b))?f:a.updateState.bind(a),requestReresolution:null!=(h=null==(g=b.requestReresolution)?void 0:g.bind(b))?h:a.requestReresolution.bind(a),addChannelzChild:null!=(j=null==(i=b.addChannelzChild)?void 0:i.bind(b))?j:a.addChannelzChild.bind(a),removeChannelzChild:null!=(l=null==(k=b.removeChannelzChild)?void 0:k.bind(b))?l:a.removeChannelzChild.bind(a)}};let d={},e=null;c.registerLoadBalancerType=function(a,b,c){d[a]={LoadBalancer:b,LoadBalancingConfig:c}},c.registerDefaultLoadBalancerType=function(a){e=a},c.createLoadBalancer=function(a,b){let c=a.getLoadBalancerName();return c in d?new d[c].LoadBalancer(b):null},c.isLoadBalancerNameRegistered=function(a){return a in d},c.getFirstUsableConfig=function(a,b=!1){for(let b of a)if(b.getLoadBalancerName()in d)return b;return b&&e?new d[e].LoadBalancingConfig:null},c.validateLoadBalancingConfig=function(a){if(null===a||"object"!=typeof a)throw Error("Load balancing config must be an object");let b=Object.keys(a);if(1!==b.length)throw Error("Provided load balancing config has multiple conflicting entries");let c=b[0];if(c in d)return d[c].LoadBalancingConfig.createFromJson(a[c]);throw Error(`Unrecognized load balancing config name ${c}`)}},46786,(a,b,c)=>{b.exports=a.x("os",()=>require("os"))},98132,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.extractAndSelectServiceConfig=c.validateServiceConfig=c.validateRetryThrottling=void 0;let d=a.r(46786),e=a.r(47844),f=a.r(53590),g=/^\d+(\.\d{1,9})?s$/,h="node";function i(a){if("service"in a&&""!==a.service){if("string"!=typeof a.service)throw Error(`Invalid method config name: invalid service: expected type string, got ${typeof a.service}`);if(!("method"in a)||""===a.method)return{service:a.service};if("string"!=typeof a.method)throw Error(`Invalid method config name: invalid method: expected type string, got ${typeof a.service}`);return{service:a.service,method:a.method}}if("method"in a&&void 0!==a.method)throw Error("Invalid method config name: method set with empty or unset service");return{}}function j(a){if(!("maxAttempts"in a)||!Number.isInteger(a.maxAttempts)||a.maxAttempts<2)throw Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in a)||"string"!=typeof a.initialBackoff||!g.test(a.initialBackoff))throw Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in a)||"string"!=typeof a.maxBackoff||!g.test(a.maxBackoff))throw Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in a)||"number"!=typeof a.backoffMultiplier||a.backoffMultiplier<=0)throw Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in a&&Array.isArray(a.retryableStatusCodes)))throw Error("Invalid method config retry policy: retryableStatusCodes is required");if(0===a.retryableStatusCodes.length)throw Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let b of a.retryableStatusCodes)if("number"==typeof b){if(!Object.values(e.Status).includes(b))throw Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if("string"==typeof b){if(!Object.values(e.Status).includes(b.toUpperCase()))throw Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:a.maxAttempts,initialBackoff:a.initialBackoff,maxBackoff:a.maxBackoff,backoffMultiplier:a.backoffMultiplier,retryableStatusCodes:a.retryableStatusCodes}}function k(a){if(!("maxAttempts"in a)||!Number.isInteger(a.maxAttempts)||a.maxAttempts<2)throw Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in a&&("string"!=typeof a.hedgingDelay||!g.test(a.hedgingDelay)))throw Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in a&&Array.isArray(a.nonFatalStatusCodes))for(let b of a.nonFatalStatusCodes)if("number"==typeof b){if(!Object.values(e.Status).includes(b))throw Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if("string"==typeof b){if(!Object.values(e.Status).includes(b.toUpperCase()))throw Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let b={maxAttempts:a.maxAttempts};return a.hedgingDelay&&(b.hedgingDelay=a.hedgingDelay),a.nonFatalStatusCodes&&(b.nonFatalStatusCodes=a.nonFatalStatusCodes),b}function l(a){var b;let c={name:[]};if(!("name"in a)||!Array.isArray(a.name))throw Error("Invalid method config: invalid name array");for(let b of a.name)c.name.push(i(b));if("waitForReady"in a){if("boolean"!=typeof a.waitForReady)throw Error("Invalid method config: invalid waitForReady");c.waitForReady=a.waitForReady}if("timeout"in a)if("object"==typeof a.timeout){if(!("seconds"in a.timeout)||"number"!=typeof a.timeout.seconds)throw Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in a.timeout)||"number"!=typeof a.timeout.nanos)throw Error("Invalid method config: invalid timeout.nanos");c.timeout=a.timeout}else if("string"==typeof a.timeout&&g.test(a.timeout)){let d=a.timeout.substring(0,a.timeout.length-1).split(".");c.timeout={seconds:0|d[0],nanos:(null!=(b=d[1])?b:0)|0}}else throw Error("Invalid method config: invalid timeout");if("maxRequestBytes"in a){if("number"!=typeof a.maxRequestBytes)throw Error("Invalid method config: invalid maxRequestBytes");c.maxRequestBytes=a.maxRequestBytes}if("maxResponseBytes"in a){if("number"!=typeof a.maxResponseBytes)throw Error("Invalid method config: invalid maxRequestBytes");c.maxResponseBytes=a.maxResponseBytes}if("retryPolicy"in a)if("hedgingPolicy"in a)throw Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");else c.retryPolicy=j(a.retryPolicy);else"hedgingPolicy"in a&&(c.hedgingPolicy=k(a.hedgingPolicy));return c}function m(a){if(!("maxTokens"in a)||"number"!=typeof a.maxTokens||a.maxTokens<=0||a.maxTokens>1e3)throw Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in a)||"number"!=typeof a.tokenRatio||a.tokenRatio<=0)throw Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+a.maxTokens.toFixed(3),tokenRatio:+a.tokenRatio.toFixed(3)}}function n(a){let b={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in a)if("string"==typeof a.loadBalancingPolicy)b.loadBalancingPolicy=a.loadBalancingPolicy;else throw Error("Invalid service config: invalid loadBalancingPolicy");if("loadBalancingConfig"in a)if(Array.isArray(a.loadBalancingConfig))for(let c of a.loadBalancingConfig)b.loadBalancingConfig.push((0,f.validateLoadBalancingConfig)(c));else throw Error("Invalid service config: invalid loadBalancingConfig");if("methodConfig"in a&&Array.isArray(a.methodConfig))for(let c of a.methodConfig)b.methodConfig.push(l(c));"retryThrottling"in a&&(b.retryThrottling=m(a.retryThrottling));let c=[];for(let a of b.methodConfig)for(let b of a.name){for(let a of c)if(b.service===a.service&&b.method===a.method)throw Error(`Invalid service config: duplicate name ${b.service}/${b.method}`);c.push(b)}return b}function o(a){if(!("serviceConfig"in a))throw Error("Invalid service config choice: missing service config");let b={serviceConfig:n(a.serviceConfig)};if("clientLanguage"in a)if(Array.isArray(a.clientLanguage))for(let c of(b.clientLanguage=[],a.clientLanguage))if("string"==typeof c)b.clientLanguage.push(c);else throw Error("Invalid service config choice: invalid clientLanguage");else throw Error("Invalid service config choice: invalid clientLanguage");if("clientHostname"in a)if(Array.isArray(a.clientHostname))for(let c of(b.clientHostname=[],a.clientHostname))if("string"==typeof c)b.clientHostname.push(c);else throw Error("Invalid service config choice: invalid clientHostname");else throw Error("Invalid service config choice: invalid clientHostname");if("percentage"in a)if("number"==typeof a.percentage&&0<=a.percentage&&a.percentage<=100)b.percentage=a.percentage;else throw Error("Invalid service config choice: invalid percentage");let c=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let b in a)if(!c.includes(b))throw Error(`Invalid service config choice: unexpected field ${b}`);return b}function p(a,b){if(!Array.isArray(a))throw Error("Invalid service config list");for(let c of a){let a=o(c);if("number"!=typeof a.percentage||!(b>a.percentage)){if(Array.isArray(a.clientHostname)){let b=!1;for(let c of a.clientHostname)c===d.hostname()&&(b=!0);if(!b)continue}if(Array.isArray(a.clientLanguage)){let b=!1;for(let c of a.clientLanguage)c===h&&(b=!0);if(!b)continue}return a.serviceConfig}}throw Error("No matching service config found")}c.validateRetryThrottling=m,c.validateServiceConfig=n,c.extractAndSelectServiceConfig=function(a,b){for(let c of a)if(c.length>0&&c[0].startsWith("grpc_config="))return p(JSON.parse(c.join("").substring(12)),b);return null}},69374,(a,b,c)=>{"use strict";var d;Object.defineProperty(c,"__esModule",{value:!0}),c.ConnectivityState=void 0,function(a){a[a.IDLE=0]="IDLE",a[a.CONNECTING=1]="CONNECTING",a[a.READY=2]="READY",a[a.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",a[a.SHUTDOWN=4]="SHUTDOWN"}(d||(c.ConnectivityState=d={}))},22087,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.uriToString=c.splitHostPort=c.parseUri=void 0;let d=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;c.parseUri=function(a){let b=d.exec(a);return null===b?null:{scheme:b[1],authority:b[2],path:b[3]}};let e=/^\d+$/;c.splitHostPort=function(a){if(a.startsWith("[")){let b=a.indexOf("]");if(-1===b)return null;let c=a.substring(1,b);if(-1===c.indexOf(":"))return null;if(!(a.length>b+1))return{host:c};if(":"!==a[b+1])return null;{let d=a.substring(b+2);return e.test(d)?{host:c,port:+d}:null}}{let b=a.split(":");return 2!==b.length?{host:a}:e.test(b[1])?{host:b[0],port:+b[1]}:null}},c.uriToString=function(a){let b="";return void 0!==a.scheme&&(b+=a.scheme+":"),void 0!==a.authority&&(b+="//"+a.authority+"/"),b+=a.path}},91539,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.mapUriDefaultScheme=c.getDefaultAuthority=c.createResolver=c.registerDefaultScheme=c.registerResolver=void 0;let d=a.r(22087),e={},f=null;c.registerResolver=function(a,b){e[a]=b},c.registerDefaultScheme=function(a){f=a},c.createResolver=function(a,b,c){if(void 0!==a.scheme&&a.scheme in e)return new e[a.scheme](a,b,c);throw Error(`No resolver could be created for target ${(0,d.uriToString)(a)}`)},c.getDefaultAuthority=function(a){if(void 0!==a.scheme&&a.scheme in e)return e[a.scheme].getDefaultAuthority(a);throw Error(`Invalid target ${(0,d.uriToString)(a)}`)},c.mapUriDefaultScheme=function(a){if(void 0===a.scheme||!(a.scheme in e))if(null!==f)return{scheme:f,authority:void 0,path:(0,d.uriToString)(a)};else return null;return a}},6483,(a,b,c)=>{"use strict";var d;Object.defineProperty(c,"__esModule",{value:!0}),c.QueuePicker=c.UnavailablePicker=c.PickResultType=void 0;let e=a.r(92240),f=a.r(47844);!function(a){a[a.COMPLETE=0]="COMPLETE",a[a.QUEUE=1]="QUEUE",a[a.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",a[a.DROP=3]="DROP"}(d||(c.PickResultType=d={}));class g{constructor(a){this.status=Object.assign({code:f.Status.UNAVAILABLE,details:"No connection established",metadata:new e.Metadata},a)}pick(a){return{pickResultType:d.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}}c.UnavailablePicker=g;class h{constructor(a){this.loadBalancer=a,this.calledExitIdle=!1}pick(a){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:d.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}}c.QueuePicker=h},39984,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.BackoffTimeout=void 0;let d=1e3,e=1.6,f=12e4,g=.2;function h(a,b){return Math.random()*(b-a)+a}class i{constructor(a,b){this.callback=a,this.initialDelay=d,this.multiplier=e,this.maxDelay=f,this.jitter=g,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,b&&(b.initialDelay&&(this.initialDelay=b.initialDelay),b.multiplier&&(this.multiplier=b.multiplier),b.jitter&&(this.jitter=b.jitter),b.maxDelay&&(this.maxDelay=b.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(a){var b,c;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},a),this.hasRef||null==(c=(b=this.timerId).unref)||c.call(b)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let a=Math.min(this.nextDelay*this.multiplier,this.maxDelay),b=a*this.jitter;this.nextDelay=a+h(-b,b)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let a=new Date,b=this.startTime;b.setMilliseconds(b.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),a<b?this.runTimer(b.getTime()-a.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var a,b;this.hasRef=!0,null==(b=(a=this.timerId).ref)||b.call(a)}unref(){var a,b;this.hasRef=!1,null==(b=(a=this.timerId).unref)||b.call(a)}getEndTime(){return this.endTime}}c.BackoffTimeout=i},16338,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ChildLoadBalancerHandler=void 0;let d=a.r(53590),e=a.r(69374),f="child_load_balancer_helper";class g{constructor(a){this.channelControlHelper=a,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(a){this.parent=a,this.child=null}createSubchannel(a,b){return this.parent.channelControlHelper.createSubchannel(a,b)}updateState(a,b){var c;if(this.calledByPendingChild()){if(a===e.ConnectivityState.CONNECTING)return;null==(c=this.parent.currentChild)||c.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(a,b)}requestReresolution(){var a;let b=null!=(a=this.parent.pendingChild)?a:this.parent.currentChild;this.child===b&&this.parent.channelControlHelper.requestReresolution()}setChild(a){this.child=a}addChannelzChild(a){this.parent.channelControlHelper.addChannelzChild(a)}removeChannelzChild(a){this.parent.channelControlHelper.removeChannelzChild(a)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(a,b){return a.getLoadBalancerName()!==b.getLoadBalancerName()}updateAddressList(a,b,c){let e;if(null===this.currentChild||null===this.latestConfig||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,b)){let a=new this.ChildPolicyHelper(this),c=(0,d.createLoadBalancer)(b,a);a.setChild(c),null===this.currentChild?(this.currentChild=c,e=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=c,e=this.pendingChild)}else e=null===this.pendingChild?this.currentChild:this.pendingChild;this.latestConfig=b,e.updateAddressList(a,b,c)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return f}}c.ChildLoadBalancerHandler=g},54849,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ResolvingLoadBalancer=void 0;let d=a.r(53590),e=a.r(98132),f=a.r(69374),g=a.r(91539),h=a.r(6483),i=a.r(39984),j=a.r(47844),k=a.r(92240),l=a.r(48520),m=a.r(47844),n=a.r(22087),o=a.r(16338),p="resolving_load_balancer";function q(a){l.trace(m.LogVerbosity.DEBUG,p,a)}let r=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function s(a,b,c,d){for(let e of c.name)switch(d){case"EMPTY":if(!e.service&&!e.method)return!0;break;case"SERVICE":if(e.service===a&&!e.method)return!0;break;case"SERVICE_AND_METHOD":if(e.service===a&&e.method===b)return!0}return!1}function t(a,b,c,d){for(let e of c)if(s(a,b,e,d))return e;return null}function u(a){return function(b,c){var d,e;let f=b.split("/").filter(a=>a.length>0),g=null!=(d=f[0])?d:"",h=null!=(e=f[1])?e:"";if(a&&a.methodConfig)for(let b of r){let c=t(g,h,a.methodConfig,b);if(c)return{methodConfig:c,pickInformation:{},status:j.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:j.Status.OK,dynamicFilterFactories:[]}}}class v{constructor(a,b,c,l,m){this.target=a,this.channelControlHelper=b,this.onSuccessfulResolution=l,this.onFailedResolution=m,this.latestChildState=f.ConnectivityState.IDLE,this.latestChildPicker=new h.QueuePicker(this),this.currentState=f.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,c["grpc.service_config"]?this.defaultServiceConfig=(0,e.validateServiceConfig)(JSON.parse(c["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(f.ConnectivityState.IDLE,new h.QueuePicker(this)),this.childLoadBalancer=new o.ChildLoadBalancerHandler({createSubchannel:b.createSubchannel.bind(b),requestReresolution:()=>{this.backoffTimeout.isRunning()?(q("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(a,b)=>{this.latestChildState=a,this.latestChildPicker=b,this.updateState(a,b)},addChannelzChild:b.addChannelzChild.bind(b),removeChannelzChild:b.removeChannelzChild.bind(b)}),this.innerResolver=(0,g.createResolver)(a,{onSuccessfulResolution:(a,b,c,e,f)=>{var g;this.backoffTimeout.stop(),this.backoffTimeout.reset();let h=null;null===b?null===c?(this.previousServiceConfig=null,h=this.defaultServiceConfig):null===this.previousServiceConfig?this.handleResolutionFailure(c):h=this.previousServiceConfig:(h=b,this.previousServiceConfig=b);let i=null!=(g=null==h?void 0:h.loadBalancingConfig)?g:[],l=(0,d.getFirstUsableConfig)(i,!0);if(null===l)return void this.handleResolutionFailure({code:j.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new k.Metadata});this.childLoadBalancer.updateAddressList(a,l,f);let m=null!=h?h:this.defaultServiceConfig;this.onSuccessfulResolution(m,null!=e?e:u(m))},onError:a=>{this.handleResolutionFailure(a)}},c);const n={initialDelay:c["grpc.initial_reconnect_backoff_ms"],maxDelay:c["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new i.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},n),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===f.ConnectivityState.IDLE&&this.updateState(f.ConnectivityState.CONNECTING,new h.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState(a,b){q((0,n.uriToString)(this.target)+" "+f.ConnectivityState[this.currentState]+" -> "+f.ConnectivityState[a]),a===f.ConnectivityState.IDLE&&(b=new h.QueuePicker(this)),this.currentState=a,this.channelControlHelper.updateState(a,b)}handleResolutionFailure(a){this.latestChildState===f.ConnectivityState.IDLE&&(this.updateState(f.ConnectivityState.TRANSIENT_FAILURE,new h.UnavailablePicker(a)),this.onFailedResolution(a))}exitIdle(){(this.currentState===f.ConnectivityState.IDLE||this.currentState===f.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(a,b){throw Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=f.ConnectivityState.IDLE,this.latestChildPicker=new h.QueuePicker(this),this.currentState=f.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}}c.ResolvingLoadBalancer=v},8358,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.channelOptionsEqual=c.recognizedOptions=void 0,c.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0},c.channelOptionsEqual=function(a,b){let c=Object.keys(a).sort(),d=Object.keys(b).sort();if(c.length!==d.length)return!1;for(let e=0;e<c.length;e+=1)if(c[e]!==d[e]||a[c[e]]!==b[d[e]])return!1;return!0}},4446,(a,b,c)=>{b.exports=a.x("net",()=>require("net"))},49271,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.stringToSubchannelAddress=c.subchannelAddressToString=c.subchannelAddressEqual=c.isTcpSubchannelAddress=void 0;let d=a.r(4446);function e(a){return"port"in a}c.isTcpSubchannelAddress=e,c.subchannelAddressEqual=function(a,b){return!a&&!b||!!a&&!!b&&(e(a)?e(b)&&a.host===b.host&&a.port===b.port:!e(b)&&a.path===b.path)},c.subchannelAddressToString=function(a){return e(a)?a.host+":"+a.port:a.path};let f=443;c.stringToSubchannelAddress=function(a,b){return(0,d.isIP)(a)?{host:a,port:null!=b?b:f}:{path:a}}},95666,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.addAdminServicesToServer=c.registerAdminService=void 0;let d=[];c.registerAdminService=function(a,b){d.push({getServiceDefinition:a,getHandlers:b})},c.addAdminServicesToServer=function(a){for(let{getServiceDefinition:b,getHandlers:c}of d)a.addService(b(),c())}},27699,(a,b,c)=>{b.exports=a.x("events",()=>require("events"))},88947,(a,b,c)=>{b.exports=a.x("stream",()=>require("stream"))},46456,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ClientDuplexStreamImpl=c.ClientWritableStreamImpl=c.ClientReadableStreamImpl=c.ClientUnaryCallImpl=c.callErrorFromStatus=void 0;let d=a.r(27699),e=a.r(88947),f=a.r(47844);c.callErrorFromStatus=function(a,b){let c=`${a.code} ${f.Status[a.code]}: ${a.details}`,d=Error(c),e=`${d.stack}
for call at
${b}`;return Object.assign(Error(c),a,{stack:e})};class g extends d.EventEmitter{constructor(){super()}cancel(){var a;null==(a=this.call)||a.cancelWithStatus(f.Status.CANCELLED,"Cancelled on client")}getPeer(){var a,b;return null!=(b=null==(a=this.call)?void 0:a.getPeer())?b:"unknown"}}c.ClientUnaryCallImpl=g;class h extends e.Readable{constructor(a){super({objectMode:!0}),this.deserialize=a}cancel(){var a;null==(a=this.call)||a.cancelWithStatus(f.Status.CANCELLED,"Cancelled on client")}getPeer(){var a,b;return null!=(b=null==(a=this.call)?void 0:a.getPeer())?b:"unknown"}_read(a){var b;null==(b=this.call)||b.startRead()}}c.ClientReadableStreamImpl=h;class i extends e.Writable{constructor(a){super({objectMode:!0}),this.serialize=a}cancel(){var a;null==(a=this.call)||a.cancelWithStatus(f.Status.CANCELLED,"Cancelled on client")}getPeer(){var a,b;return null!=(b=null==(a=this.call)?void 0:a.getPeer())?b:"unknown"}_write(a,b,c){var d;let e={callback:c},f=Number(b);Number.isNaN(f)||(e.flags=f),null==(d=this.call)||d.sendMessageWithContext(e,a)}_final(a){var b;null==(b=this.call)||b.halfClose(),a()}}c.ClientWritableStreamImpl=i;class j extends e.Duplex{constructor(a,b){super({objectMode:!0}),this.serialize=a,this.deserialize=b}cancel(){var a;null==(a=this.call)||a.cancelWithStatus(f.Status.CANCELLED,"Cancelled on client")}getPeer(){var a,b;return null!=(b=null==(a=this.call)?void 0:a.getPeer())?b:"unknown"}_read(a){var b;null==(b=this.call)||b.startRead()}_write(a,b,c){var d;let e={callback:c},f=Number(b);Number.isNaN(f)||(e.flags=f),null==(d=this.call)||d.sendMessageWithContext(e,a)}_final(a){var b;null==(b=this.call)||b.halfClose(),a()}}c.ClientDuplexStreamImpl=j},48212,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.InterceptingListenerImpl=c.isInterceptingListener=void 0,c.isInterceptingListener=function(a){return void 0!==a.onReceiveMetadata&&1===a.onReceiveMetadata.length};class d{constructor(a,b){this.listener=a,this.nextListener=b,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(a){this.processingMetadata=!0,this.listener.onReceiveMetadata(a,a=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(a),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(a){this.processingMessage=!0,this.listener.onReceiveMessage(a,a=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=a,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(a),this.processPendingStatus())})}onReceiveStatus(a){this.listener.onReceiveStatus(a,a=>{this.processingMetadata||this.processingMessage?this.pendingStatus=a:this.nextListener.onReceiveStatus(a)})}}c.InterceptingListenerImpl=d},53252,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.getInterceptingCall=c.InterceptingCall=c.RequesterBuilder=c.ListenerBuilder=c.InterceptorConfigurationError=void 0;let d=a.r(92240),e=a.r(48212),f=a.r(47844),g=a.r(78711);class h extends Error{constructor(a){super(a),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,h)}}c.InterceptorConfigurationError=h;class i{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(a){return this.metadata=a,this}withOnReceiveMessage(a){return this.message=a,this}withOnReceiveStatus(a){return this.status=a,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}}c.ListenerBuilder=i;class j{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(a){return this.start=a,this}withSendMessage(a){return this.message=a,this}withHalfClose(a){return this.halfClose=a,this}withCancel(a){return this.cancel=a,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}}c.RequesterBuilder=j;let k=(a,b)=>{b(a)},l=(a,b)=>{b(a)},m=(a,b)=>{b(a)},n={start:(a,b,c)=>{c(a,b)},sendMessage:(a,b)=>{b(a)},halfClose:a=>{a()},cancel:a=>{a()}};class o{constructor(a,b){var c,d,e,f;this.nextCall=a,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,b?this.requester={start:null!=(c=b.start)?c:n.start,sendMessage:null!=(d=b.sendMessage)?d:n.sendMessage,halfClose:null!=(e=b.halfClose)?e:n.halfClose,cancel:null!=(f=b.cancel)?f:n.cancel}:this.requester=n}cancelWithStatus(a,b){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(a,b)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(a,b){var c,d,f,g,h,i;let j={onReceiveMetadata:null!=(d=null==(c=null==b?void 0:b.onReceiveMetadata)?void 0:c.bind(b))?d:a=>{},onReceiveMessage:null!=(g=null==(f=null==b?void 0:b.onReceiveMessage)?void 0:f.bind(b))?g:a=>{},onReceiveStatus:null!=(i=null==(h=null==b?void 0:b.onReceiveStatus)?void 0:h.bind(b))?i:a=>{}};this.processingMetadata=!0,this.requester.start(a,j,(a,b)=>{var c,d,f;let g;if(this.processingMetadata=!1,(0,e.isInterceptingListener)(b))g=b;else{let a={onReceiveMetadata:null!=(c=b.onReceiveMetadata)?c:k,onReceiveMessage:null!=(d=b.onReceiveMessage)?d:l,onReceiveStatus:null!=(f=b.onReceiveStatus)?f:m};g=new e.InterceptingListenerImpl(a,j)}this.nextCall.start(a,g),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(a,b){this.processingMessage=!0,this.requester.sendMessage(b,c=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=a,this.pendingMessage=b):(this.nextCall.sendMessageWithContext(a,c),this.processPendingHalfClose())})}sendMessage(a){this.sendMessageWithContext({},a)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}}function p(a,b,c){var d,e;let f=null!=(d=c.deadline)?d:1/0,g=c.host,h=null!=(e=c.parent)?e:null,i=c.propagate_flags,j=c.credentials,k=a.createCall(b,f,g,h,i);return j&&k.setCredentials(j),k}c.InterceptingCall=o;class q{constructor(a,b){this.call=a,this.methodDefinition=b}cancelWithStatus(a,b){this.call.cancelWithStatus(a,b)}getPeer(){return this.call.getPeer()}sendMessageWithContext(a,b){let c;try{c=this.methodDefinition.requestSerialize(b)}catch(a){this.call.cancelWithStatus(f.Status.INTERNAL,`Request message serialization failure: ${(0,g.getErrorMessage)(a)}`);return}this.call.sendMessageWithContext(a,c)}sendMessage(a){this.sendMessageWithContext({},a)}start(a,b){let c=null;this.call.start(a,{onReceiveMetadata:a=>{var c;null==(c=null==b?void 0:b.onReceiveMetadata)||c.call(b,a)},onReceiveMessage:a=>{var e;let h;try{h=this.methodDefinition.responseDeserialize(a)}catch(a){c={code:f.Status.INTERNAL,details:`Response message parsing error: ${(0,g.getErrorMessage)(a)}`,metadata:new d.Metadata},this.call.cancelWithStatus(c.code,c.details);return}null==(e=null==b?void 0:b.onReceiveMessage)||e.call(b,h)},onReceiveStatus:a=>{var d,e;c?null==(d=null==b?void 0:b.onReceiveStatus)||d.call(b,c):null==(e=null==b?void 0:b.onReceiveStatus)||e.call(b,a)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}}class r extends q{constructor(a,b){super(a,b)}start(a,b){var c,d;let e=!1,f={onReceiveMetadata:null!=(d=null==(c=null==b?void 0:b.onReceiveMetadata)?void 0:c.bind(b))?d:a=>{},onReceiveMessage:a=>{var c;e=!0,null==(c=null==b?void 0:b.onReceiveMessage)||c.call(b,a)},onReceiveStatus:a=>{var c,d;e||null==(c=null==b?void 0:b.onReceiveMessage)||c.call(b,null),null==(d=null==b?void 0:b.onReceiveStatus)||d.call(b,a)}};super.start(a,f),this.call.startRead()}}class s extends q{}function t(a,b,c){let d=p(a,c.path,b);return c.responseStream?new s(d,c):new r(d,c)}c.getInterceptingCall=function(a,b,c,d){if(a.clientInterceptors.length>0&&a.clientInterceptorProviders.length>0)throw new h("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(a.callInterceptors.length>0&&a.callInterceptorProviders.length>0)throw new h("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let e=[];e=a.callInterceptors.length>0||a.callInterceptorProviders.length>0?[].concat(a.callInterceptors,a.callInterceptorProviders.map(a=>a(b))).filter(a=>a):[].concat(a.clientInterceptors,a.clientInterceptorProviders.map(a=>a(b))).filter(a=>a);let f=Object.assign({},c,{method_definition:b});return e.reduceRight((a,b)=>c=>b(c,a),a=>t(d,a,b))(f)}},62562,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Client=void 0;let d=a.r(46456),e=a.r(51621),f=a.r(69374),g=a.r(47844),h=a.r(92240),i=a.r(53252),j=Symbol(),k=Symbol(),l=Symbol(),m=Symbol();function n(a){return"function"==typeof a}function o(a){return a.stack.split("\n").slice(1).join("\n")}class p{constructor(a,b,c={}){var d,f;if(c=Object.assign({},c),this[k]=null!=(d=c.interceptors)?d:[],delete c.interceptors,this[l]=null!=(f=c.interceptor_providers)?f:[],delete c.interceptor_providers,this[k].length>0&&this[l].length>0)throw Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[m]=c.callInvocationTransformer,delete c.callInvocationTransformer,c.channelOverride)this[j]=c.channelOverride;else if(c.channelFactoryOverride){const d=c.channelFactoryOverride;delete c.channelFactoryOverride,this[j]=d(a,b,c)}else this[j]=new e.ChannelImplementation(a,b,c)}close(){this[j].close()}getChannel(){return this[j]}waitForReady(a,b){let c=d=>{let e;if(d)return void b(Error("Failed to connect before the deadline"));try{e=this[j].getConnectivityState(!0)}catch(a){b(Error("The channel has been closed"));return}if(e===f.ConnectivityState.READY)b();else try{this[j].watchConnectivityState(e,a,c)}catch(a){b(Error("The channel has been closed"))}};setImmediate(c)}checkOptionalUnaryResponseArguments(a,b,c){if(n(a))return{metadata:new h.Metadata,options:{},callback:a};if(n(b))if(a instanceof h.Metadata)return{metadata:a,options:{},callback:b};else return{metadata:new h.Metadata,options:a,callback:b};if(!(a instanceof h.Metadata&&b instanceof Object&&n(c)))throw Error("Incorrect arguments passed");return{metadata:a,options:b,callback:c}}makeUnaryRequest(a,b,c,e,f,h,n){var p,q;let r=this.checkOptionalUnaryResponseArguments(f,h,n),s={path:a,requestStream:!1,responseStream:!1,requestSerialize:b,responseDeserialize:c},t={argument:e,metadata:r.metadata,call:new d.ClientUnaryCallImpl,channel:this[j],methodDefinition:s,callOptions:r.options,callback:r.callback};this[m]&&(t=this[m](t));let u=t.call,v={clientInterceptors:this[k],clientInterceptorProviders:this[l],callInterceptors:null!=(p=t.callOptions.interceptors)?p:[],callInterceptorProviders:null!=(q=t.callOptions.interceptor_providers)?q:[]},w=(0,i.getInterceptingCall)(v,t.methodDefinition,t.callOptions,t.channel);u.call=w;let x=null,y=!1,z=Error();return w.start(t.metadata,{onReceiveMetadata:a=>{u.emit("metadata",a)},onReceiveMessage(a){null!==x&&w.cancelWithStatus(g.Status.INTERNAL,"Too many responses received"),x=a},onReceiveStatus(a){if(!y){if(y=!0,a.code===g.Status.OK)if(null===x){let b=o(z);t.callback((0,d.callErrorFromStatus)({code:g.Status.INTERNAL,details:"No message received",metadata:a.metadata},b))}else t.callback(null,x);else{let b=o(z);t.callback((0,d.callErrorFromStatus)(a,b))}z=null,u.emit("status",a)}}}),w.sendMessage(e),w.halfClose(),u}makeClientStreamRequest(a,b,c,e,f,h){var n,p;let q=this.checkOptionalUnaryResponseArguments(e,f,h),r={path:a,requestStream:!0,responseStream:!1,requestSerialize:b,responseDeserialize:c},s={metadata:q.metadata,call:new d.ClientWritableStreamImpl(b),channel:this[j],methodDefinition:r,callOptions:q.options,callback:q.callback};this[m]&&(s=this[m](s));let t=s.call,u={clientInterceptors:this[k],clientInterceptorProviders:this[l],callInterceptors:null!=(n=s.callOptions.interceptors)?n:[],callInterceptorProviders:null!=(p=s.callOptions.interceptor_providers)?p:[]},v=(0,i.getInterceptingCall)(u,s.methodDefinition,s.callOptions,s.channel);t.call=v;let w=null,x=!1,y=Error();return v.start(s.metadata,{onReceiveMetadata:a=>{t.emit("metadata",a)},onReceiveMessage(a){null!==w&&v.cancelWithStatus(g.Status.INTERNAL,"Too many responses received"),w=a},onReceiveStatus(a){if(!x){if(x=!0,a.code===g.Status.OK)if(null===w){let b=o(y);s.callback((0,d.callErrorFromStatus)({code:g.Status.INTERNAL,details:"No message received",metadata:a.metadata},b))}else s.callback(null,w);else{let b=o(y);s.callback((0,d.callErrorFromStatus)(a,b))}y=null,t.emit("status",a)}}}),t}checkMetadataAndOptions(a,b){let c,d;return a instanceof h.Metadata?(c=a,d=b||{}):(d=a||{},c=new h.Metadata),{metadata:c,options:d}}makeServerStreamRequest(a,b,c,e,f,h){var n,p;let q=this.checkMetadataAndOptions(f,h),r={path:a,requestStream:!1,responseStream:!0,requestSerialize:b,responseDeserialize:c},s={argument:e,metadata:q.metadata,call:new d.ClientReadableStreamImpl(c),channel:this[j],methodDefinition:r,callOptions:q.options};this[m]&&(s=this[m](s));let t=s.call,u={clientInterceptors:this[k],clientInterceptorProviders:this[l],callInterceptors:null!=(n=s.callOptions.interceptors)?n:[],callInterceptorProviders:null!=(p=s.callOptions.interceptor_providers)?p:[]},v=(0,i.getInterceptingCall)(u,s.methodDefinition,s.callOptions,s.channel);t.call=v;let w=!1,x=Error();return v.start(s.metadata,{onReceiveMetadata(a){t.emit("metadata",a)},onReceiveMessage(a){t.push(a)},onReceiveStatus(a){if(!w){if(w=!0,t.push(null),a.code!==g.Status.OK){let b=o(x);t.emit("error",(0,d.callErrorFromStatus)(a,b))}x=null,t.emit("status",a)}}}),v.sendMessage(e),v.halfClose(),t}makeBidiStreamRequest(a,b,c,e,f){var h,n;let p=this.checkMetadataAndOptions(e,f),q={path:a,requestStream:!0,responseStream:!0,requestSerialize:b,responseDeserialize:c},r={metadata:p.metadata,call:new d.ClientDuplexStreamImpl(b,c),channel:this[j],methodDefinition:q,callOptions:p.options};this[m]&&(r=this[m](r));let s=r.call,t={clientInterceptors:this[k],clientInterceptorProviders:this[l],callInterceptors:null!=(h=r.callOptions.interceptors)?h:[],callInterceptorProviders:null!=(n=r.callOptions.interceptor_providers)?n:[]},u=(0,i.getInterceptingCall)(t,r.methodDefinition,r.callOptions,r.channel);s.call=u;let v=!1,w=Error();return u.start(r.metadata,{onReceiveMetadata(a){s.emit("metadata",a)},onReceiveMessage(a){s.push(a)},onReceiveStatus(a){if(!v){if(v=!0,s.push(null),a.code!==g.Status.OK){let b=o(w);s.emit("error",(0,d.callErrorFromStatus)(a,b))}w=null,s.emit("status",a)}}}),s}}c.Client=p},79523,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.loadPackageDefinition=c.makeClientConstructor=void 0;let d=a.r(62562),e={unary:d.Client.prototype.makeUnaryRequest,server_stream:d.Client.prototype.makeServerStreamRequest,client_stream:d.Client.prototype.makeClientStreamRequest,bidi:d.Client.prototype.makeBidiStreamRequest};function f(a){return["__proto__","prototype","constructor"].includes(a)}function g(a,b,c){c||(c={});class g extends d.Client{}return Object.keys(a).forEach(b=>{let c;if(f(b))return;let d=a[b];if("string"==typeof b&&"$"===b.charAt(0))throw Error("Method names cannot start with $");c=d.requestStream?d.responseStream?"bidi":"client_stream":d.responseStream?"server_stream":"unary";let i=d.requestSerialize,j=d.responseDeserialize,k=h(e[c],d.path,i,j);g.prototype[b]=k,Object.assign(g.prototype[b],d),d.originalName&&!f(d.originalName)&&(g.prototype[d.originalName]=g.prototype[b])}),g.service=a,g.serviceName=b,g}function h(a,b,c,d){return function(...e){return a.call(this,b,c,d,...e)}}function i(a){return"format"in a}c.makeClientConstructor=g,c.loadPackageDefinition=function(a){let b={};for(let c in a)if(Object.prototype.hasOwnProperty.call(a,c)){let d=a[c],e=c.split(".");if(e.some(a=>f(a)))continue;let h=e[e.length-1],j=b;for(let a of e.slice(0,-1))j[a]||(j[a]={}),j=j[a];i(d)?j[h]=d:j[h]=g(d,h,{})}return b}},7568,(a,b,c)=>{var d=1/0,e="[object Symbol]",f=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,g=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,h="\ud800-\udfff",i="\\u0300-\\u036f\\ufe20-\\ufe23",j="\\u20d0-\\u20f0",k="\\u2700-\\u27bf",l="a-z\\xdf-\\xf6\\xf8-\\xff",m="A-Z\\xc0-\\xd6\\xd8-\\xde",n="\\ufe0e\\ufe0f",o="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",p="[']",q="["+h+"]",r="["+o+"]",s="["+i+j+"]",t="\\d+",u="["+k+"]",v="["+l+"]",w="[^"+h+o+t+k+l+m+"]",x="\ud83c[\udffb-\udfff]",y="[^"+h+"]",z="(?:\ud83c[\udde6-\uddff]){2}",A="[\ud800-\udbff][\udc00-\udfff]",B="["+m+"]",C="\\u200d",D="(?:"+v+"|"+w+")",E="(?:"+B+"|"+w+")",F="(?:"+p+"(?:d|ll|m|re|s|t|ve))?",G="(?:"+p+"(?:D|LL|M|RE|S|T|VE))?",H="(?:"+s+"|"+x+")?",I="["+n+"]?",J="(?:"+C+"(?:"+[y,z,A].join("|")+")"+I+H+")*",K=I+H+J,L="(?:"+[u,z,A].join("|")+")"+K,M="(?:"+[y+s+"?",s,z,A,q].join("|")+")",N=RegExp(p,"g"),O=RegExp(s,"g"),P=RegExp(x+"(?="+x+")|"+M+K,"g"),Q=RegExp([B+"?"+v+"+"+F+"(?="+[r,B,"$"].join("|")+")",E+"+"+G+"(?="+[r,B+D,"$"].join("|")+")",B+"?"+D+"+"+F,B+"+"+G,t,L].join("|"),"g"),R=RegExp("["+C+h+i+j+n+"]"),S=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,T={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"ss"},U=a.g&&a.g.Object===Object&&a.g,V="object"==typeof self&&self&&self.Object===Object&&self,W=U||V||Function("return this")();function X(a,b,c,d){var e=-1,f=a?a.length:0;for(d&&f&&(c=a[++e]);++e<f;)c=b(c,a[e],e,a);return c}function Y(a){return a.split("")}function Z(a){return a.match(f)||[]}var $=function(a){return function(b){return null==a?void 0:a[b]}}(T);function _(a){return R.test(a)}function aa(a){return S.test(a)}function ab(a){return _(a)?ac(a):Y(a)}function ac(a){return a.match(P)||[]}function ad(a){return a.match(Q)||[]}var ae=Object.prototype.toString,af=W.Symbol,ag=af?af.prototype:void 0,ah=ag?ag.toString:void 0;function ai(a,b,c){var d=-1,e=a.length;b<0&&(b=-b>e?0:e+b),(c=c>e?e:c)<0&&(c+=e),e=b>c?0:c-b>>>0,b>>>=0;for(var f=Array(e);++d<e;)f[d]=a[d+b];return f}function aj(a){if("string"==typeof a)return a;if(an(a))return ah?ah.call(a):"";var b=a+"";return"0"==b&&1/a==-d?"-0":b}function ak(a,b,c){var d=a.length;return c=void 0===c?d:c,!b&&c>=d?a:ai(a,b,c)}function al(a){return function(b){var c=_(b=ao(b))?ab(b):void 0,d=c?c[0]:b.charAt(0),e=c?ak(c,1).join(""):b.slice(1);return d[a]()+e}}function am(a){return!!a&&"object"==typeof a}function an(a){return"symbol"==typeof a||am(a)&&ae.call(a)==e}function ao(a){return null==a?"":aj(a)}var ap=function(a){return function(b){return X(at(ar(b).replace(N,"")),a,"")}}(function(a,b,c){return b=b.toLowerCase(),a+(c?aq(b):b)});function aq(a){return as(ao(a).toLowerCase())}function ar(a){return(a=ao(a))&&a.replace(g,$).replace(O,"")}var as=al("toUpperCase");function at(a,b,c){return(a=ao(a),void 0===(b=c?void 0:b))?aa(a)?ad(a):Z(a):a.match(b)||[]}b.exports=ap},75634,(a,b,c)=>{"use strict";b.exports=function a(a,b){for(var c=Array(arguments.length-1),d=0,e=2,f=!0;e<arguments.length;)c[d++]=arguments[e++];return new Promise(function(e,g){c[d]=function(a){if(f)if(f=!1,a)g(a);else{for(var b=Array(arguments.length-1),c=0;c<b.length;)b[c++]=arguments[c];e.apply(null,b)}};try{a.apply(b||null,c)}catch(a){f&&(f=!1,g(a))}})}},65736,(a,b,c)=>{"use strict";var d=c;d.length=function(a){var b=a.length;if(!b)return 0;for(var c=0;--b%4>1&&"="===a.charAt(b);)++c;return Math.ceil(3*a.length)/4-c};for(var e=Array(64),f=Array(123),g=0;g<64;)f[e[g]=g<26?g+65:g<52?g+71:g<62?g-4:g-59|43]=g++;d.encode=function(a,b,c){for(var d,f=null,g=[],h=0,i=0;b<c;){var j=a[b++];switch(i){case 0:g[h++]=e[j>>2],d=(3&j)<<4,i=1;break;case 1:g[h++]=e[d|j>>4],d=(15&j)<<2,i=2;break;case 2:g[h++]=e[d|j>>6],g[h++]=e[63&j],i=0}h>8191&&((f||(f=[])).push(String.fromCharCode.apply(String,g)),h=0)}return(i&&(g[h++]=e[d],g[h++]=61,1===i&&(g[h++]=61)),f)?(h&&f.push(String.fromCharCode.apply(String,g.slice(0,h))),f.join("")):String.fromCharCode.apply(String,g.slice(0,h))};var h="invalid encoding";d.decode=function(a,b,c){for(var d,e=c,g=0,i=0;i<a.length;){var j=a.charCodeAt(i++);if(61===j&&g>1)break;if(void 0===(j=f[j]))throw Error(h);switch(g){case 0:d=j,g=1;break;case 1:b[c++]=d<<2|(48&j)>>4,d=j,g=2;break;case 2:b[c++]=(15&d)<<4|(60&j)>>2,d=j,g=3;break;case 3:b[c++]=(3&d)<<6|j,g=0}}if(1===g)throw Error(h);return c-e},d.test=function(a){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(a)}},3249,(a,b,c)=>{"use strict";function d(){this._listeners={}}b.exports=d,d.prototype.on=function(a,b,c){return(this._listeners[a]||(this._listeners[a]=[])).push({fn:b,ctx:c||this}),this},d.prototype.off=function(a,b){if(void 0===a)this._listeners={};else if(void 0===b)this._listeners[a]=[];else for(var c=this._listeners[a],d=0;d<c.length;)c[d].fn===b?c.splice(d,1):++d;return this},d.prototype.emit=function(a){var b=this._listeners[a];if(b){for(var c=[],d=1;d<arguments.length;)c.push(arguments[d++]);for(d=0;d<b.length;)b[d].fn.apply(b[d++].ctx,c)}return this}},86575,(a,b,c)=>{"use strict";function d(a){return"undefined"!=typeof Float32Array?!function(){var b=new Float32Array([-0]),c=new Uint8Array(b.buffer),d=128===c[3];function e(a,d,e){b[0]=a,d[e]=c[0],d[e+1]=c[1],d[e+2]=c[2],d[e+3]=c[3]}function f(a,d,e){b[0]=a,d[e]=c[3],d[e+1]=c[2],d[e+2]=c[1],d[e+3]=c[0]}function g(a,d){return c[0]=a[d],c[1]=a[d+1],c[2]=a[d+2],c[3]=a[d+3],b[0]}function h(a,d){return c[3]=a[d],c[2]=a[d+1],c[1]=a[d+2],c[0]=a[d+3],b[0]}a.writeFloatLE=d?e:f,a.writeFloatBE=d?f:e,a.readFloatLE=d?g:h,a.readFloatBE=d?h:g}():!function(){function b(a,b,c,d){var e=+(b<0);if(e&&(b=-b),0===b)a(1/b>0?0:0x80000000,c,d);else if(isNaN(b))a(0x7fc00000,c,d);else if(b>34028234663852886e22)a((e<<31|0x7f800000)>>>0,c,d);else if(b<11754943508222875e-54)a((e<<31|Math.round(b/1401298464324817e-60))>>>0,c,d);else{var f=Math.floor(Math.log(b)/Math.LN2),g=8388607&Math.round(b*Math.pow(2,-f)*8388608);a((e<<31|f+127<<23|g)>>>0,c,d)}}function c(a,b,c){var d=a(b,c),e=(d>>31)*2+1,f=d>>>23&255,g=8388607&d;return 255===f?g?NaN:1/0*e:0===f?1401298464324817e-60*e*g:e*Math.pow(2,f-150)*(g+8388608)}a.writeFloatLE=b.bind(null,e),a.writeFloatBE=b.bind(null,f),a.readFloatLE=c.bind(null,g),a.readFloatBE=c.bind(null,h)}(),"undefined"!=typeof Float64Array?!function(){var b=new Float64Array([-0]),c=new Uint8Array(b.buffer),d=128===c[7];function e(a,d,e){b[0]=a,d[e]=c[0],d[e+1]=c[1],d[e+2]=c[2],d[e+3]=c[3],d[e+4]=c[4],d[e+5]=c[5],d[e+6]=c[6],d[e+7]=c[7]}function f(a,d,e){b[0]=a,d[e]=c[7],d[e+1]=c[6],d[e+2]=c[5],d[e+3]=c[4],d[e+4]=c[3],d[e+5]=c[2],d[e+6]=c[1],d[e+7]=c[0]}function g(a,d){return c[0]=a[d],c[1]=a[d+1],c[2]=a[d+2],c[3]=a[d+3],c[4]=a[d+4],c[5]=a[d+5],c[6]=a[d+6],c[7]=a[d+7],b[0]}function h(a,d){return c[7]=a[d],c[6]=a[d+1],c[5]=a[d+2],c[4]=a[d+3],c[3]=a[d+4],c[2]=a[d+5],c[1]=a[d+6],c[0]=a[d+7],b[0]}a.writeDoubleLE=d?e:f,a.writeDoubleBE=d?f:e,a.readDoubleLE=d?g:h,a.readDoubleBE=d?h:g}():!function(){function b(a,b,c,d,e,f){var g,h=+(d<0);if(h&&(d=-d),0===d)a(0,e,f+b),a(1/d>0?0:0x80000000,e,f+c);else if(isNaN(d))a(0,e,f+b),a(0x7ff80000,e,f+c);else if(d>17976931348623157e292)a(0,e,f+b),a((h<<31|0x7ff00000)>>>0,e,f+c);else if(d<22250738585072014e-324)a((g=d/5e-324)>>>0,e,f+b),a((h<<31|g/0x100000000)>>>0,e,f+c);else{var i=Math.floor(Math.log(d)/Math.LN2);1024===i&&(i=1023),a(0x10000000000000*(g=d*Math.pow(2,-i))>>>0,e,f+b),a((h<<31|i+1023<<20|1048576*g&1048575)>>>0,e,f+c)}}function c(a,b,c,d,e){var f=a(d,e+b),g=a(d,e+c),h=(g>>31)*2+1,i=g>>>20&2047,j=0x100000000*(1048575&g)+f;return 2047===i?j?NaN:1/0*h:0===i?5e-324*h*j:h*Math.pow(2,i-1075)*(j+0x10000000000000)}a.writeDoubleLE=b.bind(null,e,0,4),a.writeDoubleBE=b.bind(null,f,4,0),a.readDoubleLE=c.bind(null,g,0,4),a.readDoubleBE=c.bind(null,h,4,0)}(),a}function e(a,b,c){b[c]=255&a,b[c+1]=a>>>8&255,b[c+2]=a>>>16&255,b[c+3]=a>>>24}function f(a,b,c){b[c]=a>>>24,b[c+1]=a>>>16&255,b[c+2]=a>>>8&255,b[c+3]=255&a}function g(a,b){return(a[b]|a[b+1]<<8|a[b+2]<<16|a[b+3]<<24)>>>0}function h(a,b){return(a[b]<<24|a[b+1]<<16|a[b+2]<<8|a[b+3])>>>0}b.exports=d(d)},13615,(__turbopack_context__,module,exports)=>{"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},41795,(a,b,c)=>{"use strict";var d=c;d.length=function(a){for(var b=0,c=0,d=0;d<a.length;++d)(c=a.charCodeAt(d))<128?b+=1:c<2048?b+=2:(64512&c)==55296&&(64512&a.charCodeAt(d+1))==56320?(++d,b+=4):b+=3;return b},d.read=function(a,b,c){if(c-b<1)return"";for(var d,e=null,f=[],g=0;b<c;)(d=a[b++])<128?f[g++]=d:d>191&&d<224?f[g++]=(31&d)<<6|63&a[b++]:d>239&&d<365?(d=((7&d)<<18|(63&a[b++])<<12|(63&a[b++])<<6|63&a[b++])-65536,f[g++]=55296+(d>>10),f[g++]=56320+(1023&d)):f[g++]=(15&d)<<12|(63&a[b++])<<6|63&a[b++],g>8191&&((e||(e=[])).push(String.fromCharCode.apply(String,f)),g=0);return e?(g&&e.push(String.fromCharCode.apply(String,f.slice(0,g))),e.join("")):String.fromCharCode.apply(String,f.slice(0,g))},d.write=function(a,b,c){for(var d,e,f=c,g=0;g<a.length;++g)(d=a.charCodeAt(g))<128?b[c++]=d:(d<2048?b[c++]=d>>6|192:((64512&d)==55296&&(64512&(e=a.charCodeAt(g+1)))==56320?(d=65536+((1023&d)<<10)+(1023&e),++g,b[c++]=d>>18|240,b[c++]=d>>12&63|128):b[c++]=d>>12|224,b[c++]=d>>6&63|128),b[c++]=63&d|128);return c-f}},32190,(a,b,c)=>{"use strict";b.exports=function a(a,b,c){var d=c||8192,e=d>>>1,f=null,g=d;return function(c){if(c<1||c>e)return a(c);g+c>d&&(f=a(d),g=0);var h=b.call(f,g,g+=c);return 7&g&&(g=(7|g)+1),h}}},91361,(a,b,c)=>{"use strict";b.exports=e;var d=a.r(35086);function e(a,b){this.lo=a>>>0,this.hi=b>>>0}var f=e.zero=new e(0,0);f.toNumber=function(){return 0},f.zzEncode=f.zzDecode=function(){return this},f.length=function(){return 1};var g=e.zeroHash="\0\0\0\0\0\0\0\0";e.fromNumber=function(a){if(0===a)return f;var b=a<0;b&&(a=-a);var c=a>>>0,d=(a-c)/0x100000000>>>0;return b&&(d=~d>>>0,c=~c>>>0,++c>0xffffffff&&(c=0,++d>0xffffffff&&(d=0))),new e(c,d)},e.from=function(a){if("number"==typeof a)return e.fromNumber(a);if(d.isString(a))if(!d.Long)return e.fromNumber(parseInt(a,10));else a=d.Long.fromString(a);return a.low||a.high?new e(a.low>>>0,a.high>>>0):f},e.prototype.toNumber=function(a){if(!a&&this.hi>>>31){var b=~this.lo+1>>>0,c=~this.hi>>>0;return b||(c=c+1>>>0),-(b+0x100000000*c)}return this.lo+0x100000000*this.hi},e.prototype.toLong=function(a){return d.Long?new d.Long(0|this.lo,0|this.hi,!!a):{low:0|this.lo,high:0|this.hi,unsigned:!!a}};var h=String.prototype.charCodeAt;e.fromHash=function(a){return a===g?f:new e((h.call(a,0)|h.call(a,1)<<8|h.call(a,2)<<16|h.call(a,3)<<24)>>>0,(h.call(a,4)|h.call(a,5)<<8|h.call(a,6)<<16|h.call(a,7)<<24)>>>0)},e.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},e.prototype.zzEncode=function(){var a=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^a)>>>0,this.lo=(this.lo<<1^a)>>>0,this},e.prototype.zzDecode=function(){var a=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^a)>>>0,this.hi=(this.hi>>>1^a)>>>0,this},e.prototype.length=function(){var a=this.lo,b=(this.lo>>>28|this.hi<<4)>>>0,c=this.hi>>>24;return 0===c?0===b?a<16384?a<128?1:2:a<2097152?3:4:b<16384?b<128?5:6:b<2097152?7:8:c<128?9:10}},35086,(a,b,c)=>{"use strict";var d=c;function e(a,b,c){for(var d=Object.keys(b),e=0;e<d.length;++e)void 0!==a[d[e]]&&c||(a[d[e]]=b[d[e]]);return a}function f(a){function b(a,c){if(!(this instanceof b))return new b(a,c);Object.defineProperty(this,"message",{get:function(){return a}}),Error.captureStackTrace?Error.captureStackTrace(this,b):Object.defineProperty(this,"stack",{value:Error().stack||""}),c&&e(this,c)}return b.prototype=Object.create(Error.prototype,{constructor:{value:b,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return a},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),b}d.asPromise=a.r(75634),d.base64=a.r(65736),d.EventEmitter=a.r(3249),d.float=a.r(86575),d.inquire=a.r(13615),d.utf8=a.r(41795),d.pool=a.r(32190),d.LongBits=a.r(91361),d.isNode=!!(a.g&&a.g.process&&a.g.process.versions&&a.g.process.versions.node),d.global=d.isNode&&a.g||"undefined"!=typeof self&&self||a.e,d.emptyArray=Object.freeze?Object.freeze([]):[],d.emptyObject=Object.freeze?Object.freeze({}):{},d.isInteger=Number.isInteger||function(a){return"number"==typeof a&&isFinite(a)&&Math.floor(a)===a},d.isString=function(a){return"string"==typeof a||a instanceof String},d.isObject=function(a){return a&&"object"==typeof a},d.isset=d.isSet=function(a,b){var c=a[b];return!!(null!=c&&a.hasOwnProperty(b))&&("object"!=typeof c||(Array.isArray(c)?c.length:Object.keys(c).length)>0)},d.Buffer=function(){try{var a=d.inquire("buffer").Buffer;return a.prototype.utf8Write?a:null}catch(a){return null}}(),d._Buffer_from=null,d._Buffer_allocUnsafe=null,d.newBuffer=function(a){return"number"==typeof a?d.Buffer?d._Buffer_allocUnsafe(a):new d.Array(a):d.Buffer?d._Buffer_from(a):"undefined"==typeof Uint8Array?a:new Uint8Array(a)},d.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,d.Long=d.global.dcodeIO&&d.global.dcodeIO.Long||d.global.Long||d.inquire("long"),d.key2Re=/^true|false|0|1$/,d.key32Re=/^-?(?:0|[1-9][0-9]*)$/,d.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,d.longToHash=function(a){return a?d.LongBits.from(a).toHash():d.LongBits.zeroHash},d.longFromHash=function(a,b){var c=d.LongBits.fromHash(a);return d.Long?d.Long.fromBits(c.lo,c.hi,b):c.toNumber(!!b)},d.merge=e,d.lcFirst=function(a){return a.charAt(0).toLowerCase()+a.substring(1)},d.newError=f,d.ProtocolError=f("ProtocolError"),d.oneOfGetter=function(a){for(var b={},c=0;c<a.length;++c)b[a[c]]=1;return function(){for(var a=Object.keys(this),c=a.length-1;c>-1;--c)if(1===b[a[c]]&&void 0!==this[a[c]]&&null!==this[a[c]])return a[c]}},d.oneOfSetter=function(a){return function(b){for(var c=0;c<a.length;++c)a[c]!==b&&delete this[a[c]]}},d.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},d._configure=function(){var a=d.Buffer;if(!a){d._Buffer_from=d._Buffer_allocUnsafe=null;return}d._Buffer_from=a.from!==Uint8Array.from&&a.from||function(b,c){return new a(b,c)},d._Buffer_allocUnsafe=a.allocUnsafe||function(b){return new a(b)}}},18207,(a,b,c)=>{"use strict";b.exports={}},22469,(a,b,c)=>{"use strict";function d(a,b){"string"==typeof a&&(b=a,a=void 0);var c=[];function e(a){if("string"!=typeof a){var b=f();if(d.verbose&&console.log("codegen: "+b),b="return "+b,a){for(var g=Object.keys(a),h=Array(g.length+1),i=Array(g.length),j=0;j<g.length;)h[j]=g[j],i[j]=a[g[j++]];return h[j]=b,Function.apply(null,h).apply(null,i)}return Function(b)()}for(var k=Array(arguments.length-1),l=0;l<k.length;)k[l]=arguments[++l];if(l=0,a=a.replace(/%([%dfijs])/g,function(a,b){var c=k[l++];switch(b){case"d":case"f":return String(Number(c));case"i":return String(Math.floor(c));case"j":return JSON.stringify(c);case"s":return String(c)}return"%"}),l!==k.length)throw Error("parameter count mismatch");return c.push(a),e}function f(d){return"function "+(d||b||"")+"("+(a&&a.join(",")||"")+"){\n  "+c.join("\n  ")+"\n}"}return e.toString=f,e}b.exports=d,d.verbose=!1},32575,(a,b,c)=>{"use strict";b.exports=f;var d=a.r(75634),e=a.r(13615)("fs");function f(a,b,c){return("function"==typeof b?(c=b,b={}):b||(b={}),c)?!b.xhr&&e&&e.readFile?e.readFile(a,function(d,e){return d&&"undefined"!=typeof XMLHttpRequest?f.xhr(a,b,c):d?c(d):c(null,b.binary?e:e.toString("utf8"))}):f.xhr(a,b,c):d(f,this,a,b)}f.xhr=function(a,b,c){var d=new XMLHttpRequest;d.onreadystatechange=function(){if(4===d.readyState){if(0!==d.status&&200!==d.status)return c(Error("status "+d.status));if(b.binary){var a=d.response;if(!a){a=[];for(var e=0;e<d.responseText.length;++e)a.push(255&d.responseText.charCodeAt(e))}return c(null,"undefined"!=typeof Uint8Array?new Uint8Array(a):a)}return c(null,d.responseText)}},b.binary&&("overrideMimeType"in d&&d.overrideMimeType("text/plain; charset=x-user-defined"),d.responseType="arraybuffer"),d.open("GET",a),d.send()}},67058,(a,b,c)=>{"use strict";var d=c,e=d.isAbsolute=function(a){return/^(?:\/|\w+:)/.test(a)},f=d.normalize=function(a){var b=(a=a.replace(/\\/g,"/").replace(/\/{2,}/g,"/")).split("/"),c=e(a),d="";c&&(d=b.shift()+"/");for(var f=0;f<b.length;)".."===b[f]?f>0&&".."!==b[f-1]?b.splice(--f,2):c?b.splice(f,1):++f:"."===b[f]?b.splice(f,1):++f;return d+b.join("/")};d.resolve=function(a,b,c){return(c||(b=f(b)),e(b))?b:(c||(a=f(a)),(a=a.replace(/(?:\/|^)[^/]+$/,"")).length?f(a+"/"+b):b)}},90063,(a,b,c)=>{"use strict";b.exports=l;var d,e,f,g=a.r(23476);((l.prototype=Object.create(g.prototype)).constructor=l).className="Namespace";var h=a.r(44529),i=a.r(28509),j=a.r(88108);function k(a,b){if(a&&a.length){for(var c={},d=0;d<a.length;++d)c[a[d].name]=a[d].toJSON(b);return c}}function l(a,b){g.call(this,a,b),this.nested=void 0,this._nestedArray=null,this._lookupCache={},this._needsRecursiveFeatureResolution=!0,this._needsRecursiveResolve=!0}function m(a){a._nestedArray=null,a._lookupCache={};for(var b=a;b=b.parent;)b._lookupCache={};return a}l.fromJSON=function(a,b){return new l(a,b.options).addJSON(b.nested)},l.arrayToJSON=k,l.isReservedId=function(a,b){if(a){for(var c=0;c<a.length;++c)if("string"!=typeof a[c]&&a[c][0]<=b&&a[c][1]>b)return!0}return!1},l.isReservedName=function(a,b){if(a){for(var c=0;c<a.length;++c)if(a[c]===b)return!0}return!1},Object.defineProperty(l.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=i.toArray(this.nested))}}),l.prototype.toJSON=function(a){return i.toObject(["options",this.options,"nested",k(this.nestedArray,a)])},l.prototype.addJSON=function(a){var b=this;if(a)for(var c,g=Object.keys(a),i=0;i<g.length;++i)c=a[g[i]],b.add((void 0!==c.fields?d.fromJSON:void 0!==c.values?f.fromJSON:void 0!==c.methods?e.fromJSON:void 0!==c.id?h.fromJSON:l.fromJSON)(g[i],c));return this},l.prototype.get=function(a){return this.nested&&this.nested[a]||null},l.prototype.getEnum=function(a){if(this.nested&&this.nested[a]instanceof f)return this.nested[a].values;throw Error("no such enum: "+a)},l.prototype.add=function(a){if(!(a instanceof h&&void 0!==a.extend||a instanceof d||a instanceof j||a instanceof f||a instanceof e||a instanceof l))throw TypeError("object must be a valid nested object");if(this.nested){var b=this.get(a.name);if(b)if(b instanceof l&&a instanceof l&&!(b instanceof d||b instanceof e)){for(var c=b.nestedArray,g=0;g<c.length;++g)a.add(c[g]);this.remove(b),this.nested||(this.nested={}),a.setOptions(b.options,!0)}else throw Error("duplicate name '"+a.name+"' in "+this)}else this.nested={};this.nested[a.name]=a,this instanceof d||this instanceof e||this instanceof f||this instanceof h||a._edition||(a._edition=a._defaultEdition),this._needsRecursiveFeatureResolution=!0,this._needsRecursiveResolve=!0;for(var i=this;i=i.parent;)i._needsRecursiveFeatureResolution=!0,i._needsRecursiveResolve=!0;return a.onAdd(this),m(this)},l.prototype.remove=function(a){if(!(a instanceof g))throw TypeError("object must be a ReflectionObject");if(a.parent!==this)throw Error(a+" is not a member of "+this);return delete this.nested[a.name],Object.keys(this.nested).length||(this.nested=void 0),a.onRemove(this),m(this)},l.prototype.define=function(a,b){if(i.isString(a))a=a.split(".");else if(!Array.isArray(a))throw TypeError("illegal path");if(a&&a.length&&""===a[0])throw Error("path must be relative");for(var c=this;a.length>0;){var d=a.shift();if(c.nested&&c.nested[d]){if(!((c=c.nested[d])instanceof l))throw Error("path conflicts with non-namespace objects")}else c.add(c=new l(d))}return b&&c.addJSON(b),c},l.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;this._resolveFeaturesRecursive(this._edition);var a=this.nestedArray,b=0;for(this.resolve();b<a.length;)a[b]instanceof l?a[b++].resolveAll():a[b++].resolve();return this._needsRecursiveResolve=!1,this},l.prototype._resolveFeaturesRecursive=function(a){return this._needsRecursiveFeatureResolution&&(this._needsRecursiveFeatureResolution=!1,a=this._edition||a,g.prototype._resolveFeaturesRecursive.call(this,a),this.nestedArray.forEach(b=>{b._resolveFeaturesRecursive(a)})),this},l.prototype.lookup=function(a,b,c){if("boolean"==typeof b?(c=b,b=void 0):b&&!Array.isArray(b)&&(b=[b]),i.isString(a)&&a.length){if("."===a)return this.root;a=a.split(".")}else if(!a.length)return this;var d=a.join(".");if(""===a[0])return this.root.lookup(a.slice(1),b);var e=this.root._fullyQualifiedObjects&&this.root._fullyQualifiedObjects["."+d];if(e&&(!b||b.indexOf(e.constructor)>-1)||(e=this._lookupImpl(a,d))&&(!b||b.indexOf(e.constructor)>-1))return e;if(c)return null;for(var f=this;f.parent;){if((e=f.parent._lookupImpl(a,d))&&(!b||b.indexOf(e.constructor)>-1))return e;f=f.parent}return null},l.prototype._lookupImpl=function(a,b){if(Object.prototype.hasOwnProperty.call(this._lookupCache,b))return this._lookupCache[b];var c=this.get(a[0]),d=null;if(c)1===a.length?d=c:c instanceof l&&(a=a.slice(1),d=c._lookupImpl(a,a.join(".")));else for(var e=0;e<this.nestedArray.length;++e)this._nestedArray[e]instanceof l&&(c=this._nestedArray[e]._lookupImpl(a,b))&&(d=c);return this._lookupCache[b]=d,d},l.prototype.lookupType=function(a){var b=this.lookup(a,[d]);if(!b)throw Error("no such type: "+a);return b},l.prototype.lookupEnum=function(a){var b=this.lookup(a,[f]);if(!b)throw Error("no such Enum '"+a+"' in "+this);return b},l.prototype.lookupTypeOrEnum=function(a){var b=this.lookup(a,[d,f]);if(!b)throw Error("no such Type or Enum '"+a+"' in "+this);return b},l.prototype.lookupService=function(a){var b=this.lookup(a,[e]);if(!b)throw Error("no such Service '"+a+"' in "+this);return b},l._configure=function(a,b,c){d=a,e=b,f=c}},58104,(a,b,c)=>{"use strict";b.exports=g;var d=a.r(44529);((g.prototype=Object.create(d.prototype)).constructor=g).className="MapField";var e=a.r(47172),f=a.r(28509);function g(a,b,c,e,g,h){if(d.call(this,a,b,e,void 0,void 0,g,h),!f.isString(c))throw TypeError("keyType must be a string");this.keyType=c,this.resolvedKeyType=null,this.map=!0}g.fromJSON=function(a,b){return new g(a,b.id,b.keyType,b.type,b.options,b.comment)},g.prototype.toJSON=function(a){var b=!!a&&!!a.keepComments;return f.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",b?this.comment:void 0])},g.prototype.resolve=function(){if(this.resolved)return this;if(void 0===e.mapKey[this.keyType])throw Error("invalid key type: "+this.keyType);return d.prototype.resolve.call(this)},g.d=function(a,b,c){return"function"==typeof c?c=f.decorateType(c).name:c&&"object"==typeof c&&(c=f.decorateEnum(c).name),function(d,e){f.decorateType(d.constructor).add(new g(e,a,b,c))}}},81640,(a,b,c)=>{"use strict";b.exports=f;var d=a.r(23476);((f.prototype=Object.create(d.prototype)).constructor=f).className="Method";var e=a.r(28509);function f(a,b,c,f,g,h,i,j,k){if(e.isObject(g)?(i=g,g=h=void 0):e.isObject(h)&&(i=h,h=void 0),!(void 0===b||e.isString(b)))throw TypeError("type must be a string");if(!e.isString(c))throw TypeError("requestType must be a string");if(!e.isString(f))throw TypeError("responseType must be a string");d.call(this,a,i),this.type=b||"rpc",this.requestType=c,this.requestStream=!!g||void 0,this.responseType=f,this.responseStream=!!h||void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=j,this.parsedOptions=k}f.fromJSON=function(a,b){return new f(a,b.type,b.requestType,b.responseType,b.requestStream,b.responseStream,b.options,b.comment,b.parsedOptions)},f.prototype.toJSON=function(a){var b=!!a&&!!a.keepComments;return e.toObject(["type","rpc"!==this.type&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",b?this.comment:void 0,"parsedOptions",this.parsedOptions])},f.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),d.prototype.resolve.call(this))}},89068,(a,b,c)=>{"use strict";b.exports=e;var d=a.r(35086);function e(a,b,c){if("function"!=typeof a)throw TypeError("rpcImpl must be a function");d.EventEmitter.call(this),this.rpcImpl=a,this.requestDelimited=!!b,this.responseDelimited=!!c}(e.prototype=Object.create(d.EventEmitter.prototype)).constructor=e,e.prototype.rpcCall=function a(b,c,e,f,g){if(!f)throw TypeError("request must be specified");var h=this;if(!g)return d.asPromise(a,h,b,c,e,f);if(!h.rpcImpl)return void setTimeout(function(){g(Error("already ended"))},0);try{return h.rpcImpl(b,c[h.requestDelimited?"encodeDelimited":"encode"](f).finish(),function(a,c){if(a)return h.emit("error",a,b),g(a);if(null===c)return void h.end(!0);if(!(c instanceof e))try{c=e[h.responseDelimited?"decodeDelimited":"decode"](c)}catch(a){return h.emit("error",a,b),g(a)}return h.emit("data",c,b),g(null,c)})}catch(a){h.emit("error",a,b),setTimeout(function(){g(a)},0);return}},e.prototype.end=function(a){return this.rpcImpl&&(a||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},3509,(a,b,c)=>{"use strict";c.Service=a.r(89068)},31908,(a,b,c)=>{"use strict";b.exports=h;var d=a.r(90063);((h.prototype=Object.create(d.prototype)).constructor=h).className="Service";var e=a.r(81640),f=a.r(28509),g=a.r(3509);function h(a,b){d.call(this,a,b),this.methods={},this._methodsArray=null}function i(a){return a._methodsArray=null,a}h.fromJSON=function(a,b){var c=new h(a,b.options);if(b.methods)for(var d=Object.keys(b.methods),f=0;f<d.length;++f)c.add(e.fromJSON(d[f],b.methods[d[f]]));return b.nested&&c.addJSON(b.nested),b.edition&&(c._edition=b.edition),c.comment=b.comment,c._defaultEdition="proto3",c},h.prototype.toJSON=function(a){var b=d.prototype.toJSON.call(this,a),c=!!a&&!!a.keepComments;return f.toObject(["edition",this._editionToJSON(),"options",b&&b.options||void 0,"methods",d.arrayToJSON(this.methodsArray,a)||{},"nested",b&&b.nested||void 0,"comment",c?this.comment:void 0])},Object.defineProperty(h.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=f.toArray(this.methods))}}),h.prototype.get=function(a){return this.methods[a]||d.prototype.get.call(this,a)},h.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;d.prototype.resolve.call(this);for(var a=this.methodsArray,b=0;b<a.length;++b)a[b].resolve();return this},h.prototype._resolveFeaturesRecursive=function(a){return this._needsRecursiveFeatureResolution&&(a=this._edition||a,d.prototype._resolveFeaturesRecursive.call(this,a),this.methodsArray.forEach(b=>{b._resolveFeaturesRecursive(a)})),this},h.prototype.add=function(a){if(this.get(a.name))throw Error("duplicate name '"+a.name+"' in "+this);return a instanceof e?(this.methods[a.name]=a,a.parent=this,i(this)):d.prototype.add.call(this,a)},h.prototype.remove=function(a){if(a instanceof e){if(this.methods[a.name]!==a)throw Error(a+" is not a member of "+this);return delete this.methods[a.name],a.parent=null,i(this)}return d.prototype.remove.call(this,a)},h.prototype.create=function(a,b,c){for(var d,e=new g.Service(a,b,c),h=0;h<this.methodsArray.length;++h){var i=f.lcFirst((d=this._methodsArray[h]).resolve().name).replace(/[^$\w_]/g,"");e[i]=f.codegen(["r","c"],f.isReserved(i)?i+"_":i)("return this.rpcCall(m,q,s,r,c)")({m:d,q:d.resolvedRequestType.ctor,s:d.resolvedResponseType.ctor})}return e}},96354,(a,b,c)=>{"use strict";b.exports=e;var d=a.r(35086);function e(a){if(a)for(var b=Object.keys(a),c=0;c<b.length;++c)this[b[c]]=a[b[c]]}e.create=function(a){return this.$type.create(a)},e.encode=function(a,b){return this.$type.encode(a,b)},e.encodeDelimited=function(a,b){return this.$type.encodeDelimited(a,b)},e.decode=function(a){return this.$type.decode(a)},e.decodeDelimited=function(a){return this.$type.decodeDelimited(a)},e.verify=function(a){return this.$type.verify(a)},e.fromObject=function(a){return this.$type.fromObject(a)},e.toObject=function(a,b){return this.$type.toObject(a,b)},e.prototype.toJSON=function(){return this.$type.toObject(this,d.toJSONOptions)}},20734,(a,b,c)=>{"use strict";b.exports=i;var d,e=a.r(35086),f=e.LongBits,g=e.utf8;function h(a,b){return RangeError("index out of range: "+a.pos+" + "+(b||1)+" > "+a.len)}function i(a){this.buf=a,this.pos=0,this.len=a.length}var j="undefined"!=typeof Uint8Array?function(a){if(a instanceof Uint8Array||Array.isArray(a))return new i(a);throw Error("illegal buffer")}:function(a){if(Array.isArray(a))return new i(a);throw Error("illegal buffer")},k=function(){return e.Buffer?function(a){return(i.create=function(a){return e.Buffer.isBuffer(a)?new d(a):j(a)})(a)}:j};function l(){var a=new f(0,0),b=0;if(this.len-this.pos>4){for(;b<4;++b)if(a.lo=(a.lo|(127&this.buf[this.pos])<<7*b)>>>0,this.buf[this.pos++]<128)return a;if(a.lo=(a.lo|(127&this.buf[this.pos])<<28)>>>0,a.hi=(a.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return a;b=0}else{for(;b<3;++b){if(this.pos>=this.len)throw h(this);if(a.lo=(a.lo|(127&this.buf[this.pos])<<7*b)>>>0,this.buf[this.pos++]<128)return a}return a.lo=(a.lo|(127&this.buf[this.pos++])<<7*b)>>>0,a}if(this.len-this.pos>4){for(;b<5;++b)if(a.hi=(a.hi|(127&this.buf[this.pos])<<7*b+3)>>>0,this.buf[this.pos++]<128)return a}else for(;b<5;++b){if(this.pos>=this.len)throw h(this);if(a.hi=(a.hi|(127&this.buf[this.pos])<<7*b+3)>>>0,this.buf[this.pos++]<128)return a}throw Error("invalid varint encoding")}function m(a,b){return(a[b-4]|a[b-3]<<8|a[b-2]<<16|a[b-1]<<24)>>>0}function n(){if(this.pos+8>this.len)throw h(this,8);return new f(m(this.buf,this.pos+=4),m(this.buf,this.pos+=4))}i.create=k(),i.prototype._slice=e.Array.prototype.subarray||e.Array.prototype.slice,i.prototype.uint32=function(){var a=0xffffffff;return function(){if(a=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(a=(a|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(a=(a|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(a=(a|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(a=(a|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return a;if((this.pos+=5)>this.len)throw this.pos=this.len,h(this,10);return a}}(),i.prototype.int32=function(){return 0|this.uint32()},i.prototype.sint32=function(){var a=this.uint32();return a>>>1^-(1&a)},i.prototype.bool=function(){return 0!==this.uint32()},i.prototype.fixed32=function(){if(this.pos+4>this.len)throw h(this,4);return m(this.buf,this.pos+=4)},i.prototype.sfixed32=function(){if(this.pos+4>this.len)throw h(this,4);return 0|m(this.buf,this.pos+=4)},i.prototype.float=function(){if(this.pos+4>this.len)throw h(this,4);var a=e.float.readFloatLE(this.buf,this.pos);return this.pos+=4,a},i.prototype.double=function(){if(this.pos+8>this.len)throw h(this,4);var a=e.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,a},i.prototype.bytes=function(){var a=this.uint32(),b=this.pos,c=this.pos+a;if(c>this.len)throw h(this,a);if(this.pos+=a,Array.isArray(this.buf))return this.buf.slice(b,c);if(b===c){var d=e.Buffer;return d?d.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,b,c)},i.prototype.string=function(){var a=this.bytes();return g.read(a,0,a.length)},i.prototype.skip=function(a){if("number"==typeof a){if(this.pos+a>this.len)throw h(this,a);this.pos+=a}else do if(this.pos>=this.len)throw h(this);while(128&this.buf[this.pos++])return this},i.prototype.skipType=function(a){switch(a){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(a=7&this.uint32());)this.skipType(a);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+a+" at offset "+this.pos)}return this},i._configure=function(a){d=a,i.create=k(),d._configure();var b=e.Long?"toLong":"toNumber";e.merge(i.prototype,{int64:function(){return l.call(this)[b](!1)},uint64:function(){return l.call(this)[b](!0)},sint64:function(){return l.call(this).zzDecode()[b](!1)},fixed64:function(){return n.call(this)[b](!0)},sfixed64:function(){return n.call(this)[b](!1)}})}},82457,(a,b,c)=>{"use strict";b.exports=l;var d,e=a.r(35086),f=e.LongBits,g=e.base64,h=e.utf8;function i(a,b,c){this.fn=a,this.len=b,this.next=void 0,this.val=c}function j(){}function k(a){this.head=a.head,this.tail=a.tail,this.len=a.len,this.next=a.states}function l(){this.len=0,this.head=new i(j,0,0),this.tail=this.head,this.states=null}var m=function(){return e.Buffer?function(){return(l.create=function(){return new d})()}:function(){return new l}};function n(a,b,c){b[c]=255&a}function o(a,b,c){for(;a>127;)b[c++]=127&a|128,a>>>=7;b[c]=a}function p(a,b){this.len=a,this.next=void 0,this.val=b}function q(a,b,c){for(;a.hi;)b[c++]=127&a.lo|128,a.lo=(a.lo>>>7|a.hi<<25)>>>0,a.hi>>>=7;for(;a.lo>127;)b[c++]=127&a.lo|128,a.lo=a.lo>>>7;b[c++]=a.lo}function r(a,b,c){b[c]=255&a,b[c+1]=a>>>8&255,b[c+2]=a>>>16&255,b[c+3]=a>>>24}l.create=m(),l.alloc=function(a){return new e.Array(a)},e.Array!==Array&&(l.alloc=e.pool(l.alloc,e.Array.prototype.subarray)),l.prototype._push=function(a,b,c){return this.tail=this.tail.next=new i(a,b,c),this.len+=b,this},p.prototype=Object.create(i.prototype),p.prototype.fn=o,l.prototype.uint32=function(a){return this.len+=(this.tail=this.tail.next=new p((a>>>=0)<128?1:a<16384?2:a<2097152?3:a<0x10000000?4:5,a)).len,this},l.prototype.int32=function(a){return a<0?this._push(q,10,f.fromNumber(a)):this.uint32(a)},l.prototype.sint32=function(a){return this.uint32((a<<1^a>>31)>>>0)},l.prototype.uint64=function(a){var b=f.from(a);return this._push(q,b.length(),b)},l.prototype.int64=l.prototype.uint64,l.prototype.sint64=function(a){var b=f.from(a).zzEncode();return this._push(q,b.length(),b)},l.prototype.bool=function(a){return this._push(n,1,+!!a)},l.prototype.fixed32=function(a){return this._push(r,4,a>>>0)},l.prototype.sfixed32=l.prototype.fixed32,l.prototype.fixed64=function(a){var b=f.from(a);return this._push(r,4,b.lo)._push(r,4,b.hi)},l.prototype.sfixed64=l.prototype.fixed64,l.prototype.float=function(a){return this._push(e.float.writeFloatLE,4,a)},l.prototype.double=function(a){return this._push(e.float.writeDoubleLE,8,a)};var s=e.Array.prototype.set?function(a,b,c){b.set(a,c)}:function(a,b,c){for(var d=0;d<a.length;++d)b[c+d]=a[d]};l.prototype.bytes=function(a){var b=a.length>>>0;if(!b)return this._push(n,1,0);if(e.isString(a)){var c=l.alloc(b=g.length(a));g.decode(a,c,0),a=c}return this.uint32(b)._push(s,b,a)},l.prototype.string=function(a){var b=h.length(a);return b?this.uint32(b)._push(h.write,b,a):this._push(n,1,0)},l.prototype.fork=function(){return this.states=new k(this),this.head=this.tail=new i(j,0,0),this.len=0,this},l.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new i(j,0,0),this.len=0),this},l.prototype.ldelim=function(){var a=this.head,b=this.tail,c=this.len;return this.reset().uint32(c),c&&(this.tail.next=a.next,this.tail=b,this.len+=c),this},l.prototype.finish=function(){for(var a=this.head.next,b=this.constructor.alloc(this.len),c=0;a;)a.fn(a.val,b,c),c+=a.len,a=a.next;return b},l._configure=function(a){d=a,l.create=m(),d._configure()}},19309,(a,b,c)=>{"use strict";b.exports=h;var d=a.r(51096),e=a.r(47172),f=a.r(28509);function g(a){return"missing required '"+a.name+"'"}function h(a){for(var b=f.codegen(["r","l","e"],a.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(a.fieldsArray.filter(function(a){return a.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()")("if(t===e)")("break")("switch(t>>>3){"),c=0;c<a.fieldsArray.length;++c){var h=a._fieldsArray[c].resolve(),i=h.resolvedType instanceof d?"int32":h.type,j="m"+f.safeProp(h.name);b("case %i: {",h.id),h.map?(b("if(%s===util.emptyObject)",j)("%s={}",j)("var c2 = r.uint32()+r.pos"),void 0!==e.defaults[h.keyType]?b("k=%j",e.defaults[h.keyType]):b("k=null"),void 0!==e.defaults[i]?b("value=%j",e.defaults[i]):b("value=null"),b("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",h.keyType)("case 2:"),void 0===e.basic[i]?b("value=types[%i].decode(r,r.uint32())",c):b("value=r.%s()",i),b("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),void 0!==e.long[h.keyType]?b('%s[typeof k==="object"?util.longToHash(k):k]=value',j):b("%s[k]=value",j)):h.repeated?(b("if(!(%s&&%s.length))",j,j)("%s=[]",j),void 0!==e.packed[i]&&b("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",j,i)("}else"),void 0===e.basic[i]?b(h.delimited?"%s.push(types[%i].decode(r,undefined,((t&~7)|4)))":"%s.push(types[%i].decode(r,r.uint32()))",j,c):b("%s.push(r.%s())",j,i)):void 0===e.basic[i]?b(h.delimited?"%s=types[%i].decode(r,undefined,((t&~7)|4))":"%s=types[%i].decode(r,r.uint32())",j,c):b("%s=r.%s()",j,i),b("break")("}")}for(b("default:")("r.skipType(t&7)")("break")("}")("}"),c=0;c<a._fieldsArray.length;++c){var k=a._fieldsArray[c];k.required&&b("if(!m.hasOwnProperty(%j))",k.name)("throw util.ProtocolError(%j,{instance:m})",g(k))}return b("return m")}},53041,(a,b,c)=>{"use strict";b.exports=i;var d=a.r(51096),e=a.r(28509);function f(a,b){return a.name+": "+b+(a.repeated&&"array"!==b?"[]":a.map&&"object"!==b?"{k:"+a.keyType+"}":"")+" expected"}function g(a,b,c,e){if(b.resolvedType)if(b.resolvedType instanceof d){a("switch(%s){",e)("default:")("return%j",f(b,"enum value"));for(var g=Object.keys(b.resolvedType.values),h=0;h<g.length;++h)a("case %i:",b.resolvedType.values[g[h]]);a("break")("}")}else a("{")("var e=types[%i].verify(%s);",c,e)("if(e)")("return%j+e",b.name+".")("}");else switch(b.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":a("if(!util.isInteger(%s))",e)("return%j",f(b,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":a("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",e,e,e,e)("return%j",f(b,"integer|Long"));break;case"float":case"double":a('if(typeof %s!=="number")',e)("return%j",f(b,"number"));break;case"bool":a('if(typeof %s!=="boolean")',e)("return%j",f(b,"boolean"));break;case"string":a("if(!util.isString(%s))",e)("return%j",f(b,"string"));break;case"bytes":a('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',e,e,e)("return%j",f(b,"buffer"))}return a}function h(a,b,c){switch(b.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":a("if(!util.key32Re.test(%s))",c)("return%j",f(b,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":a("if(!util.key64Re.test(%s))",c)("return%j",f(b,"integer|Long key"));break;case"bool":a("if(!util.key2Re.test(%s))",c)("return%j",f(b,"boolean key"))}return a}function i(a){var b=e.codegen(["m"],a.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),c=a.oneofsArray,d={};c.length&&b("var p={}");for(var i=0;i<a.fieldsArray.length;++i){var j=a._fieldsArray[i].resolve(),k="m"+e.safeProp(j.name);if(j.optional&&b("if(%s!=null&&m.hasOwnProperty(%j)){",k,j.name),j.map)b("if(!util.isObject(%s))",k)("return%j",f(j,"object"))("var k=Object.keys(%s)",k)("for(var i=0;i<k.length;++i){"),h(b,j,"k[i]"),g(b,j,i,k+"[k[i]]")("}");else if(j.repeated)b("if(!Array.isArray(%s))",k)("return%j",f(j,"array"))("for(var i=0;i<%s.length;++i){",k),g(b,j,i,k+"[i]")("}");else{if(j.partOf){var l=e.safeProp(j.partOf.name);1===d[j.partOf.name]&&b("if(p%s===1)",l)("return%j",j.partOf.name+": multiple values"),d[j.partOf.name]=1,b("p%s=1",l)}g(b,j,i,k)}j.optional&&b("}")}return b("return null")}},86100,(a,b,c)=>{"use strict";var d=c,e=a.r(51096),f=a.r(28509);function g(a,b,c,d){var f=!1;if(b.resolvedType)if(b.resolvedType instanceof e){a("switch(d%s){",d);for(var g=b.resolvedType.values,h=Object.keys(g),i=0;i<h.length;++i)g[h[i]]!==b.typeDefault||f||(a("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',d,d,d),b.repeated||a("break"),f=!0),a("case%j:",h[i])("case %i:",g[h[i]])("m%s=%j",d,g[h[i]])("break");a("}")}else a('if(typeof d%s!=="object")',d)("throw TypeError(%j)",b.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",d,c,d);else{var j=!1;switch(b.type){case"double":case"float":a("m%s=Number(d%s)",d,d);break;case"uint32":case"fixed32":a("m%s=d%s>>>0",d,d);break;case"int32":case"sint32":case"sfixed32":a("m%s=d%s|0",d,d);break;case"uint64":j=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":a("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",d,d,j)('else if(typeof d%s==="string")',d)("m%s=parseInt(d%s,10)",d,d)('else if(typeof d%s==="number")',d)("m%s=d%s",d,d)('else if(typeof d%s==="object")',d)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",d,d,d,j?"true":"");break;case"bytes":a('if(typeof d%s==="string")',d)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",d,d,d)("else if(d%s.length >= 0)",d)("m%s=d%s",d,d);break;case"string":a("m%s=String(d%s)",d,d);break;case"bool":a("m%s=Boolean(d%s)",d,d)}}return a}function h(a,b,c,d){if(b.resolvedType)b.resolvedType instanceof e?a("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",d,c,d,d,c,d,d):a("d%s=types[%i].toObject(m%s,o)",d,c,d);else{var f=!1;switch(b.type){case"double":case"float":a("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",d,d,d,d);break;case"uint64":f=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":a('if(typeof m%s==="number")',d)("d%s=o.longs===String?String(m%s):m%s",d,d,d)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",d,d,d,d,f?"true":"",d);break;case"bytes":a("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",d,d,d,d,d);break;default:a("d%s=m%s",d,d)}}return a}d.fromObject=function(a){var b=a.fieldsArray,c=f.codegen(["d"],a.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!b.length)return c("return new this.ctor");c("var m=new this.ctor");for(var d=0;d<b.length;++d){var h=b[d].resolve(),i=f.safeProp(h.name);h.map?(c("if(d%s){",i)('if(typeof d%s!=="object")',i)("throw TypeError(%j)",h.fullName+": object expected")("m%s={}",i)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",i),g(c,h,d,i+"[ks[i]]")("}")("}")):h.repeated?(c("if(d%s){",i)("if(!Array.isArray(d%s))",i)("throw TypeError(%j)",h.fullName+": array expected")("m%s=[]",i)("for(var i=0;i<d%s.length;++i){",i),g(c,h,d,i+"[i]")("}")("}")):(h.resolvedType instanceof e||c("if(d%s!=null){",i),g(c,h,d,i),h.resolvedType instanceof e||c("}"))}return c("return m")},d.toObject=function(a){var b=a.fieldsArray.slice().sort(f.compareFieldsById);if(!b.length)return f.codegen()("return {}");for(var c=f.codegen(["m","o"],a.name+"$toObject")("if(!o)")("o={}")("var d={}"),d=[],g=[],i=[],j=0;j<b.length;++j)b[j].partOf||(b[j].resolve().repeated?d:b[j].map?g:i).push(b[j]);if(d.length){for(c("if(o.arrays||o.defaults){"),j=0;j<d.length;++j)c("d%s=[]",f.safeProp(d[j].name));c("}")}if(g.length){for(c("if(o.objects||o.defaults){"),j=0;j<g.length;++j)c("d%s={}",f.safeProp(g[j].name));c("}")}if(i.length){for(c("if(o.defaults){"),j=0;j<i.length;++j){var k=i[j],l=f.safeProp(k.name);if(k.resolvedType instanceof e)c("d%s=o.enums===String?%j:%j",l,k.resolvedType.valuesById[k.typeDefault],k.typeDefault);else if(k.long)c("if(util.Long){")("var n=new util.Long(%i,%i,%j)",k.typeDefault.low,k.typeDefault.high,k.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",l)("}else")("d%s=o.longs===String?%j:%i",l,k.typeDefault.toString(),k.typeDefault.toNumber());else if(k.bytes){var m="["+Array.prototype.slice.call(k.typeDefault).join(",")+"]";c("if(o.bytes===String)d%s=%j",l,String.fromCharCode.apply(String,k.typeDefault))("else{")("d%s=%s",l,m)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",l,l)("}")}else c("d%s=%j",l,k.typeDefault)}c("}")}var n=!1;for(j=0;j<b.length;++j){var k=b[j],o=a._fieldsArray.indexOf(k),l=f.safeProp(k.name);k.map?(n||(n=!0,c("var ks2")),c("if(m%s&&(ks2=Object.keys(m%s)).length){",l,l)("d%s={}",l)("for(var j=0;j<ks2.length;++j){"),h(c,k,o,l+"[ks2[j]]")("}")):k.repeated?(c("if(m%s&&m%s.length){",l,l)("d%s=[]",l)("for(var j=0;j<m%s.length;++j){",l),h(c,k,o,l+"[j]")("}")):(c("if(m%s!=null&&m.hasOwnProperty(%j)){",l,k.name),h(c,k,o,l),k.partOf&&c("if(o.oneofs)")("d%s=%j",f.safeProp(k.partOf.name),k.name)),c("}")}return c("return d")}},55782,(a,b,c)=>{"use strict";var d=c,e=a.r(96354);d[".google.protobuf.Any"]={fromObject:function(a){if(a&&a["@type"]){var b=a["@type"].substring(a["@type"].lastIndexOf("/")+1),c=this.lookup(b);if(c){var d="."===a["@type"].charAt(0)?a["@type"].slice(1):a["@type"];return -1===d.indexOf("/")&&(d="/"+d),this.create({type_url:d,value:c.encode(c.fromObject(a)).finish()})}}return this.fromObject(a)},toObject:function(a,b){var c="type.googleapis.com/",d="",f="";if(b&&b.json&&a.type_url&&a.value){f=a.type_url.substring(a.type_url.lastIndexOf("/")+1),d=a.type_url.substring(0,a.type_url.lastIndexOf("/")+1);var g=this.lookup(f);g&&(a=g.decode(a.value))}if(!(a instanceof this.ctor)&&a instanceof e){var h=a.$type.toObject(a,b),i="."===a.$type.fullName[0]?a.$type.fullName.slice(1):a.$type.fullName;return""===d&&(d=c),f=d+i,h["@type"]=f,h}return this.toObject(a,b)}}},4018,(a,b,c)=>{"use strict";b.exports=s;var d=a.r(90063);((s.prototype=Object.create(d.prototype)).constructor=s).className="Type";var e=a.r(51096),f=a.r(88108),g=a.r(44529),h=a.r(58104),i=a.r(31908),j=a.r(96354),k=a.r(20734),l=a.r(82457),m=a.r(28509),n=a.r(77773),o=a.r(19309),p=a.r(53041),q=a.r(86100),r=a.r(55782);function s(a,b){d.call(this,a,b),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}function t(a){return a._fieldsById=a._fieldsArray=a._oneofsArray=null,delete a.encode,delete a.decode,delete a.verify,a}Object.defineProperties(s.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var a=Object.keys(this.fields),b=0;b<a.length;++b){var c=this.fields[a[b]],d=c.id;if(this._fieldsById[d])throw Error("duplicate id "+d+" in "+this);this._fieldsById[d]=c}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=m.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=m.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=s.generateConstructor(this)())},set:function(a){var b=a.prototype;b instanceof j||((a.prototype=new j).constructor=a,m.merge(a.prototype,b)),a.$type=a.prototype.$type=this,m.merge(a,j,!0),this._ctor=a;for(var c=0;c<this.fieldsArray.length;++c)this._fieldsArray[c].resolve();var d={};for(c=0;c<this.oneofsArray.length;++c)d[this._oneofsArray[c].resolve().name]={get:m.oneOfGetter(this._oneofsArray[c].oneof),set:m.oneOfSetter(this._oneofsArray[c].oneof)};c&&Object.defineProperties(a.prototype,d)}}}),s.generateConstructor=function(a){for(var b,c=m.codegen(["p"],a.name),d=0;d<a.fieldsArray.length;++d)(b=a._fieldsArray[d]).map?c("this%s={}",m.safeProp(b.name)):b.repeated&&c("this%s=[]",m.safeProp(b.name));return c("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")},s.fromJSON=function(a,b){var c=new s(a,b.options);c.extensions=b.extensions,c.reserved=b.reserved;for(var j=Object.keys(b.fields),k=0;k<j.length;++k)c.add((void 0!==b.fields[j[k]].keyType?h.fromJSON:g.fromJSON)(j[k],b.fields[j[k]]));if(b.oneofs)for(j=Object.keys(b.oneofs),k=0;k<j.length;++k)c.add(f.fromJSON(j[k],b.oneofs[j[k]]));if(b.nested)for(j=Object.keys(b.nested),k=0;k<j.length;++k){var l=b.nested[j[k]];c.add((void 0!==l.id?g.fromJSON:void 0!==l.fields?s.fromJSON:void 0!==l.values?e.fromJSON:void 0!==l.methods?i.fromJSON:d.fromJSON)(j[k],l))}return b.extensions&&b.extensions.length&&(c.extensions=b.extensions),b.reserved&&b.reserved.length&&(c.reserved=b.reserved),b.group&&(c.group=!0),b.comment&&(c.comment=b.comment),b.edition&&(c._edition=b.edition),c._defaultEdition="proto3",c},s.prototype.toJSON=function(a){var b=d.prototype.toJSON.call(this,a),c=!!a&&!!a.keepComments;return m.toObject(["edition",this._editionToJSON(),"options",b&&b.options||void 0,"oneofs",d.arrayToJSON(this.oneofsArray,a),"fields",d.arrayToJSON(this.fieldsArray.filter(function(a){return!a.declaringField}),a)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",b&&b.nested||void 0,"comment",c?this.comment:void 0])},s.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;d.prototype.resolveAll.call(this);var a=this.oneofsArray;for(c=0;c<a.length;)a[c++].resolve();for(var b=this.fieldsArray,c=0;c<b.length;)b[c++].resolve();return this},s.prototype._resolveFeaturesRecursive=function(a){return this._needsRecursiveFeatureResolution&&(a=this._edition||a,d.prototype._resolveFeaturesRecursive.call(this,a),this.oneofsArray.forEach(b=>{b._resolveFeatures(a)}),this.fieldsArray.forEach(b=>{b._resolveFeatures(a)})),this},s.prototype.get=function(a){return this.fields[a]||this.oneofs&&this.oneofs[a]||this.nested&&this.nested[a]||null},s.prototype.add=function(a){if(this.get(a.name))throw Error("duplicate name '"+a.name+"' in "+this);if(a instanceof g&&void 0===a.extend){if(this._fieldsById?this._fieldsById[a.id]:this.fieldsById[a.id])throw Error("duplicate id "+a.id+" in "+this);if(this.isReservedId(a.id))throw Error("id "+a.id+" is reserved in "+this);if(this.isReservedName(a.name))throw Error("name '"+a.name+"' is reserved in "+this);return a.parent&&a.parent.remove(a),this.fields[a.name]=a,a.message=this,a.onAdd(this),t(this)}return a instanceof f?(this.oneofs||(this.oneofs={}),this.oneofs[a.name]=a,a.onAdd(this),t(this)):d.prototype.add.call(this,a)},s.prototype.remove=function(a){if(a instanceof g&&void 0===a.extend){if(!this.fields||this.fields[a.name]!==a)throw Error(a+" is not a member of "+this);return delete this.fields[a.name],a.parent=null,a.onRemove(this),t(this)}if(a instanceof f){if(!this.oneofs||this.oneofs[a.name]!==a)throw Error(a+" is not a member of "+this);return delete this.oneofs[a.name],a.parent=null,a.onRemove(this),t(this)}return d.prototype.remove.call(this,a)},s.prototype.isReservedId=function(a){return d.isReservedId(this.reserved,a)},s.prototype.isReservedName=function(a){return d.isReservedName(this.reserved,a)},s.prototype.create=function(a){return new this.ctor(a)},s.prototype.setup=function(){for(var a=this.fullName,b=[],c=0;c<this.fieldsArray.length;++c)b.push(this._fieldsArray[c].resolve().resolvedType);this.encode=n(this)({Writer:l,types:b,util:m}),this.decode=o(this)({Reader:k,types:b,util:m}),this.verify=p(this)({types:b,util:m}),this.fromObject=q.fromObject(this)({types:b,util:m}),this.toObject=q.toObject(this)({types:b,util:m});var d=r[a];if(d){var e=Object.create(this);e.fromObject=this.fromObject,this.fromObject=d.fromObject.bind(e),e.toObject=this.toObject,this.toObject=d.toObject.bind(e)}return this},s.prototype.encode=function(a,b){return this.setup().encode(a,b)},s.prototype.encodeDelimited=function(a,b){return this.encode(a,b&&b.len?b.fork():b).ldelim()},s.prototype.decode=function(a,b){return this.setup().decode(a,b)},s.prototype.decodeDelimited=function(a){return a instanceof k||(a=k.create(a)),this.decode(a,a.uint32())},s.prototype.verify=function(a){return this.setup().verify(a)},s.prototype.fromObject=function(a){return this.setup().fromObject(a)},s.prototype.toObject=function(a,b){return this.setup().toObject(a,b)},s.d=function(a){return function(b){m.decorateType(b,a)}}},77756,(a,b,c)=>{"use strict";b.exports=l;var d,e,f,g=a.r(90063);((l.prototype=Object.create(g.prototype)).constructor=l).className="Root";var h=a.r(44529),i=a.r(51096),j=a.r(88108),k=a.r(28509);function l(a){g.call(this,"",a),this.deferred=[],this.files=[],this._edition="proto2",this._fullyQualifiedObjects={}}function m(){}l.fromJSON=function(a,b){return b||(b=new l),a.options&&b.setOptions(a.options),b.addJSON(a.nested).resolveAll()},l.prototype.resolvePath=k.path.resolve,l.prototype.fetch=k.fetch,l.prototype.load=function a(b,c,d){"function"==typeof c&&(d=c,c=void 0);var g=this;if(!d)return k.asPromise(a,g,b,c);var h=d===m;function i(a,b){if(d){if(h)throw a;b&&b.resolveAll();var c=d;d=null,c(a,b)}}function j(a){var b=a.lastIndexOf("google/protobuf/");if(b>-1){var c=a.substring(b);if(c in f)return c}return null}function l(a,b){try{if(k.isString(b)&&"{"===b.charAt(0)&&(b=JSON.parse(b)),k.isString(b)){e.filename=a;var d,f=e(b,g,c),l=0;if(f.imports)for(;l<f.imports.length;++l)(d=j(f.imports[l])||g.resolvePath(a,f.imports[l]))&&n(d);if(f.weakImports)for(l=0;l<f.weakImports.length;++l)(d=j(f.weakImports[l])||g.resolvePath(a,f.weakImports[l]))&&n(d,!0)}else g.setOptions(b.options).addJSON(b.nested)}catch(a){i(a)}h||o||i(null,g)}function n(a,b){if(a=j(a)||a,!(g.files.indexOf(a)>-1)){if(g.files.push(a),a in f)return void(h?l(a,f[a]):(++o,setTimeout(function(){--o,l(a,f[a])})));if(h){var c;try{c=k.fs.readFileSync(a).toString("utf8")}catch(a){b||i(a);return}l(a,c)}else++o,g.fetch(a,function(c,e){if(--o,d){if(c)return void(b?o||i(null,g):i(c));l(a,e)}})}}var o=0;k.isString(b)&&(b=[b]);for(var p,q=0;q<b.length;++q)(p=g.resolvePath("",b[q]))&&n(p);return h?g.resolveAll():o||i(null,g),g},l.prototype.loadSync=function(a,b){if(!k.isNode)throw Error("not supported");return this.load(a,b,m)},l.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(a){return"'extend "+a.extend+"' in "+a.parent.fullName}).join(", "));return g.prototype.resolveAll.call(this)};var n=/^[A-Z]/;function o(a,b){var c=b.parent.lookup(b.extend);if(c){var d=new h(b.fullName,b.id,b.type,b.rule,void 0,b.options);return!!c.get(d.name)||(d.declaringField=b,b.extensionField=d,c.add(d),!0)}return!1}l.prototype._handleAdd=function(a){if(a instanceof h)void 0===a.extend||a.extensionField||o(this,a)||this.deferred.push(a);else if(a instanceof i)n.test(a.name)&&(a.parent[a.name]=a.values);else if(!(a instanceof j)){if(a instanceof d)for(var b=0;b<this.deferred.length;)o(this,this.deferred[b])?this.deferred.splice(b,1):++b;for(var c=0;c<a.nestedArray.length;++c)this._handleAdd(a._nestedArray[c]);n.test(a.name)&&(a.parent[a.name]=a)}(a instanceof d||a instanceof i||a instanceof h)&&(this._fullyQualifiedObjects[a.fullName]=a)},l.prototype._handleRemove=function(a){if(a instanceof h){if(void 0!==a.extend)if(a.extensionField)a.extensionField.parent.remove(a.extensionField),a.extensionField=null;else{var b=this.deferred.indexOf(a);b>-1&&this.deferred.splice(b,1)}}else if(a instanceof i)n.test(a.name)&&delete a.parent[a.name];else if(a instanceof g){for(var c=0;c<a.nestedArray.length;++c)this._handleRemove(a._nestedArray[c]);n.test(a.name)&&delete a.parent[a.name]}delete this._fullyQualifiedObjects[a.fullName]},l._configure=function(a,b,c){d=a,e=b,f=c}},28509,(a,b,c)=>{"use strict";var d,e,f=b.exports=a.r(35086),g=a.r(18207);f.codegen=a.r(22469),f.fetch=a.r(32575),f.path=a.r(67058),f.fs=f.inquire("fs"),f.toArray=function(a){if(a){for(var b=Object.keys(a),c=Array(b.length),d=0;d<b.length;)c[d]=a[b[d++]];return c}return[]},f.toObject=function(a){for(var b={},c=0;c<a.length;){var d=a[c++],e=a[c++];void 0!==e&&(b[d]=e)}return b};var h=/\\/g,i=/"/g;f.isReserved=function(a){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(a)},f.safeProp=function(a){return!/^[$\w_]+$/.test(a)||f.isReserved(a)?'["'+a.replace(h,"\\\\").replace(i,'\\"')+'"]':"."+a},f.ucFirst=function(a){return a.charAt(0).toUpperCase()+a.substring(1)};var j=/_([a-z])/g;f.camelCase=function(a){return a.substring(0,1)+a.substring(1).replace(j,function(a,b){return b.toUpperCase()})},f.compareFieldsById=function(a,b){return a.id-b.id},f.decorateType=function(b,c){if(b.$type)return c&&b.$type.name!==c&&(f.decorateRoot.remove(b.$type),b.$type.name=c,f.decorateRoot.add(b.$type)),b.$type;d||(d=a.r(4018));var e=new d(c||b.name);return f.decorateRoot.add(e),e.ctor=b,Object.defineProperty(b,"$type",{value:e,enumerable:!1}),Object.defineProperty(b.prototype,"$type",{value:e,enumerable:!1}),e};var k=0;f.decorateEnum=function(b){if(b.$type)return b.$type;e||(e=a.r(51096));var c=new e("Enum"+k++,b);return f.decorateRoot.add(c),Object.defineProperty(b,"$type",{value:c,enumerable:!1}),c},f.setProperty=function(a,b,c,d){function e(a,b,c){var f=b.shift();if("__proto__"===f||"prototype"===f)return a;if(b.length>0)a[f]=e(a[f]||{},b,c);else{var g=a[f];if(g&&d)return a;g&&(c=[].concat(g).concat(c)),a[f]=c}return a}if("object"!=typeof a)throw TypeError("dst must be an object");if(!b)throw TypeError("path must be specified");return e(a,b=b.split("."),c)},Object.defineProperty(f,"decorateRoot",{get:function(){return g.decorated||(g.decorated=new(a.r(77756)))}})},47172,(a,b,c)=>{"use strict";var d=c,e=a.r(28509),f=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function g(a,b){var c=0,d={};for(b|=0;c<a.length;)d[f[c+b]]=a[c++];return d}d.basic=g([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),d.defaults=g([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",e.emptyArray,null]),d.long=g([0,0,0,1,1],7),d.mapKey=g([0,0,0,5,5,0,0,0,1,1,0,2],2),d.packed=g([1,5,0,0,0,5,5,0,0,0,1,1,0])},44529,(a,b,c)=>{"use strict";b.exports=j;var d,e=a.r(23476);((j.prototype=Object.create(e.prototype)).constructor=j).className="Field";var f=a.r(51096),g=a.r(47172),h=a.r(28509),i=/^required|optional|repeated$/;function j(a,b,c,d,f,j,k){if(h.isObject(d)?(k=f,j=d,d=f=void 0):h.isObject(f)&&(k=j,j=f,f=void 0),e.call(this,a,j),!h.isInteger(b)||b<0)throw TypeError("id must be a non-negative integer");if(!h.isString(c))throw TypeError("type must be a string");if(void 0!==d&&!i.test(d=d.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(void 0!==f&&!h.isString(f))throw TypeError("extend must be a string");"proto3_optional"===d&&(d="optional"),this.rule=d&&"optional"!==d?d:void 0,this.type=c,this.id=b,this.extend=f||void 0,this.repeated="repeated"===d,this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=!!h.Long&&void 0!==g.long[c],this.bytes="bytes"===c,this.resolvedType=null,this.extensionField=null,this.declaringField=null,this.comment=k}j.fromJSON=function(a,b){var c=new j(a,b.id,b.type,b.rule,b.extend,b.options,b.comment);return b.edition&&(c._edition=b.edition),c._defaultEdition="proto3",c},Object.defineProperty(j.prototype,"required",{get:function(){return"LEGACY_REQUIRED"===this._features.field_presence}}),Object.defineProperty(j.prototype,"optional",{get:function(){return!this.required}}),Object.defineProperty(j.prototype,"delimited",{get:function(){return this.resolvedType instanceof d&&"DELIMITED"===this._features.message_encoding}}),Object.defineProperty(j.prototype,"packed",{get:function(){return"PACKED"===this._features.repeated_field_encoding}}),Object.defineProperty(j.prototype,"hasPresence",{get:function(){return!this.repeated&&!this.map&&(this.partOf||this.declaringField||this.extensionField||"IMPLICIT"!==this._features.field_presence)}}),j.prototype.setOption=function(a,b,c){return e.prototype.setOption.call(this,a,b,c)},j.prototype.toJSON=function(a){var b=!!a&&!!a.keepComments;return h.toObject(["edition",this._editionToJSON(),"rule","optional"!==this.rule&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",b?this.comment:void 0])},j.prototype.resolve=function(){if(this.resolved)return this;if(void 0===(this.typeDefault=g.defaults[this.type])?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof d?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&null!=this.options.default&&(this.typeDefault=this.options.default,this.resolvedType instanceof f&&"string"==typeof this.typeDefault&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(void 0===this.options.packed||!this.resolvedType||this.resolvedType instanceof f||delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=h.Long.fromNumber(this.typeDefault,"u"===this.type.charAt(0)),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&"string"==typeof this.typeDefault){var a;h.base64.test(this.typeDefault)?h.base64.decode(this.typeDefault,a=h.newBuffer(h.base64.length(this.typeDefault)),0):h.utf8.write(this.typeDefault,a=h.newBuffer(h.utf8.length(this.typeDefault)),0),this.typeDefault=a}return this.map?this.defaultValue=h.emptyObject:this.repeated?this.defaultValue=h.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof d&&(this.parent.ctor.prototype[this.name]=this.defaultValue),e.prototype.resolve.call(this)},j.prototype._inferLegacyProtoFeatures=function(a){if("proto2"!==a&&"proto3"!==a)return{};var b={};if("required"===this.rule&&(b.field_presence="LEGACY_REQUIRED"),this.parent&&void 0===g.defaults[this.type]){var c=this.parent.get(this.type.split(".").pop());c&&c instanceof d&&c.group&&(b.message_encoding="DELIMITED")}return!0===this.getOption("packed")?b.repeated_field_encoding="PACKED":!1===this.getOption("packed")&&(b.repeated_field_encoding="EXPANDED"),b},j.prototype._resolveFeatures=function(a){return e.prototype._resolveFeatures.call(this,this._edition||a)},j.d=function(a,b,c,d){return"function"==typeof b?b=h.decorateType(b).name:b&&"object"==typeof b&&(b=h.decorateEnum(b).name),function(e,f){h.decorateType(e.constructor).add(new j(f,a,b,c,{default:d}))}},j._configure=function(a){d=a}},88108,(a,b,c)=>{"use strict";b.exports=g;var d=a.r(23476);((g.prototype=Object.create(d.prototype)).constructor=g).className="OneOf";var e=a.r(44529),f=a.r(28509);function g(a,b,c,e){if(Array.isArray(b)||(c=b,b=void 0),d.call(this,a,c),!(void 0===b||Array.isArray(b)))throw TypeError("fieldNames must be an Array");this.oneof=b||[],this.fieldsArray=[],this.comment=e}function h(a){if(a.parent)for(var b=0;b<a.fieldsArray.length;++b)a.fieldsArray[b].parent||a.parent.add(a.fieldsArray[b])}g.fromJSON=function(a,b){return new g(a,b.oneof,b.options,b.comment)},g.prototype.toJSON=function(a){var b=!!a&&!!a.keepComments;return f.toObject(["options",this.options,"oneof",this.oneof,"comment",b?this.comment:void 0])},g.prototype.add=function(a){if(!(a instanceof e))throw TypeError("field must be a Field");return a.parent&&a.parent!==this.parent&&a.parent.remove(a),this.oneof.push(a.name),this.fieldsArray.push(a),a.partOf=this,h(this),this},g.prototype.remove=function(a){if(!(a instanceof e))throw TypeError("field must be a Field");var b=this.fieldsArray.indexOf(a);if(b<0)throw Error(a+" is not a member of "+this);return this.fieldsArray.splice(b,1),(b=this.oneof.indexOf(a.name))>-1&&this.oneof.splice(b,1),a.partOf=null,this},g.prototype.onAdd=function(a){d.prototype.onAdd.call(this,a);for(var b=this,c=0;c<this.oneof.length;++c){var e=a.get(this.oneof[c]);e&&!e.partOf&&(e.partOf=b,b.fieldsArray.push(e))}h(this)},g.prototype.onRemove=function(a){for(var b,c=0;c<this.fieldsArray.length;++c)(b=this.fieldsArray[c]).parent&&b.parent.remove(b);d.prototype.onRemove.call(this,a)},Object.defineProperty(g.prototype,"isProto3Optional",{get:function(){if(null==this.fieldsArray||1!==this.fieldsArray.length)return!1;var a=this.fieldsArray[0];return null!=a.options&&!0===a.options.proto3_optional}}),g.d=function(){for(var a=Array(arguments.length),b=0;b<arguments.length;)a[b]=arguments[b++];return function(b,c){f.decorateType(b.constructor).add(new g(c,a)),Object.defineProperty(b,c,{get:f.oneOfGetter(a),set:f.oneOfSetter(a)})}}},23476,(a,b,c)=>{"use strict";b.exports=j,j.className="ReflectionObject";let d=a.r(88108);var e,f=a.r(28509),g={enum_type:"OPEN",field_presence:"EXPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"},h={enum_type:"CLOSED",field_presence:"EXPLICIT",json_format:"LEGACY_BEST_EFFORT",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"EXPANDED",utf8_validation:"NONE"},i={enum_type:"OPEN",field_presence:"IMPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"};function j(a,b){if(!f.isString(a))throw TypeError("name must be a string");if(b&&!f.isObject(b))throw TypeError("options must be an object");this.options=b,this.parsedOptions=null,this.name=a,this._edition=null,this._defaultEdition="proto2",this._features={},this._featuresResolved=!1,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(j.prototype,{root:{get:function(){for(var a=this;null!==a.parent;)a=a.parent;return a}},fullName:{get:function(){for(var a=[this.name],b=this.parent;b;)a.unshift(b.name),b=b.parent;return a.join(".")}}}),j.prototype.toJSON=function(){throw Error()},j.prototype.onAdd=function(a){this.parent&&this.parent!==a&&this.parent.remove(this),this.parent=a,this.resolved=!1;var b=a.root;b instanceof e&&b._handleAdd(this)},j.prototype.onRemove=function(a){var b=a.root;b instanceof e&&b._handleRemove(this),this.parent=null,this.resolved=!1},j.prototype.resolve=function(){return this.resolved||this.root instanceof e&&(this.resolved=!0),this},j.prototype._resolveFeaturesRecursive=function(a){return this._resolveFeatures(this._edition||a)},j.prototype._resolveFeatures=function(a){if(!this._featuresResolved){var b={};if(!a)throw Error("Unknown edition for "+this.fullName);var c=Object.assign(this.options?Object.assign({},this.options.features):{},this._inferLegacyProtoFeatures(a));if(this._edition){if("proto2"===a)b=Object.assign({},h);else if("proto3"===a)b=Object.assign({},i);else if("2023"===a)b=Object.assign({},g);else throw Error("Unknown edition: "+a);this._features=Object.assign(b,c||{}),this._featuresResolved=!0;return}if(this.partOf instanceof d){var e=Object.assign({},this.partOf._features);this._features=Object.assign(e,c||{})}else if(this.declaringField);else if(this.parent){var f=Object.assign({},this.parent._features);this._features=Object.assign(f,c||{})}else throw Error("Unable to find a parent for "+this.fullName);this.extensionField&&(this.extensionField._features=this._features),this._featuresResolved=!0}},j.prototype._inferLegacyProtoFeatures=function(){return{}},j.prototype.getOption=function(a){if(this.options)return this.options[a]},j.prototype.setOption=function(a,b,c){return this.options||(this.options={}),/^features\./.test(a)?f.setProperty(this.options,a,b,c):c&&void 0!==this.options[a]||(this.getOption(a)!==b&&(this.resolved=!1),this.options[a]=b),this},j.prototype.setParsedOption=function(a,b,c){this.parsedOptions||(this.parsedOptions=[]);var d=this.parsedOptions;if(c){var e=d.find(function(b){return Object.prototype.hasOwnProperty.call(b,a)});if(e){var g=e[a];f.setProperty(g,c,b)}else(e={})[a]=f.setProperty({},c,b),d.push(e)}else{var h={};h[a]=b,d.push(h)}return this},j.prototype.setOptions=function(a,b){if(a)for(var c=Object.keys(a),d=0;d<c.length;++d)this.setOption(c[d],a[c[d]],b);return this},j.prototype.toString=function(){var a=this.constructor.className,b=this.fullName;return b.length?a+" "+b:a},j.prototype._editionToJSON=function(){if(this._edition&&"proto3"!==this._edition)return this._edition},j._configure=function(a){e=a}},51096,(a,b,c)=>{"use strict";b.exports=g;var d=a.r(23476);((g.prototype=Object.create(d.prototype)).constructor=g).className="Enum";var e=a.r(90063),f=a.r(28509);function g(a,b,c,e,f,g){if(d.call(this,a,c),b&&"object"!=typeof b)throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=e,this.comments=f||{},this.valuesOptions=g,this._valuesFeatures={},this.reserved=void 0,b)for(var h=Object.keys(b),i=0;i<h.length;++i)"number"==typeof b[h[i]]&&(this.valuesById[this.values[h[i]]=b[h[i]]]=h[i])}g.prototype._resolveFeatures=function(a){return a=this._edition||a,d.prototype._resolveFeatures.call(this,a),Object.keys(this.values).forEach(a=>{var b=Object.assign({},this._features);this._valuesFeatures[a]=Object.assign(b,this.valuesOptions&&this.valuesOptions[a]&&this.valuesOptions[a].features)}),this},g.fromJSON=function(a,b){var c=new g(a,b.values,b.options,b.comment,b.comments);return c.reserved=b.reserved,b.edition&&(c._edition=b.edition),c._defaultEdition="proto3",c},g.prototype.toJSON=function(a){var b=!!a&&!!a.keepComments;return f.toObject(["edition",this._editionToJSON(),"options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",b?this.comment:void 0,"comments",b?this.comments:void 0])},g.prototype.add=function(a,b,c,d){if(!f.isString(a))throw TypeError("name must be a string");if(!f.isInteger(b))throw TypeError("id must be an integer");if(void 0!==this.values[a])throw Error("duplicate name '"+a+"' in "+this);if(this.isReservedId(b))throw Error("id "+b+" is reserved in "+this);if(this.isReservedName(a))throw Error("name '"+a+"' is reserved in "+this);if(void 0!==this.valuesById[b]){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+b+" in "+this);this.values[a]=b}else this.valuesById[this.values[a]=b]=a;return d&&(void 0===this.valuesOptions&&(this.valuesOptions={}),this.valuesOptions[a]=d||null),this.comments[a]=c||null,this},g.prototype.remove=function(a){if(!f.isString(a))throw TypeError("name must be a string");var b=this.values[a];if(null==b)throw Error("name '"+a+"' does not exist in "+this);return delete this.valuesById[b],delete this.values[a],delete this.comments[a],this.valuesOptions&&delete this.valuesOptions[a],this},g.prototype.isReservedId=function(a){return e.isReservedId(this.reserved,a)},g.prototype.isReservedName=function(a){return e.isReservedName(this.reserved,a)}},77773,(a,b,c)=>{"use strict";b.exports=h;var d=a.r(51096),e=a.r(47172),f=a.r(28509);function g(a,b,c,d){return b.delimited?a("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",c,d,(b.id<<3|3)>>>0,(b.id<<3|4)>>>0):a("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",c,d,(b.id<<3|2)>>>0)}function h(a){for(var b,c,h=f.codegen(["m","w"],a.name+"$encode")("if(!w)")("w=Writer.create()"),i=a.fieldsArray.slice().sort(f.compareFieldsById),b=0;b<i.length;++b){var j=i[b].resolve(),k=a._fieldsArray.indexOf(j),l=j.resolvedType instanceof d?"int32":j.type,m=e.basic[l];c="m"+f.safeProp(j.name),j.map?(h("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",c,j.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",c)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(j.id<<3|2)>>>0,8|e.mapKey[j.keyType],j.keyType),void 0===m?h("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",k,c):h(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|m,l,c),h("}")("}")):j.repeated?(h("if(%s!=null&&%s.length){",c,c),j.packed&&void 0!==e.packed[l]?h("w.uint32(%i).fork()",(j.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",c)("w.%s(%s[i])",l,c)("w.ldelim()"):(h("for(var i=0;i<%s.length;++i)",c),void 0===m?g(h,j,k,c+"[i]"):h("w.uint32(%i).%s(%s[i])",(j.id<<3|m)>>>0,l,c)),h("}")):(j.optional&&h("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",c,j.name),void 0===m?g(h,j,k,c):h("w.uint32(%i).%s(%s)",(j.id<<3|m)>>>0,l,c))}return h("return w")}},93497,(a,b,c)=>{"use strict";b.exports=f;var d=a.r(82457);(f.prototype=Object.create(d.prototype)).constructor=f;var e=a.r(35086);function f(){d.call(this)}function g(a,b,c){a.length<40?e.utf8.write(a,b,c):b.utf8Write?b.utf8Write(a,c):b.write(a,c)}f._configure=function(){f.alloc=e._Buffer_allocUnsafe,f.writeBytesBuffer=e.Buffer&&e.Buffer.prototype instanceof Uint8Array&&"set"===e.Buffer.prototype.set.name?function(a,b,c){b.set(a,c)}:function(a,b,c){if(a.copy)a.copy(b,c,0,a.length);else for(var d=0;d<a.length;)b[c++]=a[d++]}},f.prototype.bytes=function(a){e.isString(a)&&(a=e._Buffer_from(a,"base64"));var b=a.length>>>0;return this.uint32(b),b&&this._push(f.writeBytesBuffer,b,a),this},f.prototype.string=function(a){var b=e.Buffer.byteLength(a);return this.uint32(b),b&&this._push(g,b,a),this},f._configure()},61544,(a,b,c)=>{"use strict";b.exports=f;var d=a.r(20734);(f.prototype=Object.create(d.prototype)).constructor=f;var e=a.r(35086);function f(a){d.call(this,a)}f._configure=function(){e.Buffer&&(f.prototype._slice=e.Buffer.prototype.slice)},f.prototype.string=function(){var a=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+a,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+a,this.len))},f._configure()},40471,(a,b,c)=>{"use strict";var d=c;function e(){d.util._configure(),d.Writer._configure(d.BufferWriter),d.Reader._configure(d.BufferReader)}d.build="minimal",d.Writer=a.r(82457),d.BufferWriter=a.r(93497),d.Reader=a.r(20734),d.BufferReader=a.r(61544),d.util=a.r(35086),d.rpc=a.r(3509),d.roots=a.r(18207),d.configure=e,e()},64374,(a,b,c)=>{"use strict";var d=b.exports=a.r(40471);function e(a,b,c){return"function"==typeof b?(c=b,b=new d.Root):b||(b=new d.Root),b.load(a,c)}function f(a,b){return b||(b=new d.Root),b.loadSync(a)}d.build="light",d.load=e,d.loadSync=f,d.encoder=a.r(77773),d.decoder=a.r(19309),d.verifier=a.r(53041),d.converter=a.r(86100),d.ReflectionObject=a.r(23476),d.Namespace=a.r(90063),d.Root=a.r(77756),d.Enum=a.r(51096),d.Type=a.r(4018),d.Field=a.r(44529),d.OneOf=a.r(88108),d.MapField=a.r(58104),d.Service=a.r(31908),d.Method=a.r(81640),d.Message=a.r(96354),d.wrappers=a.r(55782),d.types=a.r(47172),d.util=a.r(28509),d.ReflectionObject._configure(d.Root),d.Namespace._configure(d.Type,d.Service,d.Enum),d.Root._configure(d.Type),d.Field._configure(d.Type)},11320,(a,b,c)=>{"use strict";b.exports=n;var d=/[\s{}=;:[\],'"()<>]/g,e=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,f=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,g=/^ *[*/]+ */,h=/^\s*\*?\/*/,i=/\n/g,j=/\s/,k=/\\(.?)/g,l={0:"\0",r:"\r",n:"\n",t:"	"};function m(a){return a.replace(k,function(a,b){switch(b){case"\\":case"":return b;default:return l[b]||""}})}function n(a,b){a=a.toString();var c=0,k=a.length,l=1,n=0,o={},p=[],q=null;function r(a){return Error("illegal "+a+" (line "+l+")")}function s(){var b="'"===q?f:e;b.lastIndex=c-1;var d=b.exec(a);if(!d)throw r("string");return c=b.lastIndex,y(q),q=null,m(d[1])}function t(b){return a.charAt(b)}function u(c,d,e){var f,j={type:a.charAt(c++),lineEmpty:!1,leading:e},k=c-(b?2:3);do if(--k<0||"\n"===(f=a.charAt(k))){j.lineEmpty=!0;break}while(" "===f||"	"===f)for(var m=a.substring(c,d).split(i),p=0;p<m.length;++p)m[p]=m[p].replace(b?h:g,"").trim();j.text=m.join("\n").trim(),o[l]=j,n=l}function v(b){var c=w(b),d=a.substring(b,c);return/^\s*\/\//.test(d)}function w(a){for(var b=a;b<k&&"\n"!==t(b);)b++;return b}function x(){if(p.length>0)return p.shift();if(q)return s();var e,f,g,h,i,m=0===c;do{if(c===k)return null;for(e=!1;j.test(g=t(c));)if("\n"===g&&(m=!0,++l),++c===k)return null;if("/"===t(c)){if(++c===k)throw r("comment");if("/"===t(c))if(b){if(h=c,i=!1,v(c-1)){i=!0;do if((c=w(c))===k||(c++,!m))break;while(v(c))}else c=Math.min(k,w(c)+1);i&&(u(h,c,m),m=!0),l++,e=!0}else{for(i="/"===t(h=c+1);"\n"!==t(++c);)if(c===k)return null;++c,i&&(u(h,c-1,m),m=!0),++l,e=!0}else{if("*"!==(g=t(c)))return"/";h=c+1,i=b||"*"===t(h);do{if("\n"===g&&++l,++c===k)throw r("comment");f=g,g=t(c)}while("*"!==f||"/"!==g)++c,i&&(u(h,c-2,m),m=!0),e=!0}}}while(e)var n=c;if(d.lastIndex=0,!d.test(t(n++)))for(;n<k&&!d.test(t(n));)++n;var o=a.substring(c,c=n);return('"'===o||"'"===o)&&(q=o),o}function y(a){p.push(a)}function z(){if(!p.length){var a=x();if(null===a)return null;y(a)}return p[0]}function A(a,b){var c=z();if(c===a)return x(),!0;if(!b)throw r("token '"+c+"', '"+a+"' expected");return!1}function B(a){var c,d=null;return void 0===a?(c=o[l-1],delete o[l-1],c&&(b||"*"===c.type||c.lineEmpty)&&(d=c.leading?c.text:null)):(n<a&&z(),c=o[a],delete o[a],c&&!c.lineEmpty&&(b||"/"===c.type)&&(d=c.leading?null:c.text)),d}return Object.defineProperty({next:x,peek:z,push:y,skip:A,cmnt:B},"line",{get:function(){return l}})}n.unescape=m},39825,(a,b,c)=>{"use strict";b.exports=y,y.filename=null,y.defaults={keepCase:!1};var d=a.r(11320),e=a.r(77756),f=a.r(4018),g=a.r(44529),h=a.r(58104),i=a.r(88108),j=a.r(51096),k=a.r(31908),l=a.r(81640),m=a.r(23476),n=a.r(47172),o=a.r(28509),p=/^[1-9][0-9]*$/,q=/^-?[1-9][0-9]*$/,r=/^0[x][0-9a-fA-F]+$/,s=/^-?0[x][0-9a-fA-F]+$/,t=/^0[0-7]+$/,u=/^-?0[0-7]+$/,v=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,w=/^[a-zA-Z_][a-zA-Z_0-9]*$/,x=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/;function y(a,b,c){b instanceof e||(c=b,b=new e),c||(c=y.defaults);var z,A,B,C,D=c.preferTrailingComment||!1,E=d(a,c.alternateCommentMode||!1),F=E.next,G=E.push,H=E.peek,I=E.skip,J=E.cmnt,K=!0,L="proto2",M=b,N=[],O={},P=c.keepCase?function(a){return a}:o.camelCase;function Q(){N.forEach(a=>{a._edition=L,Object.keys(O).forEach(b=>{void 0===a.getOption(b)&&a.setOption(b,O[b],!0)})})}function R(a,b,c){var d=y.filename;return c||(y.filename=null),Error("illegal "+(b||"token")+" '"+a+"' ("+(d?d+", ":"")+"line "+E.line+")")}function S(){var a,b=[];do{if('"'!==(a=F())&&"'"!==a)throw R(a);b.push(F()),I(a),a=H()}while('"'===a||"'"===a)return b.join("")}function T(a){var b=F();switch(b){case"'":case'"':return G(b),S();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return V(b,!0)}catch(c){if(a&&x.test(b))return b;throw R(b,"value")}}function U(a,b){do if(b&&('"'===(c=H())||"'"===c)){var c,d,e=S();if(a.push(e),L>=2023)throw R(e,"id")}else try{a.push([d=W(F()),I("to",!0)?W(F()):d])}catch(d){if(b&&x.test(c)&&L>=2023)a.push(c);else throw d}while(I(",",!0))var f={options:void 0};f.setOption=function(a,b){void 0===this.options&&(this.options={}),this.options[a]=b},aa(f,function(a){if("option"===a)ai(f,a),I(";");else throw R(a)},function(){am(f)})}function V(a,b){var c=1;switch("-"===a.charAt(0)&&(c=-1,a=a.substring(1)),a){case"inf":case"INF":case"Inf":return 1/0*c;case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(p.test(a))return c*parseInt(a,10);if(r.test(a))return c*parseInt(a,16);if(t.test(a))return c*parseInt(a,8);if(v.test(a))return c*parseFloat(a);throw R(a,"number",b)}function W(a,b){switch(a){case"max":case"MAX":case"Max":return 0x1fffffff;case"0":return 0}if(!b&&"-"===a.charAt(0))throw R(a,"id");if(q.test(a))return parseInt(a,10);if(s.test(a))return parseInt(a,16);if(u.test(a))return parseInt(a,8);throw R(a,"id")}function X(){if(void 0!==A)throw R("package");if(A=F(),!x.test(A))throw R(A,"name");M=M.define(A),I(";")}function Y(){var a,b=H();switch(b){case"weak":a=C||(C=[]),F();break;case"public":F();default:a=B||(B=[])}b=S(),I(";"),a.push(b)}function Z(){if(I("="),(L=S())<2023)throw R(L,"syntax");I(";")}function $(){if(I("="),!["2023"].includes(L=S()))throw R(L,"edition");I(";")}function _(a,b){switch(b){case"option":return ai(a,b),I(";"),!0;case"message":return ab(a,b),!0;case"enum":return ag(a,b),!0;case"service":return an(a,b),!0;case"extend":return ap(a,b),!0}return!1}function aa(a,b,c){var d,e=E.line;if(a&&("string"!=typeof a.comment&&(a.comment=J()),a.filename=y.filename),I("{",!0)){for(;"}"!==(d=F());)b(d);I(";",!0)}else c&&c(),I(";"),a&&("string"!=typeof a.comment||D)&&(a.comment=J(e)||a.comment)}function ab(a,b){if(!w.test(b=F()))throw R(b,"type name");var c=new f(b);aa(c,function(a){if(!_(c,a))switch(a){case"map":ae(c,a);break;case"required":if("proto2"!==L)throw R(a);case"repeated":ac(c,a);break;case"optional":if("proto3"===L)ac(c,"proto3_optional");else if("proto2"!==L)throw R(a);else ac(c,"optional");break;case"oneof":af(c,a);break;case"extensions":U(c.extensions||(c.extensions=[]));break;case"reserved":U(c.reserved||(c.reserved=[]),!0);break;default:if("proto2"===L||!x.test(a))throw R(a);G(a),ac(c,"optional")}}),a.add(c),a===M&&N.push(c)}function ac(a,b,c){var d=F();if("group"===d)return void ad(a,b);for(;d.endsWith(".")||H().startsWith(".");)d+=F();if(!x.test(d))throw R(d,"type");var e=F();if(!w.test(e))throw R(e,"name");e=P(e),I("=");var f=new g(e,W(F()),d,b,c);if(aa(f,function(a){if("option"===a)ai(f,a),I(";");else throw R(a)},function(){am(f)}),"proto3_optional"===b){var h=new i("_"+e);f.setOption("proto3_optional",!0),h.add(f),a.add(h)}else a.add(f);a===M&&N.push(f)}function ad(a,b){if(L>=2023)throw R("group");var c=F();if(!w.test(c))throw R(c,"name");var d=o.lcFirst(c);c===d&&(c=o.ucFirst(c)),I("=");var e=W(F()),h=new f(c);h.group=!0;var i=new g(d,e,c,b);i.filename=y.filename,aa(h,function(a){switch(a){case"option":ai(h,a),I(";");break;case"required":case"repeated":ac(h,a);break;case"optional":"proto3"===L?ac(h,"proto3_optional"):ac(h,"optional");break;case"message":ab(h,a);break;case"enum":ag(h,a);break;case"reserved":U(h.reserved||(h.reserved=[]),!0);break;default:throw R(a)}}),a.add(h).add(i)}function ae(a){I("<");var b=F();if(void 0===n.mapKey[b])throw R(b,"type");I(",");var c=F();if(!x.test(c))throw R(c,"type");I(">");var d=F();if(!w.test(d))throw R(d,"name");I("=");var e=new h(P(d),W(F()),b,c);aa(e,function(a){if("option"===a)ai(e,a),I(";");else throw R(a)},function(){am(e)}),a.add(e)}function af(a,b){if(!w.test(b=F()))throw R(b,"name");var c=new i(P(b));aa(c,function(a){"option"===a?(ai(c,a),I(";")):(G(a),ac(c,"optional"))}),a.add(c)}function ag(a,b){if(!w.test(b=F()))throw R(b,"name");var c=new j(b);aa(c,function(a){switch(a){case"option":ai(c,a),I(";");break;case"reserved":U(c.reserved||(c.reserved=[]),!0),void 0===c.reserved&&(c.reserved=[]);break;default:ah(c,a)}}),a.add(c),a===M&&N.push(c)}function ah(a,b){if(!w.test(b))throw R(b,"name");I("=");var c=W(F(),!0),d={options:void 0};d.getOption=function(a){return this.options[a]},d.setOption=function(a,b){m.prototype.setOption.call(d,a,b)},d.setParsedOption=function(){},aa(d,function(a){if("option"===a)ai(d,a),I(";");else throw R(a)},function(){am(d)}),a.add(b,c,d.comment,d.parsedOptions||d.options)}function ai(a,b){var c,d,e=!0;for("option"===b&&(b=F());"="!==b;){if("("===b){var f=F();I(")"),b="("+f+")"}if(e){if(e=!1,b.includes(".")&&!b.includes("(")){var g=b.split(".");c=g[0]+".",b=g[1];continue}c=b}else d=d?d+=b:b;b=F()}var h=aj(a,d?c.concat(d):c);d=d&&"."===d[0]?d.slice(1):d,al(a,c=c&&"."===c[c.length-1]?c.slice(0,-1):c,h,d)}function aj(a,b){if(I("{",!0)){for(var c={};!I("}",!0);){if(!w.test(z=F()))throw R(z,"name");if(null===z)throw R(z,"end of input");var d,e,f=z;if(I(":",!0),"{"===H())d=aj(a,b+"."+z);else if("["===H()){if(d=[],I("[",!0)){do e=T(!0),d.push(e);while(I(",",!0))I("]"),void 0!==e&&ak(a,b+"."+z,e)}}else d=T(!0),ak(a,b+"."+z,d);var g=c[f];g&&(d=[].concat(g).concat(d)),c[f]=d,I(",",!0),I(";",!0)}return c}var h=T(!0);return ak(a,b,h),h}function ak(a,b,c){if(M===a&&/^features\./.test(b)){O[b]=c;return}a.setOption&&a.setOption(b,c)}function al(a,b,c,d){a.setParsedOption&&a.setParsedOption(b,c,d)}function am(a){if(I("[",!0)){do ai(a,"option");while(I(",",!0))I("]")}return a}function an(a,b){if(!w.test(b=F()))throw R(b,"service name");var c=new k(b);aa(c,function(a){if(!_(c,a))if("rpc"===a)ao(c,a);else throw R(a)}),a.add(c),a===M&&N.push(c)}function ao(a,b){var c=J(),d=b;if(!w.test(b=F()))throw R(b,"name");var e,f,g,h,i=b;if(I("("),I("stream",!0)&&(f=!0),!x.test(b=F())||(e=b,I(")"),I("returns"),I("("),I("stream",!0)&&(h=!0),!x.test(b=F())))throw R(b);g=b,I(")");var j=new l(i,d,e,g,f,h);j.comment=c,aa(j,function(a){if("option"===a)ai(j,a),I(";");else throw R(a)}),a.add(j)}function ap(a,b){if(!x.test(b=F()))throw R(b,"reference");var c=b;aa(null,function(b){switch(b){case"required":case"repeated":ac(a,b,c);break;case"optional":"proto3"===L?ac(a,"proto3_optional",c):ac(a,"optional",c);break;default:if("proto2"===L||!x.test(b))throw R(b);G(b),ac(a,"optional",c)}})}for(;null!==(z=F());)switch(z){case"package":if(!K)throw R(z);X();break;case"import":if(!K)throw R(z);Y();break;case"syntax":if(!K)throw R(z);Z();break;case"edition":if(!K)throw R(z);$();break;case"option":ai(M,z),I(";",!0);break;default:if(_(M,z)){K=!1;continue}throw R(z)}return Q(),y.filename=null,{package:A,imports:B,weakImports:C,root:b}}},62303,(a,b,c)=>{"use strict";b.exports=f;var d,e=/\/|\./;function f(a,b){e.test(a)||(a="google/protobuf/"+a+".proto",b={nested:{google:{nested:{protobuf:{nested:b}}}}}),f[a]=b}f("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}}),f("duration",{Duration:d={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}}),f("timestamp",{Timestamp:d}),f("empty",{Empty:{fields:{}}}),f("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}}),f("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}}),f("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}}),f.get=function(a){return f[a]||null}},33691,(a,b,c)=>{"use strict";var d=b.exports=a.r(64374);d.build="full",d.tokenize=a.r(11320),d.parse=a.r(39825),d.common=a.r(62303),d.Root._configure(d.Type,d.parse,d.common)},55084,(a,b,c)=>{"use strict";b.exports=a.r(33691)},87430,a=>{a.v(JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"options":{"go_package":"google.golang.org/protobuf/types/descriptorpb","java_package":"com.google.protobuf","java_outer_classname":"DescriptorProtos","csharp_namespace":"Google.Protobuf.Reflection","objc_class_prefix":"GPB","cc_enable_arenas":true,"optimize_for":"SPEED"},"nested":{"FileDescriptorSet":{"edition":"proto2","fields":{"file":{"rule":"repeated","type":"FileDescriptorProto","id":1}},"extensions":[[536000000,536000000]]},"Edition":{"edition":"proto2","values":{"EDITION_UNKNOWN":0,"EDITION_LEGACY":900,"EDITION_PROTO2":998,"EDITION_PROTO3":999,"EDITION_2023":1000,"EDITION_2024":1001,"EDITION_1_TEST_ONLY":1,"EDITION_2_TEST_ONLY":2,"EDITION_99997_TEST_ONLY":99997,"EDITION_99998_TEST_ONLY":99998,"EDITION_99999_TEST_ONLY":99999,"EDITION_MAX":2147483647}},"FileDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"package":{"type":"string","id":2},"dependency":{"rule":"repeated","type":"string","id":3},"publicDependency":{"rule":"repeated","type":"int32","id":10},"weakDependency":{"rule":"repeated","type":"int32","id":11},"optionDependency":{"rule":"repeated","type":"string","id":15},"messageType":{"rule":"repeated","type":"DescriptorProto","id":4},"enumType":{"rule":"repeated","type":"EnumDescriptorProto","id":5},"service":{"rule":"repeated","type":"ServiceDescriptorProto","id":6},"extension":{"rule":"repeated","type":"FieldDescriptorProto","id":7},"options":{"type":"FileOptions","id":8},"sourceCodeInfo":{"type":"SourceCodeInfo","id":9},"syntax":{"type":"string","id":12},"edition":{"type":"Edition","id":14}}},"DescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"field":{"rule":"repeated","type":"FieldDescriptorProto","id":2},"extension":{"rule":"repeated","type":"FieldDescriptorProto","id":6},"nestedType":{"rule":"repeated","type":"DescriptorProto","id":3},"enumType":{"rule":"repeated","type":"EnumDescriptorProto","id":4},"extensionRange":{"rule":"repeated","type":"ExtensionRange","id":5},"oneofDecl":{"rule":"repeated","type":"OneofDescriptorProto","id":8},"options":{"type":"MessageOptions","id":7},"reservedRange":{"rule":"repeated","type":"ReservedRange","id":9},"reservedName":{"rule":"repeated","type":"string","id":10},"visibility":{"type":"SymbolVisibility","id":11}},"nested":{"ExtensionRange":{"fields":{"start":{"type":"int32","id":1},"end":{"type":"int32","id":2},"options":{"type":"ExtensionRangeOptions","id":3}}},"ReservedRange":{"fields":{"start":{"type":"int32","id":1},"end":{"type":"int32","id":2}}}}},"ExtensionRangeOptions":{"edition":"proto2","fields":{"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999},"declaration":{"rule":"repeated","type":"Declaration","id":2,"options":{"retention":"RETENTION_SOURCE"}},"features":{"type":"FeatureSet","id":50},"verification":{"type":"VerificationState","id":3,"options":{"default":"UNVERIFIED","retention":"RETENTION_SOURCE"}}},"extensions":[[1000,536870911]],"nested":{"Declaration":{"fields":{"number":{"type":"int32","id":1},"fullName":{"type":"string","id":2},"type":{"type":"string","id":3},"reserved":{"type":"bool","id":5},"repeated":{"type":"bool","id":6}},"reserved":[[4,4]]},"VerificationState":{"values":{"DECLARATION":0,"UNVERIFIED":1}}}},"FieldDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"number":{"type":"int32","id":3},"label":{"type":"Label","id":4},"type":{"type":"Type","id":5},"typeName":{"type":"string","id":6},"extendee":{"type":"string","id":2},"defaultValue":{"type":"string","id":7},"oneofIndex":{"type":"int32","id":9},"jsonName":{"type":"string","id":10},"options":{"type":"FieldOptions","id":8},"proto3Optional":{"type":"bool","id":17}},"nested":{"Type":{"values":{"TYPE_DOUBLE":1,"TYPE_FLOAT":2,"TYPE_INT64":3,"TYPE_UINT64":4,"TYPE_INT32":5,"TYPE_FIXED64":6,"TYPE_FIXED32":7,"TYPE_BOOL":8,"TYPE_STRING":9,"TYPE_GROUP":10,"TYPE_MESSAGE":11,"TYPE_BYTES":12,"TYPE_UINT32":13,"TYPE_ENUM":14,"TYPE_SFIXED32":15,"TYPE_SFIXED64":16,"TYPE_SINT32":17,"TYPE_SINT64":18}},"Label":{"values":{"LABEL_OPTIONAL":1,"LABEL_REPEATED":3,"LABEL_REQUIRED":2}}}},"OneofDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"options":{"type":"OneofOptions","id":2}}},"EnumDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"value":{"rule":"repeated","type":"EnumValueDescriptorProto","id":2},"options":{"type":"EnumOptions","id":3},"reservedRange":{"rule":"repeated","type":"EnumReservedRange","id":4},"reservedName":{"rule":"repeated","type":"string","id":5},"visibility":{"type":"SymbolVisibility","id":6}},"nested":{"EnumReservedRange":{"fields":{"start":{"type":"int32","id":1},"end":{"type":"int32","id":2}}}}},"EnumValueDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"number":{"type":"int32","id":2},"options":{"type":"EnumValueOptions","id":3}}},"ServiceDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"method":{"rule":"repeated","type":"MethodDescriptorProto","id":2},"options":{"type":"ServiceOptions","id":3}}},"MethodDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"inputType":{"type":"string","id":2},"outputType":{"type":"string","id":3},"options":{"type":"MethodOptions","id":4},"clientStreaming":{"type":"bool","id":5},"serverStreaming":{"type":"bool","id":6}}},"FileOptions":{"edition":"proto2","fields":{"javaPackage":{"type":"string","id":1},"javaOuterClassname":{"type":"string","id":8},"javaMultipleFiles":{"type":"bool","id":10},"javaGenerateEqualsAndHash":{"type":"bool","id":20,"options":{"deprecated":true}},"javaStringCheckUtf8":{"type":"bool","id":27},"optimizeFor":{"type":"OptimizeMode","id":9,"options":{"default":"SPEED"}},"goPackage":{"type":"string","id":11},"ccGenericServices":{"type":"bool","id":16},"javaGenericServices":{"type":"bool","id":17},"pyGenericServices":{"type":"bool","id":18},"deprecated":{"type":"bool","id":23},"ccEnableArenas":{"type":"bool","id":31,"options":{"default":true}},"objcClassPrefix":{"type":"string","id":36},"csharpNamespace":{"type":"string","id":37},"swiftPrefix":{"type":"string","id":39},"phpClassPrefix":{"type":"string","id":40},"phpNamespace":{"type":"string","id":41},"phpMetadataNamespace":{"type":"string","id":44},"rubyPackage":{"type":"string","id":45},"features":{"type":"FeatureSet","id":50},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[42,42],[38,38],"php_generic_services"],"nested":{"OptimizeMode":{"values":{"SPEED":1,"CODE_SIZE":2,"LITE_RUNTIME":3}}}},"MessageOptions":{"edition":"proto2","fields":{"messageSetWireFormat":{"type":"bool","id":1},"noStandardDescriptorAccessor":{"type":"bool","id":2},"deprecated":{"type":"bool","id":3},"mapEntry":{"type":"bool","id":7},"deprecatedLegacyJsonFieldConflicts":{"type":"bool","id":11,"options":{"deprecated":true}},"features":{"type":"FeatureSet","id":12},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[4,4],[5,5],[6,6],[8,8],[9,9]]},"FieldOptions":{"edition":"proto2","fields":{"ctype":{"type":"CType","id":1,"options":{"default":"STRING"}},"packed":{"type":"bool","id":2},"jstype":{"type":"JSType","id":6,"options":{"default":"JS_NORMAL"}},"lazy":{"type":"bool","id":5},"unverifiedLazy":{"type":"bool","id":15},"deprecated":{"type":"bool","id":3},"weak":{"type":"bool","id":10,"options":{"deprecated":true}},"debugRedact":{"type":"bool","id":16},"retention":{"type":"OptionRetention","id":17},"targets":{"rule":"repeated","type":"OptionTargetType","id":19},"editionDefaults":{"rule":"repeated","type":"EditionDefault","id":20},"features":{"type":"FeatureSet","id":21},"featureSupport":{"type":"FeatureSupport","id":22},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[4,4],[18,18]],"nested":{"CType":{"values":{"STRING":0,"CORD":1,"STRING_PIECE":2}},"JSType":{"values":{"JS_NORMAL":0,"JS_STRING":1,"JS_NUMBER":2}},"OptionRetention":{"values":{"RETENTION_UNKNOWN":0,"RETENTION_RUNTIME":1,"RETENTION_SOURCE":2}},"OptionTargetType":{"values":{"TARGET_TYPE_UNKNOWN":0,"TARGET_TYPE_FILE":1,"TARGET_TYPE_EXTENSION_RANGE":2,"TARGET_TYPE_MESSAGE":3,"TARGET_TYPE_FIELD":4,"TARGET_TYPE_ONEOF":5,"TARGET_TYPE_ENUM":6,"TARGET_TYPE_ENUM_ENTRY":7,"TARGET_TYPE_SERVICE":8,"TARGET_TYPE_METHOD":9}},"EditionDefault":{"fields":{"edition":{"type":"Edition","id":3},"value":{"type":"string","id":2}}},"FeatureSupport":{"fields":{"editionIntroduced":{"type":"Edition","id":1},"editionDeprecated":{"type":"Edition","id":2},"deprecationWarning":{"type":"string","id":3},"editionRemoved":{"type":"Edition","id":4}}}}},"OneofOptions":{"edition":"proto2","fields":{"features":{"type":"FeatureSet","id":1},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"EnumOptions":{"edition":"proto2","fields":{"allowAlias":{"type":"bool","id":2},"deprecated":{"type":"bool","id":3},"deprecatedLegacyJsonFieldConflicts":{"type":"bool","id":6,"options":{"deprecated":true}},"features":{"type":"FeatureSet","id":7},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[5,5]]},"EnumValueOptions":{"edition":"proto2","fields":{"deprecated":{"type":"bool","id":1},"features":{"type":"FeatureSet","id":2},"debugRedact":{"type":"bool","id":3},"featureSupport":{"type":"FieldOptions.FeatureSupport","id":4},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"ServiceOptions":{"edition":"proto2","fields":{"features":{"type":"FeatureSet","id":34},"deprecated":{"type":"bool","id":33},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"MethodOptions":{"edition":"proto2","fields":{"deprecated":{"type":"bool","id":33},"idempotencyLevel":{"type":"IdempotencyLevel","id":34,"options":{"default":"IDEMPOTENCY_UNKNOWN"}},"features":{"type":"FeatureSet","id":35},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"nested":{"IdempotencyLevel":{"values":{"IDEMPOTENCY_UNKNOWN":0,"NO_SIDE_EFFECTS":1,"IDEMPOTENT":2}}}},"UninterpretedOption":{"edition":"proto2","fields":{"name":{"rule":"repeated","type":"NamePart","id":2},"identifierValue":{"type":"string","id":3},"positiveIntValue":{"type":"uint64","id":4},"negativeIntValue":{"type":"int64","id":5},"doubleValue":{"type":"double","id":6},"stringValue":{"type":"bytes","id":7},"aggregateValue":{"type":"string","id":8}},"nested":{"NamePart":{"fields":{"namePart":{"rule":"required","type":"string","id":1},"isExtension":{"rule":"required","type":"bool","id":2}}}}},"FeatureSet":{"edition":"proto2","fields":{"fieldPresence":{"type":"FieldPresence","id":1,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_2023","edition_defaults.value":"EXPLICIT"}},"enumType":{"type":"EnumType","id":2,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"OPEN"}},"repeatedFieldEncoding":{"type":"RepeatedFieldEncoding","id":3,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"PACKED"}},"utf8Validation":{"type":"Utf8Validation","id":4,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"VERIFY"}},"messageEncoding":{"type":"MessageEncoding","id":5,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_LEGACY","edition_defaults.value":"LENGTH_PREFIXED"}},"jsonFormat":{"type":"JsonFormat","id":6,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"ALLOW"}},"enforceNamingStyle":{"type":"EnforceNamingStyle","id":7,"options":{"retention":"RETENTION_SOURCE","targets":"TARGET_TYPE_METHOD","feature_support.edition_introduced":"EDITION_2024","edition_defaults.edition":"EDITION_2024","edition_defaults.value":"STYLE2024"}},"defaultSymbolVisibility":{"type":"VisibilityFeature.DefaultSymbolVisibility","id":8,"options":{"retention":"RETENTION_SOURCE","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2024","edition_defaults.edition":"EDITION_2024","edition_defaults.value":"EXPORT_TOP_LEVEL"}}},"extensions":[[1000,9994],[9995,9999],[10000,10000]],"reserved":[[999,999]],"nested":{"FieldPresence":{"values":{"FIELD_PRESENCE_UNKNOWN":0,"EXPLICIT":1,"IMPLICIT":2,"LEGACY_REQUIRED":3}},"EnumType":{"values":{"ENUM_TYPE_UNKNOWN":0,"OPEN":1,"CLOSED":2}},"RepeatedFieldEncoding":{"values":{"REPEATED_FIELD_ENCODING_UNKNOWN":0,"PACKED":1,"EXPANDED":2}},"Utf8Validation":{"values":{"UTF8_VALIDATION_UNKNOWN":0,"VERIFY":2,"NONE":3}},"MessageEncoding":{"values":{"MESSAGE_ENCODING_UNKNOWN":0,"LENGTH_PREFIXED":1,"DELIMITED":2}},"JsonFormat":{"values":{"JSON_FORMAT_UNKNOWN":0,"ALLOW":1,"LEGACY_BEST_EFFORT":2}},"EnforceNamingStyle":{"values":{"ENFORCE_NAMING_STYLE_UNKNOWN":0,"STYLE2024":1,"STYLE_LEGACY":2}},"VisibilityFeature":{"fields":{},"reserved":[[1,536870911]],"nested":{"DefaultSymbolVisibility":{"values":{"DEFAULT_SYMBOL_VISIBILITY_UNKNOWN":0,"EXPORT_ALL":1,"EXPORT_TOP_LEVEL":2,"LOCAL_ALL":3,"STRICT":4}}}}}},"FeatureSetDefaults":{"edition":"proto2","fields":{"defaults":{"rule":"repeated","type":"FeatureSetEditionDefault","id":1},"minimumEdition":{"type":"Edition","id":4},"maximumEdition":{"type":"Edition","id":5}},"nested":{"FeatureSetEditionDefault":{"fields":{"edition":{"type":"Edition","id":3},"overridableFeatures":{"type":"FeatureSet","id":4},"fixedFeatures":{"type":"FeatureSet","id":5}},"reserved":[[1,1],[2,2],"features"]}}},"SourceCodeInfo":{"edition":"proto2","fields":{"location":{"rule":"repeated","type":"Location","id":1}},"extensions":[[536000000,536000000]],"nested":{"Location":{"fields":{"path":{"rule":"repeated","type":"int32","id":1,"options":{"packed":true}},"span":{"rule":"repeated","type":"int32","id":2,"options":{"packed":true}},"leadingComments":{"type":"string","id":3},"trailingComments":{"type":"string","id":4},"leadingDetachedComments":{"rule":"repeated","type":"string","id":6}}}}},"GeneratedCodeInfo":{"edition":"proto2","fields":{"annotation":{"rule":"repeated","type":"Annotation","id":1}},"nested":{"Annotation":{"fields":{"path":{"rule":"repeated","type":"int32","id":1,"options":{"packed":true}},"sourceFile":{"type":"string","id":2},"begin":{"type":"int32","id":3},"end":{"type":"int32","id":4},"semantic":{"type":"Semantic","id":5}},"nested":{"Semantic":{"values":{"NONE":0,"SET":1,"ALIAS":2}}}}}},"SymbolVisibility":{"edition":"proto2","values":{"VISIBILITY_UNSET":0,"VISIBILITY_LOCAL":1,"VISIBILITY_EXPORT":2}}}}}}}}'))},28264,(a,b,c)=>{"use strict";var d=a.r(55084);b.exports=c=d.descriptor=d.Root.fromJSON(a.r(87430)).lookup(".google.protobuf");var e=d.Namespace,f=d.Root,g=d.Enum,h=d.Type,i=d.Field,j=d.MapField,k=d.OneOf,l=d.Service,m=d.Method;function n(a,b,d){var j=c.FileDescriptorProto.create({name:a.filename||(a.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});E(d,j),a instanceof f||(j.package=a.fullName.substring(1));for(var k,m=0;m<a.nestedArray.length;++m)(k=a._nestedArray[m])instanceof h?j.messageType.push(k.toDescriptor(d)):k instanceof g?j.enumType.push(k.toDescriptor()):k instanceof i?j.extension.push(k.toDescriptor(d)):k instanceof l?j.service.push(k.toDescriptor()):k instanceof e&&n(k,b,d);j.options=A(a.options,c.FileOptions),j.messageType.length+j.enumType.length+j.extension.length+j.service.length&&b.push(j)}f.fromDescriptor=function(a){"number"==typeof a.length&&(a=c.FileDescriptorSet.decode(a));var b=new f;if(a.file)for(var d,e,j,k=0;k<a.file.length;++k){e=b,(d=a.file[k]).package&&d.package.length&&(e=b.define(d.package));var m=D(d);if(d.name&&d.name.length&&b.files.push(e.filename=d.name),d.messageType)for(j=0;j<d.messageType.length;++j)e.add(h.fromDescriptor(d.messageType[j],m));if(d.enumType)for(j=0;j<d.enumType.length;++j)e.add(g.fromDescriptor(d.enumType[j],m));if(d.extension)for(j=0;j<d.extension.length;++j)e.add(i.fromDescriptor(d.extension[j],m));if(d.service)for(j=0;j<d.service.length;++j)e.add(l.fromDescriptor(d.service[j],m));var n=y(d.options,c.FileOptions);if(n){var o=Object.keys(n);for(j=0;j<o.length;++j)e.setOption(o[j],n[o[j]])}}return b.resolveAll()},f.prototype.toDescriptor=function(a){var b=c.FileDescriptorSet.create();return n(this,b.file,a),b};var o=0;h.fromDescriptor=function(a,b,d){"number"==typeof a.length&&(a=c.DescriptorProto.decode(a));var e,f=new h(a.name.length?a.name:"Type"+o++,y(a.options,c.MessageOptions));if(d||(f._edition=b),a.oneofDecl)for(e=0;e<a.oneofDecl.length;++e)f.add(k.fromDescriptor(a.oneofDecl[e]));if(a.field)for(e=0;e<a.field.length;++e){var j=i.fromDescriptor(a.field[e],b,!0);f.add(j),a.field[e].hasOwnProperty("oneofIndex")&&f.oneofsArray[a.field[e].oneofIndex].add(j)}if(a.extension)for(e=0;e<a.extension.length;++e)f.add(i.fromDescriptor(a.extension[e],b,!0));if(a.nestedType)for(e=0;e<a.nestedType.length;++e)f.add(h.fromDescriptor(a.nestedType[e],b,!0)),a.nestedType[e].options&&a.nestedType[e].options.mapEntry&&f.setOption("map_entry",!0);if(a.enumType)for(e=0;e<a.enumType.length;++e)f.add(g.fromDescriptor(a.enumType[e],b,!0));if(a.extensionRange&&a.extensionRange.length)for(e=0,f.extensions=[];e<a.extensionRange.length;++e)f.extensions.push([a.extensionRange[e].start,a.extensionRange[e].end]);if(a.reservedRange&&a.reservedRange.length||a.reservedName&&a.reservedName.length){if(f.reserved=[],a.reservedRange)for(e=0;e<a.reservedRange.length;++e)f.reserved.push([a.reservedRange[e].start,a.reservedRange[e].end]);if(a.reservedName)for(e=0;e<a.reservedName.length;++e)f.reserved.push(a.reservedName[e])}return f},h.prototype.toDescriptor=function(a){var b,d,e=c.DescriptorProto.create({name:this.name});for(d=0;d<this.fieldsArray.length;++d)if(e.field.push(b=this._fieldsArray[d].toDescriptor(a)),this._fieldsArray[d]instanceof j){var f=w(this._fieldsArray[d].keyType,this._fieldsArray[d].resolvedKeyType,!1),k=w(this._fieldsArray[d].type,this._fieldsArray[d].resolvedType,!1),l=11===k||14===k?this._fieldsArray[d].resolvedType&&B(this.parent,this._fieldsArray[d].resolvedType)||this._fieldsArray[d].type:void 0;e.nestedType.push(c.DescriptorProto.create({name:b.typeName,field:[c.FieldDescriptorProto.create({name:"key",number:1,label:1,type:f}),c.FieldDescriptorProto.create({name:"value",number:2,label:1,type:k,typeName:l})],options:c.MessageOptions.create({mapEntry:!0})}))}for(d=0;d<this.oneofsArray.length;++d)e.oneofDecl.push(this._oneofsArray[d].toDescriptor());for(d=0;d<this.nestedArray.length;++d)this._nestedArray[d]instanceof i?e.field.push(this._nestedArray[d].toDescriptor(a)):this._nestedArray[d]instanceof h?e.nestedType.push(this._nestedArray[d].toDescriptor(a)):this._nestedArray[d]instanceof g&&e.enumType.push(this._nestedArray[d].toDescriptor());if(this.extensions)for(d=0;d<this.extensions.length;++d)e.extensionRange.push(c.DescriptorProto.ExtensionRange.create({start:this.extensions[d][0],end:this.extensions[d][1]}));if(this.reserved)for(d=0;d<this.reserved.length;++d)"string"==typeof this.reserved[d]?e.reservedName.push(this.reserved[d]):e.reservedRange.push(c.DescriptorProto.ReservedRange.create({start:this.reserved[d][0],end:this.reserved[d][1]}));return e.options=A(this.options,c.MessageOptions),e};var p=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;i.fromDescriptor=function(a,b,d){if("number"==typeof a.length&&(a=c.DescriptorProto.decode(a)),"number"!=typeof a.number)throw Error("missing field id");switch(e=a.typeName&&a.typeName.length?a.typeName:u(a.type),a.label){case 1:f=void 0;break;case 2:f="required";break;case 3:f="repeated";break;default:throw Error("illegal label: "+a.label)}var e,f,g=a.extendee;void 0!==a.extendee&&(g=g.length?g:void 0);var h=new i(a.name.length?a.name:"field"+a.number,a.number,e,f,g);if(d||(h._edition=b),h.options=y(a.options,c.FieldOptions),a.proto3_optional&&(h.options.proto3_optional=!0),a.defaultValue&&a.defaultValue.length){var j=a.defaultValue;switch(j){case"true":case"TRUE":j=!0;break;case"false":case"FALSE":j=!1;break;default:p.exec(j)&&(j=parseInt(j))}h.setOption("default",j)}return v(a.type)&&("proto3"===b?a.options&&!a.options.packed&&h.setOption("packed",!1):(!b||"proto2"===b)&&a.options&&a.options.packed&&h.setOption("packed",!0)),h},i.prototype.toDescriptor=function(a){var b=c.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)b.type=11,b.typeName=d.util.ucFirst(this.name),b.label=3;else{switch(b.type=w(this.type,this.resolve().resolvedType,this.delimited)){case 10:case 11:case 14:b.typeName=this.resolvedType?B(this.parent,this.resolvedType):this.type}"repeated"===this.rule?b.label=3:this.required&&"proto2"===a?b.label=2:b.label=1}if(b.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(b.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(b.options=A(this.options,c.FieldOptions),null!=this.options.default&&(b.defaultValue=String(this.options.default)),this.options.proto3_optional&&(b.proto3_optional=!0)),"proto3"===a?this.packed||((b.options||(b.options=c.FieldOptions.create())).packed=!1):(!a||"proto2"===a)&&this.packed&&((b.options||(b.options=c.FieldOptions.create())).packed=!0),b};var q=0;g.fromDescriptor=function(a,b,d){"number"==typeof a.length&&(a=c.EnumDescriptorProto.decode(a));var e={};if(a.value)for(var f=0;f<a.value.length;++f){var h=a.value[f].name,i=a.value[f].number||0;e[h&&h.length?h:"NAME"+i]=i}var j=new g(a.name&&a.name.length?a.name:"Enum"+q++,e,y(a.options,c.EnumOptions));return d||(j._edition=b),j},g.prototype.toDescriptor=function(){for(var a=[],b=0,d=Object.keys(this.values);b<d.length;++b)a.push(c.EnumValueDescriptorProto.create({name:d[b],number:this.values[d[b]]}));return c.EnumDescriptorProto.create({name:this.name,value:a,options:A(this.options,c.EnumOptions)})};var r=0;k.fromDescriptor=function(a){return"number"==typeof a.length&&(a=c.OneofDescriptorProto.decode(a)),new k(a.name&&a.name.length?a.name:"oneof"+r++)},k.prototype.toDescriptor=function(){return c.OneofDescriptorProto.create({name:this.name})};var s=0;l.fromDescriptor=function(a,b,d){"number"==typeof a.length&&(a=c.ServiceDescriptorProto.decode(a));var e=new l(a.name&&a.name.length?a.name:"Service"+s++,y(a.options,c.ServiceOptions));if(d||(e._edition=b),a.method)for(var f=0;f<a.method.length;++f)e.add(m.fromDescriptor(a.method[f]));return e},l.prototype.toDescriptor=function(){for(var a=[],b=0;b<this.methodsArray.length;++b)a.push(this._methodsArray[b].toDescriptor());return c.ServiceDescriptorProto.create({name:this.name,method:a,options:A(this.options,c.ServiceOptions)})};var t=0;function u(a){switch(a){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+a)}function v(a){switch(a){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function w(a,b,c){switch(a){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(b instanceof g)return 14;if(b instanceof h)return c?10:11;throw Error("illegal type: "+a)}function x(a,b){for(var c,d,e={},f=0;f<b.fieldsArray.length;++f)if("uninterpretedOption"!==(d=(c=b._fieldsArray[f]).name)&&Object.prototype.hasOwnProperty.call(a,d)){var i=C(d);c.resolvedType instanceof h?e[i]=x(a[d],c.resolvedType):c.resolvedType instanceof g?e[i]=c.resolvedType.valuesById[a[d]]:e[i]=a[d]}return e}function y(a,b){if(a)return x(b.toObject(a),b)}function z(a,b){for(var c={},e=Object.keys(a),f=0;f<e.length;++f){var g=e[f],i=d.util.camelCase(g);if(Object.prototype.hasOwnProperty.call(b.fields,i)){var j=b.fields[i];j.resolvedType instanceof h?c[i]=z(a[g],j.resolvedType):c[i]=a[g],j.repeated&&!Array.isArray(c[i])&&(c[i]=[c[i]])}}return c}function A(a,b){if(a)return b.fromObject(z(a,b))}function B(a,b){var c=a.fullName.split("."),d=b.fullName.split("."),g=0,h=0,i=d.length-1;if(!(a instanceof f)&&b instanceof e)for(;g<c.length&&h<i&&c[g]===d[h];){var j=b.lookup(c[g++],!0);if(null!==j&&j!==b)break;++h}else for(;g<c.length&&h<i&&c[g]===d[h];++g,++h);return d.slice(h).join(".")}function C(a){return a.substring(0,1)+a.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(a,b){return"_"+b.toLowerCase()})}function D(a){if("editions"===a.syntax)if(a.edition===c.Edition.EDITION_2023)return"2023";else throw Error("Unsupported edition "+a.edition);return"proto3"===a.syntax?"proto3":"proto2"}function E(a,b){if(a)if("proto2"===a||"proto3"===a)b.syntax=a;else if(b.syntax="editions","2023"===a)b.edition=c.Edition.EDITION_2023;else throw Error("Unsupported edition "+a)}m.fromDescriptor=function(a){return"number"==typeof a.length&&(a=c.MethodDescriptorProto.decode(a)),new m(a.name&&a.name.length?a.name:"Method"+t++,"rpc",a.inputType,a.outputType,!!a.clientStreaming,!!a.serverStreaming,y(a.options,c.MethodOptions))},m.prototype.toDescriptor=function(){return c.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:A(this.options,c.MethodOptions)})}},5171,a=>{a.v({nested:{google:{nested:{protobuf:{nested:{Api:{fields:{name:{type:"string",id:1},methods:{rule:"repeated",type:"Method",id:2},options:{rule:"repeated",type:"Option",id:3},version:{type:"string",id:4},sourceContext:{type:"SourceContext",id:5},mixins:{rule:"repeated",type:"Mixin",id:6},syntax:{type:"Syntax",id:7}}},Method:{fields:{name:{type:"string",id:1},requestTypeUrl:{type:"string",id:2},requestStreaming:{type:"bool",id:3},responseTypeUrl:{type:"string",id:4},responseStreaming:{type:"bool",id:5},options:{rule:"repeated",type:"Option",id:6},syntax:{type:"Syntax",id:7}}},Mixin:{fields:{name:{type:"string",id:1},root:{type:"string",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}}}}}}}})},5236,a=>{a.v({nested:{google:{nested:{protobuf:{nested:{SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}})},2893,a=>{a.v({nested:{google:{nested:{protobuf:{nested:{Type:{fields:{name:{type:"string",id:1},fields:{rule:"repeated",type:"Field",id:2},oneofs:{rule:"repeated",type:"string",id:3},options:{rule:"repeated",type:"Option",id:4},sourceContext:{type:"SourceContext",id:5},syntax:{type:"Syntax",id:6}}},Field:{fields:{kind:{type:"Kind",id:1},cardinality:{type:"Cardinality",id:2},number:{type:"int32",id:3},name:{type:"string",id:4},typeUrl:{type:"string",id:6},oneofIndex:{type:"int32",id:7},packed:{type:"bool",id:8},options:{rule:"repeated",type:"Option",id:9},jsonName:{type:"string",id:10},defaultValue:{type:"string",id:11}},nested:{Kind:{values:{TYPE_UNKNOWN:0,TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Cardinality:{values:{CARDINALITY_UNKNOWN:0,CARDINALITY_OPTIONAL:1,CARDINALITY_REQUIRED:2,CARDINALITY_REPEATED:3}}}},Enum:{fields:{name:{type:"string",id:1},enumvalue:{rule:"repeated",type:"EnumValue",id:2},options:{rule:"repeated",type:"Option",id:3},sourceContext:{type:"SourceContext",id:4},syntax:{type:"Syntax",id:5}}},EnumValue:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{rule:"repeated",type:"Option",id:3}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}},Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}})},5035,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.addCommonProtos=c.loadProtosWithOptionsSync=c.loadProtosWithOptions=void 0;let d=a.r(22734),e=a.r(14747),f=a.r(55084);function g(a,b){let c=a.resolvePath;a.resolvePath=(a,f)=>{if(e.isAbsolute(f))return f;for(let a of b){let b=e.join(a,f);try{return d.accessSync(b,d.constants.R_OK),b}catch(a){continue}}return process.emitWarning(`${f} not found in any of the include paths ${b}`),c(a,f)}}c.loadProtosWithOptions=async function(a,b){let c=new f.Root;if((b=b||{}).includeDirs){if(!Array.isArray(b.includeDirs))return Promise.reject(Error("The includeDirs option must be an array"));g(c,b.includeDirs)}let d=await c.load(a,b);return d.resolveAll(),d},c.loadProtosWithOptionsSync=function(a,b){let c=new f.Root;if((b=b||{}).includeDirs){if(!Array.isArray(b.includeDirs))throw Error("The includeDirs option must be an array");g(c,b.includeDirs)}let d=c.loadSync(a,b);return d.resolveAll(),d},c.addCommonProtos=function(){let b=a.r(5171),c=a.r(87430),d=a.r(5236),e=a.r(2893);f.common("api",b.nested.google.nested.protobuf.nested),f.common("descriptor",c.nested.google.nested.protobuf.nested),f.common("source_context",d.nested.google.nested.protobuf.nested),f.common("type",e.nested.google.nested.protobuf.nested)}},59570,(a,b,c)=>{!function(d,e){function f(a){return a.default||a}if("function"==typeof define&&define.amd){let b;void 0!==(b=function(){var a={};return e(a),f(a)}())&&a.v(b)}else e(c),b.exports=f(c)}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:a.e,function(a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var b=null;try{b=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function c(a,b,c){this.low=0|a,this.high=0|b,this.unsigned=!!c}function d(a){return!0===(a&&a.__isLong__)}function e(a){var b=Math.clz32(a&-a);return a?31-b:b}c.prototype.__isLong__,Object.defineProperty(c.prototype,"__isLong__",{value:!0}),c.isLong=d;var f={},g={};function h(a,b){var c,d,e;if(b)return(a>>>=0,(e=0<=a&&a<256)&&(d=g[a]))?d:(c=j(a,0,!0),e&&(g[a]=c),c);return(a|=0,(e=-128<=a&&a<128)&&(d=f[a]))?d:(c=j(a,a<0?-1:0,!1),e&&(f[a]=c),c)}function i(a,b){if(isNaN(a))return b?s:r;if(b){if(a<0)return s;if(a>=o)return x}else{if(a<=-p)return y;if(a+1>=p)return w}return a<0?i(-a,b).neg():j(a%n|0,a/n|0,b)}function j(a,b,d){return new c(a,b,d)}c.fromInt=h,c.fromNumber=i,c.fromBits=j;var k=Math.pow;function l(a,b,c){if(0===a.length)throw Error("empty string");if("number"==typeof b?(c=b,b=!1):b=!!b,"NaN"===a||"Infinity"===a||"+Infinity"===a||"-Infinity"===a)return b?s:r;if((c=c||10)<2||36<c)throw RangeError("radix");if((d=a.indexOf("-"))>0)throw Error("interior hyphen");if(0===d)return l(a.substring(1),b,c).neg();for(var d,e=i(k(c,8)),f=r,g=0;g<a.length;g+=8){var h=Math.min(8,a.length-g),j=parseInt(a.substring(g,g+h),c);if(h<8){var m=i(k(c,h));f=f.mul(m).add(i(j))}else f=(f=f.mul(e)).add(i(j))}return f.unsigned=b,f}function m(a,b){return"number"==typeof a?i(a,b):"string"==typeof a?l(a,b):j(a.low,a.high,"boolean"==typeof b?b:a.unsigned)}c.fromString=l,c.fromValue=m;var n=0x100000000,o=0xffffffffffffffff,p=0x8000000000000000,q=h(0x1000000),r=h(0);c.ZERO=r;var s=h(0,!0);c.UZERO=s;var t=h(1);c.ONE=t;var u=h(1,!0);c.UONE=u;var v=h(-1);c.NEG_ONE=v;var w=j(-1,0x7fffffff,!1);c.MAX_VALUE=w;var x=j(-1,-1,!0);c.MAX_UNSIGNED_VALUE=x;var y=j(0,-0x80000000,!1);c.MIN_VALUE=y;var z=c.prototype;z.toInt=function(){return this.unsigned?this.low>>>0:this.low},z.toNumber=function(){return this.unsigned?(this.high>>>0)*n+(this.low>>>0):this.high*n+(this.low>>>0)},z.toString=function(a){if((a=a||10)<2||36<a)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(!this.eq(y))return"-"+this.neg().toString(a);else{var b=i(a),c=this.div(b),d=c.mul(b).sub(this);return c.toString(a)+d.toInt().toString(a)}for(var e=i(k(a,6),this.unsigned),f=this,g="";;){var h=f.div(e),j=(f.sub(h.mul(e)).toInt()>>>0).toString(a);if((f=h).isZero())return j+g;for(;j.length<6;)j="0"+j;g=""+j+g}},z.getHighBits=function(){return this.high},z.getHighBitsUnsigned=function(){return this.high>>>0},z.getLowBits=function(){return this.low},z.getLowBitsUnsigned=function(){return this.low>>>0},z.getNumBitsAbs=function(){if(this.isNegative())return this.eq(y)?64:this.neg().getNumBitsAbs();for(var a=0!=this.high?this.high:this.low,b=31;b>0&&(a&1<<b)==0;b--);return 0!=this.high?b+33:b+1},z.isSafeInteger=function(){var a=this.high>>21;return!a||!this.unsigned&&-1===a&&(0!==this.low||-2097152!==this.high)},z.isZero=function(){return 0===this.high&&0===this.low},z.eqz=z.isZero,z.isNegative=function(){return!this.unsigned&&this.high<0},z.isPositive=function(){return this.unsigned||this.high>=0},z.isOdd=function(){return(1&this.low)==1},z.isEven=function(){return(1&this.low)==0},z.equals=function(a){return d(a)||(a=m(a)),(this.unsigned===a.unsigned||this.high>>>31!=1||a.high>>>31!=1)&&this.high===a.high&&this.low===a.low},z.eq=z.equals,z.notEquals=function(a){return!this.eq(a)},z.neq=z.notEquals,z.ne=z.notEquals,z.lessThan=function(a){return 0>this.comp(a)},z.lt=z.lessThan,z.lessThanOrEqual=function(a){return 0>=this.comp(a)},z.lte=z.lessThanOrEqual,z.le=z.lessThanOrEqual,z.greaterThan=function(a){return this.comp(a)>0},z.gt=z.greaterThan,z.greaterThanOrEqual=function(a){return this.comp(a)>=0},z.gte=z.greaterThanOrEqual,z.ge=z.greaterThanOrEqual,z.compare=function(a){if(d(a)||(a=m(a)),this.eq(a))return 0;var b=this.isNegative(),c=a.isNegative();return b&&!c?-1:!b&&c?1:this.unsigned?a.high>>>0>this.high>>>0||a.high===this.high&&a.low>>>0>this.low>>>0?-1:1:this.sub(a).isNegative()?-1:1},z.comp=z.compare,z.negate=function(){return!this.unsigned&&this.eq(y)?y:this.not().add(t)},z.neg=z.negate,z.add=function(a){d(a)||(a=m(a));var b,c,e=this.high>>>16,f=65535&this.high,g=this.low>>>16,h=65535&this.low,i=a.high>>>16,k=65535&a.high,l=a.low>>>16,n=65535&a.low,o=0,p=0;return b=0+((c=0+(h+n))>>>16),c&=65535,b+=g+l,p+=b>>>16,b&=65535,p+=f+k,o+=p>>>16,p&=65535,o+=e+i,j(b<<16|c,(o&=65535)<<16|p,this.unsigned)},z.subtract=function(a){return d(a)||(a=m(a)),this.add(a.neg())},z.sub=z.subtract,z.multiply=function(a){if(this.isZero())return this;if(d(a)||(a=m(a)),b)return j(b.mul(this.low,this.high,a.low,a.high),b.get_high(),this.unsigned);if(a.isZero())return this.unsigned?s:r;if(this.eq(y))return a.isOdd()?y:r;if(a.eq(y))return this.isOdd()?y:r;if(this.isNegative())if(a.isNegative())return this.neg().mul(a.neg());else return this.neg().mul(a).neg();if(a.isNegative())return this.mul(a.neg()).neg();if(this.lt(q)&&a.lt(q))return i(this.toNumber()*a.toNumber(),this.unsigned);var c,e,f=this.high>>>16,g=65535&this.high,h=this.low>>>16,k=65535&this.low,l=a.high>>>16,n=65535&a.high,o=a.low>>>16,p=65535&a.low,t=0,u=0;return c=0+((e=0+k*p)>>>16),e&=65535,c+=h*p,u+=c>>>16,c&=65535,c+=k*o,u+=c>>>16,c&=65535,u+=g*p,t+=u>>>16,u&=65535,u+=h*o,t+=u>>>16,u&=65535,u+=k*n,t+=u>>>16,u&=65535,t+=f*p+g*o+h*n+k*l,j(c<<16|e,(t&=65535)<<16|u,this.unsigned)},z.mul=z.multiply,z.divide=function(a){if(d(a)||(a=m(a)),a.isZero())throw Error("division by zero");if(b){var c,e,f;return this.unsigned||-0x80000000!==this.high||-1!==a.low||-1!==a.high?j((this.unsigned?b.div_u:b.div_s)(this.low,this.high,a.low,a.high),b.get_high(),this.unsigned):this}if(this.isZero())return this.unsigned?s:r;if(this.unsigned){if(a.unsigned||(a=a.toUnsigned()),a.gt(this))return s;if(a.gt(this.shru(1)))return u;f=s}else{if(this.eq(y))if(a.eq(t)||a.eq(v))return y;else return a.eq(y)?t:(c=this.shr(1).div(a).shl(1)).eq(r)?a.isNegative()?t:v:(e=this.sub(a.mul(c)),f=c.add(e.div(a)));if(a.eq(y))return this.unsigned?s:r;if(this.isNegative())return a.isNegative()?this.neg().div(a.neg()):this.neg().div(a).neg();if(a.isNegative())return this.div(a.neg()).neg();f=r}for(e=this;e.gte(a);){for(var g=Math.ceil(Math.log(c=Math.max(1,Math.floor(e.toNumber()/a.toNumber())))/Math.LN2),h=g<=48?1:k(2,g-48),l=i(c),n=l.mul(a);n.isNegative()||n.gt(e);)c-=h,n=(l=i(c,this.unsigned)).mul(a);l.isZero()&&(l=t),f=f.add(l),e=e.sub(n)}return f},z.div=z.divide,z.modulo=function(a){return(d(a)||(a=m(a)),b)?j((this.unsigned?b.rem_u:b.rem_s)(this.low,this.high,a.low,a.high),b.get_high(),this.unsigned):this.sub(this.div(a).mul(a))},z.mod=z.modulo,z.rem=z.modulo,z.not=function(){return j(~this.low,~this.high,this.unsigned)},z.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},z.clz=z.countLeadingZeros,z.countTrailingZeros=function(){return this.low?e(this.low):e(this.high)+32},z.ctz=z.countTrailingZeros,z.and=function(a){return d(a)||(a=m(a)),j(this.low&a.low,this.high&a.high,this.unsigned)},z.or=function(a){return d(a)||(a=m(a)),j(this.low|a.low,this.high|a.high,this.unsigned)},z.xor=function(a){return d(a)||(a=m(a)),j(this.low^a.low,this.high^a.high,this.unsigned)},z.shiftLeft=function(a){return(d(a)&&(a=a.toInt()),0==(a&=63))?this:a<32?j(this.low<<a,this.high<<a|this.low>>>32-a,this.unsigned):j(0,this.low<<a-32,this.unsigned)},z.shl=z.shiftLeft,z.shiftRight=function(a){return(d(a)&&(a=a.toInt()),0==(a&=63))?this:a<32?j(this.low>>>a|this.high<<32-a,this.high>>a,this.unsigned):j(this.high>>a-32,this.high>=0?0:-1,this.unsigned)},z.shr=z.shiftRight,z.shiftRightUnsigned=function(a){return(d(a)&&(a=a.toInt()),0==(a&=63))?this:a<32?j(this.low>>>a|this.high<<32-a,this.high>>>a,this.unsigned):32===a?j(this.high,0,this.unsigned):j(this.high>>>a-32,0,this.unsigned)},z.shru=z.shiftRightUnsigned,z.shr_u=z.shiftRightUnsigned,z.rotateLeft=function(a){var b;return(d(a)&&(a=a.toInt()),0==(a&=63))?this:32===a?j(this.high,this.low,this.unsigned):a<32?(b=32-a,j(this.low<<a|this.high>>>b,this.high<<a|this.low>>>b,this.unsigned)):(a-=32,b=32-a,j(this.high<<a|this.low>>>b,this.low<<a|this.high>>>b,this.unsigned))},z.rotl=z.rotateLeft,z.rotateRight=function(a){var b;return(d(a)&&(a=a.toInt()),0==(a&=63))?this:32===a?j(this.high,this.low,this.unsigned):a<32?(b=32-a,j(this.high<<b|this.low>>>a,this.low<<b|this.high>>>a,this.unsigned)):(a-=32,b=32-a,j(this.low<<b|this.high>>>a,this.high<<b|this.low>>>a,this.unsigned))},z.rotr=z.rotateRight,z.toSigned=function(){return this.unsigned?j(this.low,this.high,!1):this},z.toUnsigned=function(){return this.unsigned?this:j(this.low,this.high,!0)},z.toBytes=function(a){return a?this.toBytesLE():this.toBytesBE()},z.toBytesLE=function(){var a=this.high,b=this.low;return[255&b,b>>>8&255,b>>>16&255,b>>>24,255&a,a>>>8&255,a>>>16&255,a>>>24]},z.toBytesBE=function(){var a=this.high,b=this.low;return[a>>>24,a>>>16&255,a>>>8&255,255&a,b>>>24,b>>>16&255,b>>>8&255,255&b]},c.fromBytes=function(a,b,d){return d?c.fromBytesLE(a,b):c.fromBytesBE(a,b)},c.fromBytesLE=function(a,b){return new c(a[0]|a[1]<<8|a[2]<<16|a[3]<<24,a[4]|a[5]<<8|a[6]<<16|a[7]<<24,b)},c.fromBytesBE=function(a,b){return new c(a[4]<<24|a[5]<<16|a[6]<<8|a[7],a[0]<<24|a[1]<<16|a[2]<<8|a[3],b)},"function"==typeof BigInt&&(c.fromBigInt=function(a,b){return j(Number(BigInt.asIntN(32,a)),Number(BigInt.asIntN(32,a>>BigInt(32))),b)},c.fromValue=function(a,b){return"bigint"==typeof a?c.fromBigInt(a,b):m(a,b)},z.toBigInt=function(){var a=BigInt(this.low>>>0);return BigInt(this.unsigned?this.high>>>0:this.high)<<BigInt(32)|a}),a.default=c})},33676,(a,b,c)=>{"use strict";var d;Object.defineProperty(c,"__esModule",{value:!0}),c.loadFileDescriptorSetFromObject=c.loadFileDescriptorSetFromBuffer=c.fromJSON=c.loadSync=c.load=c.IdempotencyLevel=c.isAnyExtension=c.Long=void 0;let e=a.r(7568),f=a.r(55084),g=a.r(28264),h=a.r(5035);c.Long=a.r(59570),c.isAnyExtension=function(a){return"@type"in a&&"string"==typeof a["@type"]},function(a){a.IDEMPOTENCY_UNKNOWN="IDEMPOTENCY_UNKNOWN",a.NO_SIDE_EFFECTS="NO_SIDE_EFFECTS",a.IDEMPOTENT="IDEMPOTENT"}(d=c.IdempotencyLevel||(c.IdempotencyLevel={}));let i={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function j(a,b){return""===a?b:a+"."+b}function k(a){return a instanceof f.Service||a instanceof f.Type||a instanceof f.Enum}function l(a){return a instanceof f.Namespace||a instanceof f.Root}function m(a,b){let c=j(b,a.name);return k(a)?[[c,a]]:l(a)&&void 0!==a.nested?Object.keys(a.nested).map(b=>m(a.nested[b],c)).reduce((a,b)=>a.concat(b),[]):[]}function n(a,b){return function(c){return a.toObject(a.decode(c),b)}}function o(a){return function(b){if(Array.isArray(b))throw Error(`Failed to serialize message: expected object with ${a.name} structure, got array instead`);let c=a.fromObject(b);return a.encode(c).finish()}}function p(a){return(a||[]).reduce((a,b)=>{for(let[c,d]of Object.entries(b))"uninterpreted_option"===c?a.uninterpreted_option.push(b.uninterpreted_option):a[c]=d;return a},{deprecated:!1,idempotency_level:d.IDEMPOTENCY_UNKNOWN,uninterpreted_option:[]})}function q(a,b,c,d){let f=a.resolvedRequestType,g=a.resolvedResponseType;return{path:"/"+b+"/"+a.name,requestStream:!!a.requestStream,responseStream:!!a.responseStream,requestSerialize:o(f),requestDeserialize:n(f,c),responseSerialize:o(g),responseDeserialize:n(g,c),originalName:e(a.name),requestType:s(f,d),responseType:s(g,d),options:p(a.parsedOptions)}}function r(a,b,c,d){let e={};for(let f of a.methodsArray)e[f.name]=q(f,b,c,d);return e}function s(a,b){let c=a.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:c.$type.toObject(c,i),fileDescriptorProtos:b}}function t(a,b){let c=a.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:c.$type.toObject(c,i),fileDescriptorProtos:b}}function u(a,b,c,d){if(a instanceof f.Service)return r(a,b,c,d);if(a instanceof f.Type)return s(a,d);if(a instanceof f.Enum)return t(a,d);throw Error("Type mismatch in reflection object handling")}function v(a,b){let c={};a.resolveAll();let d=a.toDescriptor("proto3").file.map(a=>Buffer.from(g.FileDescriptorProto.encode(a).finish()));for(let[e,f]of m(a,""))c[e]=u(f,e,b,d);return c}function w(a,b){b=b||{};let c=f.Root.fromDescriptor(a);return c.resolveAll(),v(c,b)}c.load=function(a,b){return(0,h.loadProtosWithOptions)(a,b).then(a=>v(a,b))},c.loadSync=function(a,b){return v((0,h.loadProtosWithOptionsSync)(a,b),b)},c.fromJSON=function(a,b){b=b||{};let c=f.Root.fromJSON(a);return c.resolveAll(),v(c,b)},c.loadFileDescriptorSetFromBuffer=function(a,b){return w(g.FileDescriptorSet.decode(a),b)},c.loadFileDescriptorSetFromObject=function(a,b){return w(g.FileDescriptorSet.fromObject(a),b)},(0,h.addCommonProtos)()},37725,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.setup=c.getChannelzServiceDefinition=c.getChannelzHandlers=c.unregisterChannelzRef=c.registerChannelzSocket=c.registerChannelzServer=c.registerChannelzSubchannel=c.registerChannelzChannel=c.ChannelzCallTracker=c.ChannelzChildrenTracker=c.ChannelzTrace=void 0;let d=a.r(4446),e=a.r(69374),f=a.r(47844),g=a.r(49271),h=a.r(95666),i=a.r(79523);function j(a){return{channel_id:a.id,name:a.name}}function k(a){return{subchannel_id:a.id,name:a.name}}function l(a){return{server_id:a.id}}function m(a){return{socket_id:a.id,name:a.name}}let n=32;class o{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(a,b,c){let d=new Date;this.events.push({description:b,severity:a,timestamp:d,childChannel:(null==c?void 0:c.kind)==="channel"?c:void 0,childSubchannel:(null==c?void 0:c.kind)==="subchannel"?c:void 0}),this.events.length>=2*n&&(this.events=this.events.slice(n)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:B(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(a=>({description:a.description,severity:a.severity,timestamp:B(a.timestamp),channel_ref:a.childChannel?j(a.childChannel):null,subchannel_ref:a.childSubchannel?k(a.childSubchannel):null}))}}}c.ChannelzTrace=o;class p{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild(a){var b,c,d;switch(a.kind){case"channel":{let c=null!=(b=this.channelChildren.get(a.id))?b:{ref:a,count:0};c.count+=1,this.channelChildren.set(a.id,c);break}case"subchannel":{let b=null!=(c=this.subchannelChildren.get(a.id))?c:{ref:a,count:0};b.count+=1,this.subchannelChildren.set(a.id,b);break}case"socket":{let b=null!=(d=this.socketChildren.get(a.id))?d:{ref:a,count:0};b.count+=1,this.socketChildren.set(a.id,b)}}}unrefChild(a){switch(a.kind){case"channel":{let b=this.channelChildren.get(a.id);void 0!==b&&(b.count-=1,0===b.count?this.channelChildren.delete(a.id):this.channelChildren.set(a.id,b));break}case"subchannel":{let b=this.subchannelChildren.get(a.id);void 0!==b&&(b.count-=1,0===b.count?this.subchannelChildren.delete(a.id):this.subchannelChildren.set(a.id,b));break}case"socket":{let b=this.socketChildren.get(a.id);void 0!==b&&(b.count-=1,0===b.count?this.socketChildren.delete(a.id):this.socketChildren.set(a.id,b))}}}getChildLists(){let a=[];for(let{ref:b}of this.channelChildren.values())a.push(b);let b=[];for(let{ref:a}of this.subchannelChildren.values())b.push(a);let c=[];for(let{ref:a}of this.socketChildren.values())c.push(a);return{channels:a,subchannels:b,sockets:c}}}c.ChannelzChildrenTracker=p;class q{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}}c.ChannelzCallTracker=q;let r=1;function s(){return r++}let t=[],u=[],v=[],w=[];function x(a){let b=Number.parseInt(a,16);return[b/256|0,b%256]}function y(a){return""===a?[]:[].concat(...a.split(":").map(a=>x(a)))}function z(a){if((0,d.isIPv4)(a))return Buffer.from(Uint8Array.from(a.split(".").map(a=>Number.parseInt(a))));if(!(0,d.isIPv6)(a))return null;{let b,c,d=a.indexOf("::");-1===d?(b=a,c=""):(b=a.substring(0,d),c=a.substring(d+2));let e=Buffer.from(y(b)),f=Buffer.from(y(c)),g=Buffer.alloc(16-e.length-f.length,0);return Buffer.concat([e,g,f])}}function A(a){switch(a){case e.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case e.ConnectivityState.IDLE:return{state:"IDLE"};case e.ConnectivityState.READY:return{state:"READY"};case e.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case e.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function B(a){if(!a)return null;let b=a.getTime();return{seconds:b/1e3|0,nanos:b%1e3*1e6}}function C(a){let b=a.getInfo();return{ref:j(a.ref),data:{target:b.target,state:A(b.state),calls_started:b.callTracker.callsStarted,calls_succeeded:b.callTracker.callsSucceeded,calls_failed:b.callTracker.callsFailed,last_call_started_timestamp:B(b.callTracker.lastCallStartedTimestamp),trace:b.trace.getTraceMessage()},channel_ref:b.children.channels.map(a=>j(a)),subchannel_ref:b.children.subchannels.map(a=>k(a))}}function D(a,b){let c=Number.parseInt(a.request.channel_id),d=t[c];void 0===d?b({code:f.Status.NOT_FOUND,details:"No channel data found for id "+c}):b(null,{channel:C(d)})}function E(a,b){let c=Number.parseInt(a.request.max_results),d=[],e=Number.parseInt(a.request.start_channel_id);for(;e<t.length;e++){let a=t[e];if(void 0!==a&&(d.push(C(a)),d.length>=c))break}b(null,{channel:d,end:e>=v.length})}function F(a){let b=a.getInfo();return{ref:l(a.ref),data:{calls_started:b.callTracker.callsStarted,calls_succeeded:b.callTracker.callsSucceeded,calls_failed:b.callTracker.callsFailed,last_call_started_timestamp:B(b.callTracker.lastCallStartedTimestamp),trace:b.trace.getTraceMessage()},listen_socket:b.listenerChildren.sockets.map(a=>m(a))}}function G(a,b){let c=Number.parseInt(a.request.server_id),d=v[c];void 0===d?b({code:f.Status.NOT_FOUND,details:"No server data found for id "+c}):b(null,{server:F(d)})}function H(a,b){let c=Number.parseInt(a.request.max_results),d=[],e=Number.parseInt(a.request.start_server_id);for(;e<v.length;e++){let a=v[e];if(void 0!==a&&(d.push(F(a)),d.length>=c))break}b(null,{server:d,end:e>=v.length})}function I(a,b){let c=Number.parseInt(a.request.subchannel_id),d=u[c];if(void 0===d)return void b({code:f.Status.NOT_FOUND,details:"No subchannel data found for id "+c});let e=d.getInfo();b(null,{subchannel:{ref:k(d.ref),data:{target:e.target,state:A(e.state),calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:B(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},socket_ref:e.children.sockets.map(a=>m(a))}})}function J(a){var b;return(0,g.isTcpSubchannelAddress)(a)?{address:"tcpip_address",tcpip_address:{ip_address:null!=(b=z(a.host))?b:void 0,port:a.port}}:{address:"uds_address",uds_address:{filename:a.path}}}function K(a,b){var c,d,e,g,h;let i=Number.parseInt(a.request.socket_id),j=w[i];if(void 0===j)return void b({code:f.Status.NOT_FOUND,details:"No socket data found for id "+i});let k=j.getInfo(),l=k.security?{model:"tls",tls:{cipher_suite:k.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:null!=(c=k.security.cipherSuiteStandardName)?c:void 0,other_name:null!=(d=k.security.cipherSuiteOtherName)?d:void 0,local_certificate:null!=(e=k.security.localCertificate)?e:void 0,remote_certificate:null!=(g=k.security.remoteCertificate)?g:void 0}}:null;b(null,{socket:{ref:m(j.ref),local:k.localAddress?J(k.localAddress):null,remote:k.remoteAddress?J(k.remoteAddress):null,remote_name:null!=(h=k.remoteName)?h:void 0,security:l,data:{keep_alives_sent:k.keepAlivesSent,streams_started:k.streamsStarted,streams_succeeded:k.streamsSucceeded,streams_failed:k.streamsFailed,last_local_stream_created_timestamp:B(k.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:B(k.lastRemoteStreamCreatedTimestamp),messages_received:k.messagesReceived,messages_sent:k.messagesSent,last_message_received_timestamp:B(k.lastMessageReceivedTimestamp),last_message_sent_timestamp:B(k.lastMessageSentTimestamp),local_flow_control_window:k.localFlowControlWindow?{value:k.localFlowControlWindow}:null,remote_flow_control_window:k.remoteFlowControlWindow?{value:k.remoteFlowControlWindow}:null}}})}function L(a,b){let c=Number.parseInt(a.request.server_id),d=v[c];if(void 0===d)return void b({code:f.Status.NOT_FOUND,details:"No server data found for id "+c});let e=Number.parseInt(a.request.start_socket_id),g=Number.parseInt(a.request.max_results),h=d.getInfo().sessionChildren.sockets.sort((a,b)=>a.id-b.id),i=[],j=0;for(;j<h.length&&(!(h[j].id>=e)||(i.push(m(h[j])),!(i.length>=g)));j++);b(null,{socket_ref:i,end:j>=h.length})}function M(){return{GetChannel:D,GetTopChannels:E,GetServer:G,GetServers:H,GetSubchannel:I,GetSocket:K,GetServerSockets:L}}c.registerChannelzChannel=function(a,b,c){let d=s(),e={id:d,name:a,kind:"channel"};return c&&(t[d]={ref:e,getInfo:b}),e},c.registerChannelzSubchannel=function(a,b,c){let d=s(),e={id:d,name:a,kind:"subchannel"};return c&&(u[d]={ref:e,getInfo:b}),e},c.registerChannelzServer=function(a,b){let c=s(),d={id:c,kind:"server"};return b&&(v[c]={ref:d,getInfo:a}),d},c.registerChannelzSocket=function(a,b,c){let d=s(),e={id:d,name:a,kind:"socket"};return c&&(w[d]={ref:e,getInfo:b}),e},c.unregisterChannelzRef=function(a){switch(a.kind){case"channel":delete t[a.id];return;case"subchannel":delete u[a.id];return;case"server":delete v[a.id];return;case"socket":delete w[a.id];return}},c.getChannelzHandlers=M;let N=null;function O(){if(N)return N;let b=(0,a.r(33676).loadSync)("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:["/ROOT/botbrains-nextjs/node_modules/@grpc/grpc-js/build/src/../../proto"]});return N=(0,i.loadPackageDefinition)(b).grpc.channelz.v1.Channelz.service}c.getChannelzServiceDefinition=O,c.setup=function(){(0,h.registerAdminService)(O,M)}},33176,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Subchannel=void 0;let d=a.r(69374),e=a.r(39984),f=a.r(48520),g=a.r(47844),h=a.r(22087),i=a.r(49271),j=a.r(37725),k="subchannel",l=0x7fffffff;class m{constructor(a,b,c,f,g){var h;this.channelTarget=a,this.subchannelAddress=b,this.options=c,this.credentials=f,this.connector=g,this.connectivityState=d.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new j.ChannelzCallTracker,this.childrenTracker=new j.ChannelzChildrenTracker,this.streamTracker=new j.ChannelzCallTracker;const k={initialDelay:c["grpc.initial_reconnect_backoff_ms"],maxDelay:c["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new e.BackoffTimeout(()=>{this.handleBackoffTimer()},k),this.backoffTimeout.unref(),this.subchannelAddressString=(0,i.subchannelAddressToString)(b),this.keepaliveTime=null!=(h=c["grpc.keepalive_time_ms"])?h:-1,0===c["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzTrace=new j.ChannelzTrace,this.channelzRef=(0,j.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(c,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(a){f.trace(g.LogVerbosity.DEBUG,k,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+a)}refTrace(a){f.trace(g.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+a)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([d.ConnectivityState.TRANSIENT_FAILURE],d.ConnectivityState.CONNECTING):this.transitionToState([d.ConnectivityState.TRANSIENT_FAILURE],d.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let a=this.options;if(a["grpc.keepalive_time_ms"]){let b=Math.min(this.keepaliveTime,l);a=Object.assign(Object.assign({},a),{"grpc.keepalive_time_ms":b})}this.connector.connect(this.subchannelAddress,this.credentials,a).then(a=>{this.transitionToState([d.ConnectivityState.CONNECTING],d.ConnectivityState.READY)?(this.transport=a,this.channelzEnabled&&this.childrenTracker.refChild(a.getChannelzRef()),a.addDisconnectListener(a=>{this.transitionToState([d.ConnectivityState.READY],d.ConnectivityState.IDLE),a&&this.keepaliveTime>0&&(this.keepaliveTime*=2,f.log(g.LogVerbosity.ERROR,`Connection to ${(0,h.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))})):a.shutdown()},a=>{this.transitionToState([d.ConnectivityState.CONNECTING],d.ConnectivityState.TRANSIENT_FAILURE,`${a}`)})}transitionToState(a,b,c){var e,f;if(-1===a.indexOf(this.connectivityState))return!1;this.trace(d.ConnectivityState[this.connectivityState]+" -> "+d.ConnectivityState[b]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+d.ConnectivityState[b]);let g=this.connectivityState;switch(this.connectivityState=b,b){case d.ConnectivityState.READY:this.stopBackoff();break;case d.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case d.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),null==(e=this.transport)||e.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case d.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),null==(f=this.transport)||f.shutdown(),this.transport=null;break;default:throw Error(`Invalid state: unknown ConnectivityState ${b}`)}for(let a of this.stateListeners)a(this,g,b,this.keepaliveTime,c);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,0===this.refcount&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.channelzEnabled&&(0,j.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([d.ConnectivityState.CONNECTING,d.ConnectivityState.READY],d.ConnectivityState.IDLE)}))}unrefIfOneRef(){return 1===this.refcount&&(this.unref(),!0)}createCall(a,b,c,d){let e;if(!this.transport)throw Error("Cannot create call, subchannel not READY");return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),e={onCallEnd:a=>{a.code===g.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):e={},this.transport.createCall(a,b,c,d,e)}startConnecting(){process.nextTick(()=>{this.transitionToState([d.ConnectivityState.IDLE],d.ConnectivityState.CONNECTING)||this.connectivityState!==d.ConnectivityState.TRANSIENT_FAILURE||(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(a){this.stateListeners.add(a)}removeConnectivityStateListener(a){this.stateListeners.delete(a)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([d.ConnectivityState.TRANSIENT_FAILURE],d.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}realSubchannelEquals(a){return a.getRealSubchannel()===this}throttleKeepalive(a){a>this.keepaliveTime&&(this.keepaliveTime=a)}}c.Subchannel=m},25328,(a,b,c)=>{b.exports=a.x("http2",()=>require("http2"))},21517,(a,b,c)=>{b.exports=a.x("http",()=>require("http"))},92509,(a,b,c)=>{b.exports=a.x("url",()=>require("url"))},79594,(a,b,c)=>{b.exports=a.x("dns",()=>require("dns"))},34197,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.setup=c.DEFAULT_PORT=void 0;let d=a.r(91539),e=a.r(79594),f=a.r(24361),g=a.r(98132),h=a.r(47844),i=a.r(92240),j=a.r(48520),k=a.r(47844),l=a.r(22087),m=a.r(4446),n=a.r(39984),o="dns_resolver";function p(a){j.trace(k.LogVerbosity.DEBUG,o,a)}c.DEFAULT_PORT=443;let q=3e4,r=f.promisify(e.resolveTxt),s=f.promisify(e.lookup);function t(...a){let b=[];for(let c=0;c<Math.max.apply(null,a.map(a=>a.length));c++)for(let d of a)c<d.length&&b.push(d[c]);return b}class u{constructor(a,b,d){var e,f,g;this.target=a,this.listener=b,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,this.returnedIpResult=!1,p("Resolver constructed for target "+(0,l.uriToString)(a));const j=(0,l.splitHostPort)(a.path);null===j?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,m.isIPv4)(j.host)||(0,m.isIPv6)(j.host)?(this.ipResult=[{host:j.host,port:null!=(e=j.port)?e:c.DEFAULT_PORT}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=j.host,this.port=null!=(f=j.port)?f:c.DEFAULT_PORT),this.percentage=100*Math.random(),1===d["grpc.service_config_disable_resolution"]&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:h.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,l.uriToString)(this.target)}`,metadata:new i.Metadata};const k={initialDelay:d["grpc.initial_reconnect_backoff_ms"],maxDelay:d["grpc.max_reconnect_backoff_ms"]};this.backoff=new n.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},k),this.backoff.unref(),this.minTimeBetweenResolutionsMs=null!=(g=d["grpc.dns_min_time_between_resolutions_ms"])?g:q,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(null!==this.ipResult){this.returnedIpResult||(p("Returning IP address for target "+(0,l.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.returnedIpResult=!0),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(null===this.dnsHostname)p("Failed to parse DNS address "+(0,l.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:h.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,l.uriToString)(this.target)}`,metadata:new i.Metadata})}),this.stopNextResolutionTimer();else{if(null!==this.pendingLookupPromise)return;p("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let a=this.dnsHostname;this.pendingLookupPromise=s(a,{all:!0}),this.pendingLookupPromise.then(a=>{if(null===this.pendingLookupPromise)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let b=a.filter(a=>4===a.family),c=a.filter(a=>6===a.family);this.latestLookupResult=t(c,b).map(a=>({host:a.address,port:+this.port}));let d="["+this.latestLookupResult.map(a=>a.host+":"+a.port).join(",")+"]";(p("Resolved addresses for target "+(0,l.uriToString)(this.target)+": "+d),0===this.latestLookupResult.length)?this.listener.onError(this.defaultResolutionError):this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},a=>{null!==this.pendingLookupPromise&&(p("Resolution error for target "+(0,l.uriToString)(this.target)+": "+a.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&null===this.pendingTxtPromise&&(this.pendingTxtPromise=r(a),this.pendingTxtPromise.then(a=>{if(null!==this.pendingTxtPromise){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,g.extractAndSelectServiceConfig)(a,this.percentage)}catch(a){this.latestServiceConfigError={code:h.Status.UNAVAILABLE,details:`Parsing service config failed with error ${a.message}`,metadata:new i.Metadata}}null!==this.latestLookupResult&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},a=>{}))}}startNextResolutionTimer(){var a,b;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=null==(b=(a=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)?void 0:b.call(a),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){null===this.pendingLookupPromise&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){null===this.pendingLookupPromise&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?p('resolution update delayed by "min time between resolutions" rate limit'):p("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.returnedIpResult=!1}static getDefaultAuthority(a){return a.path}}c.setup=function(){(0,d.registerResolver)("dns",u),(0,d.registerDefaultScheme)("dns")}},83183,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.getProxiedConnection=c.mapProxyName=void 0;let d=a.r(48520),e=a.r(47844),f=a.r(91539),g=a.r(21517),h=a.r(55004),i=a.r(48520),j=a.r(49271),k=a.r(22087),l=a.r(92509),m=a.r(34197),n="proxy";function o(a){i.trace(e.LogVerbosity.DEBUG,n,a)}function p(){let a,b="",c="";if(process.env.grpc_proxy)c="grpc_proxy",b=process.env.grpc_proxy;else if(process.env.https_proxy)c="https_proxy",b=process.env.https_proxy;else{if(!process.env.http_proxy)return{};c="http_proxy",b=process.env.http_proxy}try{a=new l.URL(b)}catch(a){return(0,d.log)(e.LogVerbosity.ERROR,`cannot parse value of "${c}" env var`),{}}if("http:"!==a.protocol)return(0,d.log)(e.LogVerbosity.ERROR,`"${a.protocol}" scheme not supported in proxy URI`),{};let f=null;a.username&&(a.password?((0,d.log)(e.LogVerbosity.INFO,"userinfo found in proxy URI"),f=`${a.username}:${a.password}`):f=a.username);let g=a.hostname,h=a.port;""===h&&(h="80");let i={address:`${g}:${h}`};return f&&(i.creds=f),o("Proxy server "+i.address+" set by environment variable "+c),i}function q(){let a=process.env.no_grpc_proxy,b="no_grpc_proxy";return(a||(a=process.env.no_proxy,b="no_proxy"),a)?(o("No proxy server list set by environment variable "+b),a.split(",")):[]}c.mapProxyName=function(a,b){var c;let d={target:a,extraOptions:{}};if((null!=(c=b["grpc.enable_http_proxy"])?c:1)===0||"unix"===a.scheme)return d;let e=p();if(!e.address)return d;let f=(0,k.splitHostPort)(a.path);if(!f)return d;let g=f.host;for(let b of q())if(b===g)return o("Not using proxy for target in no_proxy list: "+(0,k.uriToString)(a)),d;let h={"grpc.http_connect_target":(0,k.uriToString)(a)};return e.creds&&(h["grpc.http_connect_creds"]=e.creds),{target:{scheme:"dns",path:e.address},extraOptions:h}},c.getProxiedConnection=function(a,b,c){var i;if(!("grpc.http_connect_target"in b))return Promise.resolve({});let l=b["grpc.http_connect_target"],n=(0,k.parseUri)(l);if(null===n)return Promise.resolve({});let p=(0,k.splitHostPort)(n.path);if(null===p)return Promise.resolve({});let q=`${p.host}:${null!=(i=p.port)?i:m.DEFAULT_PORT}`,r={method:"CONNECT",path:q},s={Host:q};(0,j.isTcpSubchannelAddress)(a)?(r.host=a.host,r.port=a.port):r.socketPath=a.path,"grpc.http_connect_creds"in b&&(s["Proxy-Authorization"]="Basic "+Buffer.from(b["grpc.http_connect_creds"]).toString("base64")),r.headers=s;let t=(0,j.subchannelAddressToString)(a);return o("Using proxy "+t+" to connect to "+r.path),new Promise((a,b)=>{let i=g.request(r);i.once("connect",(g,j,l)=>{var m;if(i.removeAllListeners(),j.removeAllListeners(),200===g.statusCode)if(o("Successfully connected to "+r.path+" through proxy "+t),"secureContext"in c){let d=(0,f.getDefaultAuthority)(n),e=(0,k.splitHostPort)(d),g=null!=(m=null==e?void 0:e.host)?m:d,i=h.connect(Object.assign({host:g,servername:g,socket:j},c),()=>{o("Successfully established a TLS connection to "+r.path+" through proxy "+t),a({socket:i,realTarget:n})});i.on("error",a=>{o("Failed to establish a TLS connection to "+r.path+" through proxy "+t+" with error "+a.message),b()})}else o("Successfully established a plaintext connection to "+r.path+" through proxy "+t),a({socket:j,realTarget:n});else(0,d.log)(e.LogVerbosity.ERROR,"Failed to connect to "+r.path+" through proxy "+t+" with status "+g.statusCode),b()}),i.once("error",a=>{i.removeAllListeners(),(0,d.log)(e.LogVerbosity.ERROR,"Failed to connect to proxy "+t+" with error "+a.message),b()}),i.end()})}},35508,(a,b,c)=>{"use strict";var d;Object.defineProperty(c,"__esModule",{value:!0}),c.StreamDecoder=void 0,function(a){a[a.NO_DATA=0]="NO_DATA",a[a.READING_SIZE=1]="READING_SIZE",a[a.READING_MESSAGE=2]="READING_MESSAGE"}(d||(d={}));class e{constructor(a){this.maxReadMessageLength=a,this.readState=d.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(a){let b,c=0,e=[];for(;c<a.length;)switch(this.readState){case d.NO_DATA:this.readCompressFlag=a.slice(c,c+1),c+=1,this.readState=d.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case d.READING_SIZE:if(b=Math.min(a.length-c,this.readSizeRemaining),a.copy(this.readPartialSize,4-this.readSizeRemaining,c,c+b),this.readSizeRemaining-=b,c+=b,0===this.readSizeRemaining){if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),-1!==this.maxReadMessageLength&&this.readMessageSize>this.maxReadMessageLength)throw Error(`Received message larger than max (${this.readMessageSize} vs ${this.maxReadMessageLength})`);if(this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=d.READING_MESSAGE;else{let a=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=d.NO_DATA,e.push(a)}}break;case d.READING_MESSAGE:if(b=Math.min(a.length-c,this.readMessageRemaining),this.readPartialMessage.push(a.slice(c,c+b)),this.readMessageRemaining-=b,c+=b,0===this.readMessageRemaining){let a=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),b=Buffer.concat(a,this.readMessageSize+5);this.readState=d.NO_DATA,e.push(b)}break;default:throw Error("Unexpected read state")}return e}}c.StreamDecoder=e},13443,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Http2SubchannelCall=void 0;let d=a.r(25328),e=a.r(46786),f=a.r(47844),g=a.r(92240),h=a.r(35508),i=a.r(48520),j=a.r(47844),k="subchannel_call";function l(a){for(let[b,c]of Object.entries(e.constants.errno))if(c===a)return b;return"Unknown system error "+a}class m{constructor(a,b,c,e,i){var j;this.http2Stream=a,this.callEventTracker=b,this.listener=c,this.transport=e,this.callId=i,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.mappedStatusCode=f.Status.UNKNOWN,this.finalStatus=null,this.internalError=null;const k=null!=(j=e.getOptions()["grpc.max_receive_message_length"])?j:f.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH;this.decoder=new h.StreamDecoder(k),a.on("response",(a,b)=>{let c="";for(let b of Object.keys(a))c+="		"+b+": "+a[b]+"\n";switch(this.trace("Received server headers:\n"+c),a[":status"]){case 400:this.mappedStatusCode=f.Status.INTERNAL;break;case 401:this.mappedStatusCode=f.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=f.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=f.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=f.Status.UNAVAILABLE;break;default:this.mappedStatusCode=f.Status.UNKNOWN}if(b&d.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(a);else{let b;try{b=g.Metadata.fromHttp2Headers(a)}catch(a){this.endCall({code:f.Status.UNKNOWN,details:a.message,metadata:new g.Metadata});return}this.listener.onReceiveMetadata(b)}}),a.on("trailers",a=>{this.handleTrailers(a)}),a.on("data",a=>{let b;if(!this.statusOutput){this.trace("receive HTTP/2 data frame of length "+a.length);try{b=this.decoder.write(a)}catch(a){this.cancelWithStatus(f.Status.RESOURCE_EXHAUSTED,a.message);return}for(let a of b)this.trace("parsed message of length "+a.length),this.callEventTracker.addMessageReceived(),this.tryPush(a)}}),a.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),a.on("close",()=>{process.nextTick(()=>{var b;let c;if(this.trace("HTTP/2 stream closed with code "+a.rstCode),(null==(b=this.finalStatus)?void 0:b.code)===f.Status.OK)return;let e="";switch(a.rstCode){case d.constants.NGHTTP2_NO_ERROR:if(null!==this.finalStatus)return;c=f.Status.INTERNAL,e=`Received RST_STREAM with code ${a.rstCode}`;break;case d.constants.NGHTTP2_REFUSED_STREAM:c=f.Status.UNAVAILABLE,e="Stream refused by server";break;case d.constants.NGHTTP2_CANCEL:c=f.Status.CANCELLED,e="Call cancelled";break;case d.constants.NGHTTP2_ENHANCE_YOUR_CALM:c=f.Status.RESOURCE_EXHAUSTED,e="Bandwidth exhausted or memory limit exceeded";break;case d.constants.NGHTTP2_INADEQUATE_SECURITY:c=f.Status.PERMISSION_DENIED,e="Protocol not secure enough";break;case d.constants.NGHTTP2_INTERNAL_ERROR:c=f.Status.INTERNAL,null===this.internalError?e=`Received RST_STREAM with code ${a.rstCode} (Internal server error)`:"ECONNRESET"===this.internalError.code||"ETIMEDOUT"===this.internalError.code?(c=f.Status.UNAVAILABLE,e=this.internalError.message):e=`Received RST_STREAM with code ${a.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:c=f.Status.INTERNAL,e=`Received RST_STREAM with code ${a.rstCode}`}this.endCall({code:c,details:e,metadata:new g.Metadata,rstCode:a.rstCode})})}),a.on("error",a=>{"ERR_HTTP2_STREAM_ERROR"!==a.code&&(this.trace("Node error event: message="+a.message+" code="+a.code+" errno="+l(a.errno)+" syscall="+a.syscall),this.internalError=a),this.callEventTracker.onStreamEnd(!1)})}onDisconnect(){this.endCall({code:f.Status.UNAVAILABLE,details:"Connection dropped",metadata:new g.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(a){i.trace(j.LogVerbosity.DEBUG,k,"["+this.callId+"] "+a)}endCall(a){(null===this.finalStatus||this.finalStatus.code===f.Status.OK)&&(this.finalStatus=a,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){null===this.finalStatus||this.finalStatus.code===f.Status.OK&&(!this.readsClosed||0!==this.unpushedReadMessages.length||this.isReadFilterPending||this.isPushPending)||this.outputStatus()}push(a){this.trace("pushing to reader message of length "+(a instanceof Buffer?a.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,this.statusOutput||(this.listener.onReceiveMessage(a),this.maybeOutputStatus())})}tryPush(a){this.canPush?(this.http2Stream.pause(),this.push(a)):(this.trace("unpushedReadMessages.push message of length "+a.length),this.unpushedReadMessages.push(a))}handleTrailers(a){let b;this.callEventTracker.onStreamEnd(!0);let c="";for(let b of Object.keys(a))c+="		"+b+": "+a[b]+"\n";this.trace("Received server trailers:\n"+c);try{b=g.Metadata.fromHttp2Headers(a)}catch(a){b=new g.Metadata}let d=b.getMap(),e=this.mappedStatusCode;if(e===f.Status.UNKNOWN&&"string"==typeof d["grpc-status"]){let a=Number(d["grpc-status"]);a in f.Status&&(e=a,this.trace("received status code "+a+" from server")),b.remove("grpc-status")}let h="";if("string"==typeof d["grpc-message"]){try{h=decodeURI(d["grpc-message"])}catch(a){h=d["grpc-message"]}b.remove("grpc-message"),this.trace('received status details string "'+h+'" from server')}let i={code:e,details:h,metadata:b};this.endCall(i)}destroyHttp2Stream(){var a;if(!this.http2Stream.destroyed){let b;b=(null==(a=this.finalStatus)?void 0:a.code)===f.Status.OK?d.constants.NGHTTP2_NO_ERROR:d.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+b),this.http2Stream.close(b)}}cancelWithStatus(a,b){this.trace("cancelWithStatus code: "+a+' details: "'+b+'"'),this.endCall({code:a,details:b,metadata:new g.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(null!==this.finalStatus&&this.finalStatus.code!==f.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let a=this.unpushedReadMessages.shift();this.push(a);return}this.http2Stream.resume()}sendMessageWithContext(a,b){this.trace("write() called with message of length "+b.length);let c=b=>{process.nextTick(()=>{var c;let d=f.Status.UNAVAILABLE;(null==b?void 0:b.code)==="ERR_STREAM_WRITE_AFTER_END"&&(d=f.Status.INTERNAL),b&&this.cancelWithStatus(d,`Write error: ${b.message}`),null==(c=a.callback)||c.call(a)})};this.trace("sending data chunk of length "+b.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(b,c)}catch(a){this.endCall({code:f.Status.UNAVAILABLE,details:`Write failed with error ${a.message}`,metadata:new g.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}}c.Http2SubchannelCall=m},318,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.getNextCallNumber=void 0;let d=0;c.getNextCallNumber=function(){return d++}},92007,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Http2SubchannelConnector=void 0;let d=a.r(25328),e=a.r(55004),f=a.r(37725),g=a.r(47844),h=a.r(83183),i=a.r(48520),j=a.r(91539),k=a.r(49271),l=a.r(22087),m=a.r(4446),n=a.r(13443),o=a.r(318),p="transport",q="transport_flowctrl",r=a.r(85223).version,{HTTP2_HEADER_AUTHORITY:s,HTTP2_HEADER_CONTENT_TYPE:t,HTTP2_HEADER_METHOD:u,HTTP2_HEADER_PATH:v,HTTP2_HEADER_TE:w,HTTP2_HEADER_USER_AGENT:x}=d.constants,y=2e4,z=Buffer.from("too_many_pings","ascii");class A{constructor(a,b,c,e){this.session=a,this.options=c,this.remoteName=e,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=y,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.streamTracker=new f.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,k.subchannelAddressToString)(b),0===c["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzRef=(0,f.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[c["grpc.primary_user_agent"],`grpc-node-js/${r}`,c["grpc.secondary_user_agent"]].filter(a=>a).join(" "),"grpc.keepalive_time_ms"in c&&(this.keepaliveTimeMs=c["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in c&&(this.keepaliveTimeoutMs=c["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in c?this.keepaliveWithoutCalls=1===c["grpc.keepalive_permit_without_calls"]:this.keepaliveWithoutCalls=!1,a.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),a.once("goaway",(a,b,c)=>{let e=!1;a===d.constants.NGHTTP2_ENHANCE_YOUR_CALM&&c&&c.equals(z)&&(e=!0),this.trace("connection closed by GOAWAY with code "+a+" and data "+(null==c?void 0:c.toString())),this.reportDisconnectToOwner(e)}),a.once("error",a=>{this.trace("connection closed with error "+a.message)}),i.isTracerEnabled(p)&&(a.on("remoteSettings",b=>{this.trace("new settings received"+(this.session!==a?" on the old connection":"")+": "+JSON.stringify(b))}),a.on("localSettings",b=>{this.trace("local settings acknowledged by remote"+(this.session!==a?" on the old connection":"")+": "+JSON.stringify(b))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var a,b,c;let d,e=this.session.socket,f=e.remoteAddress?(0,k.stringToSubchannelAddress)(e.remoteAddress,e.remotePort):null,g=e.localAddress?(0,k.stringToSubchannelAddress)(e.localAddress,e.localPort):null;if(this.session.encrypted){let b=e,c=b.getCipher(),f=b.getCertificate(),g=b.getPeerCertificate();d={cipherSuiteStandardName:null!=(a=c.standardName)?a:null,cipherSuiteOtherName:c.standardName?null:c.name,localCertificate:f&&"raw"in f?f.raw:null,remoteCertificate:g&&"raw"in g?g.raw:null}}else d=null;return{remoteAddress:f,localAddress:g,security:d,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:null!=(b=this.session.state.localWindowSize)?b:null,remoteFlowControlWindow:null!=(c=this.session.state.remoteWindowSize)?c:null}}trace(a){i.trace(g.LogVerbosity.DEBUG,p,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+a)}keepaliveTrace(a){i.trace(g.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+a)}flowControlTrace(a){i.trace(g.LogVerbosity.DEBUG,q,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+a)}internalsTrace(a){i.trace(g.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+a)}reportDisconnectToOwner(a){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(b=>b(a)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let a of this.activeCalls)a.onDisconnect()})}addDisconnectListener(a){this.disconnectListeners.push(a)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var a,b;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),null==(b=(a=this.keepaliveTimeoutId).unref)||b.call(a));try{this.session.ping((a,b,c)=>{a&&(this.keepaliveTrace("Ping failed with error "+a.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch(a){this.handleDisconnect()}}maybeStartKeepalivePingTimer(){var a,b;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):this.keepaliveTimerId||this.keepaliveTimeoutId||(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=null==(b=(a=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs)).unref)?void 0:b.call(a)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall(a){this.activeCalls.delete(a),0===this.activeCalls.size&&this.session.unref()}addActiveCall(a){this.activeCalls.add(a),1===this.activeCalls.size&&(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(a,b,c,d,e){let f,g,h,i=a.toHttp2Headers();i[s]=b,i[x]=this.userAgent,i[t]="application/grpc",i[u]="POST",i[v]=c,i[w]="trailers";try{f=this.session.request(i)}catch(a){throw this.handleDisconnect(),a}return this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed),this.channelzEnabled?(this.streamTracker.addCallStarted(),g={addMessageSent:()=>{var a;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,null==(a=e.addMessageSent)||a.call(e)},addMessageReceived:()=>{var a;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,null==(a=e.addMessageReceived)||a.call(e)},onCallEnd:a=>{var b;null==(b=e.onCallEnd)||b.call(e,a),this.removeActiveCall(h)},onStreamEnd:a=>{var b;a?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),null==(b=e.onStreamEnd)||b.call(e,a)}}):g={addMessageSent:()=>{var a;null==(a=e.addMessageSent)||a.call(e)},addMessageReceived:()=>{var a;null==(a=e.addMessageReceived)||a.call(e)},onCallEnd:a=>{var b;null==(b=e.onCallEnd)||b.call(e,a),this.removeActiveCall(h)},onStreamEnd:a=>{var b;null==(b=e.onStreamEnd)||b.call(e,a)}},h=new n.Http2SubchannelCall(f,g,d,this,(0,o.getNextCallNumber)()),this.addActiveCall(h),h}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}getOptions(){return this.options}shutdown(){this.session.close(),(0,f.unregisterChannelzRef)(this.channelzRef)}}class B{constructor(a){this.channelTarget=a,this.session=null,this.isShutdown=!1}trace(a){i.trace(g.LogVerbosity.DEBUG,p,(0,l.uriToString)(this.channelTarget)+" "+a)}createSession(a,b,c,f){return this.isShutdown?Promise.reject():new Promise((g,h)=>{var i,n,o;let p;f.realTarget?(p=(0,l.uriToString)(f.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,l.uriToString)(f.realTarget))):(p=null,this.trace("creating HTTP/2 session to "+(0,k.subchannelAddressToString)(a)));let q=(0,j.getDefaultAuthority)(null!=(i=f.realTarget)?i:this.channelTarget),r=b._getConnectionOptions()||{};r.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in c?r.maxSessionMemory=c["grpc-node.max_session_memory"]:r.maxSessionMemory=Number.MAX_SAFE_INTEGER;let s="http://";if("secureContext"in r){if(s="https://",c["grpc.ssl_target_name_override"]){let a=c["grpc.ssl_target_name_override"];r.checkServerIdentity=(b,c)=>(0,e.checkServerIdentity)(a,c),r.servername=a}else{let a=null!=(o=null==(n=(0,l.splitHostPort)(q))?void 0:n.host)?o:"localhost";r.servername=a}f.socket&&(r.createConnection=(a,b)=>f.socket)}else r.createConnection=(b,c)=>f.socket?f.socket:m.connect(a);r=Object.assign(Object.assign(Object.assign({},r),a),{enableTrace:1===c["grpc-node.tls_enable_trace"]});let t=d.connect(s+q,r);this.session=t;let u="Failed to connect";t.unref(),t.once("connect",()=>{t.removeAllListeners(),g(new A(t,a,c,p)),this.session=null}),t.once("close",()=>{this.session=null,setImmediate(()=>{h(`${u} (${new Date().toISOString()})`)})}),t.once("error",a=>{u=a.message,this.trace("connection failed with error "+u)})})}connect(a,b,c){var d,f;if(this.isShutdown)return Promise.reject();let g=b._getConnectionOptions()||{};if("secureContext"in g){if(g.ALPNProtocols=["h2"],c["grpc.ssl_target_name_override"]){let a=c["grpc.ssl_target_name_override"];g.checkServerIdentity=(b,c)=>(0,e.checkServerIdentity)(a,c),g.servername=a}else if("grpc.http_connect_target"in c){let a=(0,j.getDefaultAuthority)(null!=(d=(0,l.parseUri)(c["grpc.http_connect_target"]))?d:{path:"localhost"}),b=(0,l.splitHostPort)(a);g.servername=null!=(f=null==b?void 0:b.host)?f:a}c["grpc-node.tls_enable_trace"]&&(g.enableTrace=!0)}return(0,h.getProxiedConnection)(a,c,g).then(d=>this.createSession(a,b,c,d))}shutdown(){var a;this.isShutdown=!0,null==(a=this.session)||a.close(),this.session=null}}c.Http2SubchannelConnector=B},16497,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.getSubchannelPool=c.SubchannelPool=void 0;let d=a.r(8358),e=a.r(33176),f=a.r(49271),g=a.r(22087),h=a.r(92007),i=1e4;class j{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let a=!0;for(let b in this.pool){let c=this.pool[b].filter(a=>!a.subchannel.unrefIfOneRef());c.length>0&&(a=!1),this.pool[b]=c}a&&null!==this.cleanupTimer&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var a,b;null===this.cleanupTimer&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},i),null==(b=(a=this.cleanupTimer).unref)||b.call(a))}getOrCreateSubchannel(a,b,c,i){this.ensureCleanupTask();let j=(0,g.uriToString)(a);if(j in this.pool){for(let a of this.pool[j])if((0,f.subchannelAddressEqual)(b,a.subchannelAddress)&&(0,d.channelOptionsEqual)(c,a.channelArguments)&&i._equals(a.channelCredentials))return a.subchannel}let k=new e.Subchannel(a,b,c,i,new h.Http2SubchannelConnector(a));return j in this.pool||(this.pool[j]=[]),this.pool[j].push({subchannelAddress:b,channelArguments:c,channelCredentials:i,subchannel:k}),k.ref(),k}}c.SubchannelPool=j;let k=new j;c.getSubchannelPool=function(a){return a?k:new j}},98726,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.FilterStackFactory=c.FilterStack=void 0;class d{constructor(a){this.filters=a}sendMetadata(a){let b=a;for(let a=0;a<this.filters.length;a++)b=this.filters[a].sendMetadata(b);return b}receiveMetadata(a){let b=a;for(let a=this.filters.length-1;a>=0;a--)b=this.filters[a].receiveMetadata(b);return b}sendMessage(a){let b=a;for(let a=0;a<this.filters.length;a++)b=this.filters[a].sendMessage(b);return b}receiveMessage(a){let b=a;for(let a=this.filters.length-1;a>=0;a--)b=this.filters[a].receiveMessage(b);return b}receiveTrailers(a){let b=a;for(let a=this.filters.length-1;a>=0;a--)b=this.filters[a].receiveTrailers(b);return b}push(a){this.filters.unshift(...a)}getFilters(){return this.filters}}c.FilterStack=d;class e{constructor(a){this.factories=a}push(a){this.factories.unshift(...a)}clone(){return new e([...this.factories])}createFilter(){return new d(this.factories.map(a=>a.createFilter()))}}c.FilterStackFactory=e},6461,(a,b,c)=>{b.exports=a.x("zlib",()=>require("zlib"))},17919,(a,b,c)=>{"use strict";var d;Object.defineProperty(c,"__esModule",{value:!0}),c.CompressionAlgorithms=void 0,function(a){a[a.identity=0]="identity",a[a.deflate=1]="deflate",a[a.gzip=2]="gzip"}(d||(c.CompressionAlgorithms=d={}))},62184,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.BaseFilter=void 0;class d{async sendMetadata(a){return a}receiveMetadata(a){return a}async sendMessage(a){return a}async receiveMessage(a){return a}receiveTrailers(a){return a}}c.BaseFilter=d},86052,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.CompressionFilterFactory=c.CompressionFilter=void 0;let d=a.r(6461),e=a.r(17919),f=a.r(47844),g=a.r(62184),h=a.r(48520),i=a=>"number"==typeof a&&"string"==typeof e.CompressionAlgorithms[a];class j{async writeMessage(a,b){let c=a;b&&(c=await this.compressMessage(c));let d=Buffer.allocUnsafe(c.length+5);return d.writeUInt8(+!!b,0),d.writeUInt32BE(c.length,1),c.copy(d,5),d}async readMessage(a){let b=1===a.readUInt8(0),c=a.slice(5);return b&&(c=await this.decompressMessage(c)),c}}class k extends j{async compressMessage(a){return a}async writeMessage(a,b){let c=Buffer.allocUnsafe(a.length+5);return c.writeUInt8(0,0),c.writeUInt32BE(a.length,1),a.copy(c,5),c}decompressMessage(a){return Promise.reject(Error('Received compressed message but "grpc-encoding" header was identity'))}}class l extends j{constructor(a){super(),this.maxRecvMessageLength=a}compressMessage(a){return new Promise((b,c)=>{d.deflate(a,(a,d)=>{a?c(a):b(d)})})}decompressMessage(a){return new Promise((b,c)=>{let e=0,g=[],h=d.createInflate();h.on("data",a=>{g.push(a),e+=a.byteLength,-1!==this.maxRecvMessageLength&&e>this.maxRecvMessageLength&&(h.destroy(),c({code:f.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),h.on("end",()=>{b(Buffer.concat(g))}),h.write(a),h.end()})}}class m extends j{constructor(a){super(),this.maxRecvMessageLength=a}compressMessage(a){return new Promise((b,c)=>{d.gzip(a,(a,d)=>{a?c(a):b(d)})})}decompressMessage(a){return new Promise((b,c)=>{let e=0,g=[],h=d.createGunzip();h.on("data",a=>{g.push(a),e+=a.byteLength,-1!==this.maxRecvMessageLength&&e>this.maxRecvMessageLength&&(h.destroy(),c({code:f.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),h.on("end",()=>{b(Buffer.concat(g))}),h.write(a),h.end()})}}class n extends j{constructor(a){super(),this.compressionName=a}compressMessage(a){return Promise.reject(Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(a){return Promise.reject(Error(`Compression method not supported: ${this.compressionName}`))}}function o(a,b){switch(a){case"identity":return new k;case"deflate":return new l(b);case"gzip":return new m(b);default:return new n(a)}}class p extends g.BaseFilter{constructor(a,b){var c,d;super(),this.sharedFilterConfig=b,this.sendCompression=new k,this.receiveCompression=new k,this.currentCompressionAlgorithm="identity";const g=a["grpc.default_compression_algorithm"];if(this.maxReceiveMessageLength=null!=(c=a["grpc.max_receive_message_length"])?c:f.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,void 0!==g)if(i(g)){const a=e.CompressionAlgorithms[g],c=null==(d=b.serverSupportedEncodingHeader)?void 0:d.split(",");(!c||c.includes(a))&&(this.currentCompressionAlgorithm=a,this.sendCompression=o(this.currentCompressionAlgorithm,-1))}else h.log(f.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${g}`)}async sendMetadata(a){let b=await a;return b.set("grpc-accept-encoding","identity,deflate,gzip"),b.set("accept-encoding","identity"),"identity"===this.currentCompressionAlgorithm?b.remove("grpc-encoding"):b.set("grpc-encoding",this.currentCompressionAlgorithm),b}receiveMetadata(a){let b=a.get("grpc-encoding");if(b.length>0){let a=b[0];"string"==typeof a&&(this.receiveCompression=o(a,this.maxReceiveMessageLength))}a.remove("grpc-encoding");let c=a.get("grpc-accept-encoding")[0];return c&&(this.sharedFilterConfig.serverSupportedEncodingHeader=c,c.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new k,this.currentCompressionAlgorithm="identity")),a.remove("grpc-accept-encoding"),a}async sendMessage(a){var b;let c,d=await a;return c=!(this.sendCompression instanceof k)&&((null!=(b=d.flags)?b:0)&2)==0,{message:await this.sendCompression.writeMessage(d.message,c),flags:d.flags}}async receiveMessage(a){return this.receiveCompression.readMessage(await a)}}c.CompressionFilter=p;class q{constructor(a,b){this.options=b,this.sharedFilterConfig={}}createFilter(){return new p(this.options,this.sharedFilterConfig)}}c.CompressionFilterFactory=q},90915,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.deadlineToString=c.getRelativeTimeout=c.getDeadlineTimeoutString=c.minDeadline=void 0,c.minDeadline=function(...a){let b=1/0;for(let c of a){let a=c instanceof Date?c.getTime():c;a<b&&(b=a)}return b};let d=[["m",1],["S",1e3],["M",6e4],["H",36e5]];c.getDeadlineTimeoutString=function(a){let b=new Date().getTime();a instanceof Date&&(a=a.getTime());let c=Math.max(a-b,0);for(let[a,b]of d){let d=c/b;if(d<1e8)return String(Math.ceil(d))+a}throw Error("Deadline is too far in the future")};let e=0x7fffffff;c.getRelativeTimeout=function(a){let b=(a instanceof Date?a.getTime():a)-new Date().getTime();return b<0?0:b>e?1/0:b},c.deadlineToString=function(a){if(a instanceof Date)return a.toISOString();{let b=new Date(a);return Number.isNaN(b.getTime())?""+a:b.toISOString()}}},77170,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.restrictControlPlaneStatusCode=void 0;let d=a.r(47844),e=[d.Status.OK,d.Status.INVALID_ARGUMENT,d.Status.NOT_FOUND,d.Status.ALREADY_EXISTS,d.Status.FAILED_PRECONDITION,d.Status.ABORTED,d.Status.OUT_OF_RANGE,d.Status.DATA_LOSS];c.restrictControlPlaneStatusCode=function(a,b){return e.includes(a)?{code:d.Status.INTERNAL,details:`Invalid status from control plane: ${a} ${d.Status[a]} ${b}`}:{code:a,details:b}}},68265,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.LoadBalancingCall=void 0;let d=a.r(69374),e=a.r(47844),f=a.r(90915),g=a.r(92240),h=a.r(6483),i=a.r(22087),j=a.r(48520),k=a.r(77170),l=a.r(25328),m="load_balancing_call";class n{constructor(a,b,c,d,e,f,g){var h,j;this.channel=a,this.callConfig=b,this.methodName=c,this.host=d,this.credentials=e,this.deadline=f,this.callNumber=g,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null;const k=this.methodName.split("/");let l="";k.length>=2&&(l=k[1]);const m=null!=(j=null==(h=(0,i.splitHostPort)(this.host))?void 0:h.host)?j:"localhost";this.serviceUrl=`https://${m}/${l}`}trace(a){j.trace(e.LogVerbosity.DEBUG,m,"["+this.callNumber+"] "+a)}outputStatus(a,b){var c,d;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+a.code+' details="'+a.details+'"');let e=Object.assign(Object.assign({},a),{progress:b});null==(c=this.listener)||c.onReceiveStatus(e),null==(d=this.onCallEnded)||d.call(this,e.code)}}doPick(){var a,b;if(this.ended)return;if(!this.metadata)throw Error("doPick called before start");this.trace("Pick called");let c=this.channel.doPick(this.metadata,this.callConfig.pickInformation),i=c.subchannel?"("+c.subchannel.getChannelzRef().id+") "+c.subchannel.getAddress():""+c.subchannel;switch(this.trace("Pick result: "+h.PickResultType[c.pickResultType]+" subchannel: "+i+" status: "+(null==(a=c.status)?void 0:a.code)+" "+(null==(b=c.status)?void 0:b.details)),c.pickResultType){case h.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(a=>{var b,h,j;if(this.ended)return void this.trace("Credentials metadata generation finished after call ended");let k=this.metadata.clone();if(k.merge(a),k.get("authorization").length>1&&this.outputStatus({code:e.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new g.Metadata},"PROCESSED"),c.subchannel.getConnectivityState()!==d.ConnectivityState.READY){this.trace("Picked subchannel "+i+" has state "+d.ConnectivityState[c.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&k.set("grpc-timeout",(0,f.getDeadlineTimeoutString)(this.deadline));try{this.child=c.subchannel.getRealSubchannel().createCall(k,this.host,this.methodName,{onReceiveMetadata:a=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(a)},onReceiveMessage:a=>{this.trace("Received message"),this.listener.onReceiveMessage(a)},onReceiveStatus:a=>{this.trace("Received status"),a.rstCode===l.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(a,"REFUSED"):this.outputStatus(a,"PROCESSED")}})}catch(a){this.trace("Failed to start call on picked subchannel "+i+" with error "+a.message),this.outputStatus({code:e.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+a.message,metadata:new g.Metadata},"NOT_STARTED");return}null==(h=(b=this.callConfig).onCommitted)||h.call(b),null==(j=c.onCallStarted)||j.call(c),this.onCallEnded=c.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},a=>{let{code:b,details:c}=(0,k.restrictControlPlaneStatusCode)("number"==typeof a.code?a.code:e.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${a.message}`);this.outputStatus({code:b,details:c,metadata:new g.Metadata},"PROCESSED")});break;case h.PickResultType.DROP:let{code:j,details:m}=(0,k.restrictControlPlaneStatusCode)(c.status.code,c.status.details);setImmediate(()=>{this.outputStatus({code:j,details:m,metadata:c.status.metadata},"DROP")});break;case h.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:a,details:b}=(0,k.restrictControlPlaneStatusCode)(c.status.code,c.status.details);setImmediate(()=>{this.outputStatus({code:a,details:b,metadata:c.status.metadata},"PROCESSED")})}break;case h.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(a,b){var c;this.trace("cancelWithStatus code: "+a+' details: "'+b+'"'),null==(c=this.child)||c.cancelWithStatus(a,b),this.outputStatus({code:a,details:b,metadata:new g.Metadata},"PROCESSED")}getPeer(){var a,b;return null!=(b=null==(a=this.child)?void 0:a.getPeer())?b:this.channel.getTarget()}start(a,b){this.trace("start called"),this.listener=b,this.metadata=a,this.doPick()}sendMessageWithContext(a,b){this.trace("write() called with message of length "+b.length),this.child?this.child.sendMessageWithContext(a,b):this.pendingMessage={context:a,message:b}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(a){throw Error("Method not implemented.")}getCallNumber(){return this.callNumber}}c.LoadBalancingCall=n},13183,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ResolvingCall=void 0;let d=a.r(47844),e=a.r(90915),f=a.r(92240),g=a.r(48520),h=a.r(77170),i="resolving_call";class j{constructor(a,b,c,f,g,h){this.channel=a,this.method=b,this.filterStackFactory=f,this.credentials=g,this.callNumber=h,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadline=c.deadline,this.host=c.host,c.parentCall&&(c.flags&d.Propagate.CANCELLATION&&c.parentCall.on("cancelled",()=>{this.cancelWithStatus(d.Status.CANCELLED,"Cancelled by parent call")}),c.flags&d.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+c.parentCall.getDeadline()),this.deadline=(0,e.minDeadline)(this.deadline,c.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(a){g.trace(d.LogVerbosity.DEBUG,i,"["+this.callNumber+"] "+a)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.trace("Deadline: "+(0,e.deadlineToString)(this.deadline));let a=(0,e.getRelativeTimeout)(this.deadline);if(a!==1/0){this.trace("Deadline will be reached in "+a+"ms");let b=()=>{this.cancelWithStatus(d.Status.DEADLINE_EXCEEDED,"Deadline exceeded")};a<=0?process.nextTick(b):this.deadlineTimer=setTimeout(b,a)}}outputStatus(a){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let b=this.filterStack.receiveTrailers(a);this.trace("ended with status: code="+b.code+' details="'+b.details+'"'),this.statusWatchers.forEach(a=>a(b)),process.nextTick(()=>{var a;null==(a=this.listener)||a.onReceiveStatus(b)})}}sendMessageOnChild(a,b){if(!this.child)throw Error("sendMessageonChild called with child not populated");let c=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:b,flags:a.flags})).then(b=>{this.writeFilterPending=!1,c.sendMessageWithContext(a,b.message),this.pendingHalfClose&&c.halfClose()},a=>{this.cancelWithStatus(a.code,a.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw Error("getConfig called before start");let a=this.channel.getConfig(this.method,this.metadata);if("NONE"===a.type)return void this.channel.queueCallForConfig(this);if("ERROR"===a.type)return void(this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(a.error));let b=a.config;if(b.status!==d.Status.OK){let{code:a,details:c}=(0,h.restrictControlPlaneStatusCode)(b.status,"Failed to route call to method "+this.method);this.outputStatus({code:a,details:c,metadata:new f.Metadata});return}if(b.methodConfig.timeout){let a=new Date;a.setSeconds(a.getSeconds()+b.methodConfig.timeout.seconds),a.setMilliseconds(a.getMilliseconds()+b.methodConfig.timeout.nanos/1e6),this.deadline=(0,e.minDeadline)(this.deadline,a),this.runDeadlineTimer()}this.filterStackFactory.push(b.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(a=>{this.child=this.channel.createInnerCall(b,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.child.start(a,{onReceiveMetadata:a=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(a))},onReceiveMessage:a=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(a).then(a=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(a),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},a=>{this.cancelWithStatus(a.code,a.details)})},onReceiveStatus:a=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=a:this.outputStatus(a)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},a=>{this.outputStatus(a)})}reportResolverError(a){var b;(null==(b=this.metadata)?void 0:b.getOptions().waitForReady)?this.channel.queueCallForConfig(this):this.outputStatus(a)}cancelWithStatus(a,b){var c;this.trace("cancelWithStatus code: "+a+' details: "'+b+'"'),null==(c=this.child)||c.cancelWithStatus(a,b),this.outputStatus({code:a,details:b,metadata:new f.Metadata})}getPeer(){var a,b;return null!=(b=null==(a=this.child)?void 0:a.getPeer())?b:this.channel.getTarget()}start(a,b){this.trace("start called"),this.metadata=a.clone(),this.listener=b,this.getConfig()}sendMessageWithContext(a,b){this.trace("write() called with message of length "+b.length),this.child?this.sendMessageOnChild(a,b):this.pendingMessage={context:a,message:b}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(a){this.credentials=this.credentials.compose(a)}addStatusWatcher(a){this.statusWatchers.push(a)}getCallNumber(){return this.callNumber}}c.ResolvingCall=j},98394,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.RetryingCall=c.MessageBufferTracker=c.RetryThrottler=void 0;let d=a.r(47844),e=a.r(92240),f=a.r(48520),g="retrying_call";class h{constructor(a,b,c){this.maxTokens=a,this.tokenRatio=b,c?this.tokens=c.tokens*(a/c.maxTokens):this.tokens=a}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}}c.RetryThrottler=h;class i{constructor(a,b){this.totalLimit=a,this.limitPerCall=b,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(a,b){var c;let d=null!=(c=this.allocatedPerCall.get(b))?c:0;return!(this.limitPerCall-d<a)&&!(this.totalLimit-this.totalAllocated<a)&&(this.allocatedPerCall.set(b,d+a),this.totalAllocated+=a,!0)}free(a,b){var c;if(this.totalAllocated<a)throw Error(`Invalid buffer allocation state: call ${b} freed ${a} > total allocated ${this.totalAllocated}`);this.totalAllocated-=a;let d=null!=(c=this.allocatedPerCall.get(b))?c:0;if(d<a)throw Error(`Invalid buffer allocation state: call ${b} freed ${a} > allocated for call ${d}`);this.allocatedPerCall.set(b,d-a)}freeAll(a){var b;let c=null!=(b=this.allocatedPerCall.get(a))?b:0;if(this.totalAllocated<c)throw Error(`Invalid buffer allocation state: call ${a} allocated ${c} > total allocated ${this.totalAllocated}`);this.totalAllocated-=c,this.allocatedPerCall.delete(a)}}c.MessageBufferTracker=i;let j="grpc-previous-rpc-attempts";class k{constructor(a,b,c,d,e,f,g,h,i){if(this.channel=a,this.callConfig=b,this.methodName=c,this.host=d,this.credentials=e,this.deadline=f,this.callNumber=g,this.bufferTracker=h,this.retryThrottler=i,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,b.methodConfig.retryPolicy){this.state="RETRY";const a=b.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(a.initialBackoff.substring(0,a.initialBackoff.length-1))}else b.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY"}getCallNumber(){return this.callNumber}trace(a){f.trace(d.LogVerbosity.DEBUG,g,"["+this.callNumber+"] "+a)}reportStatus(a){this.trace("ended with status: code="+a.code+' details="'+a.details+'"'),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var b;null==(b=this.listener)||b.onReceiveStatus({code:a.code,details:a.details,metadata:a.metadata})})}cancelWithStatus(a,b){for(let{call:c}of(this.trace("cancelWithStatus code: "+a+' details: "'+b+'"'),this.reportStatus({code:a,details:b,metadata:new e.Metadata}),this.underlyingCalls))c.cancelWithStatus(a,b)}getPeer(){return null!==this.committedCallIndex?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(a){var b;return null!=(b=this.writeBuffer[a-this.writeBufferOffset])?b:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if("COMMITTED"!==this.state)return;let a=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let b=this.writeBufferOffset;b<a;b++){let a=this.getBufferEntry(b);a.allocated&&this.bufferTracker.free(a.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(a-this.writeBufferOffset),this.writeBufferOffset=a}commitCall(a){if("COMMITTED"!==this.state&&"COMPLETED"!==this.underlyingCalls[a].state){this.trace("Committing call ["+this.underlyingCalls[a].call.getCallNumber()+"] at index "+a),this.state="COMMITTED",this.committedCallIndex=a;for(let b=0;b<this.underlyingCalls.length;b++)b!==a&&"COMPLETED"!==this.underlyingCalls[b].state&&(this.underlyingCalls[b].state="COMPLETED",this.underlyingCalls[b].call.cancelWithStatus(d.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if("COMMITTED"===this.state)return;let a=-1,b=-1;for(let[c,d]of this.underlyingCalls.entries())"ACTIVE"===d.state&&d.nextMessageToSend>a&&(a=d.nextMessageToSend,b=c);-1===b?this.state="TRANSPARENT_ONLY":this.commitCall(b)}isStatusCodeInList(a,b){return a.some(a=>a===b||a.toString().toLowerCase()===d.Status[b].toLowerCase())}getNextRetryBackoffMs(){var a;let b=null==(a=this.callConfig)?void 0:a.methodConfig.retryPolicy;if(!b)return 0;let c=Math.random()*this.nextRetryBackoffSec*1e3,d=Number(b.maxBackoff.substring(0,b.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*b.backoffMultiplier,d),c}maybeRetryCall(a,b){let c;if("RETRY"!==this.state)return void b(!1);let d=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(d.maxAttempts,5))return void b(!1);if(null===a)c=this.getNextRetryBackoffMs();else if(a<0){this.state="TRANSPARENT_ONLY",b(!1);return}else c=a,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var a,c;"RETRY"!==this.state?b(!1):(null==(c=null==(a=this.retryThrottler)?void 0:a.canRetryCall())||c)&&(b(!0),this.attempts+=1,this.startNewAttempt())},c)}countActiveCalls(){let a=0;for(let b of this.underlyingCalls)(null==b?void 0:b.state)==="ACTIVE"&&(a+=1);return a}handleProcessedStatus(a,b,c){var d,e,f;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(b),this.reportStatus(a);break;case"HEDGING":if(this.isStatusCodeInList(null!=(d=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)?d:[],a.code)){let d;if(null==(e=this.retryThrottler)||e.addCallFailed(),null===c)d=0;else if(c<0){this.state="TRANSPARENT_ONLY",this.commitCall(b),this.reportStatus(a);return}else d=c;setTimeout(()=>{this.maybeStartHedgingAttempt(),0===this.countActiveCalls()&&(this.commitCall(b),this.reportStatus(a))},d)}else this.commitCall(b),this.reportStatus(a);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,a.code)?(null==(f=this.retryThrottler)||f.addCallFailed(),this.maybeRetryCall(c,c=>{c||(this.commitCall(b),this.reportStatus(a))})):(this.commitCall(b),this.reportStatus(a))}}getPushback(a){let b=a.get("grpc-retry-pushback-ms");if(0===b.length)return null;try{return parseInt(b[0])}catch(a){return -1}}handleChildStatus(a,b){var c;if("COMPLETED"===this.underlyingCalls[b].state)return;if(this.trace("state="+this.state+" handling status with progress "+a.progress+" from child ["+this.underlyingCalls[b].call.getCallNumber()+"] in state "+this.underlyingCalls[b].state),this.underlyingCalls[b].state="COMPLETED",a.code===d.Status.OK){null==(c=this.retryThrottler)||c.addCallSucceeded(),this.commitCall(b),this.reportStatus(a);return}if("COMMITTED"===this.state)return void this.reportStatus(a);let e=this.getPushback(a.metadata);switch(a.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(a,b,e):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(b),this.reportStatus(a);break;case"PROCESSED":this.handleProcessedStatus(a,b,e)}}maybeStartHedgingAttempt(){if("HEDGING"!==this.state||!this.callConfig.methodConfig.hedgingPolicy)return;let a=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(a.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var a,b,c;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),"HEDGING"!==this.state||!this.callConfig.methodConfig.hedgingPolicy)return;let d=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(d.maxAttempts,5))return;let e=null!=(a=d.hedgingDelay)?a:"0s",f=Number(e.substring(0,e.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},1e3*f),null==(c=(b=this.hedgingTimer).unref)||c.call(b)}startNewAttempt(){let a=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+a.getCallNumber()+"] for attempt "+this.attempts);let b=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:a,nextMessageToSend:0});let c=this.attempts-1,d=this.initialMetadata.clone();c>0&&d.set(j,`${c}`);let e=!1;a.start(d,{onReceiveMetadata:d=>{this.trace("Received metadata from child ["+a.getCallNumber()+"]"),this.commitCall(b),e=!0,c>0&&d.set(j,`${c}`),"ACTIVE"===this.underlyingCalls[b].state&&this.listener.onReceiveMetadata(d)},onReceiveMessage:c=>{this.trace("Received message from child ["+a.getCallNumber()+"]"),this.commitCall(b),"ACTIVE"===this.underlyingCalls[b].state&&this.listener.onReceiveMessage(c)},onReceiveStatus:d=>{this.trace("Received status from child ["+a.getCallNumber()+"]"),!e&&c>0&&d.metadata.set(j,`${c}`),this.handleChildStatus(d,b)}}),this.sendNextChildMessage(b),this.readStarted&&a.startRead()}start(a,b){this.trace("start called"),this.listener=b,this.initialMetadata=a,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(a){var b,c;let d=this.underlyingCalls[a],e=d.nextMessageToSend;null==(c=(b=this.getBufferEntry(e)).callback)||c.call(b),this.clearSentMessages(),d.nextMessageToSend+=1,this.sendNextChildMessage(a)}sendNextChildMessage(a){let b=this.underlyingCalls[a];if("COMPLETED"!==b.state&&this.getBufferEntry(b.nextMessageToSend)){let c=this.getBufferEntry(b.nextMessageToSend);switch(c.entryType){case"MESSAGE":b.call.sendMessageWithContext({callback:b=>{this.handleChildWriteCompleted(a)}},c.message.message);break;case"HALF_CLOSE":b.nextMessageToSend+=1,b.call.halfClose()}}}sendMessageWithContext(a,b){var c;this.trace("write() called with message of length "+b.length);let d={message:b,flags:a.flags},e=this.getNextBufferIndex(),f={entryType:"MESSAGE",message:d,allocated:this.bufferTracker.allocate(b.length,this.callNumber)};if(this.writeBuffer.push(f),f.allocated)for(let[d,f]of(null==(c=a.callback)||c.call(a),this.underlyingCalls.entries()))"ACTIVE"===f.state&&f.nextMessageToSend===e&&f.call.sendMessageWithContext({callback:a=>{this.handleChildWriteCompleted(d)}},b);else{if(this.commitCallWithMostMessages(),null===this.committedCallIndex)return;let c=this.underlyingCalls[this.committedCallIndex];f.callback=a.callback,"ACTIVE"===c.state&&c.nextMessageToSend===e&&c.call.sendMessageWithContext({callback:a=>{this.handleChildWriteCompleted(this.committedCallIndex)}},b)}}startRead(){for(let a of(this.trace("startRead called"),this.readStarted=!0,this.underlyingCalls))(null==a?void 0:a.state)==="ACTIVE"&&a.call.startRead()}halfClose(){this.trace("halfClose called");let a=this.getNextBufferIndex();for(let b of(this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1}),this.underlyingCalls))(null==b?void 0:b.state)==="ACTIVE"&&b.nextMessageToSend===a&&(b.nextMessageToSend+=1,b.call.halfClose())}setCredentials(a){throw Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}}c.RetryingCall=k},57068,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.BaseSubchannelWrapper=void 0;class d{constructor(a){this.child=a}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(a){this.child.addConnectivityStateListener(a)}removeConnectivityStateListener(a){this.child.removeConnectivityStateListener(a)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(a){this.child.throttleKeepalive(a)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(a){return this.getRealSubchannel()===a.getRealSubchannel()}}c.BaseSubchannelWrapper=d},30615,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.InternalChannel=void 0;let d=a.r(48728),e=a.r(54849),f=a.r(16497),g=a.r(6483),h=a.r(47844),i=a.r(98726),j=a.r(86052),k=a.r(91539),l=a.r(48520),m=a.r(83183),n=a.r(22087),o=a.r(69374),p=a.r(37725),q=a.r(68265),r=a.r(90915),s=a.r(13183),t=a.r(318),u=a.r(77170),v=a.r(98394),w=a.r(57068),x=0x7fffffff,y=1e3,z=18e5,A=new Map,B=0x1000000,C=1048576;class D extends w.BaseSubchannelWrapper{constructor(a,b){super(a),this.channel=b,this.refCount=0,this.subchannelStateListener=(a,c,d,e)=>{b.throttleKeepalive(e)},a.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}}class E{constructor(a,b,c){var q,r,s,t,w,E,F,G;if(this.credentials=b,this.options=c,this.connectivityState=o.ConnectivityState.IDLE,this.currentPicker=new g.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new p.ChannelzCallTracker,this.childrenTracker=new p.ChannelzChildrenTracker,"string"!=typeof a)throw TypeError("Channel target must be a string");if(!(b instanceof d.ChannelCredentials))throw TypeError("Channel credentials must be a ChannelCredentials object");if(c&&"object"!=typeof c)throw TypeError("Channel options must be an object");this.originalTarget=a;const H=(0,n.parseUri)(a);if(null===H)throw Error(`Could not parse target name "${a}"`);const I=(0,k.mapUriDefaultScheme)(H);if(null===I)throw Error(`Could not find a default scheme for target name "${a}"`);this.callRefTimer=setInterval(()=>{},x),null==(r=(q=this.callRefTimer).unref)||r.call(q),0===this.options["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzTrace=new p.ChannelzTrace,this.channelzRef=(0,p.registerChannelzChannel)(a,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,k.getDefaultAuthority)(I);const J=(0,m.mapProxyName)(I,c);this.target=J.target,this.options=Object.assign({},this.options,J.extraOptions),this.subchannelPool=(0,f.getSubchannelPool)((null!=(s=c["grpc.use_local_subchannel_pool"])?s:0)===0),this.retryBufferTracker=new v.MessageBufferTracker(null!=(t=c["grpc.retry_buffer_size"])?t:B,null!=(w=c["grpc.per_rpc_retry_buffer_size"])?w:C),this.keepaliveTime=null!=(E=c["grpc.keepalive_time_ms"])?E:-1,this.idleTimeoutMs=Math.max(null!=(F=c["grpc.client_idle_timeout_ms"])?F:z,y);const K={createSubchannel:(a,b)=>{let c=this.subchannelPool.getOrCreateSubchannel(this.target,a,Object.assign({},this.options,b),this.credentials);c.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",c.getChannelzRef());let d=new D(c,this);return this.wrappedSubchannels.add(d),d},updateState:(a,b)=>{this.currentPicker=b;let c=this.pickQueue.slice();for(let a of(this.pickQueue=[],c.length>0&&this.callRefTimerUnref(),c))a.doPick();this.updateState(a)},requestReresolution:()=>{throw Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:a=>{this.channelzEnabled&&this.childrenTracker.refChild(a)},removeChannelzChild:a=>{this.channelzEnabled&&this.childrenTracker.unrefChild(a)}};this.resolvingLoadBalancer=new e.ResolvingLoadBalancer(this.target,K,c,(a,b)=>{a.retryThrottling?A.set(this.getTarget(),new v.RetryThrottler(a.retryThrottling.maxTokens,a.retryThrottling.tokenRatio,A.get(this.getTarget()))):A.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=b,this.currentResolutionError=null,process.nextTick(()=>{let a=this.configSelectionQueue;for(let b of(this.configSelectionQueue=[],a.length>0&&this.callRefTimerUnref(),a))b.getConfig()})},a=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+a.code+' and details "'+a.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),null===this.configSelector&&(this.currentResolutionError=Object.assign(Object.assign({},(0,u.restrictControlPlaneStatusCode)(a.code,a.details)),{metadata:a.metadata}));let b=this.configSelectionQueue;for(let c of(this.configSelectionQueue=[],b.length>0&&this.callRefTimerUnref(),b))c.reportResolverError(a)}),this.filterStackFactory=new i.FilterStackFactory([new j.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(c,void 0,2));const L=Error();(0,l.trace)(h.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+") Channel constructed \n"+(null==(G=L.stack)?void 0:G.substring(L.stack.indexOf("\n")+1))),this.lastActivityTimestamp=new Date}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(a,b){(0,l.trace)(null!=b?b:h.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,n.uriToString)(this.target)+" "+a)}callRefTimerRef(){var a,b,c,d;(null==(b=(a=this.callRefTimer).hasRef)?void 0:b.call(a))||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),null==(d=(c=this.callRefTimer).ref)||d.call(c))}callRefTimerUnref(){var a,b;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),null==(b=(a=this.callRefTimer).unref)||b.call(a))}removeConnectivityStateWatcher(a){let b=this.connectivityStateWatchers.findIndex(b=>b===a);b>=0&&this.connectivityStateWatchers.splice(b,1)}updateState(a){for(let b of((0,l.trace)(h.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,n.uriToString)(this.target)+" "+o.ConnectivityState[this.connectivityState]+" -> "+o.ConnectivityState[a]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+o.ConnectivityState[a]),this.connectivityState=a,this.connectivityStateWatchers.slice()))a!==b.currentState&&(b.timer&&clearTimeout(b.timer),this.removeConnectivityStateWatcher(b),b.callback());a!==o.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(a){if(a>this.keepaliveTime)for(let b of(this.keepaliveTime=a,this.wrappedSubchannels))b.throttleKeepalive(a)}removeWrappedSubchannel(a){this.wrappedSubchannels.delete(a)}doPick(a,b){return this.currentPicker.pick({metadata:a,extraPickInfo:b})}queueCallForPick(a){this.pickQueue.push(a),this.callRefTimerRef()}getConfig(a,b){return(this.resolvingLoadBalancer.exitIdle(),this.configSelector)?{type:"SUCCESS",config:this.configSelector(a,b)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(a){this.configSelectionQueue.push(a),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(o.ConnectivityState.IDLE),this.currentPicker=new g.QueuePicker(this.resolvingLoadBalancer),this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}startIdleTimeout(a){var b,c;this.idleTimer=setTimeout(()=>{if(this.callCount>0)return void this.startIdleTimeout(this.idleTimeoutMs);let a=new Date().valueOf()-this.lastActivityTimestamp.valueOf();a>=this.idleTimeoutMs?(this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()):this.startIdleTimeout(this.idleTimeoutMs-a)},a),null==(c=(b=this.idleTimer).unref)||c.call(b)}maybeStartIdleTimer(){this.connectivityState===o.ConnectivityState.SHUTDOWN||this.idleTimer||this.startIdleTimeout(this.idleTimeoutMs)}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1}onCallEnd(a){this.channelzEnabled&&(a.code===h.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()}createLoadBalancingCall(a,b,c,d,e){let f=(0,t.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+f+'] method="'+b+'"'),new q.LoadBalancingCall(this,a,b,c,d,e,f)}createRetryingCall(a,b,c,d,e){let f=(0,t.getNextCallNumber)();return this.trace("createRetryingCall ["+f+'] method="'+b+'"'),new v.RetryingCall(this,a,b,c,d,e,f,this.retryBufferTracker,A.get(this.getTarget()))}createInnerCall(a,b,c,d,e){return 0===this.options["grpc.enable_retries"]?this.createLoadBalancingCall(a,b,c,d,e):this.createRetryingCall(a,b,c,d,e)}createResolvingCall(a,b,c,d,e){let f=(0,t.getNextCallNumber)();this.trace("createResolvingCall ["+f+'] method="'+a+'", deadline='+(0,r.deadlineToString)(b));let g={deadline:b,flags:null!=e?e:h.Propagate.DEFAULTS,host:null!=c?c:this.defaultAuthority,parentCall:d},i=new s.ResolvingCall(this,a,g,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),f);return this.onCallStart(),i.addStatusWatcher(a=>{this.onCallEnd(a)}),i}close(){this.resolvingLoadBalancer.destroy(),this.updateState(o.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.idleTimer&&clearTimeout(this.idleTimer),this.channelzEnabled&&(0,p.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,n.uriToString)(this.target)}getConnectivityState(a){let b=this.connectivityState;return a&&(this.resolvingLoadBalancer.exitIdle(),this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()),b}watchConnectivityState(a,b,c){if(this.connectivityState===o.ConnectivityState.SHUTDOWN)throw Error("Channel has been shut down");let d=null;if(b!==1/0){let a=b instanceof Date?b:new Date(b),f=new Date;if(b===-1/0||a<=f)return void process.nextTick(c,Error("Deadline passed without connectivity state change"));d=setTimeout(()=>{this.removeConnectivityStateWatcher(e),c(Error("Deadline passed without connectivity state change"))},a.getTime()-f.getTime())}let e={currentState:a,callback:c,timer:d};this.connectivityStateWatchers.push(e)}getChannelzRef(){return this.channelzRef}createCall(a,b,c,d,e){if("string"!=typeof a)throw TypeError("Channel#createCall: method must be a string");if(!("number"==typeof b||b instanceof Date))throw TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===o.ConnectivityState.SHUTDOWN)throw Error("Channel has been shut down");return this.createResolvingCall(a,b,c,d,e)}}c.InternalChannel=E},51621,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ChannelImplementation=void 0;let d=a.r(48728),e=a.r(30615);class f{constructor(a,b,c){if("string"!=typeof a)throw TypeError("Channel target must be a string");if(!(b instanceof d.ChannelCredentials))throw TypeError("Channel credentials must be a ChannelCredentials object");if(c&&"object"!=typeof c)throw TypeError("Channel options must be an object");this.internalChannel=new e.InternalChannel(a,b,c)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(a){return this.internalChannel.getConnectivityState(a)}watchConnectivityState(a,b,c){this.internalChannel.watchConnectivityState(a,b,c)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(a,b,c,d,e){if("string"!=typeof a)throw TypeError("Channel#createCall: method must be a string");if(!("number"==typeof b||b instanceof Date))throw TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(a,b,c,d,e)}}c.ChannelImplementation=f},22432,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Http2ServerCallStream=c.ServerDuplexStreamImpl=c.ServerWritableStreamImpl=c.ServerReadableStreamImpl=c.ServerUnaryCallImpl=void 0;let d=a.r(27699),e=a.r(25328),f=a.r(88947),g=a.r(6461),h=a.r(47844),i=a.r(92240),j=a.r(35508),k=a.r(48520),l=a.r(78711),m="server_call";function n(a){k.trace(h.LogVerbosity.DEBUG,m,a)}let o="grpc-message",p="grpc-status",q="grpc-timeout",r=/(\d{1,8})\s*([HMSmun])/,s={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},t={"grpc-accept-encoding":"identity,deflate,gzip","grpc-encoding":"identity"},u={[e.constants.HTTP2_HEADER_STATUS]:e.constants.HTTP_STATUS_OK,[e.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},v={waitForTrailers:!0};class w extends d.EventEmitter{constructor(a,b,c){super(),this.call=a,this.metadata=b,this.request=c,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata(a){this.call.sendMetadata(a)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}}c.ServerUnaryCallImpl=w;class x extends f.Readable{constructor(a,b,c,d){super({objectMode:!0}),this.call=a,this.metadata=b,this.deserialize=c,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,d)}_read(a){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata(a){this.call.sendMetadata(a)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}}c.ServerReadableStreamImpl=x;class y extends f.Writable{constructor(a,b,c,d){super({objectMode:!0}),this.call=a,this.metadata=b,this.serialize=c,this.request=d,this.cancelled=!1,this.trailingMetadata=new i.Metadata,this.call.setupSurfaceCall(this),this.on("error",a=>{this.call.sendError(a),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(a){this.call.sendMetadata(a)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write(a,b,c){try{let b=this.call.serializeMessage(a);if(!this.call.write(b))return void this.call.once("drain",c)}catch(a){this.emit("error",{details:(0,l.getErrorMessage)(a),code:h.Status.INTERNAL})}c()}_final(a){this.call.sendStatus({code:h.Status.OK,details:"OK",metadata:this.trailingMetadata}),a(null)}end(a){return a&&(this.trailingMetadata=a),super.end()}}c.ServerWritableStreamImpl=y;class z extends f.Duplex{constructor(a,b,c,d,e){super({objectMode:!0}),this.call=a,this.metadata=b,this.serialize=c,this.deserialize=d,this.cancelled=!1,this.trailingMetadata=new i.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,e),this.on("error",a=>{this.call.sendError(a),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(a){this.call.sendMetadata(a)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end(a){return a&&(this.trailingMetadata=a),super.end()}}c.ServerDuplexStreamImpl=z,z.prototype._read=x.prototype._read,z.prototype._write=y.prototype._write,z.prototype._final=y.prototype._final;class A extends d.EventEmitter{constructor(a,b,c){super(),this.stream=a,this.handler=b,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=h.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=h.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",a=>{}),this.stream.once("close",()=>{var a;n("Request to method "+(null==(a=this.handler)?void 0:a.path)+" stream closed with rstCode "+this.stream.rstCode),!this.statusSent&&(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:h.Status.CANCELLED,details:"Cancelled by client",metadata:null}),this.deadlineTimer&&clearTimeout(this.deadlineTimer))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in c&&(this.maxSendMessageSize=c["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in c&&(this.maxReceiveMessageSize=c["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage(a,b){let c=a.subarray(5);if("identity"===b)return c;if("deflate"!==b&&"gzip"!==b)return Promise.reject({code:h.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${b}"`});{let a;return a="deflate"===b?g.createInflate():g.createGunzip(),new Promise((b,d)=>{let e=0,f=[];a.on("data",b=>{f.push(b),e+=b.byteLength,-1!==this.maxReceiveMessageSize&&e>this.maxReceiveMessageSize&&(a.destroy(),d({code:h.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxReceiveMessageSize}`}))}),a.on("end",()=>{b(Buffer.concat(f))}),a.write(c),a.end()})}}sendMetadata(a){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let b=a?a.toHttp2Headers():null,c=Object.assign(Object.assign(Object.assign({},u),t),b);this.stream.respond(c,v)}receiveMetadata(a){let b=i.Metadata.fromHttp2Headers(a);k.isTracerEnabled(m)&&n("Request to "+this.handler.path+" received headers "+JSON.stringify(b.toJSON()));let c=b.get(q);if(c.length>0){let a=c[0].toString().match(r);if(null===a){let a=Error("Invalid deadline");return a.code=h.Status.OUT_OF_RANGE,this.sendError(a),b}let d=a[1]*s[a[2]]|0,e=new Date;this.deadline=e.setMilliseconds(e.getMilliseconds()+d),this.deadlineTimer=setTimeout(B,d,this),b.remove(q)}return b.remove(e.constants.HTTP2_HEADER_ACCEPT_ENCODING),b.remove(e.constants.HTTP2_HEADER_TE),b.remove(e.constants.HTTP2_HEADER_CONTENT_TYPE),b.remove("grpc-accept-encoding"),b}receiveUnaryMessage(a){return new Promise((b,c)=>{let{stream:d}=this,e=0,f=this,g=[],i=this.maxReceiveMessageSize;function j(a){if(e+=a.byteLength,-1!==i&&e>i){d.removeListener("data",j),d.removeListener("end",k),d.removeListener("error",k),c({code:h.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${e} vs. ${i})`});return}g.push(a)}function k(i){if(d.removeListener("data",j),d.removeListener("end",k),d.removeListener("error",k),void 0!==i)return void c({code:h.Status.INTERNAL,details:i.message});if(0===e)return void c({code:h.Status.INTERNAL,details:"received empty unary message"});f.emit("receiveMessage");let l=Buffer.concat(g,e),m=1===l.readUInt8(0)?a:"identity",n=f.getDecompressedMessage(l,m);Buffer.isBuffer(n)?b(f.deserializeMessageWithInternalError(n)):n.then(a=>b(f.deserializeMessageWithInternalError(a)),b=>c(b.code?b:{code:h.Status.INTERNAL,details:`Received "grpc-encoding" header "${a}" but ${a} decompression failed`}))}this.stream.on("data",j),this.stream.on("end",k),this.stream.on("error",k)})}async deserializeMessageWithInternalError(a){try{return this.deserializeMessage(a)}catch(a){throw{details:(0,l.getErrorMessage)(a),code:h.Status.INTERNAL}}}serializeMessage(a){let b=this.handler.serialize(a),c=b.byteLength,d=Buffer.allocUnsafe(c+5);return d.writeUInt8(0,0),d.writeUInt32BE(c,1),b.copy(d,5),d}deserializeMessage(a){return this.handler.deserialize(a)}async sendUnaryMessage(a,b,c,d){if(!this.checkCancelled()){if(void 0===c&&(c=null),a){!Object.prototype.hasOwnProperty.call(a,"metadata")&&c&&(a.metadata=c),this.sendError(a);return}try{let a=this.serializeMessage(b);this.write(a),this.sendStatus({code:h.Status.OK,details:"OK",metadata:c})}catch(a){this.sendError({details:(0,l.getErrorMessage)(a),code:h.Status.INTERNAL})}}}sendStatus(a){var b,c;if(this.emit("callEnd",a.code),this.emit("streamEnd",a.code===h.Status.OK),!this.checkCancelled())if(n("Request to method "+(null==(b=this.handler)?void 0:b.path)+" ended with status code: "+h.Status[a.code]+" details: "+a.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.headersSent)this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var b;let c=Object.assign({[p]:a.code,[o]:encodeURI(a.details)},null==(b=a.metadata)?void 0:b.toHttp2Headers());this.stream.sendTrailers(c),this.statusSent=!0}),this.stream.end());else{let b=Object.assign(Object.assign({[p]:a.code,[o]:encodeURI(a.details)},u),null==(c=a.metadata)?void 0:c.toHttp2Headers());this.stream.respond(b,{endStream:!0}),this.statusSent=!0}}sendError(a){let b={code:h.Status.UNKNOWN,details:"message"in a?a.message:"Unknown Error",metadata:"metadata"in a&&void 0!==a.metadata?a.metadata:null};"code"in a&&"number"==typeof a.code&&Number.isInteger(a.code)&&(b.code=a.code,"details"in a&&"string"==typeof a.details&&(b.details=a.details)),this.sendStatus(b)}write(a){if(!this.checkCancelled())return -1!==this.maxSendMessageSize&&a.length>this.maxSendMessageSize?void this.sendError({code:h.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${a.length} vs. ${this.maxSendMessageSize})`}):(this.sendMetadata(),this.emit("sendMessage"),this.stream.write(a))}resume(){this.stream.resume()}setupSurfaceCall(a){this.once("cancelled",b=>{a.cancelled=!0,a.emit("cancelled",b)}),this.once("callEnd",b=>a.emit("callEnd",b))}setupReadable(a,b){let c=new j.StreamDecoder(this.maxReceiveMessageSize),d=!1,e=!1,f=!1,g=async()=>{f||!d||e||(f=!0,await this.pushOrBufferMessage(a,null))};this.stream.on("data",async d=>{let f;try{f=c.write(d)}catch(a){this.sendError({code:h.Status.RESOURCE_EXHAUSTED,details:a.message});return}for(let c of(e=!0,this.stream.pause(),f)){let d;this.emit("receiveMessage");let e=1===c.readUInt8(0)?b:"identity";try{d=await this.getDecompressedMessage(c,e)}catch(a){this.sendError(a);return}if(!d)return;await this.pushOrBufferMessage(a,d)}e=!1,this.stream.resume(),await g()}),this.stream.once("end",async()=>{d=!0,await g()})}consumeUnpushedMessages(a){for(this.canPush=!0;this.messagesToPush.length>0;){let b=this.messagesToPush.shift(),c=a.push(b);if(null===b||!1===c){this.canPush=!1;break}}return this.canPush}async pushOrBufferMessage(a,b){this.isPushPending?this.bufferedMessages.push(b):await this.pushMessage(a,b)}async pushMessage(a,b){if(null===b){n("Received end of stream"),this.canPush?a.push(null):this.messagesToPush.push(null);return}n("Received message of length "+b.length),this.isPushPending=!0;try{let c=await this.deserializeMessage(b);this.canPush?a.push(c)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(c)}catch(c){this.bufferedMessages.length=0;let b=(0,l.getErrorCode)(c);(null===b||b<h.Status.OK||b>h.Status.UNAUTHENTICATED)&&(b=h.Status.INTERNAL),a.emit("error",{details:(0,l.getErrorMessage)(c),code:b})}this.isPushPending=!1,this.bufferedMessages.length>0&&await this.pushMessage(a,this.bufferedMessages.shift())}getPeer(){var a;let b=null==(a=this.stream.session)?void 0:a.socket;return null!=b&&b.remoteAddress?b.remotePort?`${b.remoteAddress}:${b.remotePort}`:b.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}}function B(a){let b=Error("Deadline exceeded");b.code=h.Status.DEADLINE_EXCEEDED,a.sendError(b),a.cancelled=!0,a.emit("cancelled","deadline")}c.Http2ServerCallStream=A},57889,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ServerCredentials=void 0;let d=a.r(13043);class e{static createInsecure(){return new f}static createSsl(a,b,c=!1){if(null!==a&&!Buffer.isBuffer(a))throw TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(b))throw TypeError("keyCertPairs must be an array");if("boolean"!=typeof c)throw TypeError("checkClientCertificate must be a boolean");let e=[],f=[];for(let a=0;a<b.length;a++){let c=b[a];if(null===c||"object"!=typeof c)throw TypeError(`keyCertPair[${a}] must be an object`);if(!Buffer.isBuffer(c.private_key))throw TypeError(`keyCertPair[${a}].private_key must be a Buffer`);if(!Buffer.isBuffer(c.cert_chain))throw TypeError(`keyCertPair[${a}].cert_chain must be a Buffer`);e.push(c.cert_chain),f.push(c.private_key)}return new g({ca:a||(0,d.getDefaultRootsData)()||void 0,cert:e,key:f,requestCert:c,ciphers:d.CIPHER_SUITES})}}c.ServerCredentials=e;class f extends e{_isSecure(){return!1}_getSettings(){return null}}class g extends e{constructor(a){super(),this.options=a}_isSecure(){return!0}_getSettings(){return this.options}}},43115,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Server=void 0;let d=a.r(25328),e=a.r(47844),f=a.r(22432),g=a.r(57889),h=a.r(91539),i=a.r(48520),j=a.r(49271),k=a.r(22087),l=a.r(37725),m=0x7fffffff,n=0x7fffffff,o=2e4,{HTTP2_HEADER_PATH:p}=d.constants,q="server";function r(){}function s(a){return{code:e.Status.UNIMPLEMENTED,details:`The server does not implement the method ${a}`}}function t(a,b){let c=s(b);switch(a){case"unary":return(a,b)=>{b(c,null)};case"clientStream":return(a,b)=>{b(c,null)};case"serverStream":return a=>{a.emit("error",c)};case"bidi":return a=>{a.emit("error",c)};default:throw Error(`Invalid handlerType ${a}`)}}class u{constructor(a){var b,c,d,e;this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new l.ChannelzTrace,this.callTracker=new l.ChannelzCallTracker,this.listenerChildrenTracker=new l.ChannelzChildrenTracker,this.sessionChildrenTracker=new l.ChannelzChildrenTracker,this.options=null!=a?a:{},0===this.options["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzRef=(0,l.registerChannelzServer)(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=null!=(b=this.options["grpc.max_connection_age_ms"])?b:m,this.maxConnectionAgeGraceMs=null!=(c=this.options["grpc.max_connection_age_grace_ms"])?c:m,this.keepaliveTimeMs=null!=(d=this.options["grpc.keepalive_time_ms"])?d:n,this.keepaliveTimeoutMs=null!=(e=this.options["grpc.keepalive_timeout_ms"])?e:o,this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter(a){return()=>{var b,c,d;let e,f=this.sessions.get(a),g=a.socket,h=g.remoteAddress?(0,j.stringToSubchannelAddress)(g.remoteAddress,g.remotePort):null,i=g.localAddress?(0,j.stringToSubchannelAddress)(g.localAddress,g.localPort):null;if(a.encrypted){let a=g,c=a.getCipher(),d=a.getCertificate(),f=a.getPeerCertificate();e={cipherSuiteStandardName:null!=(b=c.standardName)?b:null,cipherSuiteOtherName:c.standardName?null:c.name,localCertificate:d&&"raw"in d?d.raw:null,remoteCertificate:f&&"raw"in f?f.raw:null}}else e=null;return{remoteAddress:h,localAddress:i,security:e,remoteName:null,streamsStarted:f.streamTracker.callsStarted,streamsSucceeded:f.streamTracker.callsSucceeded,streamsFailed:f.streamTracker.callsFailed,messagesSent:f.messagesSent,messagesReceived:f.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:f.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:f.lastMessageSentTimestamp,lastMessageReceivedTimestamp:f.lastMessageReceivedTimestamp,localFlowControlWindow:null!=(c=a.state.localWindowSize)?c:null,remoteFlowControlWindow:null!=(d=a.state.remoteWindowSize)?d:null}}}trace(a){i.trace(e.LogVerbosity.DEBUG,q,"("+this.channelzRef.id+") "+a)}addProtoService(){throw Error("Not implemented. Use addService() instead")}addService(a,b){if(null===a||"object"!=typeof a||null===b||"object"!=typeof b)throw Error("addService() requires two objects as arguments");let c=Object.keys(a);if(0===c.length)throw Error("Cannot add an empty service to a server");c.forEach(c=>{let d,e,f=a[c];d=f.requestStream?f.responseStream?"bidi":"clientStream":f.responseStream?"serverStream":"unary";let g=b[c];if(void 0===g&&"string"==typeof f.originalName&&(g=b[f.originalName]),e=void 0!==g?g.bind(b):t(d,c),!1===this.register(f.path,e,f.responseSerialize,f.requestDeserialize,d))throw Error(`Method handler for ${f.path} already provided.`)})}removeService(a){if(null===a||"object"!=typeof a)throw Error("removeService() requires object as argument");Object.keys(a).forEach(b=>{let c=a[b];this.unregister(c.path)})}bind(a,b){throw Error("Not implemented. Use bindAsync() instead")}bindAsync(a,b,c){if(!0===this.started)throw Error("server is already started");if(this.shutdown)throw Error("bindAsync called after shutdown");if("string"!=typeof a)throw TypeError("port must be a string");if(null===b||!(b instanceof g.ServerCredentials))throw TypeError("creds must be a ServerCredentials object");if("function"!=typeof c)throw TypeError("callback must be a function");let f=(0,k.parseUri)(a);if(null===f)throw Error(`Could not parse port "${a}"`);let m=(0,h.mapUriDefaultScheme)(f);if(null===m)throw Error(`Could not get a default scheme for port "${a}"`);let n={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?n.maxSessionMemory=this.options["grpc-node.max_session_memory"]:n.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(n.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});let o=(a,b)=>{process.nextTick(()=>c(a,b))},p=()=>{let a;if(b._isSecure()){let c=Object.assign(n,b._getSettings());c.enableTrace=1===this.options["grpc-node.tls_enable_trace"],(a=d.createSecureServer(c)).on("secureConnection",a=>{a.on("error",a=>{this.trace("An incoming TLS connection closed with error: "+a.message)})})}else a=d.createServer(n);return a.setTimeout(0,r),this._setupHandlers(a),a},q=(a,b,c)=>0===a.length?Promise.resolve({port:b,count:c}):Promise.all(a.map(a=>{let c;this.trace("Attempting to bind "+(0,j.subchannelAddressToString)(a)),c=(0,j.isTcpSubchannelAddress)(a)?{host:a.host,port:b}:a;let d=p();return new Promise((e,f)=>{let g=b=>{this.trace("Failed to bind "+(0,j.subchannelAddressToString)(a)+" with error "+b.message),e(b)};d.once("error",g),d.listen(c,()=>{let a;if(this.shutdown){d.close(),e(Error("bindAsync failed because server is shutdown"));return}let c=d.address();a="string"==typeof c?{path:c}:{host:c.address,port:c.port};let f=(0,l.registerChannelzSocket)((0,j.subchannelAddressToString)(a),()=>({localAddress:a,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(f),this.http2ServerList.push({server:d,channelzRef:f}),this.trace("Successfully bound "+(0,j.subchannelAddressToString)(a)),e("port"in a?a.port:b),d.removeListener("error",g)})})})).then(a=>{let d=0;for(let c of a)if("number"==typeof c&&(d+=1,c!==b))throw Error("Invalid state: multiple port numbers added from single address");return{port:b,count:d+c}}),s=a=>{if(0===a.length)return Promise.resolve({port:0,count:0});let b=a[0],c=p();return new Promise((d,e)=>{let f=c=>{this.trace("Failed to bind "+(0,j.subchannelAddressToString)(b)+" with error "+c.message),d(s(a.slice(1)))};c.once("error",f),c.listen(b,()=>{if(this.shutdown){c.close(),d({port:0,count:0});return}let b=c.address(),e={host:b.address,port:b.port},g=(0,l.registerChannelzSocket)((0,j.subchannelAddressToString)(e),()=>({localAddress:e,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(g),this.http2ServerList.push({server:c,channelzRef:g}),this.trace("Successfully bound "+(0,j.subchannelAddressToString)(e)),d(q(a.slice(1),b.port,1)),c.removeListener("error",f)})})},t={onSuccessfulResolution:(b,c,d)=>{let f;(t.onSuccessfulResolution=()=>{},this.shutdown&&o(Error("bindAsync failed because server is shutdown"),0),0===b.length)?o(Error(`No addresses resolved for port ${a}`),0):(f=(0,j.isTcpSubchannelAddress)(b[0])?0===b[0].port?s(b):q(b,b[0].port,0):q(b,1,0)).then(a=>{if(0===a.count){let a=`No address added out of total ${b.length} resolved`;i.log(e.LogVerbosity.ERROR,a),o(Error(a),0)}else a.count<b.length&&i.log(e.LogVerbosity.INFO,`WARNING Only ${a.count} addresses added out of total ${b.length} resolved`),o(null,a.port)},a=>{let c=`No address added out of total ${b.length} resolved`;i.log(e.LogVerbosity.ERROR,c),o(Error(c),0)})},onError:a=>{o(Error(a.details),0)}};(0,h.createResolver)(m,t,this.options).updateResolution()}forceShutdown(){for(let{server:a,channelzRef:b}of this.http2ServerList)a.listening&&a.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(b),(0,l.unregisterChannelzRef)(b))});this.started=!1,this.shutdown=!0,this.sessions.forEach((a,b)=>{b.destroy(d.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&(0,l.unregisterChannelzRef)(this.channelzRef)}register(a,b,c,d,e){return!this.handlers.has(a)&&(this.handlers.set(a,{func:b,serialize:c,deserialize:d,type:e,path:a}),!0)}unregister(a){return this.handlers.delete(a)}start(){if(0===this.http2ServerList.length||this.http2ServerList.every(({server:a})=>!0!==a.listening))throw Error("server must be bound in order to start");if(!0===this.started)throw Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown(a){let b=b=>{this.channelzEnabled&&(0,l.unregisterChannelzRef)(this.channelzRef),a(b)},c=0;function d(){0==--c&&b()}for(let{server:a,channelzRef:b}of(this.started=!1,this.shutdown=!0,this.http2ServerList))a.listening&&(c++,a.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(b),(0,l.unregisterChannelzRef)(b)),d()}));this.sessions.forEach((a,b)=>{b.closed||(c+=1,b.close(d))}),0===c&&b()}addHttp2Port(){throw Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(a,b){let c=b[d.constants.HTTP2_HEADER_CONTENT_TYPE];return"string"==typeof c&&!!c.startsWith("application/grpc")||(a.respond({[d.constants.HTTP2_HEADER_STATUS]:d.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1)}_retrieveHandler(a){this.trace("Received call to method "+a+" at address "+this.serverAddressString);let b=this.handlers.get(a);return void 0===b?(this.trace("No handler registered for method "+a+". Sending UNIMPLEMENTED status."),null):b}_respondWithError(a,b,c=null){let d=new f.Http2ServerCallStream(b,null,this.options);void 0===a.code&&(a.code=e.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),null==c||c.streamTracker.addCallFailed()),d.sendError(a)}_channelzHandler(a,b){let c=this.sessions.get(a.session);if(this.callTracker.addCallStarted(),null==c||c.streamTracker.addCallStarted(),!this._verifyContentType(a,b)){this.callTracker.addCallFailed(),null==c||c.streamTracker.addCallFailed();return}let d=b[p],g=this._retrieveHandler(d);if(!g)return void this._respondWithError(s(d),a,c);let h=new f.Http2ServerCallStream(a,g,this.options);h.once("callEnd",a=>{a===e.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),c&&(h.once("streamEnd",a=>{a?c.streamTracker.addCallSucceeded():c.streamTracker.addCallFailed()}),h.on("sendMessage",()=>{c.messagesSent+=1,c.lastMessageSentTimestamp=new Date}),h.on("receiveMessage",()=>{c.messagesReceived+=1,c.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(h,g,b)||(this.callTracker.addCallFailed(),null==c||c.streamTracker.addCallFailed(),h.sendError({code:e.Status.INTERNAL,details:`Unknown handler type: ${g.type}`}))}_streamHandler(a,b){if(!0!==this._verifyContentType(a,b))return;let c=b[p],d=this._retrieveHandler(c);if(!d)return void this._respondWithError(s(c),a,null);let g=new f.Http2ServerCallStream(a,d,this.options);this._runHandlerForCall(g,d,b)||g.sendError({code:e.Status.INTERNAL,details:`Unknown handler type: ${d.type}`})}_runHandlerForCall(a,b,c){var d;let e=a.receiveMetadata(c),f=null!=(d=e.get("grpc-encoding")[0])?d:"identity";e.remove("grpc-encoding");let{type:g}=b;if("unary"===g)v(a,b,e,f);else if("clientStream"===g)w(a,b,e,f);else if("serverStream"===g)x(a,b,e,f);else{if("bidi"!==g)return!1;y(a,b,e,f)}return!0}_setupHandlers(a){if(null===a)return;let b=a.address(),c="null";b&&(c="string"==typeof b?b:b.address+":"+b.port),this.serverAddressString=c;let e=this.channelzEnabled?this._channelzHandler:this._streamHandler;a.on("stream",e.bind(this)),a.on("session",a=>{var b,c,e,f,g;if(!this.started)return void a.destroy();let h=(0,l.registerChannelzSocket)(null!=(b=a.socket.remoteAddress)?b:"unknown",this.getChannelzSessionInfoGetter(a),this.channelzEnabled),i={ref:h,streamTracker:new l.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set(a,i);let j=a.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+j),this.sessionChildrenTracker.refChild(h));let k=null,n=null,o=!1;if(this.maxConnectionAgeMs!==m){let b=this.maxConnectionAgeMs/10,f=Math.random()*b*2-b;k=null==(e=(c=setTimeout(()=>{var b,c;o=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+j);try{a.goaway(d.constants.NGHTTP2_NO_ERROR,0x7fffffff,Buffer.from("max_age"))}catch(b){a.destroy();return}a.close(),this.maxConnectionAgeGraceMs!==m&&(n=null==(c=(b=setTimeout(()=>{a.destroy()},this.maxConnectionAgeGraceMs)).unref)?void 0:c.call(b))},this.maxConnectionAgeMs+f)).unref)?void 0:e.call(c)}let p=null==(g=(f=setInterval(()=>{var b,c;let d=null==(c=(b=setTimeout(()=>{o=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+j),a.close()},this.keepaliveTimeoutMs)).unref)?void 0:c.call(b);try{a.ping((a,b,c)=>{clearTimeout(d)})}catch(b){a.destroy()}},this.keepaliveTimeMs)).unref)?void 0:g.call(f);a.on("close",()=>{this.channelzEnabled&&(o||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+j),this.sessionChildrenTracker.unrefChild(h),(0,l.unregisterChannelzRef)(h)),k&&clearTimeout(k),n&&clearTimeout(n),p&&clearTimeout(p),this.sessions.delete(a)})})}}async function v(a,b,c,d){try{let e=await a.receiveUnaryMessage(d);if(void 0===e||a.cancelled)return;let g=new f.ServerUnaryCallImpl(a,c,e);b.func(g,(b,c,d,e)=>{a.sendUnaryMessage(b,c,d,e)})}catch(b){a.sendError(b)}}function w(a,b,c,d){let e=new f.ServerReadableStreamImpl(a,c,b.deserialize,d);function g(b,c,d,f){e.destroy(),a.sendUnaryMessage(b,c,d,f)}a.cancelled||(e.on("error",g),b.func(e,g))}async function x(a,b,c,d){try{let e=await a.receiveUnaryMessage(d);if(void 0===e||a.cancelled)return;let g=new f.ServerWritableStreamImpl(a,c,b.serialize,e);b.func(g)}catch(b){a.sendError(b)}}function y(a,b,c,d){let e=new f.ServerDuplexStreamImpl(a,c,b.serialize,b.deserialize,d);a.cancelled||b.func(e)}c.Server=u},4910,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.StatusBuilder=void 0;class d{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(a){return this.code=a,this}withDetails(a){return this.details=a,this}withMetadata(a){return this.metadata=a,this}build(){let a={};return null!==this.code&&(a.code=this.code),null!==this.details&&(a.details=this.details),null!==this.metadata&&(a.metadata=this.metadata),a}}c.StatusBuilder=d},9546,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.isDuration=c.durationToMs=c.msToDuration=void 0,c.msToDuration=function(a){return{seconds:a/1e3|0,nanos:a%1e3*1e6|0}},c.durationToMs=function(a){return 1e3*a.seconds+a.nanos/1e6|0},c.isDuration=function(a){return"number"==typeof a.seconds&&"number"==typeof a.nanos}},94631,(a,b,c)=>{"use strict";var d;Object.defineProperty(c,"__esModule",{value:!0}),c.setup=c.OutlierDetectionLoadBalancer=c.OutlierDetectionLoadBalancingConfig=void 0;let e=a.r(69374),f=a.r(47844),g=a.r(9546),h=a.r(49489),i=a.r(53590),j=a.r(16338),k=a.r(6483),l=a.r(49271),m=a.r(57068),n=a.r(48520),o="outlier_detection";function p(a){n.trace(f.LogVerbosity.DEBUG,o,a)}let q="outlier_detection",r=(null!=(d=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)?d:"true")==="true",s={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},t={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function u(a,b,c,d){if(b in a&&typeof a[b]!==c){let e=d?`${d}.${b}`:b;throw Error(`outlier detection config ${e} parse error: expected ${c}, got ${typeof a[b]}`)}}function v(a,b,c){let d=c?`${c}.${b}`:b;if(b in a){if(!(0,g.isDuration)(a[b]))throw Error(`outlier detection config ${d} parse error: expected Duration, got ${typeof a[b]}`);if(!(a[b].seconds>=0&&a[b].seconds<=315576e6&&a[b].nanos>=0&&a[b].nanos<=0x3b9ac9ff))throw Error(`outlier detection config ${d} parse error: values out of range for non-negative Duaration`)}}function w(a,b,c){let d=c?`${c}.${b}`:b;if(u(a,b,"number",c),b in a&&!(a[b]>=0&&a[b]<=100))throw Error(`outlier detection config ${d} parse error: value out of range for percentage (0-100)`)}class x{constructor(a,b,c,d,e,f,g){if(this.childPolicy=g,g.length>0&&"pick_first"===g[0].getLoadBalancerName())throw Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=null!=a?a:1e4,this.baseEjectionTimeMs=null!=b?b:3e4,this.maxEjectionTimeMs=null!=c?c:3e5,this.maxEjectionPercent=null!=d?d:10,this.successRateEjection=e?Object.assign(Object.assign({},s),e):null,this.failurePercentageEjection=f?Object.assign(Object.assign({},t),f):null}getLoadBalancerName(){return q}toJsonObject(){return{interval:(0,g.msToDuration)(this.intervalMs),base_ejection_time:(0,g.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,g.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map(a=>a.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy(a){return new x(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,a)}static createFromJson(a){var b;if(v(a,"interval"),v(a,"base_ejection_time"),v(a,"max_ejection_time"),w(a,"max_ejection_percent"),"success_rate_ejection"in a){if("object"!=typeof a.success_rate_ejection)throw Error("outlier detection config success_rate_ejection must be an object");u(a.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),w(a.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),u(a.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),u(a.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in a){if("object"!=typeof a.failure_percentage_ejection)throw Error("outlier detection config failure_percentage_ejection must be an object");w(a.failure_percentage_ejection,"threshold","failure_percentage_ejection"),w(a.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),u(a.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),u(a.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new x(a.interval?(0,g.durationToMs)(a.interval):null,a.base_ejection_time?(0,g.durationToMs)(a.base_ejection_time):null,a.max_ejection_time?(0,g.durationToMs)(a.max_ejection_time):null,null!=(b=a.max_ejection_percent)?b:null,a.success_rate_ejection,a.failure_percentage_ejection,a.child_policy.map(i.validateLoadBalancingConfig))}}c.OutlierDetectionLoadBalancingConfig=x;class y extends m.BaseSubchannelWrapper{constructor(a,b){super(a),this.mapEntry=b,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=a.getConnectivityState(),a.addConnectivityStateListener((a,b,c,d)=>{if(this.childSubchannelState=c,!this.ejected)for(let a of this.stateListeners)a(this,b,c,d)})}getConnectivityState(){return this.ejected?e.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener(a){this.stateListeners.push(a)}removeConnectivityStateListener(a){let b=this.stateListeners.indexOf(a);b>-1&&this.stateListeners.splice(b,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let a=this.mapEntry.subchannelWrappers.indexOf(this);a>=0&&this.mapEntry.subchannelWrappers.splice(a,1)}}eject(){for(let a of(this.ejected=!0,this.stateListeners))a(this,this.childSubchannelState,e.ConnectivityState.TRANSIENT_FAILURE,-1)}uneject(){for(let a of(this.ejected=!1,this.stateListeners))a(this,e.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState,-1)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}}function z(){return{success:0,failure:0}}class A{constructor(){this.activeBucket=z(),this.inactiveBucket=z()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=z()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}}class B{constructor(a,b){this.wrappedPicker=a,this.countCalls=b}pick(a){let b=this.wrappedPicker.pick(a);if(b.pickResultType!==k.PickResultType.COMPLETE)return b;{let a=b.subchannel,c=a.getMapEntry();if(!c)return Object.assign(Object.assign({},b),{subchannel:a.getWrappedSubchannel()});{let d=b.onCallEnded;return this.countCalls&&(d=a=>{var d;a===f.Status.OK?c.counter.addSuccess():c.counter.addFailure(),null==(d=b.onCallEnded)||d.call(b,a)}),Object.assign(Object.assign({},b),{subchannel:a.getWrappedSubchannel(),onCallEnded:d})}}}}class C{constructor(a){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new j.ChildLoadBalancerHandler((0,h.createChildChannelControlHelper)(a,{createSubchannel:(b,c)=>{let d=a.createSubchannel(b,c),e=this.addressMap.get((0,l.subchannelAddressToString)(b)),f=new y(d,e);return(null==e?void 0:e.currentEjectionTimestamp)!==null&&f.eject(),null==e||e.subchannelWrappers.push(f),f},updateState:(b,c)=>{b===e.ConnectivityState.READY?a.updateState(b,new B(c,this.isCountingEnabled())):a.updateState(b,c)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return null!==this.latestConfig&&(null!==this.latestConfig.getSuccessRateEjectionConfig()||null!==this.latestConfig.getFailurePercentageEjectionConfig())}getCurrentEjectionPercent(){let a=0;for(let b of this.addressMap.values())null!==b.currentEjectionTimestamp&&(a+=1);return 100*a/this.addressMap.size}runSuccessRateCheck(a){if(!this.latestConfig)return;let b=this.latestConfig.getSuccessRateEjectionConfig();if(!b)return;p("Running success rate check");let c=b.request_volume,d=0,e=[];for(let[a,b]of this.addressMap){let f=b.counter.getLastSuccesses(),g=b.counter.getLastFailures();p("Stats for "+a+": successes="+f+" failures="+g+" targetRequestVolume="+c),f+g>=c&&(d+=1,e.push(f/(f+g)))}if(p("Found "+d+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+e+"]"),d<b.minimum_hosts)return;let f=e.reduce((a,b)=>a+b)/e.length,g=0;for(let a of e){let b=a-f;g+=b*b}let h=Math.sqrt(g/e.length),i=f-h*(b.stdev_factor/1e3);for(let[d,e]of(p("stdev="+h+" ejectionThreshold="+i),this.addressMap.entries())){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let f=e.counter.getLastSuccesses(),g=e.counter.getLastFailures();if(f+g<c)continue;let h=f/(f+g);if(p("Checking candidate "+d+" successRate="+h),h<i){let c=100*Math.random();p("Candidate "+d+" randomNumber="+c+" enforcement_percentage="+b.enforcement_percentage),c<b.enforcement_percentage&&(p("Ejecting candidate "+d),this.eject(e,a))}}}runFailurePercentageCheck(a){if(!this.latestConfig)return;let b=this.latestConfig.getFailurePercentageEjectionConfig();if(!b)return;p("Running failure percentage check. threshold="+b.threshold+" request volume threshold="+b.request_volume);let c=0;for(let a of this.addressMap.values())a.counter.getLastSuccesses()+a.counter.getLastFailures()>=b.request_volume&&(c+=1);if(!(c<b.minimum_hosts))for(let[c,d]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let e=d.counter.getLastSuccesses(),f=d.counter.getLastFailures();if((p("Candidate successes="+e+" failures="+f),!(e+f<b.request_volume))&&100*f/(f+e)>b.threshold){let e=100*Math.random();p("Candidate "+c+" randomNumber="+e+" enforcement_percentage="+b.enforcement_percentage),e<b.enforcement_percentage&&(p("Ejecting candidate "+c),this.eject(d,a))}}}eject(a,b){for(let b of(a.currentEjectionTimestamp=new Date,a.ejectionTimeMultiplier+=1,a.subchannelWrappers))b.eject()}uneject(a){for(let b of(a.currentEjectionTimestamp=null,a.subchannelWrappers))b.uneject()}switchAllBuckets(){for(let a of this.addressMap.values())a.counter.switchBuckets()}startTimer(a){var b,c;this.ejectionTimer=setTimeout(()=>this.runChecks(),a),null==(c=(b=this.ejectionTimer).unref)||c.call(b)}runChecks(){let a=new Date;if(p("Ejection timer running"),this.switchAllBuckets(),this.latestConfig)for(let[b,c]of(this.timerStartTime=a,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(a),this.runFailurePercentageCheck(a),this.addressMap.entries()))if(null===c.currentEjectionTimestamp)c.ejectionTimeMultiplier>0&&(c.ejectionTimeMultiplier-=1);else{let a=this.latestConfig.getBaseEjectionTimeMs(),d=this.latestConfig.getMaxEjectionTimeMs(),e=new Date(c.currentEjectionTimestamp.getTime());e.setMilliseconds(e.getMilliseconds()+Math.min(a*c.ejectionTimeMultiplier,Math.max(a,d))),e<new Date&&(p("Unejecting "+b),this.uneject(c))}}updateAddressList(a,b,c){if(!(b instanceof x))return;let d=new Set;for(let b of a)d.add((0,l.subchannelAddressToString)(b));for(let a of d)this.addressMap.has(a)||(p("Adding map entry for "+a),this.addressMap.set(a,{counter:new A,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(let a of this.addressMap.keys())d.has(a)||(p("Removing map entry for "+a),this.addressMap.delete(a));let e=(0,i.getFirstUsableConfig)(b.getChildPolicy(),!0);if(this.childBalancer.updateAddressList(a,e,c),b.getSuccessRateEjectionConfig()||b.getFailurePercentageEjectionConfig())if(this.timerStartTime){p("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let a=b.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(a)}else p("Starting new timer"),this.timerStartTime=new Date,this.startTimer(b.getIntervalMs()),this.switchAllBuckets();else for(let a of(p("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer),this.addressMap.values()))this.uneject(a),a.ejectionTimeMultiplier=0;this.latestConfig=b}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return q}}c.OutlierDetectionLoadBalancer=C,c.setup=function(){r&&(0,h.registerLoadBalancerType)(q,C,x)}},49489,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.OutlierDetectionLoadBalancingConfig=c.BaseSubchannelWrapper=c.registerAdminService=c.FilterStackFactory=c.BaseFilter=c.PickResultType=c.QueuePicker=c.UnavailablePicker=c.ChildLoadBalancerHandler=c.subchannelAddressToString=c.validateLoadBalancingConfig=c.getFirstUsableConfig=c.registerLoadBalancerType=c.createChildChannelControlHelper=c.BackoffTimeout=c.durationToMs=c.uriToString=c.createResolver=c.registerResolver=c.log=c.trace=void 0;var d=a.r(48520);Object.defineProperty(c,"trace",{enumerable:!0,get:function(){return d.trace}}),Object.defineProperty(c,"log",{enumerable:!0,get:function(){return d.log}});var e=a.r(91539);Object.defineProperty(c,"registerResolver",{enumerable:!0,get:function(){return e.registerResolver}}),Object.defineProperty(c,"createResolver",{enumerable:!0,get:function(){return e.createResolver}});var f=a.r(22087);Object.defineProperty(c,"uriToString",{enumerable:!0,get:function(){return f.uriToString}});var g=a.r(9546);Object.defineProperty(c,"durationToMs",{enumerable:!0,get:function(){return g.durationToMs}});var h=a.r(39984);Object.defineProperty(c,"BackoffTimeout",{enumerable:!0,get:function(){return h.BackoffTimeout}});var i=a.r(53590);Object.defineProperty(c,"createChildChannelControlHelper",{enumerable:!0,get:function(){return i.createChildChannelControlHelper}}),Object.defineProperty(c,"registerLoadBalancerType",{enumerable:!0,get:function(){return i.registerLoadBalancerType}}),Object.defineProperty(c,"getFirstUsableConfig",{enumerable:!0,get:function(){return i.getFirstUsableConfig}}),Object.defineProperty(c,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return i.validateLoadBalancingConfig}});var j=a.r(49271);Object.defineProperty(c,"subchannelAddressToString",{enumerable:!0,get:function(){return j.subchannelAddressToString}});var k=a.r(16338);Object.defineProperty(c,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return k.ChildLoadBalancerHandler}});var l=a.r(6483);Object.defineProperty(c,"UnavailablePicker",{enumerable:!0,get:function(){return l.UnavailablePicker}}),Object.defineProperty(c,"QueuePicker",{enumerable:!0,get:function(){return l.QueuePicker}}),Object.defineProperty(c,"PickResultType",{enumerable:!0,get:function(){return l.PickResultType}});var m=a.r(62184);Object.defineProperty(c,"BaseFilter",{enumerable:!0,get:function(){return m.BaseFilter}});var n=a.r(98726);Object.defineProperty(c,"FilterStackFactory",{enumerable:!0,get:function(){return n.FilterStackFactory}});var o=a.r(95666);Object.defineProperty(c,"registerAdminService",{enumerable:!0,get:function(){return o.registerAdminService}});var p=a.r(57068);Object.defineProperty(c,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return p.BaseSubchannelWrapper}});var q=a.r(94631);Object.defineProperty(c,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return q.OutlierDetectionLoadBalancingConfig}})},4771,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.setup=void 0;let d=a.r(91539);class e{constructor(a,b,c){let d;this.listener=b,this.addresses=[],this.hasReturnedResult=!1,d=""===a.authority?"/"+a.path:a.path,this.addresses=[{path:d}]}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{}))}destroy(){}static getDefaultAuthority(a){return"localhost"}}c.setup=function(){(0,d.registerResolver)("unix",e)}},67756,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.setup=void 0;let d=a.r(4446),e=a.r(47844),f=a.r(92240),g=a.r(91539),h=a.r(22087),i=a.r(48520),j="ip_resolver";function k(a){i.trace(e.LogVerbosity.DEBUG,j,a)}let l="ipv4",m="ipv6",n=443;class o{constructor(a,b,c){var g;this.listener=b,this.addresses=[],this.error=null,this.hasReturnedResult=!1,k("Resolver constructed for target "+(0,h.uriToString)(a));const i=[];if(a.scheme!==l&&a.scheme!==m){this.error={code:e.Status.UNAVAILABLE,details:`Unrecognized scheme ${a.scheme} in IP resolver`,metadata:new f.Metadata};return}for(const b of a.path.split(",")){const c=(0,h.splitHostPort)(b);if(null===c||a.scheme===l&&!(0,d.isIPv4)(c.host)||a.scheme===m&&!(0,d.isIPv6)(c.host)){this.error={code:e.Status.UNAVAILABLE,details:`Failed to parse ${a.scheme} address ${b}`,metadata:new f.Metadata};return}i.push({host:c.host,port:null!=(g=c.port)?g:n})}this.addresses=i,k("Parsed "+a.scheme+" address list "+this.addresses)}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(a){return a.path.split(",")[0]}}c.setup=function(){(0,g.registerResolver)(l,o),(0,g.registerResolver)(m,o)}},9249,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.setup=c.PickFirstLoadBalancer=c.shuffled=c.PickFirstLoadBalancingConfig=void 0;let d=a.r(53590),e=a.r(69374),f=a.r(6483),g=a.r(48520),h=a.r(47844),i="pick_first";function j(a){g.trace(h.LogVerbosity.DEBUG,i,a)}let k="pick_first",l=250;class m{constructor(a){this.shuffleAddressList=a}getLoadBalancerName(){return k}toJsonObject(){return{[k]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(a){if("shuffleAddressList"in a&&"boolean"!=typeof a.shuffleAddressList)throw Error("pick_first config field shuffleAddressList must be a boolean if provided");return new m(!0===a.shuffleAddressList)}}c.PickFirstLoadBalancingConfig=m;class n{constructor(a){this.subchannel=a}pick(a){return{pickResultType:f.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}}function o(a){let b=a.slice();for(let a=b.length-1;a>1;a--){let c=Math.floor(Math.random()*(a+1)),d=b[a];b[a]=b[c],b[c]=d}return b}c.shuffled=o;class p{constructor(a){this.channelControlHelper=a,this.children=[],this.currentState=e.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(a,b,c,d,e)=>{this.onSubchannelStateUpdate(a,b,c,e)},this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.latestAddressList=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}allChildrenHaveReportedTF(){return this.children.every(a=>a.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.updateState(e.ConnectivityState.READY,new n(this.currentPick)):0===this.children.length?this.updateState(e.ConnectivityState.IDLE,new f.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(e.ConnectivityState.TRANSIENT_FAILURE,new f.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(e.ConnectivityState.CONNECTING,new f.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){for(let{subchannel:a}of(this.stickyTransientFailureMode=!0,this.children))a.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(null!==this.currentPick){let a=this.currentPick;this.currentPick=null,a.unref(),a.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(a.getChannelzRef())}}onSubchannelStateUpdate(a,b,c,d){var f;if(null==(f=this.currentPick)?void 0:f.realSubchannelEquals(a)){c!==e.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(let[b,f]of this.children.entries())if(a.realSubchannelEquals(f.subchannel)){c===e.ConnectivityState.READY&&this.pickSubchannel(f.subchannel),c===e.ConnectivityState.TRANSIENT_FAILURE&&(f.hasReportedTransientFailure=!0,d&&(this.lastError=d),this.maybeEnterStickyTransientFailureMode(),b===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(b+1)),f.subchannel.startConnecting();return}}startNextSubchannelConnecting(a){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(let[b,c]of this.children.entries())if(b>=a){let a=c.subchannel.getConnectivityState();if(a===e.ConnectivityState.IDLE||a===e.ConnectivityState.CONNECTING)return void this.startConnecting(b)}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(a){var b,c;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=a,this.children[a].subchannel.getConnectivityState()===e.ConnectivityState.IDLE&&(j("Start connecting to subchannel with address "+this.children[a].subchannel.getAddress()),process.nextTick(()=>{var b;null==(b=this.children[a])||b.subchannel.startConnecting()})),this.connectionDelayTimeout=null==(c=(b=setTimeout(()=>{this.startNextSubchannelConnecting(a+1)},l)).unref)?void 0:c.call(b)}pickSubchannel(a){this.currentPick&&a.realSubchannelEquals(this.currentPick)||(j("Pick subchannel with address "+a.getAddress()),this.stickyTransientFailureMode=!1,null!==this.currentPick&&(this.currentPick.unref(),this.channelControlHelper.removeChannelzChild(this.currentPick.getChannelzRef()),this.currentPick.removeConnectivityStateListener(this.subchannelStateListener)),this.currentPick=a,a.ref(),this.channelControlHelper.addChannelzChild(a.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(a,b){j(e.ConnectivityState[this.currentState]+" -> "+e.ConnectivityState[a]),this.currentState=a,this.channelControlHelper.updateState(a,b)}resetSubchannelList(){for(let a of this.children)this.currentPick&&a.subchannel.realSubchannelEquals(this.currentPick)||a.subchannel.removeConnectivityStateListener(this.subchannelStateListener),a.subchannel.unref(),this.channelControlHelper.removeChannelzChild(a.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}connectToAddressList(a){let b=a.map(a=>({subchannel:this.channelControlHelper.createSubchannel(a,{}),hasReportedTransientFailure:!1}));for(let{subchannel:a}of b)a.ref(),this.channelControlHelper.addChannelzChild(a.getChannelzRef());for(let{subchannel:a}of(this.resetSubchannelList(),this.children=b,this.children))if(a.addConnectivityStateListener(this.subchannelStateListener),a.getConnectivityState()===e.ConnectivityState.READY)return void this.pickSubchannel(a);for(let a of this.children)a.subchannel.getConnectivityState()===e.ConnectivityState.TRANSIENT_FAILURE&&(a.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}updateAddressList(a,b){b instanceof m&&(b.getShuffleAddressList()&&(a=o(a)),this.latestAddressList=a,this.connectToAddressList(a))}exitIdle(){this.currentState===e.ConnectivityState.IDLE&&this.latestAddressList&&this.connectToAddressList(this.latestAddressList)}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return k}}c.PickFirstLoadBalancer=p,c.setup=function(){(0,d.registerLoadBalancerType)(k,p,m),(0,d.registerDefaultLoadBalancerType)(k)}},30771,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.setup=c.RoundRobinLoadBalancer=void 0;let d=a.r(53590),e=a.r(69374),f=a.r(6483),g=a.r(49271),h=a.r(48520),i=a.r(47844),j="round_robin";function k(a){h.trace(i.LogVerbosity.DEBUG,j,a)}let l="round_robin";class m{getLoadBalancerName(){return l}constructor(){}toJsonObject(){return{[l]:{}}}static createFromJson(a){return new m}}class n{constructor(a,b=0){this.subchannelList=a,this.nextIndex=b}pick(a){let b=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:f.PickResultType.COMPLETE,subchannel:b,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}}class o{constructor(a){this.channelControlHelper=a,this.subchannels=[],this.currentState=e.ConnectivityState.IDLE,this.currentReadyPicker=null,this.lastError=null,this.subchannelStateListener=(a,b,c,d,f)=>{this.calculateAndUpdateState(),(c===e.ConnectivityState.TRANSIENT_FAILURE||c===e.ConnectivityState.IDLE)&&(f&&(this.lastError=f),this.channelControlHelper.requestReresolution(),a.startConnecting())}}countSubchannelsWithState(a){return this.subchannels.filter(b=>b.getConnectivityState()===a).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(e.ConnectivityState.READY)>0){let a=this.subchannels.filter(a=>a.getConnectivityState()===e.ConnectivityState.READY),b=0;null!==this.currentReadyPicker&&(b=a.indexOf(this.currentReadyPicker.peekNextSubchannel()))<0&&(b=0),this.updateState(e.ConnectivityState.READY,new n(a,b))}else this.countSubchannelsWithState(e.ConnectivityState.CONNECTING)>0?this.updateState(e.ConnectivityState.CONNECTING,new f.QueuePicker(this)):this.countSubchannelsWithState(e.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(e.ConnectivityState.TRANSIENT_FAILURE,new f.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(e.ConnectivityState.IDLE,new f.QueuePicker(this))}updateState(a,b){k(e.ConnectivityState[this.currentState]+" -> "+e.ConnectivityState[a]),a===e.ConnectivityState.READY?this.currentReadyPicker=b:this.currentReadyPicker=null,this.currentState=a,this.channelControlHelper.updateState(a,b)}resetSubchannelList(){for(let a of this.subchannels)a.removeConnectivityStateListener(this.subchannelStateListener),a.unref(),this.channelControlHelper.removeChannelzChild(a.getChannelzRef());this.subchannels=[]}updateAddressList(a,b){for(let b of(this.resetSubchannelList(),k("Connect to address list "+a.map(a=>(0,g.subchannelAddressToString)(a))),this.subchannels=a.map(a=>this.channelControlHelper.createSubchannel(a,{})),this.subchannels)){b.ref(),b.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(b.getChannelzRef());let a=b.getConnectivityState();(a===e.ConnectivityState.IDLE||a===e.ConnectivityState.TRANSIENT_FAILURE)&&b.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(let a of this.subchannels)a.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return l}}c.RoundRobinLoadBalancer=o,c.setup=function(){(0,d.registerLoadBalancerType)(l,o,m)}},92635,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.experimental=c.addAdminServicesToServer=c.getChannelzHandlers=c.getChannelzServiceDefinition=c.InterceptorConfigurationError=c.InterceptingCall=c.RequesterBuilder=c.ListenerBuilder=c.StatusBuilder=c.getClientChannel=c.ServerCredentials=c.Server=c.setLogVerbosity=c.setLogger=c.load=c.loadObject=c.CallCredentials=c.ChannelCredentials=c.waitForClientReady=c.closeClient=c.Channel=c.makeGenericClientConstructor=c.makeClientConstructor=c.loadPackageDefinition=c.Client=c.compressionAlgorithms=c.propagate=c.connectivityState=c.status=c.logVerbosity=c.Metadata=c.credentials=void 0;let d=a.r(32375);Object.defineProperty(c,"CallCredentials",{enumerable:!0,get:function(){return d.CallCredentials}});let e=a.r(51621);Object.defineProperty(c,"Channel",{enumerable:!0,get:function(){return e.ChannelImplementation}});let f=a.r(17919);Object.defineProperty(c,"compressionAlgorithms",{enumerable:!0,get:function(){return f.CompressionAlgorithms}});let g=a.r(69374);Object.defineProperty(c,"connectivityState",{enumerable:!0,get:function(){return g.ConnectivityState}});let h=a.r(48728);Object.defineProperty(c,"ChannelCredentials",{enumerable:!0,get:function(){return h.ChannelCredentials}});let i=a.r(62562);Object.defineProperty(c,"Client",{enumerable:!0,get:function(){return i.Client}});let j=a.r(47844);Object.defineProperty(c,"logVerbosity",{enumerable:!0,get:function(){return j.LogVerbosity}}),Object.defineProperty(c,"status",{enumerable:!0,get:function(){return j.Status}}),Object.defineProperty(c,"propagate",{enumerable:!0,get:function(){return j.Propagate}});let k=a.r(48520),l=a.r(79523);Object.defineProperty(c,"loadPackageDefinition",{enumerable:!0,get:function(){return l.loadPackageDefinition}}),Object.defineProperty(c,"makeClientConstructor",{enumerable:!0,get:function(){return l.makeClientConstructor}}),Object.defineProperty(c,"makeGenericClientConstructor",{enumerable:!0,get:function(){return l.makeClientConstructor}});let m=a.r(92240);Object.defineProperty(c,"Metadata",{enumerable:!0,get:function(){return m.Metadata}});let n=a.r(43115);Object.defineProperty(c,"Server",{enumerable:!0,get:function(){return n.Server}});let o=a.r(57889);Object.defineProperty(c,"ServerCredentials",{enumerable:!0,get:function(){return o.ServerCredentials}});let p=a.r(4910);Object.defineProperty(c,"StatusBuilder",{enumerable:!0,get:function(){return p.StatusBuilder}}),c.credentials={combineChannelCredentials:(a,...b)=>b.reduce((a,b)=>a.compose(b),a),combineCallCredentials:(a,...b)=>b.reduce((a,b)=>a.compose(b),a),createInsecure:h.ChannelCredentials.createInsecure,createSsl:h.ChannelCredentials.createSsl,createFromSecureContext:h.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:d.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:d.CallCredentials.createFromGoogleCredential,createEmpty:d.CallCredentials.createEmpty},c.closeClient=a=>a.close(),c.waitForClientReady=(a,b,c)=>a.waitForReady(b,c),c.loadObject=(a,b)=>{throw Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")},c.load=(a,b,c)=>{throw Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")},c.setLogger=a=>{k.setLogger(a)},c.setLogVerbosity=a=>{k.setLoggerVerbosity(a)},c.getClientChannel=a=>i.Client.prototype.getChannel.call(a);var q=a.r(53252);Object.defineProperty(c,"ListenerBuilder",{enumerable:!0,get:function(){return q.ListenerBuilder}}),Object.defineProperty(c,"RequesterBuilder",{enumerable:!0,get:function(){return q.RequesterBuilder}}),Object.defineProperty(c,"InterceptingCall",{enumerable:!0,get:function(){return q.InterceptingCall}}),Object.defineProperty(c,"InterceptorConfigurationError",{enumerable:!0,get:function(){return q.InterceptorConfigurationError}});var r=a.r(37725);Object.defineProperty(c,"getChannelzServiceDefinition",{enumerable:!0,get:function(){return r.getChannelzServiceDefinition}}),Object.defineProperty(c,"getChannelzHandlers",{enumerable:!0,get:function(){return r.getChannelzHandlers}});var s=a.r(95666);Object.defineProperty(c,"addAdminServicesToServer",{enumerable:!0,get:function(){return s.addAdminServicesToServer}}),c.experimental=a.r(49489);let t=a.r(34197),u=a.r(4771),v=a.r(67756),w=a.r(9249),x=a.r(30771),y=a.r(94631),z=a.r(37725);(()=>{t.setup(),u.setup(),v.setup(),w.setup(),x.setup(),y.setup(),z.setup()})()},76983,93396,79431,55475,958,a=>{"use strict";let b,c,d=()=>void 0,e={NODE_CLIENT:!1},f=function(a){let b=[],c=0;for(let d=0;d<a.length;d++){let e=a.charCodeAt(d);e<128?b[c++]=e:(e<2048?b[c++]=e>>6|192:((64512&e)==55296&&d+1<a.length&&(64512&a.charCodeAt(d+1))==56320?(e=65536+((1023&e)<<10)+(1023&a.charCodeAt(++d)),b[c++]=e>>18|240,b[c++]=e>>12&63|128):b[c++]=e>>12|224,b[c++]=e>>6&63|128),b[c++]=63&e|128)}return b},g=function(a){let b=[],c=0,d=0;for(;c<a.length;){let e=a[c++];if(e<128)b[d++]=String.fromCharCode(e);else if(e>191&&e<224){let f=a[c++];b[d++]=String.fromCharCode((31&e)<<6|63&f)}else if(e>239&&e<365){let f=((7&e)<<18|(63&a[c++])<<12|(63&a[c++])<<6|63&a[c++])-65536;b[d++]=String.fromCharCode(55296+(f>>10)),b[d++]=String.fromCharCode(56320+(1023&f))}else{let f=a[c++],g=a[c++];b[d++]=String.fromCharCode((15&e)<<12|(63&f)<<6|63&g)}}return b.join("")},h={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(a,b){if(!Array.isArray(a))throw Error("encodeByteArray takes an array as a parameter");this.init_();let c=b?this.byteToCharMapWebSafe_:this.byteToCharMap_,d=[];for(let b=0;b<a.length;b+=3){let e=a[b],f=b+1<a.length,g=f?a[b+1]:0,h=b+2<a.length,i=h?a[b+2]:0,j=e>>2,k=(3&e)<<4|g>>4,l=(15&g)<<2|i>>6,m=63&i;!h&&(m=64,f||(l=64)),d.push(c[j],c[k],c[l],c[m])}return d.join("")},encodeString(a,b){return this.HAS_NATIVE_SUPPORT&&!b?btoa(a):this.encodeByteArray(f(a),b)},decodeString(a,b){return this.HAS_NATIVE_SUPPORT&&!b?atob(a):g(this.decodeStringToByteArray(a,b))},decodeStringToByteArray(a,b){this.init_();let c=b?this.charToByteMapWebSafe_:this.charToByteMap_,d=[];for(let b=0;b<a.length;){let e=c[a.charAt(b++)],f=b<a.length?c[a.charAt(b)]:0,g=++b<a.length?c[a.charAt(b)]:64,h=++b<a.length?c[a.charAt(b)]:64;if(++b,null==e||null==f||null==g||null==h)throw new i;let j=e<<2|f>>4;if(d.push(j),64!==g){let a=f<<4&240|g>>2;if(d.push(a),64!==h){let a=g<<6&192|h;d.push(a)}}}return d},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let a=0;a<this.ENCODED_VALS.length;a++)this.byteToCharMap_[a]=this.ENCODED_VALS.charAt(a),this.charToByteMap_[this.byteToCharMap_[a]]=a,this.byteToCharMapWebSafe_[a]=this.ENCODED_VALS_WEBSAFE.charAt(a),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[a]]=a,a>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(a)]=a,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(a)]=a)}}};class i extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let j=function(a){let b=f(a);return h.encodeByteArray(b,!0)},k=function(a){return j(a).replace(/\./g,"")},l=function(a){try{return h.decodeString(a,!0)}catch(a){console.error("base64Decode failed: ",a)}return null};function m(){return"undefined"!=typeof self?self:a.g}let n=()=>m().__FIREBASE_DEFAULTS__,o=()=>{if("undefined"==typeof process||void 0===process.env)return;let a=process.env.__FIREBASE_DEFAULTS__;if(a)return JSON.parse(a)},p=()=>{let a;if("undefined"==typeof document)return;try{a=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(a){return}let b=a&&l(a[1]);return b&&JSON.parse(b)},q=()=>{try{return d()||n()||o()||p()}catch(a){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${a}`);return}},r=a=>q()?.emulatorHosts?.[a],s=()=>q()?.config;class t{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((a,b)=>{this.resolve=a,this.reject=b})}wrapCallback(a){return(b,c)=>{b?this.reject(b):this.resolve(c),"function"==typeof a&&(this.promise.catch(()=>{}),1===a.length?a(b):a(b,c))}}}function u(a){try{return(a.startsWith("http://")||a.startsWith("https://")?new URL(a).hostname:a).endsWith(".cloudworkstations.dev")}catch{return!1}}async function v(a){return(await fetch(a,{credentials:"include"})).ok}function w(a,b){}function x(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function y(){return!1}function z(){let b=q()?.forceEnvironment;if("node"===b)return!0;if("browser"===b)return!1;try{return"[object process]"===Object.prototype.toString.call(a.g.process)}catch(a){return!1}}function A(){return B()}function B(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function C(){return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent}function D(){let a="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof a&&void 0!==a.id}function E(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function F(){return!z()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function G(){return!z()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function H(){try{return"object"==typeof indexedDB}catch(a){return!1}}function I(){return new Promise((a,b)=>{try{let c=!0,d="validate-browser-context-for-indexeddb-analytics-module",e=self.indexedDB.open(d);e.onsuccess=()=>{e.result.close(),c||self.indexedDB.deleteDatabase(d),a(!0)},e.onupgradeneeded=()=>{c=!1},e.onerror=()=>{b(e.error?.message||"")}}catch(a){b(a)}})}let J="FirebaseError";class K extends Error{constructor(a,b,c){super(b),this.code=a,this.customData=c,this.name=J,Object.setPrototypeOf(this,K.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,L.prototype.create)}}class L{constructor(a,b,c){this.service=a,this.serviceName=b,this.errors=c}create(a,...b){let c=b[0]||{},d=`${this.service}/${a}`,e=this.errors[a],f=e?M(e,c):"Error",g=`${this.serviceName}: ${f} (${d}).`;return new K(d,g,c)}}function M(a,b){return a.replace(N,(a,c)=>{let d=b[c];return null!=d?String(d):`<${c}?>`})}let N=/\{\$([^}]+)}/g;function O(a,b){if(a===b)return!0;let c=Object.keys(a),d=Object.keys(b);for(let e of c){if(!d.includes(e))return!1;let c=a[e],f=b[e];if(P(c)&&P(f)){if(!O(c,f))return!1}else if(c!==f)return!1}for(let a of d)if(!c.includes(a))return!1;return!0}function P(a){return null!==a&&"object"==typeof a}function Q(a){let b=[];for(let[c,d]of Object.entries(a))Array.isArray(d)?d.forEach(a=>{b.push(encodeURIComponent(c)+"="+encodeURIComponent(a))}):b.push(encodeURIComponent(c)+"="+encodeURIComponent(d));return b.length?"&"+b.join("&"):""}function R(a){let b={};return a.replace(/^\?/,"").split("&").forEach(a=>{if(a){let[c,d]=a.split("=");b[decodeURIComponent(c)]=decodeURIComponent(d)}}),b}function S(a){let b=a.indexOf("?");if(!b)return"";let c=a.indexOf("#",b);return a.substring(b,c>0?c:void 0)}function T(a,b){let c=new U(a,b);return c.subscribe.bind(c)}class U{constructor(a,b){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=b,this.task.then(()=>{a(this)}).catch(a=>{this.error(a)})}next(a){this.forEachObserver(b=>{b.next(a)})}error(a){this.forEachObserver(b=>{b.error(a)}),this.close(a)}complete(){this.forEachObserver(a=>{a.complete()}),this.close()}subscribe(a,b,c){let d;if(void 0===a&&void 0===b&&void 0===c)throw Error("Missing Observer.");void 0===(d=V(a,["next","error","complete"])?a:{next:a,error:b,complete:c}).next&&(d.next=W),void 0===d.error&&(d.error=W),void 0===d.complete&&(d.complete=W);let e=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?d.error(this.finalError):d.complete()}catch(a){}}),this.observers.push(d),e}unsubscribeOne(a){void 0!==this.observers&&void 0!==this.observers[a]&&(delete this.observers[a],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(a){if(!this.finalized)for(let b=0;b<this.observers.length;b++)this.sendOne(b,a)}sendOne(a,b){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[a])try{b(this.observers[a])}catch(a){"undefined"!=typeof console&&console.error&&console.error(a)}})}close(a){this.finalized||(this.finalized=!0,void 0!==a&&(this.finalError=a),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function V(a,b){if("object"!=typeof a||null===a)return!1;for(let c of b)if(c in a&&"function"==typeof a[c])return!0;return!1}function W(){}function X(a){return a&&a._delegate?a._delegate:a}e.NODE_CLIENT=!0;class Y{constructor(a,b,c){this.name=a,this.instanceFactory=b,this.type=c,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(a){return this.instantiationMode=a,this}setMultipleInstances(a){return this.multipleInstances=a,this}setServiceProps(a){return this.serviceProps=a,this}setInstanceCreatedCallback(a){return this.onInstanceCreated=a,this}}let Z="[DEFAULT]";class ${constructor(a,b){this.name=a,this.container=b,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(a){let b=this.normalizeInstanceIdentifier(a);if(!this.instancesDeferred.has(b)){let a=new t;if(this.instancesDeferred.set(b,a),this.isInitialized(b)||this.shouldAutoInitialize())try{let c=this.getOrInitializeService({instanceIdentifier:b});c&&a.resolve(c)}catch(a){}}return this.instancesDeferred.get(b).promise}getImmediate(a){let b=this.normalizeInstanceIdentifier(a?.identifier),c=a?.optional??!1;if(this.isInitialized(b)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:b})}catch(a){if(c)return null;throw a}if(c)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(a){if(a.name!==this.name)throw Error(`Mismatching Component ${a.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=a,this.shouldAutoInitialize()){if(aa(a))try{this.getOrInitializeService({instanceIdentifier:Z})}catch(a){}for(let[a,b]of this.instancesDeferred.entries()){let c=this.normalizeInstanceIdentifier(a);try{let a=this.getOrInitializeService({instanceIdentifier:c});b.resolve(a)}catch(a){}}}}clearInstance(a=Z){this.instancesDeferred.delete(a),this.instancesOptions.delete(a),this.instances.delete(a)}async delete(){let a=Array.from(this.instances.values());await Promise.all([...a.filter(a=>"INTERNAL"in a).map(a=>a.INTERNAL.delete()),...a.filter(a=>"_delete"in a).map(a=>a._delete())])}isComponentSet(){return null!=this.component}isInitialized(a=Z){return this.instances.has(a)}getOptions(a=Z){return this.instancesOptions.get(a)||{}}initialize(a={}){let{options:b={}}=a,c=this.normalizeInstanceIdentifier(a.instanceIdentifier);if(this.isInitialized(c))throw Error(`${this.name}(${c}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let d=this.getOrInitializeService({instanceIdentifier:c,options:b});for(let[a,b]of this.instancesDeferred.entries())c===this.normalizeInstanceIdentifier(a)&&b.resolve(d);return d}onInit(a,b){let c=this.normalizeInstanceIdentifier(b),d=this.onInitCallbacks.get(c)??new Set;d.add(a),this.onInitCallbacks.set(c,d);let e=this.instances.get(c);return e&&a(e,c),()=>{d.delete(a)}}invokeOnInitCallbacks(a,b){let c=this.onInitCallbacks.get(b);if(c)for(let d of c)try{d(a,b)}catch{}}getOrInitializeService({instanceIdentifier:a,options:b={}}){let c=this.instances.get(a);if(!c&&this.component&&(c=this.component.instanceFactory(this.container,{instanceIdentifier:_(a),options:b}),this.instances.set(a,c),this.instancesOptions.set(a,b),this.invokeOnInitCallbacks(c,a),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,a,c)}catch{}return c||null}normalizeInstanceIdentifier(a=Z){return this.component?this.component.multipleInstances?a:Z:a}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}function _(a){return a===Z?void 0:a}function aa(a){return"EAGER"===a.instantiationMode}class ab{constructor(a){this.name=a,this.providers=new Map}addComponent(a){let b=this.getProvider(a.name);if(b.isComponentSet())throw Error(`Component ${a.name} has already been registered with ${this.name}`);b.setComponent(a)}addOrOverwriteComponent(a){this.getProvider(a.name).isComponentSet()&&this.providers.delete(a.name),this.addComponent(a)}getProvider(a){if(this.providers.has(a))return this.providers.get(a);let b=new $(a,this);return this.providers.set(a,b),b}getProviders(){return Array.from(this.providers.values())}}let ac=[];!function(a){a[a.DEBUG=0]="DEBUG",a[a.VERBOSE=1]="VERBOSE",a[a.INFO=2]="INFO",a[a.WARN=3]="WARN",a[a.ERROR=4]="ERROR",a[a.SILENT=5]="SILENT"}(de||(de={}));let ad={debug:de.DEBUG,verbose:de.VERBOSE,info:de.INFO,warn:de.WARN,error:de.ERROR,silent:de.SILENT},ae=de.INFO,af={[de.DEBUG]:"log",[de.VERBOSE]:"log",[de.INFO]:"info",[de.WARN]:"warn",[de.ERROR]:"error"},ag=(a,b,...c)=>{if(b<a.logLevel)return;let d=new Date().toISOString(),e=af[b];if(e)console[e](`[${d}]  ${a.name}:`,...c);else throw Error(`Attempted to log a message with an invalid logType (value: ${b})`)};class ah{constructor(a){this.name=a,this._logLevel=ae,this._logHandler=ag,this._userLogHandler=null,ac.push(this)}get logLevel(){return this._logLevel}set logLevel(a){if(!(a in de))throw TypeError(`Invalid value "${a}" assigned to \`logLevel\``);this._logLevel=a}setLogLevel(a){this._logLevel="string"==typeof a?ad[a]:a}get logHandler(){return this._logHandler}set logHandler(a){if("function"!=typeof a)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=a}get userLogHandler(){return this._userLogHandler}set userLogHandler(a){this._userLogHandler=a}debug(...a){this._userLogHandler&&this._userLogHandler(this,de.DEBUG,...a),this._logHandler(this,de.DEBUG,...a)}log(...a){this._userLogHandler&&this._userLogHandler(this,de.VERBOSE,...a),this._logHandler(this,de.VERBOSE,...a)}info(...a){this._userLogHandler&&this._userLogHandler(this,de.INFO,...a),this._logHandler(this,de.INFO,...a)}warn(...a){this._userLogHandler&&this._userLogHandler(this,de.WARN,...a),this._logHandler(this,de.WARN,...a)}error(...a){this._userLogHandler&&this._userLogHandler(this,de.ERROR,...a),this._logHandler(this,de.ERROR,...a)}}function ai(a){ac.forEach(b=>{b.setLogLevel(a)})}function aj(a,b){for(let c of ac){let d=null;b&&b.level&&(d=ad[b.level]),null===a?c.userLogHandler=null:c.userLogHandler=(b,c,...e)=>{let f=e.map(a=>{if(null==a)return null;if("string"==typeof a)return a;if("number"==typeof a||"boolean"==typeof a)return a.toString();if(a instanceof Error)return a.message;try{return JSON.stringify(a)}catch(a){return null}}).filter(a=>a).join(" ");c>=(d??b.logLevel)&&a({level:de[c].toLowerCase(),message:f,args:e,type:b.name})}}}let ak=(a,b)=>b.some(b=>a instanceof b);function al(){return b||(b=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function am(){return c||(c=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}let an=new WeakMap,ao=new WeakMap,ap=new WeakMap,aq=new WeakMap,ar=new WeakMap;function as(a){let b=new Promise((b,c)=>{let d=()=>{a.removeEventListener("success",e),a.removeEventListener("error",f)},e=()=>{b(ay(a.result)),d()},f=()=>{c(a.error),d()};a.addEventListener("success",e),a.addEventListener("error",f)});return b.then(b=>{b instanceof IDBCursor&&an.set(b,a)}).catch(()=>{}),ar.set(b,a),b}function at(a){if(ao.has(a))return;let b=new Promise((b,c)=>{let d=()=>{a.removeEventListener("complete",e),a.removeEventListener("error",f),a.removeEventListener("abort",f)},e=()=>{b(),d()},f=()=>{c(a.error||new DOMException("AbortError","AbortError")),d()};a.addEventListener("complete",e),a.addEventListener("error",f),a.addEventListener("abort",f)});ao.set(a,b)}let au={get(a,b,c){if(a instanceof IDBTransaction){if("done"===b)return ao.get(a);if("objectStoreNames"===b)return a.objectStoreNames||ap.get(a);if("store"===b)return c.objectStoreNames[1]?void 0:c.objectStore(c.objectStoreNames[0])}return ay(a[b])},set:(a,b,c)=>(a[b]=c,!0),has:(a,b)=>a instanceof IDBTransaction&&("done"===b||"store"===b)||b in a};function av(a){au=a(au)}function aw(a){return a!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?am().includes(a)?function(...b){return a.apply(az(this),b),ay(an.get(this))}:function(...b){return ay(a.apply(az(this),b))}:function(b,...c){let d=a.call(az(this),b,...c);return ap.set(d,b.sort?b.sort():[b]),ay(d)}}function ax(a){return"function"==typeof a?aw(a):(a instanceof IDBTransaction&&at(a),ak(a,al()))?new Proxy(a,au):a}function ay(a){if(a instanceof IDBRequest)return as(a);if(aq.has(a))return aq.get(a);let b=ax(a);return b!==a&&(aq.set(a,b),ar.set(b,a)),b}let az=a=>ar.get(a);function aA(a,b,{blocked:c,upgrade:d,blocking:e,terminated:f}={}){let g=indexedDB.open(a,b),h=ay(g);return d&&g.addEventListener("upgradeneeded",a=>{d(ay(g.result),a.oldVersion,a.newVersion,ay(g.transaction),a)}),c&&g.addEventListener("blocked",a=>c(a.oldVersion,a.newVersion,a)),h.then(a=>{f&&a.addEventListener("close",()=>f()),e&&a.addEventListener("versionchange",a=>e(a.oldVersion,a.newVersion,a))}).catch(()=>{}),h}let aB=["get","getKey","getAll","getAllKeys","count"],aC=["put","add","delete","clear"],aD=new Map;function aE(a,b){if(!(a instanceof IDBDatabase&&!(b in a)&&"string"==typeof b))return;if(aD.get(b))return aD.get(b);let c=b.replace(/FromIndex$/,""),d=b!==c,e=aC.includes(c);if(!(c in(d?IDBIndex:IDBObjectStore).prototype)||!(e||aB.includes(c)))return;let f=async function(a,...b){let f=this.transaction(a,e?"readwrite":"readonly"),g=f.store;return d&&(g=g.index(b.shift())),(await Promise.all([g[c](...b),e&&f.done]))[0]};return aD.set(b,f),f}av(a=>({...a,get:(b,c,d)=>aE(b,c)||a.get(b,c,d),has:(b,c)=>!!aE(b,c)||a.has(b,c)}));class aF{constructor(a){this.container=a}getPlatformInfoString(){return this.container.getProviders().map(a=>{if(!aG(a))return null;{let b=a.getImmediate();return`${b.library}/${b.version}`}}).filter(a=>a).join(" ")}}function aG(a){let b=a.getComponent();return b?.type==="VERSION"}let aH="@firebase/app",aI="0.14.6",aJ=new ah("@firebase/app"),aK="12.6.0",aL="[DEFAULT]",aM={[aH]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},aN=new Map,aO=new Map,aP=new Map;function aQ(a,b){try{a.container.addComponent(b)}catch(c){aJ.debug(`Component ${b.name} failed to register with FirebaseApp ${a.name}`,c)}}function aR(a,b){a.container.addOrOverwriteComponent(b)}function aS(a){let b=a.name;if(aP.has(b))return aJ.debug(`There were multiple attempts to register component ${b}.`),!1;for(let c of(aP.set(b,a),aN.values()))aQ(c,a);for(let b of aO.values())aQ(b,a);return!0}function aT(a,b){let c=a.container.getProvider("heartbeat").getImmediate({optional:!0});return c&&c.triggerHeartbeat(),a.container.getProvider(b)}function aU(a,b,c=aL){aT(a,b).clearInstance(c)}function aV(a){return void 0!==a.options}function aW(a){return!aV(a)&&("authIdToken"in a||"appCheckToken"in a||"releaseOnDeref"in a||"automaticDataCollectionEnabled"in a)}function aX(a){return null!=a&&void 0!==a.settings}function aY(){aP.clear()}let aZ=new L("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class a${constructor(a,b,c){this._isDeleted=!1,this._options={...a},this._config={...b},this._name=b.name,this._automaticDataCollectionEnabled=b.automaticDataCollectionEnabled,this._container=c,this.container.addComponent(new Y("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(a){this.checkDestroyed(),this._automaticDataCollectionEnabled=a}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(a){this._isDeleted=a}checkDestroyed(){if(this.isDeleted)throw aZ.create("app-deleted",{appName:this._name})}}function a_(a,b){let c=l(a.split(".")[1]);null===c?console.error(`FirebaseServerApp ${b} is invalid: second part could not be parsed.`):void 0===JSON.parse(c).exp?console.error(`FirebaseServerApp ${b} is invalid: expiration claim could not be parsed`):1e3*JSON.parse(c).exp-new Date().getTime()<=0&&console.error(`FirebaseServerApp ${b} is invalid: the token has expired.`)}class a0 extends a${constructor(a,b,c,d){const e=void 0===b.automaticDataCollectionEnabled||b.automaticDataCollectionEnabled,f={name:c,automaticDataCollectionEnabled:e};void 0!==a.apiKey?super(a,f,d):super(a.options,f,d),this._serverConfig={automaticDataCollectionEnabled:e,...b},this._serverConfig.authIdToken&&a_(this._serverConfig.authIdToken,"authIdToken"),this._serverConfig.appCheckToken&&a_(this._serverConfig.appCheckToken,"appCheckToken"),this._finalizationRegistry=null,"undefined"!=typeof FinalizationRegistry&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,b.releaseOnDeref=void 0,a7(aH,aI,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(a){this.isDeleted||(this._refCount++,void 0!==a&&null!==this._finalizationRegistry&&this._finalizationRegistry.register(a,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){a6(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw aZ.create("server-app-deleted")}}let a1=aK;function a2(a,b={}){let c=a;"object"!=typeof b&&(b={name:b});let d={name:aL,automaticDataCollectionEnabled:!0,...b},e=d.name;if("string"!=typeof e||!e)throw aZ.create("bad-app-name",{appName:String(e)});if(c||(c=s()),!c)throw aZ.create("no-options");let f=aN.get(e);if(f)if(O(c,f.options)&&O(d,f.config))return f;else throw aZ.create("duplicate-app",{appName:e});let g=new ab(e);for(let a of aP.values())g.addComponent(a);let h=new a$(c,d,g);return aN.set(e,h),h}function a3(a,b={}){let c;if(A()&&!B())throw aZ.create("invalid-server-app-environment");let d=b||{};if(a&&(aV(a)?c=a.options:aW(a)?d=a:c=a),void 0===d.automaticDataCollectionEnabled&&(d.automaticDataCollectionEnabled=!0),c||(c=s()),!c)throw aZ.create("no-options");let e={...d,...c};void 0!==e.releaseOnDeref&&delete e.releaseOnDeref;let f=a=>[...a].reduce((a,b)=>Math.imul(31,a)+b.charCodeAt(0)|0,0);if(void 0!==d.releaseOnDeref&&"undefined"==typeof FinalizationRegistry)throw aZ.create("finalization-registry-not-supported",{});let g=""+f(JSON.stringify(e)),h=aO.get(g);if(h)return h.incRefCount(d.releaseOnDeref),h;let i=new ab(g);for(let a of aP.values())i.addComponent(a);let j=new a0(c,d,g,i);return aO.set(g,j),j}function a4(a=aL){let b=aN.get(a);if(!b&&a===aL&&s())return a2();if(!b)throw aZ.create("no-app",{appName:a});return b}function a5(){return Array.from(aN.values())}async function a6(a){let b=!1,c=a.name;aN.has(c)?(b=!0,aN.delete(c)):aO.has(c)&&0>=a.decRefCount()&&(aO.delete(c),b=!0),b&&(await Promise.all(a.container.getProviders().map(a=>a.delete())),a.isDeleted=!0)}function a7(a,b,c){let d=aM[a]??a;c&&(d+=`-${c}`);let e=d.match(/\s|\//),f=b.match(/\s|\//);if(e||f){let a=[`Unable to register library "${d}" with version "${b}":`];e&&a.push(`library name "${d}" contains illegal characters (whitespace or "/")`),e&&f&&a.push("and"),f&&a.push(`version name "${b}" contains illegal characters (whitespace or "/")`),aJ.warn(a.join(" "));return}aS(new Y(`${d}-version`,()=>({library:d,version:b}),"VERSION"))}function a8(a,b){if(null!==a&&"function"!=typeof a)throw aZ.create("invalid-log-argument");aj(a,b)}function a9(a){ai(a)}let ba="firebase-heartbeat-database",bb=1,bc="firebase-heartbeat-store",bd=null;function be(){return bd||(bd=aA(ba,bb,{upgrade:(a,b)=>{if(0===b)try{a.createObjectStore(bc)}catch(a){console.warn(a)}}}).catch(a=>{throw aZ.create("idb-open",{originalErrorMessage:a.message})})),bd}async function bf(a){try{let b=(await be()).transaction(bc),c=await b.objectStore(bc).get(bh(a));return await b.done,c}catch(a){if(a instanceof K)aJ.warn(a.message);else{let b=aZ.create("idb-get",{originalErrorMessage:a?.message});aJ.warn(b.message)}}}async function bg(a,b){try{let c=(await be()).transaction(bc,"readwrite"),d=c.objectStore(bc);await d.put(b,bh(a)),await c.done}catch(a){if(a instanceof K)aJ.warn(a.message);else{let b=aZ.create("idb-set",{originalErrorMessage:a?.message});aJ.warn(b.message)}}}function bh(a){return`${a.name}!${a.options.appId}`}let bi=1024,bj=30;class bk{constructor(a){this.container=a,this._heartbeatsCache=null;const b=this.container.getProvider("app").getImmediate();this._storage=new bn(b),this._heartbeatsCachePromise=this._storage.read().then(a=>(this._heartbeatsCache=a,a))}async triggerHeartbeat(){try{let a=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),b=bl();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===b||this._heartbeatsCache.heartbeats.some(a=>a.date===b))return;if(this._heartbeatsCache.heartbeats.push({date:b,agent:a}),this._heartbeatsCache.heartbeats.length>bj){let a=bp(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(a){aJ.warn(a)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||0===this._heartbeatsCache.heartbeats.length)return"";let a=bl(),{heartbeatsToSend:b,unsentEntries:c}=bm(this._heartbeatsCache.heartbeats),d=k(JSON.stringify({version:2,heartbeats:b}));return this._heartbeatsCache.lastSentHeartbeatDate=a,c.length>0?(this._heartbeatsCache.heartbeats=c,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),d}catch(a){return aJ.warn(a),""}}}function bl(){return new Date().toISOString().substring(0,10)}function bm(a,b=bi){let c=[],d=a.slice();for(let e of a){let a=c.find(a=>a.agent===e.agent);if(a){if(a.dates.push(e.date),bo(c)>b){a.dates.pop();break}}else if(c.push({agent:e.agent,dates:[e.date]}),bo(c)>b){c.pop();break}d=d.slice(1)}return{heartbeatsToSend:c,unsentEntries:d}}class bn{constructor(a){this.app=a,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!H()&&I().then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let a=await bf(this.app);return a?.heartbeats?a:{heartbeats:[]}}}async overwrite(a){if(await this._canUseIndexedDBPromise){let b=await this.read();return bg(this.app,{lastSentHeartbeatDate:a.lastSentHeartbeatDate??b.lastSentHeartbeatDate,heartbeats:a.heartbeats})}}async add(a){if(await this._canUseIndexedDBPromise){let b=await this.read();return bg(this.app,{lastSentHeartbeatDate:a.lastSentHeartbeatDate??b.lastSentHeartbeatDate,heartbeats:[...b.heartbeats,...a.heartbeats]})}}}function bo(a){return k(JSON.stringify({version:2,heartbeats:a})).length}function bp(a){if(0===a.length)return -1;let b=0,c=a[0].date;for(let d=1;d<a.length;d++)a[d].date<c&&(c=a[d].date,b=d);return b}function bq(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}(function(a){aS(new Y("platform-logger",a=>new aF(a),"PRIVATE")),aS(new Y("heartbeat",a=>new bk(a),"PRIVATE")),a7(aH,aI,""),a7(aH,aI,"esm2020"),a7("fire-js","")})(""),a.s(["SDK_VERSION",()=>a1,"_DEFAULT_ENTRY_NAME",()=>aL,"_addComponent",()=>aQ,"_addOrOverwriteComponent",()=>aR,"_apps",()=>aN,"_clearComponents",()=>aY,"_components",()=>aP,"_getProvider",()=>aT,"_isFirebaseApp",()=>aV,"_isFirebaseServerApp",()=>aX,"_isFirebaseServerAppSettings",()=>aW,"_registerComponent",()=>aS,"_removeServiceInstance",()=>aU,"_serverApps",()=>aO,"deleteApp",()=>a6,"getApp",()=>a4,"getApps",()=>a5,"initializeApp",()=>a2,"initializeServerApp",()=>a3,"onLog",()=>a8,"registerVersion",()=>a7,"setLogLevel",()=>a9],66707),a7("firebase","12.6.0","app"),a.i(66707);let br=bq,bs=new L("auth","Firebase",bq()),bt=new ah("@firebase/auth");function bu(a,...b){bt.logLevel<=de.WARN&&bt.warn(`Auth (${a1}): ${a}`,...b)}function bv(a,...b){bt.logLevel<=de.ERROR&&bt.error(`Auth (${a1}): ${a}`,...b)}function bw(a,...b){throw bA(a,...b)}function bx(a,...b){return bA(a,...b)}function by(a,b,c){return new L("auth","Firebase",{...br(),[b]:c}).create(b,{appName:a.name})}function bz(a){return by(a,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function bA(a,...b){if("string"!=typeof a){let c=b[0],d=[...b.slice(1)];return d[0]&&(d[0].appName=a.name),a._errorFactory.create(c,...d)}return bs.create(a,...b)}function bB(a,b,...c){if(!a)throw bA(b,...c)}function bC(a){let b="INTERNAL ASSERTION FAILED: "+a;throw bv(b),Error(b)}function bD(a,b){a||bC(b)}function bE(){return"http:"===bF()||"https:"===bF()}function bF(){return"undefined"!=typeof self&&self.location?.protocol||null}function bG(){return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(bE()||D()||"connection"in navigator))||navigator.onLine}function bH(){if("undefined"==typeof navigator)return null;let a=navigator;return a.languages&&a.languages[0]||a.language||null}class bI{constructor(a,b){this.shortDelay=a,this.longDelay=b,bD(b>a,"Short delay should be less than long delay!"),this.isMobile=y()||E()}get(){return bG()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function bJ(a,b){bD(a.emulator,"Emulator should always be set here");let{url:c}=a.emulator;return b?`${c}${b.startsWith("/")?b.slice(1):b}`:c}class bK{static initialize(a,b,c){this.fetchImpl=a,b&&(this.headersImpl=b),c&&(this.responseImpl=c)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void bC("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void bC("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void bC("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}let bL={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},bM=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],bN=new bI(3e4,6e4);function bO(a,b){return a.tenantId&&!b.tenantId?{...b,tenantId:a.tenantId}:b}async function bP(a,b,c,d,e={}){return bQ(a,e,async()=>{let e={},f={};d&&("GET"===b?f=d:e={body:JSON.stringify(d)});let g=Q({key:a.config.apiKey,...f}).slice(1),h=await a._getAdditionalHeaders();h["Content-Type"]="application/json",a.languageCode&&(h["X-Firebase-Locale"]=a.languageCode);let i={method:b,headers:h,...e};return C()||(i.referrerPolicy="no-referrer"),a.emulatorConfig&&u(a.emulatorConfig.host)&&(i.credentials="include"),bK.fetch()(await bS(a,a.config.apiHost,c,g),i)})}async function bQ(a,b,c){a._canInitEmulator=!1;let d={...bL,...b};try{let b=new bU(a),e=await Promise.race([c(),b.promise]);b.clearNetworkTimeout();let f=await e.json();if("needConfirmation"in f)throw bV(a,"account-exists-with-different-credential",f);if(e.ok&&!("errorMessage"in f))return f;{let[b,c]=(e.ok?f.errorMessage:f.error.message).split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===b)throw bV(a,"credential-already-in-use",f);if("EMAIL_EXISTS"===b)throw bV(a,"email-already-in-use",f);if("USER_DISABLED"===b)throw bV(a,"user-disabled",f);let g=d[b]||b.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw by(a,g,c);bw(a,g)}}catch(b){if(b instanceof K)throw b;bw(a,"network-request-failed",{message:String(b)})}}async function bR(a,b,c,d,e={}){let f=await bP(a,b,c,d,e);return"mfaPendingCredential"in f&&bw(a,"multi-factor-auth-required",{_serverResponse:f}),f}async function bS(a,b,c,d){let e=`${b}${c}?${d}`,f=a,g=f.config.emulator?bJ(a.config,e):`${a.config.apiScheme}://${e}`;return bM.includes(c)&&(await f._persistenceManagerAvailable,"COOKIE"===f._getPersistenceType())?f._getPersistence()._getFinalTarget(g).toString():g}function bT(a){switch(a){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class bU{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(a){this.auth=a,this.timer=null,this.promise=new Promise((a,b)=>{this.timer=setTimeout(()=>b(bx(this.auth,"network-request-failed")),bN.get())})}}function bV(a,b,c){let d={appName:a.name};c.email&&(d.email=c.email),c.phoneNumber&&(d.phoneNumber=c.phoneNumber);let e=bx(a,b,d);return e.customData._tokenResponse=c,e}function bW(a){return void 0!==a&&void 0!==a.enterprise}class bX{constructor(a){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===a.recaptchaKey)throw Error("recaptchaKey undefined");this.siteKey=a.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=a.recaptchaEnforcementState}getProviderEnforcementState(a){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(let b of this.recaptchaEnforcementState)if(b.provider&&b.provider===a)return bT(b.enforcementState);return null}isProviderEnabled(a){return"ENFORCE"===this.getProviderEnforcementState(a)||"AUDIT"===this.getProviderEnforcementState(a)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function bY(a,b){return bP(a,"GET","/v2/recaptchaConfig",bO(a,b))}async function bZ(a,b){return bP(a,"POST","/v1/accounts:delete",b)}async function b$(a,b){return bP(a,"POST","/v1/accounts:lookup",b)}function b_(a){if(a)try{let b=new Date(Number(a));if(!isNaN(b.getTime()))return b.toUTCString()}catch(a){}}async function b0(a,b=!1){let c=X(a),d=await c.getIdToken(b),e=b2(d);bB(e&&e.exp&&e.auth_time&&e.iat,c.auth,"internal-error");let f="object"==typeof e.firebase?e.firebase:void 0,g=f?.sign_in_provider;return{claims:e,token:d,authTime:b_(b1(e.auth_time)),issuedAtTime:b_(b1(e.iat)),expirationTime:b_(b1(e.exp)),signInProvider:g||null,signInSecondFactor:f?.sign_in_second_factor||null}}function b1(a){return 1e3*Number(a)}function b2(a){let[b,c,d]=a.split(".");if(void 0===b||void 0===c||void 0===d)return bv("JWT malformed, contained fewer than 3 sections"),null;try{let a=l(c);if(!a)return bv("Failed to decode base64 JWT payload"),null;return JSON.parse(a)}catch(a){return bv("Caught error parsing JWT payload as JSON",a?.toString()),null}}function b3(a){let b=b2(a);return bB(b,"internal-error"),bB(void 0!==b.exp,"internal-error"),bB(void 0!==b.iat,"internal-error"),Number(b.exp)-Number(b.iat)}async function b4(a,b,c=!1){if(c)return b;try{return await b}catch(b){throw b instanceof K&&b5(b)&&a.auth.currentUser===a&&await a.auth.signOut(),b}}function b5({code:a}){return"auth/user-disabled"===a||"auth/user-token-expired"===a}class b6{constructor(a){this.user=a,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(a){if(!a)return this.errorBackoff=3e4,Math.max(0,(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5);{let a=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),a}}schedule(a=!1){if(!this.isRunning)return;let b=this.getInterval(a);this.timerId=setTimeout(async()=>{await this.iteration()},b)}async iteration(){try{await this.user.getIdToken(!0)}catch(a){a?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class b7{constructor(a,b){this.createdAt=a,this.lastLoginAt=b,this._initializeTime()}_initializeTime(){this.lastSignInTime=b_(this.lastLoginAt),this.creationTime=b_(this.createdAt)}_copy(a){this.createdAt=a.createdAt,this.lastLoginAt=a.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function b8(a){let b=a.auth,c=await a.getIdToken(),d=await b4(a,b$(b,{idToken:c}));bB(d?.users.length,b,"internal-error");let e=d.users[0];a._notifyReloadListener(e);let f=e.providerUserInfo?.length?cb(e.providerUserInfo):[],g=ca(a.providerData,f),h=a.isAnonymous,i=!(a.email&&e.passwordHash)&&!g?.length,j=!!h&&i;Object.assign(a,{uid:e.localId,displayName:e.displayName||null,photoURL:e.photoUrl||null,email:e.email||null,emailVerified:e.emailVerified||!1,phoneNumber:e.phoneNumber||null,tenantId:e.tenantId||null,providerData:g,metadata:new b7(e.createdAt,e.lastLoginAt),isAnonymous:j})}async function b9(a){let b=X(a);await b8(b),await b.auth._persistUserIfCurrent(b),b.auth._notifyListenersIfCurrent(b)}function ca(a,b){return[...a.filter(a=>!b.some(b=>b.providerId===a.providerId)),...b]}function cb(a){return a.map(({providerId:a,...b})=>({providerId:a,uid:b.rawId||"",displayName:b.displayName||null,email:b.email||null,phoneNumber:b.phoneNumber||null,photoURL:b.photoUrl||null}))}async function cc(a,b){let c=await bQ(a,{},async()=>{let c=Q({grant_type:"refresh_token",refresh_token:b}).slice(1),{tokenApiHost:d,apiKey:e}=a.config,f=await bS(a,d,"/v1/token",`key=${e}`),g=await a._getAdditionalHeaders();g["Content-Type"]="application/x-www-form-urlencoded";let h={method:"POST",headers:g,body:c};return a.emulatorConfig&&u(a.emulatorConfig.host)&&(h.credentials="include"),bK.fetch()(f,h)});return{accessToken:c.access_token,expiresIn:c.expires_in,refreshToken:c.refresh_token}}async function cd(a,b){return bP(a,"POST","/v2/accounts:revokeToken",bO(a,b))}class ce{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(a){bB(a.idToken,"internal-error"),bB(void 0!==a.idToken,"internal-error"),bB(void 0!==a.refreshToken,"internal-error");let b="expiresIn"in a&&void 0!==a.expiresIn?Number(a.expiresIn):b3(a.idToken);this.updateTokensAndExpiration(a.idToken,a.refreshToken,b)}updateFromIdToken(a){bB(0!==a.length,"internal-error");let b=b3(a);this.updateTokensAndExpiration(a,null,b)}async getToken(a,b=!1){return b||!this.accessToken||this.isExpired?(bB(this.refreshToken,a,"user-token-expired"),this.refreshToken)?(await this.refresh(a,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(a,b){let{accessToken:c,refreshToken:d,expiresIn:e}=await cc(a,b);this.updateTokensAndExpiration(c,d,Number(e))}updateTokensAndExpiration(a,b,c){this.refreshToken=b||null,this.accessToken=a||null,this.expirationTime=Date.now()+1e3*c}static fromJSON(a,b){let{refreshToken:c,accessToken:d,expirationTime:e}=b,f=new ce;return c&&(bB("string"==typeof c,"internal-error",{appName:a}),f.refreshToken=c),d&&(bB("string"==typeof d,"internal-error",{appName:a}),f.accessToken=d),e&&(bB("number"==typeof e,"internal-error",{appName:a}),f.expirationTime=e),f}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(a){this.accessToken=a.accessToken,this.refreshToken=a.refreshToken,this.expirationTime=a.expirationTime}_clone(){return Object.assign(new ce,this.toJSON())}_performRefresh(){return bC("not implemented")}}function cf(a,b){bB("string"==typeof a||void 0===a,"internal-error",{appName:b})}class cg{constructor({uid:a,auth:b,stsTokenManager:c,...d}){this.providerId="firebase",this.proactiveRefresh=new b6(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=a,this.auth=b,this.stsTokenManager=c,this.accessToken=c.accessToken,this.displayName=d.displayName||null,this.email=d.email||null,this.emailVerified=d.emailVerified||!1,this.phoneNumber=d.phoneNumber||null,this.photoURL=d.photoURL||null,this.isAnonymous=d.isAnonymous||!1,this.tenantId=d.tenantId||null,this.providerData=d.providerData?[...d.providerData]:[],this.metadata=new b7(d.createdAt||void 0,d.lastLoginAt||void 0)}async getIdToken(a){let b=await b4(this,this.stsTokenManager.getToken(this.auth,a));return bB(b,this.auth,"internal-error"),this.accessToken!==b&&(this.accessToken=b,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),b}getIdTokenResult(a){return b0(this,a)}reload(){return b9(this)}_assign(a){this!==a&&(bB(this.uid===a.uid,this.auth,"internal-error"),this.displayName=a.displayName,this.photoURL=a.photoURL,this.email=a.email,this.emailVerified=a.emailVerified,this.phoneNumber=a.phoneNumber,this.isAnonymous=a.isAnonymous,this.tenantId=a.tenantId,this.providerData=a.providerData.map(a=>({...a})),this.metadata._copy(a.metadata),this.stsTokenManager._assign(a.stsTokenManager))}_clone(a){let b=new cg({...this,auth:a,stsTokenManager:this.stsTokenManager._clone()});return b.metadata._copy(this.metadata),b}_onReload(a){bB(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=a,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(a){this.reloadListener?this.reloadListener(a):this.reloadUserInfo=a}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(a,b=!1){let c=!1;a.idToken&&a.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(a),c=!0),b&&await b8(this),await this.auth._persistUserIfCurrent(this),c&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(aX(this.auth.app))return Promise.reject(bz(this.auth));let a=await this.getIdToken();return await b4(this,bZ(this.auth,{idToken:a})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(a=>({...a})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(a,b){let c=b.displayName??void 0,d=b.email??void 0,e=b.phoneNumber??void 0,f=b.photoURL??void 0,g=b.tenantId??void 0,h=b._redirectEventId??void 0,i=b.createdAt??void 0,j=b.lastLoginAt??void 0,{uid:k,emailVerified:l,isAnonymous:m,providerData:n,stsTokenManager:o}=b;bB(k&&o,a,"internal-error");let p=ce.fromJSON(this.name,o);bB("string"==typeof k,a,"internal-error"),cf(c,a.name),cf(d,a.name),bB("boolean"==typeof l,a,"internal-error"),bB("boolean"==typeof m,a,"internal-error"),cf(e,a.name),cf(f,a.name),cf(g,a.name),cf(h,a.name),cf(i,a.name),cf(j,a.name);let q=new cg({uid:k,auth:a,email:d,emailVerified:l,displayName:c,isAnonymous:m,photoURL:f,phoneNumber:e,tenantId:g,stsTokenManager:p,createdAt:i,lastLoginAt:j});return n&&Array.isArray(n)&&(q.providerData=n.map(a=>({...a}))),h&&(q._redirectEventId=h),q}static async _fromIdTokenResponse(a,b,c=!1){let d=new ce;d.updateFromServerResponse(b);let e=new cg({uid:b.localId,auth:a,stsTokenManager:d,isAnonymous:c});return await b8(e),e}static async _fromGetAccountInfoResponse(a,b,c){let d=b.users[0];bB(void 0!==d.localId,"internal-error");let e=void 0!==d.providerUserInfo?cb(d.providerUserInfo):[],f=!(d.email&&d.passwordHash)&&!e?.length,g=new ce;g.updateFromIdToken(c);let h=new cg({uid:d.localId,auth:a,stsTokenManager:g,isAnonymous:f});return Object.assign(h,{uid:d.localId,displayName:d.displayName||null,photoURL:d.photoUrl||null,email:d.email||null,emailVerified:d.emailVerified||!1,phoneNumber:d.phoneNumber||null,tenantId:d.tenantId||null,providerData:e,metadata:new b7(d.createdAt,d.lastLoginAt),isAnonymous:!(d.email&&d.passwordHash)&&!e?.length}),h}}let ch=new Map;function ci(a){bD(a instanceof Function,"Expected a class definition");let b=ch.get(a);return b?bD(b instanceof a,"Instance stored in cache mismatched with class"):(b=new a,ch.set(a,b)),b}class cj{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(a,b){this.storage[a]=b}async _get(a){let b=this.storage[a];return void 0===b?null:b}async _remove(a){delete this.storage[a]}_addListener(a,b){}_removeListener(a,b){}}cj.type="NONE";let ck=cj;function cl(a,b,c){return`firebase:${a}:${b}:${c}`}class cm{constructor(a,b,c){this.persistence=a,this.auth=b,this.userKey=c;const{config:d,name:e}=this.auth;this.fullUserKey=cl(this.userKey,d.apiKey,e),this.fullPersistenceKey=cl("persistence",d.apiKey,e),this.boundEventHandler=b._onStorageEvent.bind(b),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(a){return this.persistence._set(this.fullUserKey,a.toJSON())}async getCurrentUser(){let a=await this.persistence._get(this.fullUserKey);if(!a)return null;if("string"==typeof a){let b=await b$(this.auth,{idToken:a}).catch(()=>void 0);return b?cg._fromGetAccountInfoResponse(this.auth,b,a):null}return cg._fromJSON(this.auth,a)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(a){if(this.persistence===a)return;let b=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=a,b)return this.setCurrentUser(b)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(a,b,c="authUser"){if(!b.length)return new cm(ci(ck),a,c);let d=(await Promise.all(b.map(async a=>{if(await a._isAvailable())return a}))).filter(a=>a),e=d[0]||ci(ck),f=cl(c,a.config.apiKey,a.name),g=null;for(let c of b)try{let b=await c._get(f);if(b){let d;if("string"==typeof b){let c=await b$(a,{idToken:b}).catch(()=>void 0);if(!c)break;d=await cg._fromGetAccountInfoResponse(a,c,b)}else d=cg._fromJSON(a,b);c!==e&&(g=d),e=c;break}}catch{}let h=d.filter(a=>a._shouldAllowMigration);return e._shouldAllowMigration&&h.length&&(e=h[0],g&&await e._set(f,g.toJSON()),await Promise.all(b.map(async a=>{if(a!==e)try{await a._remove(f)}catch{}}))),new cm(e,a,c)}}function cn(a){let b=a.toLowerCase();if(b.includes("opera/")||b.includes("opr/")||b.includes("opios/"))return"Opera";{if(cr(b))return"IEMobile";if(b.includes("msie")||b.includes("trident/"))return"IE";if(b.includes("edge/"))return"Edge";if(co(b))return"Firefox";if(b.includes("silk/"))return"Silk";if(ct(b))return"Blackberry";if(cu(b))return"Webos";if(cp(b))return"Safari";if((b.includes("chrome/")||cq(b))&&!b.includes("edge/"))return"Chrome";if(cs(b))return"Android";let c=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,d=a.match(c);if(d?.length===2)return d[1]}return"Other"}function co(a=x()){return/firefox\//i.test(a)}function cp(a=x()){let b=a.toLowerCase();return b.includes("safari/")&&!b.includes("chrome/")&&!b.includes("crios/")&&!b.includes("android")}function cq(a=x()){return/crios\//i.test(a)}function cr(a=x()){return/iemobile/i.test(a)}function cs(a=x()){return/android/i.test(a)}function ct(a=x()){return/blackberry/i.test(a)}function cu(a=x()){return/webos/i.test(a)}function cv(a,b=[]){let c;switch(a){case"Browser":c=cn(x());break;case"Worker":c=`${cn(x())}-${a}`;break;default:c=a}let d=b.length?b.join(","):"FirebaseCore-web";return`${c}/JsCore/${a1}/${d}`}class cw{constructor(a){this.auth=a,this.queue=[]}pushCallback(a,b){let c=b=>new Promise((c,d)=>{try{let d=a(b);c(d)}catch(a){d(a)}});c.onAbort=b,this.queue.push(c);let d=this.queue.length-1;return()=>{this.queue[d]=()=>Promise.resolve()}}async runMiddleware(a){if(this.auth.currentUser===a)return;let b=[];try{for(let c of this.queue)await c(a),c.onAbort&&b.push(c.onAbort)}catch(a){for(let a of(b.reverse(),b))try{a()}catch(a){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:a?.message})}}}async function cx(a,b={}){return bP(a,"GET","/v2/passwordPolicy",bO(a,b))}let cy=6;class cz{constructor(a){const b=a.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=b.minPasswordLength??cy,b.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=b.maxPasswordLength),void 0!==b.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=b.containsLowercaseCharacter),void 0!==b.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=b.containsUppercaseCharacter),void 0!==b.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=b.containsNumericCharacter),void 0!==b.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=b.containsNonAlphanumericCharacter),this.enforcementState=a.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=a.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=a.forceUpgradeOnSignin??!1,this.schemaVersion=a.schemaVersion}validatePassword(a){let b={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(a,b),this.validatePasswordCharacterOptions(a,b),b.isValid&&(b.isValid=b.meetsMinPasswordLength??!0),b.isValid&&(b.isValid=b.meetsMaxPasswordLength??!0),b.isValid&&(b.isValid=b.containsLowercaseLetter??!0),b.isValid&&(b.isValid=b.containsUppercaseLetter??!0),b.isValid&&(b.isValid=b.containsNumericCharacter??!0),b.isValid&&(b.isValid=b.containsNonAlphanumericCharacter??!0),b}validatePasswordLengthOptions(a,b){let c=this.customStrengthOptions.minPasswordLength,d=this.customStrengthOptions.maxPasswordLength;c&&(b.meetsMinPasswordLength=a.length>=c),d&&(b.meetsMaxPasswordLength=a.length<=d)}validatePasswordCharacterOptions(a,b){let c;this.updatePasswordCharacterOptionsStatuses(b,!1,!1,!1,!1);for(let d=0;d<a.length;d++)c=a.charAt(d),this.updatePasswordCharacterOptionsStatuses(b,c>="a"&&c<="z",c>="A"&&c<="Z",c>="0"&&c<="9",this.allowedNonAlphanumericCharacters.includes(c))}updatePasswordCharacterOptionsStatuses(a,b,c,d,e){this.customStrengthOptions.containsLowercaseLetter&&(a.containsLowercaseLetter||(a.containsLowercaseLetter=b)),this.customStrengthOptions.containsUppercaseLetter&&(a.containsUppercaseLetter||(a.containsUppercaseLetter=c)),this.customStrengthOptions.containsNumericCharacter&&(a.containsNumericCharacter||(a.containsNumericCharacter=d)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(a.containsNonAlphanumericCharacter||(a.containsNonAlphanumericCharacter=e))}}class cA{constructor(a,b,c,d){this.app=a,this.heartbeatServiceProvider=b,this.appCheckServiceProvider=c,this.config=d,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new cC(this),this.idTokenSubscription=new cC(this),this.beforeStateQueue=new cw(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=bs,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=a.name,this.clientVersion=d.sdkClientVersion,this._persistenceManagerAvailable=new Promise(a=>this._resolvePersistenceManagerAvailable=a)}_initializeWithPersistence(a,b){return b&&(this._popupRedirectResolver=ci(b)),this._initializationPromise=this.queue(async()=>{if(!this._deleted){if(this.persistenceManager=await cm.create(this,a),this._resolvePersistenceManagerAvailable?.(),!this._deleted){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(a){}await this.initializeCurrentUser(b),this.lastNotifiedUid=this.currentUser?.uid||null,this._deleted||(this._isInitialized=!0)}}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;let a=await this.assertedPersistence.getCurrentUser();if(this.currentUser||a){if(this.currentUser&&a&&this.currentUser.uid===a.uid){this._currentUser._assign(a),await this.currentUser.getIdToken();return}await this._updateCurrentUser(a,!0)}}async initializeCurrentUserFromIdToken(a){try{let b=await b$(this,{idToken:a}),c=await cg._fromGetAccountInfoResponse(this,b,a);await this.directlySetCurrentUser(c)}catch(a){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",a),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(a){if(aX(this.app)){let a=this.app.settings.authIdToken;return a?new Promise(b=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(b,b))}):this.directlySetCurrentUser(null)}let b=await this.assertedPersistence.getCurrentUser(),c=b,d=!1;if(a&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();let b=this.redirectUser?._redirectEventId,e=c?._redirectEventId,f=await this.tryRedirectSignIn(a);(!b||b===e)&&f?.user&&(c=f.user,d=!0)}if(!c)return this.directlySetCurrentUser(null);if(!c._redirectEventId){if(d)try{await this.beforeStateQueue.runMiddleware(c)}catch(a){c=b,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return c?this.reloadAndSetCurrentUserOrClear(c):this.directlySetCurrentUser(null)}return(bB(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===c._redirectEventId)?this.directlySetCurrentUser(c):this.reloadAndSetCurrentUserOrClear(c)}async tryRedirectSignIn(a){let b=null;try{b=await this._popupRedirectResolver._completeRedirectFn(this,a,!0)}catch(a){await this._setRedirectUser(null)}return b}async reloadAndSetCurrentUserOrClear(a){try{await b8(a)}catch(a){if(a?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(a)}useDeviceLanguage(){this.languageCode=bH()}async _delete(){this._deleted=!0}async updateCurrentUser(a){if(aX(this.app))return Promise.reject(bz(this));let b=a?X(a):null;return b&&bB(b.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(b&&b._clone(this))}async _updateCurrentUser(a,b=!1){if(!this._deleted)return a&&bB(this.tenantId===a.tenantId,this,"tenant-id-mismatch"),b||await this.beforeStateQueue.runMiddleware(a),this.queue(async()=>{await this.directlySetCurrentUser(a),this.notifyAuthListeners()})}async signOut(){return aX(this.app)?Promise.reject(bz(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(a){return aX(this.app)?Promise.reject(bz(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(ci(a))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(a){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();let b=this._getPasswordPolicyInternal();return b.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):b.validatePassword(a)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){let a=new cz(await cx(this));null===this.tenantId?this._projectPasswordPolicy=a:this._tenantPasswordPolicies[this.tenantId]=a}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(a){this._errorFactory=new L("auth","Firebase",a())}onAuthStateChanged(a,b,c){return this.registerStateListener(this.authStateSubscription,a,b,c)}beforeAuthStateChanged(a,b){return this.beforeStateQueue.pushCallback(a,b)}onIdTokenChanged(a,b,c){return this.registerStateListener(this.idTokenSubscription,a,b,c)}authStateReady(){return new Promise((a,b)=>{if(this.currentUser)a();else{let c=this.onAuthStateChanged(()=>{c(),a()},b)}})}async revokeAccessToken(a){if(this.currentUser){let b={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:a,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(b.tenantId=this.tenantId),await cd(this,b)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(a,b){let c=await this.getOrInitRedirectPersistenceManager(b);return null===a?c.removeCurrentUser():c.setCurrentUser(a)}async getOrInitRedirectPersistenceManager(a){if(!this.redirectPersistenceManager){let b=a&&ci(a)||this._popupRedirectResolver;bB(b,this,"argument-error"),this.redirectPersistenceManager=await cm.create(this,[ci(b._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(a){return(this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===a)?this._currentUser:this.redirectUser?._redirectEventId===a?this.redirectUser:null}async _persistUserIfCurrent(a){if(a===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(a))}_notifyListenersIfCurrent(a){a===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let a=this.currentUser?.uid??null;this.lastNotifiedUid!==a&&(this.lastNotifiedUid=a,this.authStateSubscription.next(this.currentUser))}registerStateListener(a,b,c,d){if(this._deleted)return()=>{};let e="function"==typeof b?b:b.next.bind(b),f=!1,g=this._isInitialized?Promise.resolve():this._initializationPromise;if(bB(g,this,"internal-error"),g.then(()=>{f||e(this.currentUser)}),"function"==typeof b){let e=a.addObserver(b,c,d);return()=>{f=!0,e()}}{let c=a.addObserver(b);return()=>{f=!0,c()}}}async directlySetCurrentUser(a){this.currentUser&&this.currentUser!==a&&this._currentUser._stopProactiveRefresh(),a&&this.isProactiveRefreshEnabled&&a._startProactiveRefresh(),this.currentUser=a,a?await this.assertedPersistence.setCurrentUser(a):await this.assertedPersistence.removeCurrentUser()}queue(a){return this.operations=this.operations.then(a,a),this.operations}get assertedPersistence(){return bB(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(a){!a||this.frameworks.includes(a)||(this.frameworks.push(a),this.frameworks.sort(),this.clientVersion=cv(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){let a={"X-Client-Version":this.clientVersion};this.app.options.appId&&(a["X-Firebase-gmpid"]=this.app.options.appId);let b=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();b&&(a["X-Firebase-Client"]=b);let c=await this._getAppCheckToken();return c&&(a["X-Firebase-AppCheck"]=c),a}async _getAppCheckToken(){if(aX(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let a=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return a?.error&&bu(`Error while retrieving App Check token: ${a.error}`),a?.token}}function cB(a){return X(a)}class cC{constructor(a){this.auth=a,this.observer=null,this.addObserver=T(a=>this.observer=a)}get next(){return bB(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}class cD{constructor(){this.enterprise=new cE}ready(a){a()}execute(a,b){return Promise.resolve("token")}render(a,b){return""}}class cE{ready(a){a()}execute(a,b){return Promise.resolve("token")}render(a,b){return""}}let cF="recaptcha-enterprise",cG="NO_RECAPTCHA";class cH{constructor(a){this.type=cF,this.auth=cB(a)}async verify(a="verify",b=!1){async function c(a){if(!b){if(null==a.tenantId&&null!=a._agentRecaptchaConfig)return a._agentRecaptchaConfig.siteKey;if(null!=a.tenantId&&void 0!==a._tenantRecaptchaConfigs[a.tenantId])return a._tenantRecaptchaConfigs[a.tenantId].siteKey}return new Promise(async(b,c)=>{bY(a,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(d=>{if(void 0===d.recaptchaKey)c(Error("recaptcha Enterprise site key undefined"));else{let c=new bX(d);return null==a.tenantId?a._agentRecaptchaConfig=c:a._tenantRecaptchaConfigs[a.tenantId]=c,b(c.siteKey)}}).catch(a=>{c(a)})})}function d(b,c,d){let e=window.grecaptcha;bW(e)?e.enterprise.ready(()=>{e.enterprise.execute(b,{action:a}).then(a=>{c(a)}).catch(()=>{c(cG)})}):d(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new cD().execute("siteKey",{action:"verify"}):new Promise((a,e)=>{c(this.auth).then(c=>{!b&&bW(window.grecaptcha)?d(c,a,e):e(Error("RecaptchaVerifier is only supported in browser"))}).catch(a=>{e(a)})})}}async function cI(a,b,c,d=!1,e=!1){let f,g=new cH(a);if(e)f=cG;else try{f=await g.verify(c)}catch(a){f=await g.verify(c,!0)}let h={...b};if("mfaSmsEnrollment"===c||"mfaSmsSignIn"===c){if("phoneEnrollmentInfo"in h){let a=h.phoneEnrollmentInfo.phoneNumber,b=h.phoneEnrollmentInfo.recaptchaToken;Object.assign(h,{phoneEnrollmentInfo:{phoneNumber:a,recaptchaToken:b,captchaResponse:f,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in h){let a=h.phoneSignInInfo.recaptchaToken;Object.assign(h,{phoneSignInInfo:{recaptchaToken:a,captchaResponse:f,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return h}return d?Object.assign(h,{captchaResp:f}):Object.assign(h,{captchaResponse:f}),Object.assign(h,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(h,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),h}async function cJ(a,b,c,d,e){if("EMAIL_PASSWORD_PROVIDER"===e)if(!a._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER"))return d(a,b).catch(async e=>{if("auth/missing-recaptcha-token"!==e.code)return Promise.reject(e);{console.log(`${c} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let e=await cI(a,b,c,"getOobCode"===c);return d(a,e)}});else{let e=await cI(a,b,c,"getOobCode"===c);return d(a,e)}if("PHONE_PROVIDER"!==e)return Promise.reject(e+" provider is not supported.");if(a._getRecaptchaConfig()?.isProviderEnabled("PHONE_PROVIDER")){let e=await cI(a,b,c);return d(a,e).catch(async e=>{if(a._getRecaptchaConfig()?.getProviderEnforcementState("PHONE_PROVIDER")==="AUDIT"&&("auth/missing-recaptcha-token"===e.code||"auth/invalid-app-credential"===e.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${c} flow.`);let e=await cI(a,b,c,!1,!0);return d(a,e)}return Promise.reject(e)})}{let e=await cI(a,b,c,!1,!0);return d(a,e)}}function cK(a,b){let c=aT(a,"auth");if(c.isInitialized()){let a=c.getImmediate();if(O(c.getOptions(),b??{}))return a;bw(a,"already-initialized")}return c.initialize({options:b})}function cL(a,b){let c=b?.persistence||[],d=(Array.isArray(c)?c:[c]).map(ci);b?.errorMap&&a._updateErrorMap(b.errorMap),a._initializeWithPersistence(d,b?.popupRedirectResolver)}function cM(a,b,c){let d=cB(a);bB(/^https?:\/\//.test(b),d,"invalid-emulator-scheme");let e=!!c?.disableWarnings,f=cN(b),{host:g,port:h}=cO(b),i=null===h?"":`:${h}`,j={url:`${f}//${g}${i}/`},k=Object.freeze({host:g,port:h,protocol:f.replace(":",""),options:Object.freeze({disableWarnings:e})});if(!d._canInitEmulator){bB(d.config.emulator&&d.emulatorConfig,d,"emulator-config-failed"),bB(O(j,d.config.emulator)&&O(k,d.emulatorConfig),d,"emulator-config-failed");return}d.config.emulator=j,d.emulatorConfig=k,d.settings.appVerificationDisabledForTesting=!0,u(g)?(v(`${f}//${g}${i}`),w("Auth",!0)):e||cQ()}function cN(a){let b=a.indexOf(":");return b<0?"":a.substr(0,b+1)}function cO(a){let b=cN(a),c=/(\/\/)?([^?#/]+)/.exec(a.substr(b.length));if(!c)return{host:"",port:null};let d=c[2].split("@").pop()||"",e=/^(\[[^\]]+\])(:|$)/.exec(d);if(e){let a=e[1];return{host:a,port:cP(d.substr(a.length+1))}}{let[a,b]=d.split(":");return{host:a,port:cP(b)}}}function cP(a){if(!a)return null;let b=Number(a);return isNaN(b)?null:b}function cQ(){"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.")}class cR{constructor(a,b){this.providerId=a,this.signInMethod=b}toJSON(){return bC("not implemented")}_getIdTokenResponse(a){return bC("not implemented")}_linkToIdToken(a,b){return bC("not implemented")}_getReauthenticationResolver(a){return bC("not implemented")}}async function cS(a,b){return bP(a,"POST","/v1/accounts:signUp",b)}async function cT(a,b){return bR(a,"POST","/v1/accounts:signInWithPassword",bO(a,b))}async function cU(a,b){return bR(a,"POST","/v1/accounts:signInWithEmailLink",bO(a,b))}async function cV(a,b){return bR(a,"POST","/v1/accounts:signInWithEmailLink",bO(a,b))}class cW extends cR{constructor(a,b,c,d=null){super("password",c),this._email=a,this._password=b,this._tenantId=d}static _fromEmailAndPassword(a,b){return new cW(a,b,"password")}static _fromEmailAndCode(a,b,c=null){return new cW(a,b,"emailLink",c)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(a){let b="string"==typeof a?JSON.parse(a):a;if(b?.email&&b?.password){if("password"===b.signInMethod)return this._fromEmailAndPassword(b.email,b.password);else if("emailLink"===b.signInMethod)return this._fromEmailAndCode(b.email,b.password,b.tenantId)}return null}async _getIdTokenResponse(a){switch(this.signInMethod){case"password":return cJ(a,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",cT,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return cU(a,{email:this._email,oobCode:this._password});default:bw(a,"internal-error")}}async _linkToIdToken(a,b){switch(this.signInMethod){case"password":return cJ(a,{idToken:b,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",cS,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return cV(a,{idToken:b,email:this._email,oobCode:this._password});default:bw(a,"internal-error")}}_getReauthenticationResolver(a){return this._getIdTokenResponse(a)}}async function cX(a,b){return bR(a,"POST","/v1/accounts:signInWithIdp",bO(a,b))}let cY="http://localhost";class cZ extends cR{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(a){let b=new cZ(a.providerId,a.signInMethod);return a.idToken||a.accessToken?(a.idToken&&(b.idToken=a.idToken),a.accessToken&&(b.accessToken=a.accessToken),a.nonce&&!a.pendingToken&&(b.nonce=a.nonce),a.pendingToken&&(b.pendingToken=a.pendingToken)):a.oauthToken&&a.oauthTokenSecret?(b.accessToken=a.oauthToken,b.secret=a.oauthTokenSecret):bw("argument-error"),b}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(a){let{providerId:b,signInMethod:c,...d}="string"==typeof a?JSON.parse(a):a;if(!b||!c)return null;let e=new cZ(b,c);return e.idToken=d.idToken||void 0,e.accessToken=d.accessToken||void 0,e.secret=d.secret,e.nonce=d.nonce,e.pendingToken=d.pendingToken||null,e}_getIdTokenResponse(a){return cX(a,this.buildRequest())}_linkToIdToken(a,b){let c=this.buildRequest();return c.idToken=b,cX(a,c)}_getReauthenticationResolver(a){let b=this.buildRequest();return b.autoCreate=!1,cX(a,b)}buildRequest(){let a={requestUri:cY,returnSecureToken:!0};if(this.pendingToken)a.pendingToken=this.pendingToken;else{let b={};this.idToken&&(b.id_token=this.idToken),this.accessToken&&(b.access_token=this.accessToken),this.secret&&(b.oauth_token_secret=this.secret),b.providerId=this.providerId,this.nonce&&!this.pendingToken&&(b.nonce=this.nonce),a.postBody=Q(b)}return a}}function c$(a){switch(a){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function c_(a){let b=R(S(a)).link,c=b?R(S(b)).deep_link_id:null,d=R(S(a)).deep_link_id;return(d?R(S(d)).link:null)||d||c||b||a}class c0{constructor(a){const b=R(S(a)),c=b.apiKey??null,d=b.oobCode??null,e=c$(b.mode??null);bB(c&&d&&e,"argument-error"),this.apiKey=c,this.operation=e,this.code=d,this.continueUrl=b.continueUrl??null,this.languageCode=b.lang??null,this.tenantId=b.tenantId??null}static parseLink(a){let b=c_(a);try{return new c0(b)}catch{return null}}}class c1{constructor(){this.providerId=c1.PROVIDER_ID}static credential(a,b){return cW._fromEmailAndPassword(a,b)}static credentialWithLink(a,b){let c=c0.parseLink(b);return bB(c,"argument-error"),cW._fromEmailAndCode(a,c.code,c.tenantId)}}c1.PROVIDER_ID="password",c1.EMAIL_PASSWORD_SIGN_IN_METHOD="password",c1.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class c2{constructor(a){this.providerId=a,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(a){this.defaultLanguageCode=a}setCustomParameters(a){return this.customParameters=a,this}getCustomParameters(){return this.customParameters}}class c3 extends c2{constructor(){super(...arguments),this.scopes=[]}addScope(a){return this.scopes.includes(a)||this.scopes.push(a),this}getScopes(){return[...this.scopes]}}class c4 extends c3{constructor(){super("facebook.com")}static credential(a){return cZ._fromParams({providerId:c4.PROVIDER_ID,signInMethod:c4.FACEBOOK_SIGN_IN_METHOD,accessToken:a})}static credentialFromResult(a){return c4.credentialFromTaggedObject(a)}static credentialFromError(a){return c4.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a||!("oauthAccessToken"in a)||!a.oauthAccessToken)return null;try{return c4.credential(a.oauthAccessToken)}catch{return null}}}c4.FACEBOOK_SIGN_IN_METHOD="facebook.com",c4.PROVIDER_ID="facebook.com";class c5 extends c3{constructor(){super("google.com"),this.addScope("profile")}static credential(a,b){return cZ._fromParams({providerId:c5.PROVIDER_ID,signInMethod:c5.GOOGLE_SIGN_IN_METHOD,idToken:a,accessToken:b})}static credentialFromResult(a){return c5.credentialFromTaggedObject(a)}static credentialFromError(a){return c5.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;let{oauthIdToken:b,oauthAccessToken:c}=a;if(!b&&!c)return null;try{return c5.credential(b,c)}catch{return null}}}c5.GOOGLE_SIGN_IN_METHOD="google.com",c5.PROVIDER_ID="google.com";class c6 extends c3{constructor(){super("github.com")}static credential(a){return cZ._fromParams({providerId:c6.PROVIDER_ID,signInMethod:c6.GITHUB_SIGN_IN_METHOD,accessToken:a})}static credentialFromResult(a){return c6.credentialFromTaggedObject(a)}static credentialFromError(a){return c6.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a||!("oauthAccessToken"in a)||!a.oauthAccessToken)return null;try{return c6.credential(a.oauthAccessToken)}catch{return null}}}c6.GITHUB_SIGN_IN_METHOD="github.com",c6.PROVIDER_ID="github.com";class c7 extends c3{constructor(){super("twitter.com")}static credential(a,b){return cZ._fromParams({providerId:c7.PROVIDER_ID,signInMethod:c7.TWITTER_SIGN_IN_METHOD,oauthToken:a,oauthTokenSecret:b})}static credentialFromResult(a){return c7.credentialFromTaggedObject(a)}static credentialFromError(a){return c7.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;let{oauthAccessToken:b,oauthTokenSecret:c}=a;if(!b||!c)return null;try{return c7.credential(b,c)}catch{return null}}}c7.TWITTER_SIGN_IN_METHOD="twitter.com",c7.PROVIDER_ID="twitter.com";class c8{constructor(a,b){this.factorId=a,this.uid=b.mfaEnrollmentId,this.enrollmentTime=new Date(b.enrolledAt).toUTCString(),this.displayName=b.displayName}static _fromServerResponse(a,b){return"phoneInfo"in b?c9._fromServerResponse(a,b):"totpInfo"in b?da._fromServerResponse(a,b):bw(a,"internal-error")}}class c9 extends c8{constructor(a){super("phone",a),this.phoneNumber=a.phoneInfo}static _fromServerResponse(a,b){return new c9(b)}}class da extends c8{constructor(a){super("totp",a)}static _fromServerResponse(a,b){return new da(b)}}function db(a){return X(a).signOut()}function dc(a,b){return bP(a,"POST","/v2/accounts/mfaEnrollment:start",bO(a,b))}function dd(a,b){return bP(a,"POST","/v2/accounts/mfaEnrollment:finalize",bO(a,b))}new WeakMap;var de,df,dg,dh,di,dj="@firebase/auth",dk="1.11.1";class dl{constructor(a){this.auth=a,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(a){return(this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser)?{accessToken:await this.auth.currentUser.getIdToken(a)}:null}addAuthTokenListener(a){if(this.assertAuthConfigured(),this.internalListeners.has(a))return;let b=this.auth.onIdTokenChanged(b=>{a(b?.stsTokenManager.accessToken||null)});this.internalListeners.set(a,b),this.updateProactiveRefresh()}removeAuthTokenListener(a){this.assertAuthConfigured();let b=this.internalListeners.get(a);b&&(this.internalListeners.delete(a),b(),this.updateProactiveRefresh())}assertAuthConfigured(){bB(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function dm(a){switch(a){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function dn(a){aS(new Y("auth",(b,{options:c})=>{let d=b.getProvider("app").getImmediate(),e=b.getProvider("heartbeat"),f=b.getProvider("app-check-internal"),{apiKey:g,authDomain:h}=d.options;bB(g&&!g.includes(":"),"invalid-api-key",{appName:d.name});let i=new cA(d,e,f,{apiKey:g,authDomain:h,clientPlatform:a,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:cv(a)});return cL(i,c),i},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((a,b,c)=>{a.getProvider("auth-internal").initialize()})),aS(new Y("auth-internal",a=>new dl(cB(a.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),a7(dj,dk,dm(a)),a7(dj,dk,"esm2020")}function dp(a=a4()){let b=aT(a,"auth");if(b.isInitialized())return b.getImmediate();let c=cK(a),d=r("auth");return d&&cM(c,`http://${d}`),c}bK.initialize(fetch,Headers,Response),dn("Node");let dq=bx("operation-not-supported-in-this-environment"),dr=async function(){throw dq};function ds(a,b){return bP(a,"POST","/v2/accounts/mfaSignIn:finalize",bO(a,b))}cA.prototype.setPersistence=async()=>{};class dt{constructor(a){this.factorId=a}_process(a,b,c){switch(b.type){case"enroll":return this._finalizeEnroll(a,b.credential,c);case"signin":return this._finalizeSignIn(a,b.credential);default:return bC("unexpected MultiFactorSessionType")}}}class du{static assertionForEnrollment(a,b){return dv._fromSecret(a,b)}static assertionForSignIn(a,b){return dv._fromEnrollmentId(a,b)}static async generateSecret(a){let b=a;bB(void 0!==b.user?.auth,"internal-error");let c=await dc(b.user.auth,{idToken:b.credential,totpEnrollmentInfo:{}});return dw._fromStartTotpMfaEnrollmentResponse(c,b.user.auth)}}du.FACTOR_ID="totp";class dv extends dt{constructor(a,b,c){super("totp"),this.otp=a,this.enrollmentId=b,this.secret=c}static _fromSecret(a,b){return new dv(b,void 0,a)}static _fromEnrollmentId(a,b){return new dv(b,a)}async _finalizeEnroll(a,b,c){return bB(void 0!==this.secret,a,"argument-error"),dd(a,{idToken:b,displayName:c,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(a,b){bB(void 0!==this.enrollmentId&&void 0!==this.otp,a,"argument-error");let c={verificationCode:this.otp};return ds(a,{mfaPendingCredential:b,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:c})}}class dw{constructor(a,b,c,d,e,f,g){this.sessionInfo=f,this.auth=g,this.secretKey=a,this.hashingAlgorithm=b,this.codeLength=c,this.codeIntervalSeconds=d,this.enrollmentCompletionDeadline=e}static _fromStartTotpMfaEnrollmentResponse(a,b){return new dw(a.totpSessionInfo.sharedSecretKey,a.totpSessionInfo.hashingAlgorithm,a.totpSessionInfo.verificationCodeLength,a.totpSessionInfo.periodSec,new Date(a.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),a.totpSessionInfo.sessionInfo,b)}_makeTotpVerificationInfo(a){return{sessionInfo:this.sessionInfo,verificationCode:a}}generateQrCodeUrl(a,b){let c=!1;return(dx(a)||dx(b))&&(c=!0),c&&(dx(a)&&(a=this.auth.currentUser?.email||"unknownuser"),dx(b)&&(b=this.auth.name)),`otpauth://totp/${b}:${a}?secret=${this.secretKey}&issuer=${b}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function dx(a){return void 0===a||a?.length===0}a.s([],19497),a.s([],93396),a.i(19497),a.s(["GoogleAuthProvider",()=>c5,"getAuth",()=>dp,"signInWithPopup",()=>dr,"signOut",()=>db],79431);var dy=a.i(24361),dz="undefined"!=typeof globalThis?globalThis:a.g,dA={};(function(){function a(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.C=Array(this.blockSize),this.o=this.h=0,this.u()}function b(a,b,c){c||(c=0);let d=Array(16);if("string"==typeof b)for(var e=0;e<16;++e)d[e]=b.charCodeAt(c++)|b.charCodeAt(c++)<<8|b.charCodeAt(c++)<<16|b.charCodeAt(c++)<<24;else for(e=0;e<16;++e)d[e]=b[c++]|b[c++]<<8|b[c++]<<16|b[c++]<<24;b=a.g[0],c=a.g[1],e=a.g[2];let f=a.g[3],g;g=b+(f^c&(e^f))+d[0]+0xd76aa478|0,g=f+(e^(b=c+(g<<7|g>>>25))&(c^e))+d[1]+0xe8c7b756|0,g=e+(c^(f=b+(g<<12|g>>>20))&(b^c))+d[2]+0x242070db|0,g=c+(b^(e=f+(g<<17|g>>>15))&(f^b))+d[3]+0xc1bdceee|0,g=b+(f^(c=e+(g<<22|g>>>10))&(e^f))+d[4]+0xf57c0faf|0,g=f+(e^(b=c+(g<<7|g>>>25))&(c^e))+d[5]+0x4787c62a|0,g=e+(c^(f=b+(g<<12|g>>>20))&(b^c))+d[6]+0xa8304613|0,g=c+(b^(e=f+(g<<17|g>>>15))&(f^b))+d[7]+0xfd469501|0,g=b+(f^(c=e+(g<<22|g>>>10))&(e^f))+d[8]+0x698098d8|0,g=f+(e^(b=c+(g<<7|g>>>25))&(c^e))+d[9]+0x8b44f7af|0,g=e+(c^(f=b+(g<<12|g>>>20))&(b^c))+d[10]+0xffff5bb1|0,g=c+(b^(e=f+(g<<17|g>>>15))&(f^b))+d[11]+0x895cd7be|0,g=b+(f^(c=e+(g<<22|g>>>10))&(e^f))+d[12]+0x6b901122|0,g=f+(e^(b=c+(g<<7|g>>>25))&(c^e))+d[13]+0xfd987193|0,g=e+(c^(f=b+(g<<12|g>>>20))&(b^c))+d[14]+0xa679438e|0,g=c+(b^(e=f+(g<<17|g>>>15))&(f^b))+d[15]+0x49b40821|0,c=e+(g<<22|g>>>10),g=b+(e^f&(c^e))+d[1]+0xf61e2562|0,b=c+(g<<5|g>>>27),g=f+(c^e&(b^c))+d[6]+0xc040b340|0,f=b+(g<<9|g>>>23),g=e+(b^c&(f^b))+d[11]+0x265e5a51|0,e=f+(g<<14|g>>>18),g=c+(f^b&(e^f))+d[0]+0xe9b6c7aa|0,c=e+(g<<20|g>>>12),g=b+(e^f&(c^e))+d[5]+0xd62f105d|0,b=c+(g<<5|g>>>27),g=f+(c^e&(b^c))+d[10]+0x2441453|0,f=b+(g<<9|g>>>23),g=e+(b^c&(f^b))+d[15]+0xd8a1e681|0,e=f+(g<<14|g>>>18),g=c+(f^b&(e^f))+d[4]+0xe7d3fbc8|0,c=e+(g<<20|g>>>12),g=b+(e^f&(c^e))+d[9]+0x21e1cde6|0,b=c+(g<<5|g>>>27),g=f+(c^e&(b^c))+d[14]+0xc33707d6|0,f=b+(g<<9|g>>>23),g=e+(b^c&(f^b))+d[3]+0xf4d50d87|0,e=f+(g<<14|g>>>18),g=c+(f^b&(e^f))+d[8]+0x455a14ed|0,c=e+(g<<20|g>>>12),g=b+(e^f&(c^e))+d[13]+0xa9e3e905|0,b=c+(g<<5|g>>>27),g=f+(c^e&(b^c))+d[2]+0xfcefa3f8|0,f=b+(g<<9|g>>>23),g=e+(b^c&(f^b))+d[7]+0x676f02d9|0,e=f+(g<<14|g>>>18),g=c+(f^b&(e^f))+d[12]+0x8d2a4c8a|0,g=b+((c=e+(g<<20|g>>>12))^e^f)+d[5]+0xfffa3942|0,g=f+((b=c+(g<<4|g>>>28))^c^e)+d[8]+0x8771f681|0,g=e+((f=b+(g<<11|g>>>21))^b^c)+d[11]+0x6d9d6122|0,g=c+((e=f+(g<<16|g>>>16))^f^b)+d[14]+0xfde5380c|0,g=b+((c=e+(g<<23|g>>>9))^e^f)+d[1]+0xa4beea44|0,g=f+((b=c+(g<<4|g>>>28))^c^e)+d[4]+0x4bdecfa9|0,g=e+((f=b+(g<<11|g>>>21))^b^c)+d[7]+0xf6bb4b60|0,g=c+((e=f+(g<<16|g>>>16))^f^b)+d[10]+0xbebfbc70|0,g=b+((c=e+(g<<23|g>>>9))^e^f)+d[13]+0x289b7ec6|0,g=f+((b=c+(g<<4|g>>>28))^c^e)+d[0]+0xeaa127fa|0,g=e+((f=b+(g<<11|g>>>21))^b^c)+d[3]+0xd4ef3085|0,g=c+((e=f+(g<<16|g>>>16))^f^b)+d[6]+0x4881d05|0,g=b+((c=e+(g<<23|g>>>9))^e^f)+d[9]+0xd9d4d039|0,g=f+((b=c+(g<<4|g>>>28))^c^e)+d[12]+0xe6db99e5|0,g=e+((f=b+(g<<11|g>>>21))^b^c)+d[15]+0x1fa27cf8|0,g=c+((e=f+(g<<16|g>>>16))^f^b)+d[2]+0xc4ac5665|0,c=e+(g<<23|g>>>9),g=b+(e^(c|~f))+d[0]+0xf4292244|0,b=c+(g<<6|g>>>26),g=f+(c^(b|~e))+d[7]+0x432aff97|0,f=b+(g<<10|g>>>22),g=e+(b^(f|~c))+d[14]+0xab9423a7|0,e=f+(g<<15|g>>>17),g=c+(f^(e|~b))+d[5]+0xfc93a039|0,c=e+(g<<21|g>>>11),g=b+(e^(c|~f))+d[12]+0x655b59c3|0,b=c+(g<<6|g>>>26),g=f+(c^(b|~e))+d[3]+0x8f0ccc92|0,f=b+(g<<10|g>>>22),g=e+(b^(f|~c))+d[10]+0xffeff47d|0,e=f+(g<<15|g>>>17),g=c+(f^(e|~b))+d[1]+0x85845dd1|0,c=e+(g<<21|g>>>11),g=b+(e^(c|~f))+d[8]+0x6fa87e4f|0,b=c+(g<<6|g>>>26),g=f+(c^(b|~e))+d[15]+0xfe2ce6e0|0,f=b+(g<<10|g>>>22),g=e+(b^(f|~c))+d[6]+0xa3014314|0,e=f+(g<<15|g>>>17),g=c+(f^(e|~b))+d[13]+0x4e0811a1|0,c=e+(g<<21|g>>>11),g=b+(e^(c|~f))+d[4]+0xf7537e82|0,b=c+(g<<6|g>>>26),g=f+(c^(b|~e))+d[11]+0xbd3af235|0,f=b+(g<<10|g>>>22),g=e+(b^(f|~c))+d[2]+0x2ad7d2bb|0,e=f+(g<<15|g>>>17),g=c+(f^(e|~b))+d[9]+0xeb86d391|0,a.g[0]=a.g[0]+b|0,a.g[1]=a.g[1]+(e+(g<<21|g>>>11))|0,a.g[2]=a.g[2]+e|0,a.g[3]=a.g[3]+f|0}function c(a,b){var c=f;return Object.prototype.hasOwnProperty.call(c,a)?c[a]:c[a]=b(a)}function d(a,b){this.h=b;let c=[],d=!0;for(let e=a.length-1;e>=0;e--){let f=0|a[e];d&&f==b||(c[e]=f,d=!1)}this.g=c}(function(a,b){function c(){}c.prototype=b.prototype,a.F=b.prototype,a.prototype=new c,a.prototype.constructor=a,a.D=function(a,c,d){for(var e=Array(arguments.length-2),f=2;f<arguments.length;f++)e[f-2]=arguments[f];return b.prototype[c].apply(a,e)}})(a,function(){this.blockSize=-1}),a.prototype.u=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},a.prototype.v=function(a,c){void 0===c&&(c=a.length);let d=c-this.blockSize,e=this.C,f=this.h,g=0;for(;g<c;){if(0==f)for(;g<=d;)b(this,a,g),g+=this.blockSize;if("string"==typeof a){for(;g<c;)if(e[f++]=a.charCodeAt(g++),f==this.blockSize){b(this,e),f=0;break}}else for(;g<c;)if(e[f++]=a[g++],f==this.blockSize){b(this,e),f=0;break}}this.h=f,this.o+=c},a.prototype.A=function(){var a=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);a[0]=128;for(var b=1;b<a.length-8;++b)a[b]=0;b=8*this.o;for(var c=a.length-8;c<a.length;++c)a[c]=255&b,b/=256;for(this.v(a),a=Array(16),b=0,c=0;c<4;++c)for(let d=0;d<32;d+=8)a[b++]=this.g[c]>>>d&255;return a};var e,f={};function g(a){return -128<=a&&a<128?c(a,function(a){return new d([0|a],a<0?-1:0)}):new d([0|a],a<0?-1:0)}function h(a){if(isNaN(a)||!isFinite(a))return j;if(a<0)return o(h(-a));let b=[],c=1;for(let d=0;a>=c;d++)b[d]=a/c|0,c*=0x100000000;return new d(b,0)}function i(a,b){if(0==a.length)throw Error("number format error: empty string");if((b=b||10)<2||36<b)throw Error("radix out of range: "+b);if("-"==a.charAt(0))return o(i(a.substring(1),b));if(a.indexOf("-")>=0)throw Error('number format error: interior "-" character');let c=h(Math.pow(b,8)),d=j;for(let f=0;f<a.length;f+=8){var e=Math.min(8,a.length-f);let g=parseInt(a.substring(f,f+e),b);e<8?(e=h(Math.pow(b,e)),d=d.j(e).add(h(g))):d=(d=d.j(c)).add(h(g))}return d}var j=g(0),k=g(1),l=g(0x1000000);function m(a){if(0!=a.h)return!1;for(let b=0;b<a.g.length;b++)if(0!=a.g[b])return!1;return!0}function n(a){return -1==a.h}function o(a){let b=a.g.length,c=[];for(let d=0;d<b;d++)c[d]=~a.g[d];return new d(c,~a.h).add(k)}function p(a,b){return a.add(o(b))}function q(a,b){for(;(65535&a[b])!=a[b];)a[b+1]+=a[b]>>>16,a[b]&=65535,b++}function r(a,b){this.g=a,this.h=b}function s(a,b){if(m(b))throw Error("division by zero");if(m(a))return new r(j,j);if(n(a))return b=s(o(a),b),new r(o(b.g),o(b.h));if(n(b))return b=s(a,o(b)),new r(o(b.g),b.h);if(a.g.length>30){if(n(a)||n(b))throw Error("slowDivide_ only works with positive integers.");for(var c=k,d=b;0>=d.l(a);)c=t(c),d=t(d);var e=u(c,1),f=u(d,1);for(d=u(d,2),c=u(c,2);!m(d);){var g=f.add(d);0>=g.l(a)&&(e=e.add(c),f=g),d=u(d,1),c=u(c,1)}return b=p(a,e.j(b)),new r(e,b)}for(e=j;a.l(b)>=0;){for(d=(d=Math.ceil(Math.log(c=Math.max(1,Math.floor(a.m()/b.m())))/Math.LN2))<=48?1:Math.pow(2,d-48),g=(f=h(c)).j(b);n(g)||g.l(a)>0;)c-=d,g=(f=h(c)).j(b);m(f)&&(f=k),e=e.add(f),a=p(a,g)}return new r(e,a)}function t(a){let b=a.g.length+1,c=[];for(let d=0;d<b;d++)c[d]=a.i(d)<<1|a.i(d-1)>>>31;return new d(c,a.h)}function u(a,b){let c=b>>5;b%=32;let e=a.g.length-c,f=[];for(let d=0;d<e;d++)f[d]=b>0?a.i(d+c)>>>b|a.i(d+c+1)<<32-b:a.i(d+c);return new d(f,a.h)}(e=d.prototype).m=function(){if(n(this))return-o(this).m();let a=0,b=1;for(let c=0;c<this.g.length;c++){let d=this.i(c);a+=(d>=0?d:0x100000000+d)*b,b*=0x100000000}return a},e.toString=function(a){if((a=a||10)<2||36<a)throw Error("radix out of range: "+a);if(m(this))return"0";if(n(this))return"-"+o(this).toString(a);let b=h(Math.pow(a,6));var c=this;let d="";for(;;){let e=s(c,b).g,f=(((c=p(c,e.j(b))).g.length>0?c.g[0]:c.h)>>>0).toString(a);if(m(c=e))return f+d;for(;f.length<6;)f="0"+f;d=f+d}},e.i=function(a){return a<0?0:a<this.g.length?this.g[a]:this.h},e.l=function(a){return n(a=p(this,a))?-1:+!m(a)},e.abs=function(){return n(this)?o(this):this},e.add=function(a){let b=Math.max(this.g.length,a.g.length),c=[],e=0;for(let d=0;d<=b;d++){let b=e+(65535&this.i(d))+(65535&a.i(d)),f=(b>>>16)+(this.i(d)>>>16)+(a.i(d)>>>16);e=f>>>16,b&=65535,f&=65535,c[d]=f<<16|b}return new d(c,-0x80000000&c[c.length-1]?-1:0)},e.j=function(a){if(m(this)||m(a))return j;if(n(this))return n(a)?o(this).j(o(a)):o(o(this).j(a));if(n(a))return o(this.j(o(a)));if(0>this.l(l)&&0>a.l(l))return h(this.m()*a.m());let b=this.g.length+a.g.length,c=[];for(var e=0;e<2*b;e++)c[e]=0;for(e=0;e<this.g.length;e++)for(let b=0;b<a.g.length;b++){let d=this.i(e)>>>16,f=65535&this.i(e),g=a.i(b)>>>16,h=65535&a.i(b);c[2*e+2*b]+=f*h,q(c,2*e+2*b),c[2*e+2*b+1]+=d*h,q(c,2*e+2*b+1),c[2*e+2*b+1]+=f*g,q(c,2*e+2*b+1),c[2*e+2*b+2]+=d*g,q(c,2*e+2*b+2)}for(a=0;a<b;a++)c[a]=c[2*a+1]<<16|c[2*a];for(a=b;a<2*b;a++)c[a]=0;return new d(c,0)},e.B=function(a){return s(this,a).h},e.and=function(a){let b=Math.max(this.g.length,a.g.length),c=[];for(let d=0;d<b;d++)c[d]=this.i(d)&a.i(d);return new d(c,this.h&a.h)},e.or=function(a){let b=Math.max(this.g.length,a.g.length),c=[];for(let d=0;d<b;d++)c[d]=this.i(d)|a.i(d);return new d(c,this.h|a.h)},e.xor=function(a){let b=Math.max(this.g.length,a.g.length),c=[];for(let d=0;d<b;d++)c[d]=this.i(d)^a.i(d);return new d(c,this.h^a.h)},a.prototype.digest=a.prototype.A,a.prototype.reset=a.prototype.u,a.prototype.update=a.prototype.v,dg=dA.Md5=a,d.prototype.add=d.prototype.add,d.prototype.multiply=d.prototype.j,d.prototype.modulo=d.prototype.B,d.prototype.compare=d.prototype.l,d.prototype.toNumber=d.prototype.m,d.prototype.toString=d.prototype.toString,d.prototype.getBits=d.prototype.i,d.fromNumber=h,d.fromString=i,df=dA.Integer=d}).apply(void 0!==dz?dz:"undefined"!=typeof self?self:{});var dB=a.i(54799),dC=a.i(92635),dD=a.i(33676);let dE="@firebase/firestore",dF="4.9.2";class dG{constructor(a){this.uid=a}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(a){return a.uid===this.uid}}dG.UNAUTHENTICATED=new dG(null),dG.GOOGLE_CREDENTIALS=new dG("google-credentials-uid"),dG.FIRST_PARTY=new dG("first-party-uid"),dG.MOCK_USER=new dG("mock-user");let dH="12.3.0";function dI(a){dH=a}function dJ(a){return(0,dy.inspect)(a,{depth:100})}let dK=new ah("@firebase/firestore");function dL(){return dK.logLevel}function dM(a,...b){if(dK.logLevel<=de.DEBUG){let c=b.map(dP);dK.debug(`Firestore (${dH}): ${a}`,...c)}}function dN(a,...b){if(dK.logLevel<=de.ERROR){let c=b.map(dP);dK.error(`Firestore (${dH}): ${a}`,...c)}}function dO(a,...b){if(dK.logLevel<=de.WARN){let c=b.map(dP);dK.warn(`Firestore (${dH}): ${a}`,...c)}}function dP(a){if("string"==typeof a)return a;try{return dJ(a)}catch(b){return a}}function dQ(a,b,c){let d="Unexpected state";"string"==typeof b?d=b:c=b,dR(a,d,c)}function dR(a,b,c){let d=`FIRESTORE (${dH}) INTERNAL ASSERTION FAILED: ${b} (ID: ${a.toString(16)})`;if(void 0!==c)try{let a=JSON.stringify(c);d+=" CONTEXT: "+a}catch(a){d+=" CONTEXT: "+c}throw dN(d),Error(d)}function dS(a,b,c,d){let e="Unexpected state";"string"==typeof c?e=c:d=c,a||dR(b,e,d)}function dT(a,b){return a}let dU="ok",dV="cancelled",dW="unknown",dX="invalid-argument",dY="deadline-exceeded",dZ="not-found",d$="already-exists",d_="permission-denied",d0="unauthenticated",d1="resource-exhausted",d2="failed-precondition",d3="aborted",d4="out-of-range",d5="unimplemented",d6="internal",d7="unavailable",d8="data-loss";class d9 extends K{constructor(a,b){super(a,b),this.code=a,this.message=b,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class ea{constructor(){this.promise=new Promise((a,b)=>{this.resolve=a,this.reject=b})}}class eb{constructor(a,b){this.user=b,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${a}`)}}class ec{getToken(){return Promise.resolve(null)}invalidateToken(){}start(a,b){a.enqueueRetryable(()=>b(dG.UNAUTHENTICATED))}shutdown(){}}class ed{constructor(a){this.authProvider=a,this.currentUser=dG.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(a,b){dS(void 0===this.tokenListener,42304);let c=this.tokenCounter,d=a=>this.tokenCounter!==c?(c=this.tokenCounter,b(a)):Promise.resolve(),e=new ea;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),e.resolve(),e=new ea,a.enqueueRetryable(()=>d(this.currentUser))};let f=()=>{let b=e;a.enqueueRetryable(async()=>{await b.promise,await d(this.currentUser)})},g=a=>{dM("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=a,this.tokenListener&&(this.auth.addAuthTokenListener(this.tokenListener),f())};this.authProvider.onInit(a=>g(a)),setTimeout(()=>{if(!this.auth){let a=this.authProvider.getImmediate({optional:!0});a?g(a):(dM("FirebaseAuthCredentialsProvider","Auth not yet detected"),e.resolve(),e=new ea)}},0),f()}getToken(){let a=this.tokenCounter,b=this.forceRefresh;return(this.forceRefresh=!1,this.auth)?this.auth.getToken(b).then(b=>this.tokenCounter!==a?(dM("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):b?(dS("string"==typeof b.accessToken,31837,{tokenData:b}),new eb(b.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.tokenListener&&this.auth.removeAuthTokenListener(this.tokenListener),this.tokenListener=void 0}getUser(){let a=this.auth&&this.auth.getUid();return dS(null===a||"string"==typeof a,2055,{currentUid:a}),new dG(a)}}class ee{constructor(a,b,c){this.sessionIndex=a,this.iamToken=b,this.authTokenFactory=c,this.type="FirstParty",this.user=dG.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let a=this.getAuthToken();return a&&this._headers.set("Authorization",a),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}}class ef{constructor(a,b,c){this.sessionIndex=a,this.iamToken=b,this.authTokenFactory=c}getToken(){return Promise.resolve(new ee(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(a,b){a.enqueueRetryable(()=>b(dG.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class eg{constructor(a){this.value=a,this.type="AppCheck",this.headers=new Map,a&&a.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class eh{constructor(a,b){this.appCheckProvider=b,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null,this.serverAppAppCheckToken=null,aX(a)&&a.settings.appCheckToken&&(this.serverAppAppCheckToken=a.settings.appCheckToken)}start(a,b){dS(void 0===this.tokenListener,3512);let c=a=>{null!=a.error&&dM("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${a.error.message}`);let c=a.token!==this.latestAppCheckToken;return this.latestAppCheckToken=a.token,dM("FirebaseAppCheckTokenProvider",`Received ${c?"new":"existing"} token.`),c?b(a.token):Promise.resolve()};this.tokenListener=b=>{a.enqueueRetryable(()=>c(b))};let d=a=>{dM("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=a,this.tokenListener&&this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(a=>d(a)),setTimeout(()=>{if(!this.appCheck){let a=this.appCheckProvider.getImmediate({optional:!0});a?d(a):dM("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.serverAppAppCheckToken)return Promise.resolve(new eg(this.serverAppAppCheckToken));let a=this.forceRefresh;return(this.forceRefresh=!1,this.appCheck)?this.appCheck.getToken(a).then(a=>a?(dS("string"==typeof a.token,44558,{tokenResult:a}),this.latestAppCheckToken=a.token,new eg(a.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.tokenListener&&this.appCheck.removeTokenListener(this.tokenListener),this.tokenListener=void 0}}function ei(a){if(!a)return new ec;switch(a.type){case"firstParty":return new ef(a.sessionIndex||"0",a.iamToken||null,a.authTokenFactory||null);case"provider":return a.client;default:throw new d9(dX,"makeAuthCredentialsProvider failed due to invalid credential type")}}function ej(a){return(0,dB.randomBytes)(a)}class ek{static newId(){let a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",b=Math.floor(256/a.length)*a.length,c="",d=20;for(;c.length<d;){let e=ej(40);for(let f=0;f<e.length;++f)c.length<d&&e[f]<b&&(c+=a.charAt(e[f]%a.length))}return c}}function el(a,b){return a<b?-1:+(a>b)}function em(a,b){let c=Math.min(a.length,b.length);for(let d=0;d<c;d++){let c=a.charAt(d),e=b.charAt(d);if(c!==e)return ep(c)===ep(e)?el(c,e):ep(c)?1:-1}return el(a.length,b.length)}let en=55296,eo=57343;function ep(a){let b=a.charCodeAt(0);return b>=en&&b<=eo}function eq(a,b,c){return a.length===b.length&&a.every((a,d)=>c(a,b[d]))}function er(a){return a+"\0"}let es="__name__";class et{constructor(a,b,c){void 0===b?b=0:b>a.length&&dQ(637,{offset:b,range:a.length}),void 0===c?c=a.length-b:c>a.length-b&&dQ(1746,{length:c,range:a.length-b}),this.segments=a,this.offset=b,this.len=c}get length(){return this.len}isEqual(a){return 0===et.comparator(this,a)}child(a){let b=this.segments.slice(this.offset,this.limit());return a instanceof et?a.forEach(a=>{b.push(a)}):b.push(a),this.construct(b)}limit(){return this.offset+this.length}popFirst(a){return a=void 0===a?1:a,this.construct(this.segments,this.offset+a,this.length-a)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(a){return this.segments[this.offset+a]}isEmpty(){return 0===this.length}isPrefixOf(a){if(a.length<this.length)return!1;for(let b=0;b<this.length;b++)if(this.get(b)!==a.get(b))return!1;return!0}isImmediateParentOf(a){if(this.length+1!==a.length)return!1;for(let b=0;b<this.length;b++)if(this.get(b)!==a.get(b))return!1;return!0}forEach(a){for(let b=this.offset,c=this.limit();b<c;b++)a(this.segments[b])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(a,b){let c=Math.min(a.length,b.length);for(let d=0;d<c;d++){let c=et.compareSegments(a.get(d),b.get(d));if(0!==c)return c}return el(a.length,b.length)}static compareSegments(a,b){let c=et.isNumericId(a),d=et.isNumericId(b);return c&&!d?-1:!c&&d?1:c&&d?et.extractNumericId(a).compare(et.extractNumericId(b)):em(a,b)}static isNumericId(a){return a.startsWith("__id")&&a.endsWith("__")}static extractNumericId(a){return df.fromString(a.substring(4,a.length-2))}}class eu extends et{construct(a,b,c){return new eu(a,b,c)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...a){let b=[];for(let c of a){if(c.indexOf("//")>=0)throw new d9(dX,`Invalid segment (${c}). Paths must not contain // in them.`);b.push(...c.split("/").filter(a=>a.length>0))}return new eu(b)}static emptyPath(){return new eu([])}}let ev=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ew extends et{construct(a,b,c){return new ew(a,b,c)}static isValidIdentifier(a){return ev.test(a)}canonicalString(){return this.toArray().map(a=>(a=a.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ew.isValidIdentifier(a)||(a="`"+a+"`"),a)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===es}static keyField(){return new ew([es])}static fromServerFormat(a){let b=[],c="",d=0,e=()=>{if(0===c.length)throw new d9(dX,`Invalid field path (${a}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);b.push(c),c=""},f=!1;for(;d<a.length;){let b=a[d];if("\\"===b){if(d+1===a.length)throw new d9(dX,"Path has trailing escape character: "+a);let b=a[d+1];if("\\"!==b&&"."!==b&&"`"!==b)throw new d9(dX,"Path has invalid escape sequence: "+a);c+=b,d+=2}else"`"===b?f=!f:"."!==b||f?c+=b:e(),d++}if(e(),f)throw new d9(dX,"Unterminated ` in path: "+a);return new ew(b)}static emptyPath(){return new ew([])}}class ex{constructor(a){this.path=a}static fromPath(a){return new ex(eu.fromString(a))}static fromName(a){return new ex(eu.fromString(a).popFirst(5))}static empty(){return new ex(eu.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(a){return this.path.length>=2&&this.path.get(this.path.length-2)===a}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(a){return null!==a&&0===eu.comparator(this.path,a.path)}toString(){return this.path.toString()}static comparator(a,b){return eu.comparator(a.path,b.path)}static isDocumentKey(a){return a.length%2==0}static fromSegments(a){return new ex(new eu(a.slice()))}}function ey(a,b,c){if(!c)throw new d9(dX,`Function ${a}() cannot be called with an empty ${b}.`)}function ez(a,b,c,d){if(!0===b&&!0===d)throw new d9(dX,`${a} and ${c} cannot be used together.`)}function eA(a){if(!ex.isDocumentKey(a))throw new d9(dX,`Invalid document reference. Document references must have an even number of segments, but ${a} has ${a.length}.`)}function eB(a){if(ex.isDocumentKey(a))throw new d9(dX,`Invalid collection reference. Collection references must have an odd number of segments, but ${a} has ${a.length}.`)}function eC(a){return"object"==typeof a&&null!==a&&(Object.getPrototypeOf(a)===Object.prototype||null===Object.getPrototypeOf(a))}function eD(a){if(void 0===a)return"undefined";if(null===a)return"null";if("string"==typeof a)return a.length>20&&(a=`${a.substring(0,20)}...`),JSON.stringify(a);if("number"==typeof a||"boolean"==typeof a)return""+a;if("object"==typeof a)if(a instanceof Array)return"an array";else{let b=eE(a);return b?`a custom ${b} object`:"an object"}else if("function"==typeof a)return"a function";else return dQ(12329,{type:typeof a})}function eE(a){return a.constructor?a.constructor.name:null}function eF(a,b){if("_delegate"in a&&(a=a._delegate),!(a instanceof b))if(b.name===a.constructor.name)throw new d9(dX,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");else{let c=eD(a);throw new d9(dX,`Expected type '${b.name}', but it was: ${c}`)}return a}function eG(a,b){let c={typeString:a};return b&&(c.value=b),c}function eH(a,b){let c;if(!eC(a))throw new d9(dX,"JSON must be an object");for(let d in b)if(b[d]){let e=b[d].typeString,f="value"in b[d]?{value:b[d].value}:void 0;if(!(d in a)){c=`JSON missing required field: '${d}'`;break}let g=a[d];if(e&&typeof g!==e){c=`JSON field '${d}' must be a ${e}.`;break}if(void 0!==f&&g!==f.value){c=`Expected '${d}' field to equal '${f.value}'`;break}}if(c)throw new d9(dX,c);return!0}let eI=-0xe7791f700,eJ=1e6;class eK{static now(){return eK.fromMillis(Date.now())}static fromDate(a){return eK.fromMillis(a.getTime())}static fromMillis(a){let b=Math.floor(a/1e3),c=Math.floor((a-1e3*b)*eJ);return new eK(b,c)}constructor(a,b){if(this.seconds=a,this.nanoseconds=b,b<0||b>=1e9)throw new d9(dX,"Timestamp nanoseconds out of range: "+b);if(a<eI||a>=0x3afff44180)throw new d9(dX,"Timestamp seconds out of range: "+a)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/eJ}_compareTo(a){return this.seconds===a.seconds?el(this.nanoseconds,a.nanoseconds):el(this.seconds,a.seconds)}isEqual(a){return a.seconds===this.seconds&&a.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:eK._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(a){if(eH(a,eK._jsonSchema))return new eK(a.seconds,a.nanoseconds)}valueOf(){return String(this.seconds-eI).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}eK._jsonSchemaVersion="firestore/timestamp/1.0",eK._jsonSchema={type:eG("string",eK._jsonSchemaVersion),seconds:eG("number"),nanoseconds:eG("number")};class eL{static fromTimestamp(a){return new eL(a)}static min(){return new eL(new eK(0,0))}static max(){return new eL(new eK(0x3afff4417f,1e9-1))}constructor(a){this.timestamp=a}compareTo(a){return this.timestamp._compareTo(a.timestamp)}isEqual(a){return this.timestamp.isEqual(a.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}let eM=-1,eN=0;class eO{constructor(a,b,c,d){this.indexId=a,this.collectionGroup=b,this.fields=c,this.indexState=d}}function eP(a){return a.fields.find(a=>2===a.kind)}function eQ(a){return a.fields.filter(a=>2!==a.kind)}function eR(a){let b=eQ(a);return 0===b.length?0:b[b.length-1].kind}function eS(a){return`id=${a.indexId}|cg=${a.collectionGroup}|f=${a.fields.map(a=>`${a.fieldPath}:${a.kind}`).join(",")}`}eO.UNKNOWN_ID=-1;class eT{constructor(a,b){this.fieldPath=a,this.kind=b}}class eU{constructor(a,b){this.sequenceNumber=a,this.offset=b}static empty(){return new eU(eN,eX.min())}}function eV(a,b){let c=a.toTimestamp().seconds,d=a.toTimestamp().nanoseconds+1;return new eX(eL.fromTimestamp(1e9===d?new eK(c+1,0):new eK(c,d)),ex.empty(),b)}function eW(a){return new eX(a.readTime,a.key,eM)}class eX{constructor(a,b,c){this.readTime=a,this.documentKey=b,this.largestBatchId=c}static min(){return new eX(eL.min(),ex.empty(),eM)}static max(){return new eX(eL.max(),ex.empty(),eM)}}function eY(a,b){let c=a.readTime.compareTo(b.readTime);return 0!==c||0!==(c=ex.comparator(a.documentKey,b.documentKey))?c:el(a.largestBatchId,b.largestBatchId)}let eZ="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class e${constructor(){this.onCommittedListeners=[]}addOnCommittedListener(a){this.onCommittedListeners.push(a)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(a=>a())}}async function e_(a){if(a.code===d2&&a.message===eZ)dM("LocalStore","Unexpectedly lost primary lease");else throw a}class e0{constructor(a){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,a(a=>{this.isDone=!0,this.result=a,this.nextCallback&&this.nextCallback(a)},a=>{this.isDone=!0,this.error=a,this.catchCallback&&this.catchCallback(a)})}catch(a){return this.next(void 0,a)}next(a,b){return(this.callbackAttached&&dQ(59440),this.callbackAttached=!0,this.isDone)?this.error?this.wrapFailure(b,this.error):this.wrapSuccess(a,this.result):new e0((c,d)=>{this.nextCallback=b=>{this.wrapSuccess(a,b).next(c,d)},this.catchCallback=a=>{this.wrapFailure(b,a).next(c,d)}})}toPromise(){return new Promise((a,b)=>{this.next(a,b)})}wrapUserFunction(a){try{let b=a();if(b instanceof e0)return b;return e0.resolve(b)}catch(a){return e0.reject(a)}}wrapSuccess(a,b){return a?this.wrapUserFunction(()=>a(b)):e0.resolve(b)}wrapFailure(a,b){return a?this.wrapUserFunction(()=>a(b)):e0.reject(b)}static resolve(a){return new e0((b,c)=>{b(a)})}static reject(a){return new e0((b,c)=>{c(a)})}static waitFor(a){return new e0((b,c)=>{let d=0,e=0,f=!1;a.forEach(a=>{++d,a.next(()=>{++e,f&&e===d&&b()},a=>c(a))}),f=!0,e===d&&b()})}static or(a){let b=e0.resolve(!1);for(let c of a)b=b.next(a=>a?e0.resolve(a):c());return b}static forEach(a,b){let c=[];return a.forEach((a,d)=>{c.push(b.call(this,a,d))}),this.waitFor(c)}static mapArray(a,b){return new e0((c,d)=>{let e=a.length,f=Array(e),g=0;for(let h=0;h<e;h++){let i=h;b(a[i]).next(a=>{f[i]=a,++g===e&&c(f)},a=>d(a))}})}static doWhile(a,b){return new e0((c,d)=>{let e=()=>{!0===a()?b().next(()=>{e()},d):c()};e()})}}let e1="SimpleDb",e2=3;class e3{static open(a,b,c,d){try{return new e3(b,a.transaction(d,c))}catch(a){throw new e7(b,a)}}constructor(a,b){this.action=a,this.transaction=b,this.aborted=!1,this.completionDeferred=new ea,this.transaction.oncomplete=()=>{this.completionDeferred.resolve()},this.transaction.onabort=()=>{b.error?this.completionDeferred.reject(new e7(a,b.error)):this.completionDeferred.resolve()},this.transaction.onerror=b=>{let c=fc(b.target.error);this.completionDeferred.reject(new e7(a,c))}}get completionPromise(){return this.completionDeferred.promise}abort(a){a&&this.completionDeferred.reject(a),this.aborted||(dM(e1,"Aborting transaction:",a?a.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}maybeCommit(){let a=this.transaction;this.aborted||"function"!=typeof a.commit||a.commit()}store(a){return new e9(this.transaction.objectStore(a))}}class e4{static delete(a){return dM(e1,"Removing database:",a),fa(m().indexedDB.deleteDatabase(a)).toPromise()}static isAvailable(){if(!H())return!1;if(e4.isMockPersistence())return!0;let a=x(),b=e4.getIOSVersion(a),c=0<b&&b<10,d=e5(a),e=0<d&&d<4.5;return!(a.indexOf("MSIE ")>0||a.indexOf("Trident/")>0||a.indexOf("Edge/")>0)&&!c&&!e}static isMockPersistence(){return"undefined"!=typeof process&&process.env?.USE_MOCK_PERSISTENCE==="YES"}static getStore(a,b){return a.store(b)}static getIOSVersion(a){let b=a.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(b?b[1].split("_").slice(0,2).join("."):"-1")}constructor(a,b,c){this.name=a,this.version=b,this.schemaConverter=c,this.lastClosedDbVersion=null,12.2===e4.getIOSVersion(x())&&dN("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async ensureDb(a){return this.db||(dM(e1,"Opening database:",this.name),this.db=await new Promise((b,c)=>{let d=indexedDB.open(this.name,this.version);d.onsuccess=a=>{b(a.target.result)},d.onblocked=()=>{c(new e7(a,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},d.onerror=b=>{let d=b.target.error;"VersionError"===d.name?c(new d9(d2,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===d.name?c(new d9(d2,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+d)):c(new e7(a,d))},d.onupgradeneeded=a=>{dM(e1,'Database "'+this.name+'" requires upgrade from version:',a.oldVersion);let b=a.target.result;this.schemaConverter.createOrUpgrade(b,d.transaction,a.oldVersion,this.version).next(()=>{dM(e1,"Database upgrade to version "+this.version+" complete")})}})),this.versionchangelistener&&(this.db.onversionchange=a=>this.versionchangelistener(a)),this.db}setVersionChangeListener(a){this.versionchangelistener=a,this.db&&(this.db.onversionchange=b=>a(b))}async runTransaction(a,b,c,d){let e="readonly"===b,f=0;for(;;){++f;try{this.db=await this.ensureDb(a);let b=e3.open(this.db,a,e?"readonly":"readwrite",c),f=d(b).next(a=>(b.maybeCommit(),a)).catch(a=>(b.abort(a),e0.reject(a))).toPromise();return f.catch(()=>{}),await b.completionPromise,f}catch(c){let a=c,b="FirebaseError"!==a.name&&f<e2;if(dM(e1,"Transaction failed with error:",a.message,"Retrying:",b),this.close(),!b)return Promise.reject(a)}}}close(){this.db&&this.db.close(),this.db=void 0}}function e5(a){let b=a.match(/Android ([\d.]+)/i);return Number(b?b[1].split(".").slice(0,2).join("."):"-1")}class e6{constructor(a){this.dbCursor=a,this.shouldStop=!1,this.nextKey=null}get isDone(){return this.shouldStop}get skipToKey(){return this.nextKey}set cursor(a){this.dbCursor=a}done(){this.shouldStop=!0}skip(a){this.nextKey=a}delete(){return fa(this.dbCursor.delete())}}class e7 extends d9{constructor(a,b){super(d7,`IndexedDB transaction '${a}' failed: ${b}`),this.name="IndexedDbTransactionError"}}function e8(a){return"IndexedDbTransactionError"===a.name}class e9{constructor(a){this.store=a}put(a,b){let c;return void 0!==b?(dM(e1,"PUT",this.store.name,a,b),c=this.store.put(b,a)):(dM(e1,"PUT",this.store.name,"<auto-key>",a),c=this.store.put(a)),fa(c)}add(a){return dM(e1,"ADD",this.store.name,a,a),fa(this.store.add(a))}get(a){return fa(this.store.get(a)).next(b=>(void 0===b&&(b=null),dM(e1,"GET",this.store.name,a,b),b))}delete(a){return dM(e1,"DELETE",this.store.name,a),fa(this.store.delete(a))}count(){return dM(e1,"COUNT",this.store.name),fa(this.store.count())}loadAll(a,b){let c=this.options(a,b),d=c.index?this.store.index(c.index):this.store;if("function"==typeof d.getAll){let a=d.getAll(c.range);return new e0((b,c)=>{a.onerror=a=>{c(a.target.error)},a.onsuccess=a=>{b(a.target.result)}})}{let a=this.cursor(c),b=[];return this.iterateCursor(a,(a,c)=>{b.push(c)}).next(()=>b)}}loadFirst(a,b){let c=this.store.getAll(a,null===b?void 0:b);return new e0((a,b)=>{c.onerror=a=>{b(a.target.error)},c.onsuccess=b=>{a(b.target.result)}})}deleteAll(a,b){dM(e1,"DELETE ALL",this.store.name);let c=this.options(a,b);c.keysOnly=!1;let d=this.cursor(c);return this.iterateCursor(d,(a,b,c)=>c.delete())}iterate(a,b){let c;b?c=a:(c={},b=a);let d=this.cursor(c);return this.iterateCursor(d,b)}iterateSerial(a){let b=this.cursor({});return new e0((c,d)=>{b.onerror=a=>{d(fc(a.target.error))},b.onsuccess=b=>{let d=b.target.result;d?a(d.primaryKey,d.value).next(a=>{a?d.continue():c()}):c()}})}iterateCursor(a,b){let c=[];return new e0((d,e)=>{a.onerror=a=>{e(a.target.error)},a.onsuccess=a=>{let e=a.target.result;if(!e)return void d();let f=new e6(e),g=b(e.primaryKey,e.value,f);if(g instanceof e0){let a=g.catch(a=>(f.done(),e0.reject(a)));c.push(a)}f.isDone?d():null===f.skipToKey?e.continue():e.continue(f.skipToKey)}}).next(()=>e0.waitFor(c))}options(a,b){let c;return void 0!==a&&("string"==typeof a?c=a:b=a),{index:c,range:b}}cursor(a){let b="next";if(a.reverse&&(b="prev"),!a.index)return this.store.openCursor(a.range,b);{let c=this.store.index(a.index);return a.keysOnly?c.openKeyCursor(a.range,b):c.openCursor(a.range,b)}}}function fa(a){return new e0((b,c)=>{a.onsuccess=a=>{b(a.target.result)},a.onerror=a=>{c(fc(a.target.error))}})}let fb=!1;function fc(a){let b=e4.getIOSVersion(x());if(b>=12.2&&b<13){let b="An internal error was encountered in the Indexed Database server";if(a.message.indexOf(b)>=0){let a=new d9("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${b}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return fb||(fb=!0,setTimeout(()=>{throw a},0)),a}}return a}let fd="IndexBackfiller",fe=15e3,ff=6e4,fg=50;class fh{constructor(a,b){this.asyncQueue=a,this.backfiller=b,this.task=null}start(){this.schedule(fe)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}schedule(a){dM(fd,`Scheduled in ${a}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",a,async()=>{this.task=null;try{let a=await this.backfiller.backfill();dM(fd,`Documents written: ${a}`)}catch(a){e8(a)?dM(fd,"Ignoring IndexedDB error during index backfill: ",a):await e_(a)}await this.schedule(ff)})}}class fi{constructor(a,b){this.localStore=a,this.persistence=b}async backfill(a=fg){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",b=>this.writeIndexEntries(b,a))}writeIndexEntries(a,b){let c=new Set,d=b,e=!0;return e0.doWhile(()=>!0===e&&d>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(a).next(b=>{if(!(null===b||c.has(b)))return dM(fd,`Processing collection: ${b}`),this.writeEntriesForCollectionGroup(a,b,d).next(a=>{d-=a,c.add(b)});e=!1})).next(()=>b-d)}writeEntriesForCollectionGroup(a,b,c){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(a,b).next(d=>this.localStore.localDocuments.getNextDocuments(a,b,d,c).next(c=>{let e=c.changes;return this.localStore.indexManager.updateIndexEntries(a,e).next(()=>this.getNewOffset(d,c)).next(c=>(dM(fd,`Updating offset: ${c}`),this.localStore.indexManager.updateCollectionGroup(a,b,c))).next(()=>e.size)}))}getNewOffset(a,b){let c=a;return b.changes.forEach((a,b)=>{let d=eW(b);eY(d,c)>0&&(c=d)}),new eX(c.readTime,c.documentKey,Math.max(b.batchId,a.largestBatchId))}}class fj{constructor(a,b){this.previousValue=a,b&&(b.sequenceNumberHandler=a=>this.setPreviousValue(a),this.writeNewSequenceNumber=a=>b.writeSequenceNumber(a))}setPreviousValue(a){return this.previousValue=Math.max(a,this.previousValue),this.previousValue}next(){let a=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(a),a}}fj.INVALID=-1;let fk="\x01",fl="\x01",fm="\x10",fn="\x11";function fo(a){let b="";for(let c=0;c<a.length;c++)b.length>0&&(b=fq(b)),b=fp(a.get(c),b);return fq(b)}function fp(a,b){let c=b,d=a.length;for(let b=0;b<d;b++){let d=a.charAt(b);switch(d){case"\0":c+=fk+fm;break;case fk:c+=fk+fn;break;default:c+=d}}return c}function fq(a){return a+fk+fl}function fr(a){let b=a.length;if(dS(b>=2,64408,{path:a}),2===b)return dS(a.charAt(0)===fk&&a.charAt(1)===fl,56145,{path:a}),eu.emptyPath();let c=b-2,d=[],e="";for(let f=0;f<b;){let b=a.indexOf(fk,f);switch((b<0||b>c)&&dQ(50515,{path:a}),a.charAt(b+1)){case fl:let g,h=a.substring(f,b);0===e.length?g=h:(e+=h,g=e,e=""),d.push(g);break;case fm:e+=a.substring(f,b),e+="\0";break;case fn:e+=a.substring(f,b+1);break;default:dQ(61167,{path:a})}f=b+2}return new eu(d)}let fs="remoteDocuments",ft="owner",fu="owner",fv="mutationQueues",fw="userId",fx="mutations",fy="batchId",fz="userMutationsIndex",fA=["userId","batchId"];function fB(a){return[a]}function fC(a,b){return[a,fo(b)]}function fD(a,b,c){return[a,fo(b),c]}let fE={},fF="documentMutations",fG="remoteDocumentsV14",fH=["prefixPath","collectionGroup","readTime","documentId"],fI="documentKeyIndex",fJ=["prefixPath","collectionGroup","documentId"],fK="collectionGroupIndex",fL=["collectionGroup","readTime","prefixPath","documentId"],fM="remoteDocumentGlobal",fN="remoteDocumentGlobalKey",fO="targets",fP="targetId",fQ="queryTargetsIndex",fR=["canonicalId","targetId"],fS="targetDocuments",fT=["targetId","path"],fU="documentTargetsIndex",fV=["path","targetId"],fW="targetGlobalKey",fX="targetGlobal",fY="collectionParents",fZ=["collectionId","parent"],f$="clientMetadata",f_="clientId",f0="bundles",f1="bundleId",f2="namedQueries",f3="name",f4="indexConfiguration",f5="indexId",f6="collectionGroupIndex",f7="collectionGroup",f8="indexState",f9=["indexId","uid"],ga="sequenceNumberIndex",gb=["uid","sequenceNumber"],gc="indexEntries",gd=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],ge="documentKeyIndex",gf=["indexId","uid","orderedDocumentKey"],gg="documentOverlays",gh=["userId","collectionPath","documentId"],gi="collectionPathOverlayIndex",gj=["userId","collectionPath","largestBatchId"],gk="collectionGroupOverlayIndex",gl=["userId","collectionGroup","largestBatchId"],gm="globals",gn="name",go=[fv,fx,fF,fs,fO,ft,fX,fS,f$,fM,fY,f0,f2],gp=[...go,gg],gq=[fv,fx,fF,fG,fO,ft,fX,fS,f$,fM,fY,f0,f2,gg],gr=gq,gs=[...gr,f4,f8,gc],gt=gs,gu=[...gs,gm],gv=gu;function gw(a){return 18===a?gv:17===a?gu:16===a?gt:15===a?gs:14===a?gr:13===a?gq:12===a?gp:11===a?go:void dQ(60245)}class gx extends e${constructor(a,b){super(),this.simpleDbTransaction=a,this.currentSequenceNumber=b}}function gy(a,b){let c=dT(a);return e4.getStore(c.simpleDbTransaction,b)}function gz(a){let b=0;for(let c in a)Object.prototype.hasOwnProperty.call(a,c)&&b++;return b}function gA(a,b){for(let c in a)Object.prototype.hasOwnProperty.call(a,c)&&b(c,a[c])}function gB(a,b){let c=[];for(let d in a)Object.prototype.hasOwnProperty.call(a,d)&&c.push(b(a[d],d,a));return c}function gC(a){for(let b in a)if(Object.prototype.hasOwnProperty.call(a,b))return!1;return!0}class gD{constructor(a,b){this.comparator=a,this.root=b||gF.EMPTY}insert(a,b){return new gD(this.comparator,this.root.insert(a,b,this.comparator).copy(null,null,gF.BLACK,null,null))}remove(a){return new gD(this.comparator,this.root.remove(a,this.comparator).copy(null,null,gF.BLACK,null,null))}get(a){let b=this.root;for(;!b.isEmpty();){let c=this.comparator(a,b.key);if(0===c)return b.value;c<0?b=b.left:c>0&&(b=b.right)}return null}indexOf(a){let b=0,c=this.root;for(;!c.isEmpty();){let d=this.comparator(a,c.key);if(0===d)return b+c.left.size;d<0?c=c.left:(b+=c.left.size+1,c=c.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(a){return this.root.inorderTraversal(a)}forEach(a){this.inorderTraversal((b,c)=>(a(b,c),!1))}toString(){let a=[];return this.inorderTraversal((b,c)=>(a.push(`${b}:${c}`),!1)),`{${a.join(", ")}}`}reverseTraversal(a){return this.root.reverseTraversal(a)}getIterator(){return new gE(this.root,null,this.comparator,!1)}getIteratorFrom(a){return new gE(this.root,a,this.comparator,!1)}getReverseIterator(){return new gE(this.root,null,this.comparator,!0)}getReverseIteratorFrom(a){return new gE(this.root,a,this.comparator,!0)}}class gE{constructor(a,b,c,d){this.isReverse=d,this.nodeStack=[];let e=1;for(;!a.isEmpty();)if(e=b?c(a.key,b):1,b&&d&&(e*=-1),e<0)a=this.isReverse?a.left:a.right;else if(0===e){this.nodeStack.push(a);break}else this.nodeStack.push(a),a=this.isReverse?a.right:a.left}getNext(){let a=this.nodeStack.pop(),b={key:a.key,value:a.value};if(this.isReverse)for(a=a.left;!a.isEmpty();)this.nodeStack.push(a),a=a.right;else for(a=a.right;!a.isEmpty();)this.nodeStack.push(a),a=a.left;return b}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let a=this.nodeStack[this.nodeStack.length-1];return{key:a.key,value:a.value}}}class gF{constructor(a,b,c,d,e){this.key=a,this.value=b,this.color=null!=c?c:gF.RED,this.left=null!=d?d:gF.EMPTY,this.right=null!=e?e:gF.EMPTY,this.size=this.left.size+1+this.right.size}copy(a,b,c,d,e){return new gF(null!=a?a:this.key,null!=b?b:this.value,null!=c?c:this.color,null!=d?d:this.left,null!=e?e:this.right)}isEmpty(){return!1}inorderTraversal(a){return this.left.inorderTraversal(a)||a(this.key,this.value)||this.right.inorderTraversal(a)}reverseTraversal(a){return this.right.reverseTraversal(a)||a(this.key,this.value)||this.left.reverseTraversal(a)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(a,b,c){let d=this,e=c(a,d.key);return(d=e<0?d.copy(null,null,null,d.left.insert(a,b,c),null):0===e?d.copy(null,b,null,null,null):d.copy(null,null,null,null,d.right.insert(a,b,c))).fixUp()}removeMin(){if(this.left.isEmpty())return gF.EMPTY;let a=this;return a.left.isRed()||a.left.left.isRed()||(a=a.moveRedLeft()),(a=a.copy(null,null,null,a.left.removeMin(),null)).fixUp()}remove(a,b){let c,d=this;if(0>b(a,d.key))d.left.isEmpty()||d.left.isRed()||d.left.left.isRed()||(d=d.moveRedLeft()),d=d.copy(null,null,null,d.left.remove(a,b),null);else{if(d.left.isRed()&&(d=d.rotateRight()),d.right.isEmpty()||d.right.isRed()||d.right.left.isRed()||(d=d.moveRedRight()),0===b(a,d.key))if(d.right.isEmpty())return gF.EMPTY;else c=d.right.min(),d=d.copy(c.key,c.value,null,null,d.right.removeMin());d=d.copy(null,null,null,null,d.right.remove(a,b))}return d.fixUp()}isRed(){return this.color}fixUp(){let a=this;return a.right.isRed()&&!a.left.isRed()&&(a=a.rotateLeft()),a.left.isRed()&&a.left.left.isRed()&&(a=a.rotateRight()),a.left.isRed()&&a.right.isRed()&&(a=a.colorFlip()),a}moveRedLeft(){let a=this.colorFlip();return a.right.left.isRed()&&(a=(a=(a=a.copy(null,null,null,null,a.right.rotateRight())).rotateLeft()).colorFlip()),a}moveRedRight(){let a=this.colorFlip();return a.left.left.isRed()&&(a=(a=a.rotateRight()).colorFlip()),a}rotateLeft(){let a=this.copy(null,null,gF.RED,null,this.right.left);return this.right.copy(null,null,this.color,a,null)}rotateRight(){let a=this.copy(null,null,gF.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,a)}colorFlip(){let a=this.left.copy(null,null,!this.left.color,null,null),b=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,a,b)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw dQ(43730,{key:this.key,value:this.value});if(this.right.isRed())throw dQ(14113,{key:this.key,value:this.value});let a=this.left.check();if(a===this.right.check())return a+ +!this.isRed();throw dQ(27949)}}gF.EMPTY=null,gF.RED=!0,gF.BLACK=!1;class gG{constructor(){this.size=0}get key(){throw dQ(57766)}get value(){throw dQ(16141)}get color(){throw dQ(16727)}get left(){throw dQ(29726)}get right(){throw dQ(36894)}copy(a,b,c,d,e){return this}insert(a,b,c){return new gF(a,b)}remove(a,b){return this}isEmpty(){return!0}inorderTraversal(a){return!1}reverseTraversal(a){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}}gF.EMPTY=new gG;class gH{constructor(a){this.comparator=a,this.data=new gD(this.comparator)}has(a){return null!==this.data.get(a)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(a){return this.data.indexOf(a)}forEach(a){this.data.inorderTraversal((b,c)=>(a(b),!1))}forEachInRange(a,b){let c=this.data.getIteratorFrom(a[0]);for(;c.hasNext();){let d=c.getNext();if(this.comparator(d.key,a[1])>=0)return;b(d.key)}}forEachWhile(a,b){let c;for(c=void 0!==b?this.data.getIteratorFrom(b):this.data.getIterator();c.hasNext();)if(!a(c.getNext().key))return}firstAfterOrEqual(a){let b=this.data.getIteratorFrom(a);return b.hasNext()?b.getNext().key:null}getIterator(){return new gI(this.data.getIterator())}getIteratorFrom(a){return new gI(this.data.getIteratorFrom(a))}add(a){return this.copy(this.data.remove(a).insert(a,!0))}delete(a){return this.has(a)?this.copy(this.data.remove(a)):this}isEmpty(){return this.data.isEmpty()}unionWith(a){let b=this;return b.size<a.size&&(b=a,a=this),a.forEach(a=>{b=b.add(a)}),b}isEqual(a){if(!(a instanceof gH)||this.size!==a.size)return!1;let b=this.data.getIterator(),c=a.data.getIterator();for(;b.hasNext();){let a=b.getNext().key,d=c.getNext().key;if(0!==this.comparator(a,d))return!1}return!0}toArray(){let a=[];return this.forEach(b=>{a.push(b)}),a}toString(){let a=[];return this.forEach(b=>a.push(b)),"SortedSet("+a.toString()+")"}copy(a){let b=new gH(this.comparator);return b.data=a,b}}class gI{constructor(a){this.iter=a}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function gJ(a,b,c,d,e){let f=a.getIterator(),g=b.getIterator(),h=gK(f),i=gK(g);for(;h||i;){let a=!1,b=!1;if(h&&i){let d=c(h,i);d<0?b=!0:d>0&&(a=!0)}else null!=h?b=!0:a=!0;a?(d(i),i=gK(g)):b?(e(h),h=gK(f)):(h=gK(f),i=gK(g))}}function gK(a){return a.hasNext()?a.getNext():void 0}class gL{constructor(a){this.fields=a,a.sort(ew.comparator)}static empty(){return new gL([])}unionWith(a){let b=new gH(ew.comparator);for(let a of this.fields)b=b.add(a);for(let c of a)b=b.add(c);return new gL(b.toArray())}covers(a){for(let b of this.fields)if(b.isPrefixOf(a))return!0;return!1}isEqual(a){return eq(this.fields,a.fields,(a,b)=>a.isEqual(b))}}function gM(a){return Buffer.from(a,"base64").toString("binary")}function gN(a){return Buffer.from(a,"binary").toString("base64")}class gO{constructor(a){this.binaryString=a}static fromBase64String(a){return new gO(gM(a))}static fromUint8Array(a){return new gO(gP(a))}[Symbol.iterator](){let a=0;return{next:()=>a<this.binaryString.length?{value:this.binaryString.charCodeAt(a++),done:!1}:{value:void 0,done:!0}}}toBase64(){return gN(this.binaryString)}toUint8Array(){return gQ(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(a){return el(this.binaryString,a.binaryString)}isEqual(a){return this.binaryString===a.binaryString}}function gP(a){let b="";for(let c=0;c<a.length;++c)b+=String.fromCharCode(a[c]);return b}function gQ(a){let b=new Uint8Array(a.length);for(let c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b}gO.EMPTY_BYTE_STRING=new gO("");let gR=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function gS(a){if(dS(!!a,39018),"string"==typeof a){let b=0,c=gR.exec(a);if(dS(!!c,46558,{timestamp:a}),c[1]){let a=c[1];b=Number(a=(a+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(a).getTime()/1e3),nanos:b}}return{seconds:gT(a.seconds),nanos:gT(a.nanos)}}function gT(a){return"number"==typeof a?a:"string"==typeof a?Number(a):0}function gU(a){return"string"==typeof a?gO.fromBase64String(a):gO.fromUint8Array(a)}let gV="server_timestamp",gW="__type__",gX="__previous_value__",gY="__local_write_time__";function gZ(a){return(a?.mapValue?.fields||{})[gW]?.stringValue===gV}function g$(a,b){let c={fields:{[gW]:{stringValue:gV},[gY]:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}};return b&&gZ(b)&&(b=g_(b)),b&&(c.fields[gX]=b),{mapValue:c}}function g_(a){let b=a.mapValue.fields[gX];return gZ(b)?g_(b):b}function g0(a){let b=gS(a.mapValue.fields[gY].timestampValue);return new eK(b.seconds,b.nanos)}class g1{constructor(a,b,c,d,e,f,g,h,i,j){this.databaseId=a,this.appId=b,this.persistenceKey=c,this.host=d,this.ssl=e,this.forceLongPolling=f,this.autoDetectLongPolling=g,this.longPollingOptions=h,this.useFetchStreams=i,this.isUsingEmulator=j}}let g2="(default)";class g3{constructor(a,b){this.projectId=a,this.database=b||g2}static empty(){return new g3("","")}get isDefaultDatabase(){return this.database===g2}isEqual(a){return a instanceof g3&&a.projectId===this.projectId&&a.database===this.database}}function g4(a,b){if(!Object.prototype.hasOwnProperty.apply(a.options,["projectId"]))throw new d9(dX,'"projectId" not provided in firebase.initializeApp.');return new g3(a.options.projectId,b)}let g5=-1;function g6(a){return null==a}function g7(a){return 0===a&&1/a==-1/0}function g8(a){return"number"==typeof a&&Number.isInteger(a)&&!g7(a)&&a<=Number.MAX_SAFE_INTEGER&&a>=Number.MIN_SAFE_INTEGER}let g9="__type__",ha="__max__",hb={mapValue:{fields:{__type__:{stringValue:ha}}}},hc="__vector__",hd="value",he={nullValue:"NULL_VALUE"};function hf(a){return"nullValue"in a?0:"booleanValue"in a?1:"integerValue"in a||"doubleValue"in a?2:"timestampValue"in a?3:"stringValue"in a?5:"bytesValue"in a?6:"referenceValue"in a?7:"geoPointValue"in a?8:"arrayValue"in a?9:"mapValue"in a?gZ(a)?4:hR(a)?0x1fffffffffffff:hP(a)?10:11:dQ(28295,{value:a})}function hg(a,b){if(a===b)return!0;let c=hf(a);if(c!==hf(b))return!1;switch(c){case 0:case 0x1fffffffffffff:return!0;case 1:return a.booleanValue===b.booleanValue;case 4:return g0(a).isEqual(g0(b));case 3:return hh(a,b);case 5:return a.stringValue===b.stringValue;case 6:return hj(a,b);case 7:return a.referenceValue===b.referenceValue;case 8:return hi(a,b);case 2:return hk(a,b);case 9:return eq(a.arrayValue.values||[],b.arrayValue.values||[],hg);case 10:case 11:return hl(a,b);default:return dQ(52216,{left:a})}}function hh(a,b){if("string"==typeof a.timestampValue&&"string"==typeof b.timestampValue&&a.timestampValue.length===b.timestampValue.length)return a.timestampValue===b.timestampValue;let c=gS(a.timestampValue),d=gS(b.timestampValue);return c.seconds===d.seconds&&c.nanos===d.nanos}function hi(a,b){return gT(a.geoPointValue.latitude)===gT(b.geoPointValue.latitude)&&gT(a.geoPointValue.longitude)===gT(b.geoPointValue.longitude)}function hj(a,b){return gU(a.bytesValue).isEqual(gU(b.bytesValue))}function hk(a,b){if("integerValue"in a&&"integerValue"in b)return gT(a.integerValue)===gT(b.integerValue);if("doubleValue"in a&&"doubleValue"in b){let c=gT(a.doubleValue),d=gT(b.doubleValue);return c===d?g7(c)===g7(d):isNaN(c)&&isNaN(d)}return!1}function hl(a,b){let c=a.mapValue.fields||{},d=b.mapValue.fields||{};if(gz(c)!==gz(d))return!1;for(let a in c)if(c.hasOwnProperty(a)&&(void 0===d[a]||!hg(c[a],d[a])))return!1;return!0}function hm(a,b){return void 0!==(a.values||[]).find(a=>hg(a,b))}function hn(a,b){if(a===b)return 0;let c=hf(a),d=hf(b);if(c!==d)return el(c,d);switch(c){case 0:case 0x1fffffffffffff:return 0;case 1:return el(a.booleanValue,b.booleanValue);case 2:return ho(a,b);case 3:return hp(a.timestampValue,b.timestampValue);case 4:return hp(g0(a),g0(b));case 5:return em(a.stringValue,b.stringValue);case 6:return hs(a.bytesValue,b.bytesValue);case 7:return hq(a.referenceValue,b.referenceValue);case 8:return hr(a.geoPointValue,b.geoPointValue);case 9:return ht(a.arrayValue,b.arrayValue);case 10:return hu(a.mapValue,b.mapValue);case 11:return hv(a.mapValue,b.mapValue);default:throw dQ(23264,{leftType:c})}}function ho(a,b){let c=gT(a.integerValue||a.doubleValue),d=gT(b.integerValue||b.doubleValue);return c<d?-1:c>d?1:c===d?0:isNaN(c)?isNaN(d)?0:-1:1}function hp(a,b){if("string"==typeof a&&"string"==typeof b&&a.length===b.length)return el(a,b);let c=gS(a),d=gS(b),e=el(c.seconds,d.seconds);return 0!==e?e:el(c.nanos,d.nanos)}function hq(a,b){let c=a.split("/"),d=b.split("/");for(let a=0;a<c.length&&a<d.length;a++){let b=el(c[a],d[a]);if(0!==b)return b}return el(c.length,d.length)}function hr(a,b){let c=el(gT(a.latitude),gT(b.latitude));return 0!==c?c:el(gT(a.longitude),gT(b.longitude))}function hs(a,b){let c=gU(a),d=gU(b);return c.compareTo(d)}function ht(a,b){let c=a.values||[],d=b.values||[];for(let a=0;a<c.length&&a<d.length;++a){let b=hn(c[a],d[a]);if(b)return b}return el(c.length,d.length)}function hu(a,b){let c=a.fields||{},d=b.fields||{},e=c[hd]?.arrayValue,f=d[hd]?.arrayValue,g=el(e?.values?.length||0,f?.values?.length||0);return 0!==g?g:ht(e,f)}function hv(a,b){if(a===hb.mapValue&&b===hb.mapValue)return 0;if(a===hb.mapValue)return 1;if(b===hb.mapValue)return -1;let c=a.fields||{},d=Object.keys(c),e=b.fields||{},f=Object.keys(e);d.sort(),f.sort();for(let a=0;a<d.length&&a<f.length;++a){let b=em(d[a],f[a]);if(0!==b)return b;let g=hn(c[d[a]],e[f[a]]);if(0!==g)return g}return el(d.length,f.length)}function hw(a){return hx(a)}function hx(a){if("nullValue"in a)return"null";if("booleanValue"in a)return""+a.booleanValue;if("integerValue"in a)return""+a.integerValue;if("doubleValue"in a)return""+a.doubleValue;if("timestampValue"in a)return hz(a.timestampValue);else if("stringValue"in a)return a.stringValue;else if("bytesValue"in a)return hy(a.bytesValue);else if("referenceValue"in a)return hB(a.referenceValue);else if("geoPointValue"in a)return hA(a.geoPointValue);else if("arrayValue"in a)return hD(a.arrayValue);else if("mapValue"in a)return hC(a.mapValue);else return dQ(61005,{value:a})}function hy(a){return gU(a).toBase64()}function hz(a){let b=gS(a);return`time(${b.seconds},${b.nanos})`}function hA(a){return`geo(${a.latitude},${a.longitude})`}function hB(a){return ex.fromName(a).toString()}function hC(a){let b=Object.keys(a.fields||{}).sort(),c="{",d=!0;for(let e of b)d?d=!1:c+=",",c+=`${e}:${hx(a.fields[e])}`;return c+"}"}function hD(a){let b="[",c=!0;for(let d of a.values||[])c?c=!1:b+=",",b+=hx(d);return b+"]"}function hE(a){switch(hf(a)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let b=g_(a);return b?16+hE(b):16;case 5:return 2*a.stringValue.length;case 6:return gU(a.bytesValue).approximateByteSize();case 7:return a.referenceValue.length;case 9:return hG(a.arrayValue);case 10:case 11:return hF(a.mapValue);default:throw dQ(13486,{value:a})}}function hF(a){let b=0;return gA(a.fields,(a,c)=>{b+=a.length+hE(c)}),b}function hG(a){return(a.values||[]).reduce((a,b)=>a+hE(b),0)}function hH(a,b){return{referenceValue:`projects/${a.projectId}/databases/${a.database}/documents/${b.path.canonicalString()}`}}function hI(a){return!!a&&"integerValue"in a}function hJ(a){return!!a&&"doubleValue"in a}function hK(a){return hI(a)||hJ(a)}function hL(a){return!!a&&"arrayValue"in a}function hM(a){return!!a&&"nullValue"in a}function hN(a){return!!a&&"doubleValue"in a&&isNaN(Number(a.doubleValue))}function hO(a){return!!a&&"mapValue"in a}function hP(a){return(a?.mapValue?.fields||{})[g9]?.stringValue===hc}function hQ(a){if(a.geoPointValue)return{geoPointValue:{...a.geoPointValue}};if(a.timestampValue&&"object"==typeof a.timestampValue)return{timestampValue:{...a.timestampValue}};if(a.mapValue){let b={mapValue:{fields:{}}};return gA(a.mapValue.fields,(a,c)=>b.mapValue.fields[a]=hQ(c)),b}{if(!a.arrayValue)return{...a};let b={arrayValue:{values:[]}};for(let c=0;c<(a.arrayValue.values||[]).length;++c)b.arrayValue.values[c]=hQ(a.arrayValue.values[c]);return b}}function hR(a){return(((a.mapValue||{}).fields||{}).__type__||{}).stringValue===ha}let hS={mapValue:{fields:{[g9]:{stringValue:hc},[hd]:{arrayValue:{}}}}};function hT(a){if("nullValue"in a)return he;if("booleanValue"in a)return{booleanValue:!1};if("integerValue"in a||"doubleValue"in a)return{doubleValue:NaN};if("timestampValue"in a)return{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}};if("stringValue"in a)return{stringValue:""};else if("bytesValue"in a)return{bytesValue:""};else if("referenceValue"in a)return hH(g3.empty(),ex.empty());else if("geoPointValue"in a)return{geoPointValue:{latitude:-90,longitude:-180}};else if("arrayValue"in a)return{arrayValue:{}};else if(!("mapValue"in a))return dQ(35942,{value:a});else return hP(a)?hS:{mapValue:{}}}function hU(a){if("nullValue"in a)return{booleanValue:!1};if("booleanValue"in a)return{doubleValue:NaN};if("integerValue"in a||"doubleValue"in a)return{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}};if("timestampValue"in a)return{stringValue:""};if("stringValue"in a)return{bytesValue:""};else if("bytesValue"in a)return hH(g3.empty(),ex.empty());else if("referenceValue"in a)return{geoPointValue:{latitude:-90,longitude:-180}};else if("geoPointValue"in a)return{arrayValue:{}};else if("arrayValue"in a)return hS;else if(!("mapValue"in a))return dQ(61959,{value:a});else return hP(a)?{mapValue:{}}:hb}function hV(a,b){let c=hn(a.value,b.value);return 0!==c?c:a.inclusive&&!b.inclusive?-1:!a.inclusive&&b.inclusive?1:0}function hW(a,b){let c=hn(a.value,b.value);return 0!==c?c:a.inclusive&&!b.inclusive?1:!a.inclusive&&b.inclusive?-1:0}class hX{constructor(a){this.value=a}static empty(){return new hX({mapValue:{}})}field(a){if(a.isEmpty())return this.value;{let b=this.value;for(let c=0;c<a.length-1;++c)if(!hO(b=(b.mapValue.fields||{})[a.get(c)]))return null;return(b=(b.mapValue.fields||{})[a.lastSegment()])||null}}set(a,b){this.getFieldsMap(a.popLast())[a.lastSegment()]=hQ(b)}setAll(a){let b=ew.emptyPath(),c={},d=[];a.forEach((a,e)=>{if(!b.isImmediateParentOf(e)){let a=this.getFieldsMap(b);this.applyChanges(a,c,d),c={},d=[],b=e.popLast()}a?c[e.lastSegment()]=hQ(a):d.push(e.lastSegment())});let e=this.getFieldsMap(b);this.applyChanges(e,c,d)}delete(a){let b=this.field(a.popLast());hO(b)&&b.mapValue.fields&&delete b.mapValue.fields[a.lastSegment()]}isEqual(a){return hg(this.value,a.value)}getFieldsMap(a){let b=this.value;b.mapValue.fields||(b.mapValue={fields:{}});for(let c=0;c<a.length;++c){let d=b.mapValue.fields[a.get(c)];hO(d)&&d.mapValue.fields||(d={mapValue:{fields:{}}},b.mapValue.fields[a.get(c)]=d),b=d}return b.mapValue.fields}applyChanges(a,b,c){for(let d of(gA(b,(b,c)=>a[b]=c),c))delete a[d]}clone(){return new hX(hQ(this.value))}}function hY(a){let b=[];return gA(a.fields,(a,c)=>{let d=new ew([a]);if(hO(c)){let a=hY(c.mapValue).fields;if(0===a.length)b.push(d);else for(let c of a)b.push(d.child(c))}else b.push(d)}),new gL(b)}class hZ{constructor(a,b,c,d,e,f,g){this.key=a,this.documentType=b,this.version=c,this.readTime=d,this.createTime=e,this.data=f,this.documentState=g}static newInvalidDocument(a){return new hZ(a,0,eL.min(),eL.min(),eL.min(),hX.empty(),0)}static newFoundDocument(a,b,c,d){return new hZ(a,1,b,eL.min(),c,d,0)}static newNoDocument(a,b){return new hZ(a,2,b,eL.min(),eL.min(),hX.empty(),0)}static newUnknownDocument(a,b){return new hZ(a,3,b,eL.min(),eL.min(),hX.empty(),2)}convertToFoundDocument(a,b){return this.createTime.isEqual(eL.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=a),this.version=a,this.documentType=1,this.data=b,this.documentState=0,this}convertToNoDocument(a){return this.version=a,this.documentType=2,this.data=hX.empty(),this.documentState=0,this}convertToUnknownDocument(a){return this.version=a,this.documentType=3,this.data=hX.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=eL.min(),this}setReadTime(a){return this.readTime=a,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(a){return a instanceof hZ&&this.key.isEqual(a.key)&&this.version.isEqual(a.version)&&this.documentType===a.documentType&&this.documentState===a.documentState&&this.data.isEqual(a.data)}mutableCopy(){return new hZ(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}function h$(a,b,c){let d=b.data.field(a),e=c.data.field(a);return null!==d&&null!==e?hn(d,e):dQ(42886)}class h_{constructor(a,b){this.position=a,this.inclusive=b}}function h0(a,b,c){let d=0;for(let e=0;e<a.position.length;e++){let f=b[e],g=a.position[e];if(d=f.field.isKeyField()?ex.comparator(ex.fromName(g.referenceValue),c.key):hn(g,c.data.field(f.field)),"desc"===f.dir&&(d*=-1),0!==d)break}return d}function h1(a,b,c){let d=h0(a,b,c);return a.inclusive?d>=0:d>0}function h2(a,b,c){let d=h0(a,b,c);return a.inclusive?d<=0:d<0}function h3(a,b){if(null===a)return null===b;if(null===b||a.inclusive!==b.inclusive||a.position.length!==b.position.length)return!1;for(let c=0;c<a.position.length;c++)if(!hg(a.position[c],b.position[c]))return!1;return!0}class h4{constructor(a,b="asc"){this.field=a,this.dir=b}}function h5(a){return a.field.canonicalString()+a.dir}function h6(a){return`${a.field.canonicalString()} (${a.dir})`}function h7(a,b){return a.dir===b.dir&&a.field.isEqual(b.field)}class h8{}class h9 extends h8{constructor(a,b,c){super(),this.field=a,this.op=b,this.value=c}static create(a,b,c){if(a.isKeyField())if("in"===b||"not-in"===b)return this.createKeyFieldInFilter(a,b,c);else return new ip(a,b,c);if("array-contains"===b)return new it(a,c);if("in"===b)return new iu(a,c);if("not-in"===b)return new iv(a,c);if("array-contains-any"===b)return new iw(a,c);else return new h9(a,b,c)}static createKeyFieldInFilter(a,b,c){return"in"===b?new iq(a,c):new ir(a,c)}matches(a){let b=a.data.field(this.field);return"!="===this.op?null!==b&&void 0===b.nullValue&&this.matchesComparison(hn(b,this.value)):null!==b&&hf(this.value)===hf(b)&&this.matchesComparison(hn(b,this.value))}matchesComparison(a){switch(this.op){case"<":return a<0;case"<=":return a<=0;case"==":return 0===a;case"!=":return 0!==a;case">":return a>0;case">=":return a>=0;default:return dQ(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ia extends h8{constructor(a,b){super(),this.filters=a,this.op=b,this.memoizedFlattenedFilters=null}static create(a,b){return new ia(a,b)}matches(a){return ib(this)?void 0===this.filters.find(b=>!b.matches(a)):void 0!==this.filters.find(b=>b.matches(a))}getFlattenedFilters(){return null!==this.memoizedFlattenedFilters||(this.memoizedFlattenedFilters=this.filters.reduce((a,b)=>a.concat(b.getFlattenedFilters()),[])),this.memoizedFlattenedFilters}getFilters(){return Object.assign([],this.filters)}}function ib(a){return"and"===a.op}function ic(a){return"or"===a.op}function id(a){return ie(a)&&ib(a)}function ie(a){for(let b of a.filters)if(b instanceof ia)return!1;return!0}function ig(a){if(a instanceof h9)return a.field.canonicalString()+a.op.toString()+hw(a.value);{if(id(a))return a.filters.map(a=>ig(a)).join(",");let b=a.filters.map(a=>ig(a)).join(",");return`${a.op}(${b})`}}function ih(a,b){return a instanceof h9?ii(a,b):a instanceof ia?ij(a,b):void dQ(19439)}function ii(a,b){return b instanceof h9&&a.op===b.op&&a.field.isEqual(b.field)&&hg(a.value,b.value)}function ij(a,b){return b instanceof ia&&a.op===b.op&&a.filters.length===b.filters.length&&a.filters.reduce((a,c,d)=>a&&ih(c,b.filters[d]),!0)}function ik(a,b){let c=a.filters.concat(b);return ia.create(c,a.op)}function il(a){return a instanceof h9?io(a):a instanceof ia?im(a):"Filter"}function im(a){return a.op.toString()+" {"+a.getFilters().map(il).join(" ,")+"}"}function io(a){return`${a.field.canonicalString()} ${a.op} ${hw(a.value)}`}class ip extends h9{constructor(a,b,c){super(a,b,c),this.key=ex.fromName(c.referenceValue)}matches(a){let b=ex.comparator(a.key,this.key);return this.matchesComparison(b)}}class iq extends h9{constructor(a,b){super(a,"in",b),this.keys=is("in",b)}matches(a){return this.keys.some(b=>b.isEqual(a.key))}}class ir extends h9{constructor(a,b){super(a,"not-in",b),this.keys=is("not-in",b)}matches(a){return!this.keys.some(b=>b.isEqual(a.key))}}function is(a,b){return(b.arrayValue?.values||[]).map(a=>ex.fromName(a.referenceValue))}class it extends h9{constructor(a,b){super(a,"array-contains",b)}matches(a){let b=a.data.field(this.field);return hL(b)&&hm(b.arrayValue,this.value)}}class iu extends h9{constructor(a,b){super(a,"in",b)}matches(a){let b=a.data.field(this.field);return null!==b&&hm(this.value.arrayValue,b)}}class iv extends h9{constructor(a,b){super(a,"not-in",b)}matches(a){if(hm(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let b=a.data.field(this.field);return null!==b&&void 0===b.nullValue&&!hm(this.value.arrayValue,b)}}class iw extends h9{constructor(a,b){super(a,"array-contains-any",b)}matches(a){let b=a.data.field(this.field);return!!hL(b)&&!!b.arrayValue.values&&b.arrayValue.values.some(a=>hm(this.value.arrayValue,a))}}class ix{constructor(a,b=null,c=[],d=[],e=null,f=null,g=null){this.path=a,this.collectionGroup=b,this.orderBy=c,this.filters=d,this.limit=e,this.startAt=f,this.endAt=g,this.memoizedCanonicalId=null}}function iy(a,b=null,c=[],d=[],e=null,f=null,g=null){return new ix(a,b,c,d,e,f,g)}function iz(a){let b=dT(a);if(null===b.memoizedCanonicalId){let a=b.path.canonicalString();null!==b.collectionGroup&&(a+="|cg:"+b.collectionGroup),a+="|f:",a+=b.filters.map(a=>ig(a)).join(","),a+="|ob:",a+=b.orderBy.map(a=>h5(a)).join(","),g6(b.limit)||(a+="|l:",a+=b.limit),b.startAt&&(a+="|lb:",a+=b.startAt.inclusive?"b:":"a:",a+=b.startAt.position.map(a=>hw(a)).join(",")),b.endAt&&(a+="|ub:",a+=b.endAt.inclusive?"a:":"b:",a+=b.endAt.position.map(a=>hw(a)).join(",")),b.memoizedCanonicalId=a}return b.memoizedCanonicalId}function iA(a){let b=a.path.canonicalString();return null!==a.collectionGroup&&(b+=" collectionGroup="+a.collectionGroup),a.filters.length>0&&(b+=`, filters: [${a.filters.map(a=>il(a)).join(", ")}]`),g6(a.limit)||(b+=", limit: "+a.limit),a.orderBy.length>0&&(b+=`, orderBy: [${a.orderBy.map(a=>h6(a)).join(", ")}]`),a.startAt&&(b+=", startAt: ",b+=a.startAt.inclusive?"b:":"a:",b+=a.startAt.position.map(a=>hw(a)).join(",")),a.endAt&&(b+=", endAt: ",b+=a.endAt.inclusive?"a:":"b:",b+=a.endAt.position.map(a=>hw(a)).join(",")),`Target(${b})`}function iB(a,b){if(a.limit!==b.limit||a.orderBy.length!==b.orderBy.length)return!1;for(let c=0;c<a.orderBy.length;c++)if(!h7(a.orderBy[c],b.orderBy[c]))return!1;if(a.filters.length!==b.filters.length)return!1;for(let c=0;c<a.filters.length;c++)if(!ih(a.filters[c],b.filters[c]))return!1;return a.collectionGroup===b.collectionGroup&&!!a.path.isEqual(b.path)&&!!h3(a.startAt,b.startAt)&&h3(a.endAt,b.endAt)}function iC(a){return ex.isDocumentKey(a.path)&&null===a.collectionGroup&&0===a.filters.length}function iD(a,b){return a.filters.filter(a=>a instanceof h9&&a.field.isEqual(b))}function iE(a,b){let c=eP(b);if(void 0===c)return null;for(let b of iD(a,c.fieldPath))switch(b.op){case"array-contains-any":return b.value.arrayValue.values||[];case"array-contains":return[b.value]}return null}function iF(a,b){let c=new Map;for(let d of eQ(b))for(let b of iD(a,d.fieldPath))switch(b.op){case"==":case"in":c.set(d.fieldPath.canonicalString(),b.value);break;case"not-in":case"!=":return c.set(d.fieldPath.canonicalString(),b.value),Array.from(c.values())}return null}function iG(a,b){let c=[],d=!0;for(let e of eQ(b)){let b=0===e.kind?iI(a,e.fieldPath,a.startAt):iJ(a,e.fieldPath,a.startAt);c.push(b.value),d&&(d=b.inclusive)}return new h_(c,d)}function iH(a,b){let c=[],d=!0;for(let e of eQ(b)){let b=0===e.kind?iJ(a,e.fieldPath,a.endAt):iI(a,e.fieldPath,a.endAt);c.push(b.value),d&&(d=b.inclusive)}return new h_(c,d)}function iI(a,b,c){let d=he,e=!0;for(let c of iD(a,b)){let a=he,b=!0;switch(c.op){case"<":case"<=":a=hT(c.value);break;case"==":case"in":case">=":a=c.value;break;case">":a=c.value,b=!1;break;case"!=":case"not-in":a=he}0>hV({value:d,inclusive:e},{value:a,inclusive:b})&&(d=a,e=b)}if(null!==c){for(let f=0;f<a.orderBy.length;++f)if(a.orderBy[f].field.isEqual(b)){let a=c.position[f];0>hV({value:d,inclusive:e},{value:a,inclusive:c.inclusive})&&(d=a,e=c.inclusive);break}}return{value:d,inclusive:e}}function iJ(a,b,c){let d=hb,e=!0;for(let c of iD(a,b)){let a=hb,b=!0;switch(c.op){case">=":case">":a=hU(c.value),b=!1;break;case"==":case"in":case"<=":a=c.value;break;case"<":a=c.value,b=!1;break;case"!=":case"not-in":a=hb}hW({value:d,inclusive:e},{value:a,inclusive:b})>0&&(d=a,e=b)}if(null!==c){for(let f=0;f<a.orderBy.length;++f)if(a.orderBy[f].field.isEqual(b)){let a=c.position[f];hW({value:d,inclusive:e},{value:a,inclusive:c.inclusive})>0&&(d=a,e=c.inclusive);break}}return{value:d,inclusive:e}}function iK(a){let b=new gH(ew.comparator),c=!1;for(let d of a.filters)for(let a of d.getFlattenedFilters())a.field.isKeyField()||("array-contains"===a.op||"array-contains-any"===a.op?c=!0:b=b.add(a.field));for(let c of a.orderBy)c.field.isKeyField()||(b=b.add(c.field));return b.size+ +!!c}function iL(a){return null!==a.limit}class iM{constructor(a,b=null,c=[],d=[],e=null,f="F",g=null,h=null){this.path=a,this.collectionGroup=b,this.explicitOrderBy=c,this.filters=d,this.limit=e,this.limitType=f,this.startAt=g,this.endAt=h,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}}function iN(a,b,c,d,e,f,g,h){return new iM(a,b,c,d,e,f,g,h)}function iO(a){return new iM(a)}function iP(a,b){return new iM(b,null,a.explicitOrderBy.slice(),a.filters.slice(),a.limit,a.limitType,a.startAt,a.endAt)}function iQ(a){return 0===a.filters.length&&null===a.limit&&null==a.startAt&&null==a.endAt&&(0===a.explicitOrderBy.length||1===a.explicitOrderBy.length&&a.explicitOrderBy[0].field.isKeyField())}function iR(a){let b=new gH(ew.comparator);return a.filters.forEach(a=>{a.getFlattenedFilters().forEach(a=>{a.isInequality()&&(b=b.add(a.field))})}),b}function iS(a){return ex.isDocumentKey(a.path)&&null===a.collectionGroup&&0===a.filters.length}function iT(a){return null!==a.collectionGroup}function iU(a){let b=dT(a);if(null===b.memoizedNormalizedOrderBy){b.memoizedNormalizedOrderBy=[];let a=new Set;for(let c of b.explicitOrderBy)b.memoizedNormalizedOrderBy.push(c),a.add(c.field.canonicalString());let c=b.explicitOrderBy.length>0?b.explicitOrderBy[b.explicitOrderBy.length-1].dir:"asc";iR(b).forEach(d=>{a.has(d.canonicalString())||d.isKeyField()||b.memoizedNormalizedOrderBy.push(new h4(d,c))}),a.has(ew.keyField().canonicalString())||b.memoizedNormalizedOrderBy.push(new h4(ew.keyField(),c))}return b.memoizedNormalizedOrderBy}function iV(a){let b=dT(a);return b.memoizedTarget||(b.memoizedTarget=iX(b,iU(a))),b.memoizedTarget}function iW(a){let b=dT(a);return b.memoizedAggregateTarget||(b.memoizedAggregateTarget=iX(b,a.explicitOrderBy)),b.memoizedAggregateTarget}function iX(a,b){if("F"===a.limitType)return iy(a.path,a.collectionGroup,b,a.filters,a.limit,a.startAt,a.endAt);{b=b.map(a=>{let b="desc"===a.dir?"asc":"desc";return new h4(a.field,b)});let c=a.endAt?new h_(a.endAt.position,a.endAt.inclusive):null,d=a.startAt?new h_(a.startAt.position,a.startAt.inclusive):null;return iy(a.path,a.collectionGroup,b,a.filters,a.limit,c,d)}}function iY(a,b){let c=a.filters.concat([b]);return new iM(a.path,a.collectionGroup,a.explicitOrderBy.slice(),c,a.limit,a.limitType,a.startAt,a.endAt)}function iZ(a,b){let c=a.explicitOrderBy.concat([b]);return new iM(a.path,a.collectionGroup,c,a.filters.slice(),a.limit,a.limitType,a.startAt,a.endAt)}function i$(a,b,c){return new iM(a.path,a.collectionGroup,a.explicitOrderBy.slice(),a.filters.slice(),b,c,a.startAt,a.endAt)}function i_(a,b){return iB(iV(a),iV(b))&&a.limitType===b.limitType}function i0(a){return`${iz(iV(a))}|lt:${a.limitType}`}function i1(a){return`Query(target=${iA(iV(a))}; limitType=${a.limitType})`}function i2(a,b){return b.isFoundDocument()&&i3(a,b)&&i4(a,b)&&i5(a,b)&&i6(a,b)}function i3(a,b){let c=b.key.path;return null!==a.collectionGroup?b.key.hasCollectionId(a.collectionGroup)&&a.path.isPrefixOf(c):ex.isDocumentKey(a.path)?a.path.isEqual(c):a.path.isImmediateParentOf(c)}function i4(a,b){for(let c of iU(a))if(!c.field.isKeyField()&&null===b.data.field(c.field))return!1;return!0}function i5(a,b){for(let c of a.filters)if(!c.matches(b))return!1;return!0}function i6(a,b){return(!a.startAt||!!h2(a.startAt,iU(a),b))&&(!a.endAt||!!h1(a.endAt,iU(a),b))}function i7(a){return a.collectionGroup||(a.path.length%2==1?a.path.lastSegment():a.path.get(a.path.length-2))}function i8(a){return(b,c)=>{let d=!1;for(let e of iU(a)){let a=i9(e,b,c);if(0!==a)return a;d=d||e.field.isKeyField()}return 0}}function i9(a,b,c){let d=a.field.isKeyField()?ex.comparator(b.key,c.key):h$(a.field,b,c);switch(a.dir){case"asc":return d;case"desc":return -1*d;default:return dQ(19790,{direction:a.dir})}}class ja{constructor(a,b){this.mapKeyFn=a,this.equalsFn=b,this.inner={},this.innerSize=0}get(a){let b=this.mapKeyFn(a),c=this.inner[b];if(void 0!==c){for(let[b,d]of c)if(this.equalsFn(b,a))return d}}has(a){return void 0!==this.get(a)}set(a,b){let c=this.mapKeyFn(a),d=this.inner[c];if(void 0===d){this.inner[c]=[[a,b]],this.innerSize++;return}for(let c=0;c<d.length;c++)if(this.equalsFn(d[c][0],a)){d[c]=[a,b];return}d.push([a,b]),this.innerSize++}delete(a){let b=this.mapKeyFn(a),c=this.inner[b];if(void 0===c)return!1;for(let d=0;d<c.length;d++)if(this.equalsFn(c[d][0],a))return 1===c.length?delete this.inner[b]:c.splice(d,1),this.innerSize--,!0;return!1}forEach(a){gA(this.inner,(b,c)=>{for(let[b,d]of c)a(b,d)})}isEmpty(){return gC(this.inner)}size(){return this.innerSize}}let jb=new gD(ex.comparator);function jc(){return jb}let jd=new gD(ex.comparator);function je(...a){let b=jd;for(let c of a)b=b.insert(c.key,c);return b}function jf(){return jj()}function jg(a){let b=jd;return a.forEach((a,c)=>b=b.insert(a,c.overlayedDocument)),b}function jh(){return jj()}function ji(){return jj()}function jj(){return new ja(a=>a.toString(),(a,b)=>a.isEqual(b))}let jk=new gD(ex.comparator);function jl(){return jk}let jm=new gH(ex.comparator);function jn(...a){let b=jm;for(let c of a)b=b.add(c);return b}let jo=new gH(el);function jp(){return jo}function jq(a,b){if(a.useProto3Json){if(isNaN(b))return{doubleValue:"NaN"};else if(b===1/0)return{doubleValue:"Infinity"};else if(b===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:g7(b)?"-0":b}}function jr(a){return{integerValue:""+a}}function js(a,b){return g8(b)?jr(b):jq(a,b)}class jt{constructor(){this._=void 0}}function ju(a,b,c){return a instanceof jy?g$(c,b):a instanceof jz?jA(a,b):a instanceof jB?jC(a,b):jE(a,b)}function jv(a,b,c){return a instanceof jz?jA(a,b):a instanceof jB?jC(a,b):c}function jw(a,b){return a instanceof jD?hK(b)?b:{integerValue:0}:null}function jx(a,b){return a instanceof jz&&b instanceof jz||a instanceof jB&&b instanceof jB?eq(a.elements,b.elements,hg):a instanceof jD&&b instanceof jD?hg(a.operand,b.operand):a instanceof jy&&b instanceof jy}class jy extends jt{}class jz extends jt{constructor(a){super(),this.elements=a}}function jA(a,b){let c=jG(b);for(let b of a.elements)c.some(a=>hg(a,b))||c.push(b);return{arrayValue:{values:c}}}class jB extends jt{constructor(a){super(),this.elements=a}}function jC(a,b){let c=jG(b);for(let b of a.elements)c=c.filter(a=>!hg(a,b));return{arrayValue:{values:c}}}class jD extends jt{constructor(a,b){super(),this.serializer=a,this.operand=b}}function jE(a,b){let c=jw(a,b),d=jF(c)+jF(a.operand);return hI(c)&&hI(a.operand)?jr(d):jq(a.serializer,d)}function jF(a){return gT(a.integerValue||a.doubleValue)}function jG(a){return hL(a)&&a.arrayValue.values?a.arrayValue.values.slice():[]}class jH{constructor(a,b){this.field=a,this.transform=b}}function jI(a,b){return a.field.isEqual(b.field)&&jx(a.transform,b.transform)}function jJ(a,b){return void 0===a&&void 0===b||!!a&&!!b&&eq(a,b,(a,b)=>jI(a,b))}class jK{constructor(a,b){this.version=a,this.transformResults=b}}class jL{constructor(a,b){this.updateTime=a,this.exists=b}static none(){return new jL}static exists(a){return new jL(void 0,a)}static updateTime(a){return new jL(a)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(a){return this.exists===a.exists&&(this.updateTime?!!a.updateTime&&this.updateTime.isEqual(a.updateTime):!a.updateTime)}}function jM(a,b){return void 0!==a.updateTime?b.isFoundDocument()&&b.version.isEqual(a.updateTime):void 0===a.exists||a.exists===b.isFoundDocument()}class jN{}function jO(a,b){if(!a.hasLocalMutations||b&&0===b.fields.length)return null;if(null===b)if(a.isNoDocument())return new j0(a.key,jL.none());else return new jT(a.key,a.data,jL.none());{let c=a.data,d=hX.empty(),e=new gH(ew.comparator);for(let a of b.fields)if(!e.has(a)){let b=c.field(a);null===b&&a.length>1&&(a=a.popLast(),b=c.field(a)),null===b?d.delete(a):d.set(a,b),e=e.add(a)}return new jW(a.key,d,new gL(e.toArray()),jL.none())}}function jP(a,b,c){a instanceof jT?jU(a,b,c):a instanceof jW?jX(a,b,c):j1(a,b,c)}function jQ(a,b,c,d){return a instanceof jT?jV(a,b,c,d):a instanceof jW?jY(a,b,c,d):j2(a,b,c)}function jR(a,b){let c=null;for(let d of a.fieldTransforms){let a=b.data.field(d.field),e=jw(d.transform,a||null);null!=e&&(null===c&&(c=hX.empty()),c.set(d.field,e))}return c||null}function jS(a,b){return a.type===b.type&&!!a.key.isEqual(b.key)&&!!a.precondition.isEqual(b.precondition)&&!!jJ(a.fieldTransforms,b.fieldTransforms)&&(0===a.type?a.value.isEqual(b.value):1!==a.type||a.data.isEqual(b.data)&&a.fieldMask.isEqual(b.fieldMask))}class jT extends jN{constructor(a,b,c,d=[]){super(),this.key=a,this.value=b,this.precondition=c,this.fieldTransforms=d,this.type=0}getFieldMask(){return null}}function jU(a,b,c){let d=a.value.clone(),e=j$(a.fieldTransforms,b,c.transformResults);d.setAll(e),b.convertToFoundDocument(c.version,d).setHasCommittedMutations()}function jV(a,b,c,d){if(!jM(a.precondition,b))return c;let e=a.value.clone(),f=j_(a.fieldTransforms,d,b);return e.setAll(f),b.convertToFoundDocument(b.version,e).setHasLocalMutations(),null}class jW extends jN{constructor(a,b,c,d,e=[]){super(),this.key=a,this.data=b,this.fieldMask=c,this.precondition=d,this.fieldTransforms=e,this.type=1}getFieldMask(){return this.fieldMask}}function jX(a,b,c){if(!jM(a.precondition,b))return void b.convertToUnknownDocument(c.version);let d=j$(a.fieldTransforms,b,c.transformResults),e=b.data;e.setAll(jZ(a)),e.setAll(d),b.convertToFoundDocument(c.version,e).setHasCommittedMutations()}function jY(a,b,c,d){if(!jM(a.precondition,b))return c;let e=j_(a.fieldTransforms,d,b),f=b.data;return(f.setAll(jZ(a)),f.setAll(e),b.convertToFoundDocument(b.version,f).setHasLocalMutations(),null===c)?null:c.unionWith(a.fieldMask.fields).unionWith(a.fieldTransforms.map(a=>a.field))}function jZ(a){let b=new Map;return a.fieldMask.fields.forEach(c=>{if(!c.isEmpty()){let d=a.data.field(c);b.set(c,d)}}),b}function j$(a,b,c){let d=new Map;dS(a.length===c.length,32656,{serverTransformResultCount:c.length,fieldTransformCount:a.length});for(let e=0;e<c.length;e++){let f=a[e],g=f.transform,h=b.data.field(f.field);d.set(f.field,jv(g,h,c[e]))}return d}function j_(a,b,c){let d=new Map;for(let e of a){let a=e.transform,f=c.data.field(e.field);d.set(e.field,ju(a,f,b))}return d}class j0 extends jN{constructor(a,b){super(),this.key=a,this.precondition=b,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}function j1(a,b,c){b.convertToNoDocument(c.version).setHasCommittedMutations()}function j2(a,b,c){return jM(a.precondition,b)?(b.convertToNoDocument(b.version).setHasLocalMutations(),null):c}class j3 extends jN{constructor(a,b){super(),this.key=a,this.precondition=b,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class j4{constructor(a,b,c,d){this.batchId=a,this.localWriteTime=b,this.baseMutations=c,this.mutations=d}applyToRemoteDocument(a,b){let c=b.mutationResults;for(let b=0;b<this.mutations.length;b++){let d=this.mutations[b];d.key.isEqual(a.key)&&jP(d,a,c[b])}}applyToLocalView(a,b){for(let c of this.baseMutations)c.key.isEqual(a.key)&&(b=jQ(c,a,b,this.localWriteTime));for(let c of this.mutations)c.key.isEqual(a.key)&&(b=jQ(c,a,b,this.localWriteTime));return b}applyToLocalDocumentSet(a,b){let c=ji();return this.mutations.forEach(d=>{let e=a.get(d.key),f=e.overlayedDocument,g=this.applyToLocalView(f,e.mutatedFields),h=jO(f,g=b.has(d.key)?null:g);null!==h&&c.set(d.key,h),f.isValidDocument()||f.convertToNoDocument(eL.min())}),c}keys(){return this.mutations.reduce((a,b)=>a.add(b.key),jn())}isEqual(a){return this.batchId===a.batchId&&eq(this.mutations,a.mutations,(a,b)=>jS(a,b))&&eq(this.baseMutations,a.baseMutations,(a,b)=>jS(a,b))}}class j5{constructor(a,b,c,d){this.batch=a,this.commitVersion=b,this.mutationResults=c,this.docVersions=d}static from(a,b,c){dS(a.mutations.length===c.length,58842,{mutationsSent:a.mutations.length,resultsReceived:c.length});let d=jl(),e=a.mutations;for(let a=0;a<e.length;a++)d=d.insert(e[a].key,c[a].version);return new j5(a,b,c,d)}}class j6{constructor(a,b){this.largestBatchId=a,this.mutation=b}getKey(){return this.mutation.key}isEqual(a){return null!==a&&this.mutation===a.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class j7{constructor(a,b){this.count=a,this.unchangedNames=b}}function j8(a){switch(a){case dU:return dQ(64938);case dV:case dW:case dY:case d1:case d6:case d7:case d0:return!1;case dX:case dZ:case d$:case d_:case d2:case d3:case d4:case d5:case d8:return!0;default:return dQ(15467,{code:a})}}function j9(a){return j8(a)&&a!==d3}function ka(a){if(void 0===a)return dN("GRPC error has no .code"),dW;switch(a){case dh.OK:return dU;case dh.CANCELLED:return dV;case dh.UNKNOWN:return dW;case dh.DEADLINE_EXCEEDED:return dY;case dh.RESOURCE_EXHAUSTED:return d1;case dh.INTERNAL:return d6;case dh.UNAVAILABLE:return d7;case dh.UNAUTHENTICATED:return d0;case dh.INVALID_ARGUMENT:return dX;case dh.NOT_FOUND:return dZ;case dh.ALREADY_EXISTS:return d$;case dh.PERMISSION_DENIED:return d_;case dh.FAILED_PRECONDITION:return d2;case dh.ABORTED:return d3;case dh.OUT_OF_RANGE:return d4;case dh.UNIMPLEMENTED:return d5;case dh.DATA_LOSS:return d8;default:return dQ(39323,{code:a})}}!function(a){a[a.OK=0]="OK",a[a.CANCELLED=1]="CANCELLED",a[a.UNKNOWN=2]="UNKNOWN",a[a.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",a[a.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",a[a.NOT_FOUND=5]="NOT_FOUND",a[a.ALREADY_EXISTS=6]="ALREADY_EXISTS",a[a.PERMISSION_DENIED=7]="PERMISSION_DENIED",a[a.UNAUTHENTICATED=16]="UNAUTHENTICATED",a[a.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",a[a.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",a[a.ABORTED=10]="ABORTED",a[a.OUT_OF_RANGE=11]="OUT_OF_RANGE",a[a.UNIMPLEMENTED=12]="UNIMPLEMENTED",a[a.INTERNAL=13]="INTERNAL",a[a.UNAVAILABLE=14]="UNAVAILABLE",a[a.DATA_LOSS=15]="DATA_LOSS"}(dh||(dh={}));class kb extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}let kc=null;function kd(){return new dy.TextEncoder}let ke=new df([0xffffffff,0xffffffff],0);function kf(a){let b=kd().encode(a),c=new dg;return c.update(b),new Uint8Array(c.digest())}function kg(a){let b=new DataView(a.buffer),c=b.getUint32(0,!0),d=b.getUint32(4,!0),e=b.getUint32(8,!0),f=b.getUint32(12,!0);return[new df([c,d],0),new df([e,f],0)]}class kh{constructor(a,b,c){if(this.bitmap=a,this.padding=b,this.hashCount=c,b<0||b>=8)throw new ki(`Invalid padding: ${b}`);if(c<0||a.length>0&&0===this.hashCount)throw new ki(`Invalid hash count: ${c}`);if(0===a.length&&0!==b)throw new ki(`Invalid padding when bitmap length is 0: ${b}`);this.bitCount=8*a.length-b,this.bitCountInInteger=df.fromNumber(this.bitCount)}getBitIndex(a,b,c){let d=a.add(b.multiply(df.fromNumber(c)));return 1===d.compare(ke)&&(d=new df([d.getBits(0),d.getBits(1)],0)),d.modulo(this.bitCountInInteger).toNumber()}isBitSet(a){return(this.bitmap[Math.floor(a/8)]&1<<a%8)!=0}mightContain(a){if(0===this.bitCount)return!1;let[b,c]=kg(kf(a));for(let a=0;a<this.hashCount;a++){let d=this.getBitIndex(b,c,a);if(!this.isBitSet(d))return!1}return!0}static create(a,b,c){let d=a%8==0?0:8-a%8,e=new kh(new Uint8Array(Math.ceil(a/8)),d,b);return c.forEach(a=>e.insert(a)),e}insert(a){if(0===this.bitCount)return;let[b,c]=kg(kf(a));for(let a=0;a<this.hashCount;a++){let d=this.getBitIndex(b,c,a);this.setBit(d)}}setBit(a){let b=Math.floor(a/8),c=a%8;this.bitmap[b]|=1<<c}}class ki extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class kj{constructor(a,b,c,d,e){this.snapshotVersion=a,this.targetChanges=b,this.targetMismatches=c,this.documentUpdates=d,this.resolvedLimboDocuments=e}static createSynthesizedRemoteEventForCurrentChange(a,b,c){let d=new Map;return d.set(a,kk.createSynthesizedTargetChangeForCurrentChange(a,b,c)),new kj(eL.min(),d,new gD(el),jc(),jn())}}class kk{constructor(a,b,c,d,e){this.resumeToken=a,this.current=b,this.addedDocuments=c,this.modifiedDocuments=d,this.removedDocuments=e}static createSynthesizedTargetChangeForCurrentChange(a,b,c){return new kk(c,b,jn(),jn(),jn())}}class kl{constructor(a,b,c,d){this.updatedTargetIds=a,this.removedTargetIds=b,this.key=c,this.newDoc=d}}class km{constructor(a,b){this.targetId=a,this.existenceFilter=b}}class kn{constructor(a,b,c=gO.EMPTY_BYTE_STRING,d=null){this.state=a,this.targetIds=b,this.resumeToken=c,this.cause=d}}class ko{constructor(){this.pendingResponses=0,this.documentChanges=ks(),this._resumeToken=gO.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}get current(){return this._current}get resumeToken(){return this._resumeToken}get isPending(){return 0!==this.pendingResponses}get hasPendingChanges(){return this._hasPendingChanges}updateResumeToken(a){a.approximateByteSize()>0&&(this._hasPendingChanges=!0,this._resumeToken=a)}toTargetChange(){let a=jn(),b=jn(),c=jn();return this.documentChanges.forEach((d,e)=>{switch(e){case 0:a=a.add(d);break;case 2:b=b.add(d);break;case 1:c=c.add(d);break;default:dQ(38017,{changeType:e})}}),new kk(this._resumeToken,this._current,a,b,c)}clearPendingChanges(){this._hasPendingChanges=!1,this.documentChanges=ks()}addDocumentChange(a,b){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(a,b)}removeDocumentChange(a){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(a)}recordPendingTargetRequest(){this.pendingResponses+=1}recordTargetResponse(){this.pendingResponses-=1,dS(this.pendingResponses>=0,3241,{pendingResponses:this.pendingResponses})}markCurrent(){this._hasPendingChanges=!0,this._current=!0}}let kp="WatchChangeAggregator";class kq{constructor(a){this.metadataProvider=a,this.targetStates=new Map,this.pendingDocumentUpdates=jc(),this.pendingDocumentUpdatesByTarget=kr(),this.pendingDocumentTargetMapping=kr(),this.pendingTargetResets=new gD(el)}handleDocumentChange(a){for(let b of a.updatedTargetIds)a.newDoc&&a.newDoc.isFoundDocument()?this.addDocumentToTarget(b,a.newDoc):this.removeDocumentFromTarget(b,a.key,a.newDoc);for(let b of a.removedTargetIds)this.removeDocumentFromTarget(b,a.key,a.newDoc)}handleTargetChange(a){this.forEachTarget(a,b=>{let c=this.ensureTargetState(b);switch(a.state){case 0:this.isActiveTarget(b)&&c.updateResumeToken(a.resumeToken);break;case 1:c.recordTargetResponse(),c.isPending||c.clearPendingChanges(),c.updateResumeToken(a.resumeToken);break;case 2:c.recordTargetResponse(),c.isPending||this.removeTarget(b);break;case 3:this.isActiveTarget(b)&&(c.markCurrent(),c.updateResumeToken(a.resumeToken));break;case 4:this.isActiveTarget(b)&&(this.resetTarget(b),c.updateResumeToken(a.resumeToken));break;default:dQ(56790,{state:a.state})}})}forEachTarget(a,b){a.targetIds.length>0?a.targetIds.forEach(b):this.targetStates.forEach((a,c)=>{this.isActiveTarget(c)&&b(c)})}handleExistenceFilter(a){let b=a.targetId,c=a.existenceFilter.count,d=this.targetDataForActiveTarget(b);if(d){let e=d.target;if(iC(e))if(0===c){let a=new ex(e.path);this.removeDocumentFromTarget(b,a,hZ.newNoDocument(a,eL.min()))}else dS(1===c,20013,{expectedCount:c});else{let d=this.getCurrentDocumentCountForTarget(b);if(d!==c){let c=this.parseBloomFilter(a),e=c?this.applyBloomFilter(c,a,d):1;if(0!==e){this.resetTarget(b);let a=2===e?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.pendingTargetResets=this.pendingTargetResets.insert(b,a)}kc?.notifyOnExistenceFilterMismatch(kt(d,a.existenceFilter,this.metadataProvider.getDatabaseId(),c,e))}}}}parseBloomFilter(a){let b,c,d=a.existenceFilter.unchangedNames;if(!d||!d.bits)return null;let{bits:{bitmap:e="",padding:f=0},hashCount:g=0}=d;try{b=gU(e).toUint8Array()}catch(a){if(a instanceof kb)return dO("Decoding the base64 bloom filter in existence filter failed ("+a.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw a}try{c=new kh(b,f,g)}catch(a){return a instanceof ki?dO("BloomFilter error: ",a):dO("Applying bloom filter failed: ",a),null}return 0===c.bitCount?null:c}applyBloomFilter(a,b,c){return 2*(b.existenceFilter.count!==c-this.filterRemovedDocuments(a,b.targetId))}filterRemovedDocuments(a,b){let c=this.metadataProvider.getRemoteKeysForTarget(b),d=0;return c.forEach(c=>{let e=this.metadataProvider.getDatabaseId(),f=`projects/${e.projectId}/databases/${e.database}/documents/${c.path.canonicalString()}`;!a.mightContain(f)&&(this.removeDocumentFromTarget(b,c,null),d++)}),d}createRemoteEvent(a){let b=new Map;this.targetStates.forEach((c,d)=>{let e=this.targetDataForActiveTarget(d);if(e){if(c.current&&iC(e.target)){let b=new ex(e.target.path);this.ensureDocumentUpdateByTarget(b).has(d)||this.targetContainsDocument(d,b)||this.removeDocumentFromTarget(d,b,hZ.newNoDocument(b,a))}c.hasPendingChanges&&(b.set(d,c.toTargetChange()),c.clearPendingChanges())}});let c=jn();this.pendingDocumentTargetMapping.forEach((a,b)=>{let d=!0;b.forEachWhile(a=>{let b=this.targetDataForActiveTarget(a);return!b||"TargetPurposeLimboResolution"===b.purpose||(d=!1,!1)}),d&&(c=c.add(a))}),this.pendingDocumentUpdates.forEach((b,c)=>c.setReadTime(a));let d=new kj(a,b,this.pendingTargetResets,this.pendingDocumentUpdates,c);return this.pendingDocumentUpdates=jc(),this.pendingDocumentUpdatesByTarget=kr(),this.pendingDocumentTargetMapping=kr(),this.pendingTargetResets=new gD(el),d}addDocumentToTarget(a,b){if(!this.isActiveTarget(a))return;let c=2*!!this.targetContainsDocument(a,b.key);this.ensureTargetState(a).addDocumentChange(b.key,c),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(b.key,b),this.pendingDocumentUpdatesByTarget=this.pendingDocumentUpdatesByTarget.insert(b.key,this.ensureDocumentUpdateByTarget(b.key).add(a)),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(b.key,this.ensureDocumentTargetMapping(b.key).add(a))}removeDocumentFromTarget(a,b,c){if(!this.isActiveTarget(a))return;let d=this.ensureTargetState(a);this.targetContainsDocument(a,b)?d.addDocumentChange(b,1):d.removeDocumentChange(b),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(b,this.ensureDocumentTargetMapping(b).delete(a)),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(b,this.ensureDocumentTargetMapping(b).add(a)),c&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(b,c))}removeTarget(a){this.targetStates.delete(a)}getCurrentDocumentCountForTarget(a){let b=this.ensureTargetState(a).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(a).size+b.addedDocuments.size-b.removedDocuments.size}recordPendingTargetRequest(a){this.ensureTargetState(a).recordPendingTargetRequest()}ensureTargetState(a){let b=this.targetStates.get(a);return b||(b=new ko,this.targetStates.set(a,b)),b}ensureDocumentTargetMapping(a){let b=this.pendingDocumentTargetMapping.get(a);return b||(b=new gH(el),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(a,b)),b}ensureDocumentUpdateByTarget(a){let b=this.pendingDocumentUpdatesByTarget.get(a);return b||(b=new gH(el),this.pendingDocumentUpdatesByTarget=this.pendingDocumentUpdatesByTarget.insert(a,b)),b}isActiveTarget(a){let b=null!==this.targetDataForActiveTarget(a);return b||dM(kp,"Detected inactive target",a),b}targetDataForActiveTarget(a){let b=this.targetStates.get(a);return b&&b.isPending?null:this.metadataProvider.getTargetDataForTarget(a)}resetTarget(a){this.targetStates.set(a,new ko),this.metadataProvider.getRemoteKeysForTarget(a).forEach(b=>{this.removeDocumentFromTarget(a,b,null)})}targetContainsDocument(a,b){return this.metadataProvider.getRemoteKeysForTarget(a).has(b)}}function kr(){return new gD(ex.comparator)}function ks(){return new gD(ex.comparator)}function kt(a,b,c,d,e){let f={localCacheCount:a,existenceFilterCount:b.count,databaseId:c.database,projectId:c.projectId},g=b.unchangedNames;return g&&(f.bloomFilter={applied:0===e,hashCount:g?.hashCount??0,bitmapLength:g?.bits?.bitmap?.length??0,padding:g?.bits?.padding??0,mightContain:a=>d?.mightContain(a)??!1}),f}let ku=(()=>{let a={};return a.asc="ASCENDING",a.desc="DESCENDING",a})(),kv=(()=>{let a={};return a["<"]="LESS_THAN",a["<="]="LESS_THAN_OR_EQUAL",a[">"]="GREATER_THAN",a[">="]="GREATER_THAN_OR_EQUAL",a["=="]="EQUAL",a["!="]="NOT_EQUAL",a["array-contains"]="ARRAY_CONTAINS",a.in="IN",a["not-in"]="NOT_IN",a["array-contains-any"]="ARRAY_CONTAINS_ANY",a})(),kw=(()=>{let a={};return a.and="AND",a.or="OR",a})();function kx(a,b){}class ky{constructor(a,b){this.databaseId=a,this.useProto3Json=b}}function kz(a){return new d9(void 0===a.code?dW:ka(a.code),a.message||"")}function kA(a,b){return a.useProto3Json||g6(b)?b:{value:b}}function kB(a){let b;return g6(b="object"==typeof a?a.value:a)?null:b}function kC(a,b){if(!a.useProto3Json)return{seconds:""+b.seconds,nanos:b.nanoseconds};{let a=new Date(1e3*b.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),c=("000000000"+b.nanoseconds).slice(-9);return`${a}.${c}Z`}}function kD(a){let b=gS(a);return new eK(b.seconds,b.nanos)}function kE(a,b){return a.useProto3Json?b.toBase64():b.toUint8Array()}function kF(a,b){return a.useProto3Json?(dS(void 0===b||"string"==typeof b,58123),gO.fromBase64String(b||"")):(dS(void 0===b||b instanceof Buffer||b instanceof Uint8Array,16193),gO.fromUint8Array(b||new Uint8Array))}function kG(a,b){return kC(a,b.toTimestamp())}function kH(a){return dS(!!a,49232),eL.fromTimestamp(kD(a))}function kI(a,b){return kJ(a,b).canonicalString()}function kJ(a,b){let c=kQ(a).child("documents");return void 0===b?c:c.child(b)}function kK(a){let b=eu.fromString(a);return dS(lE(b),10190,{key:b.toString()}),b}function kL(a,b){return kI(a.databaseId,b.path)}function kM(a,b){let c=kK(b);if(c.get(1)!==a.databaseId.projectId)throw new d9(dX,"Tried to deserialize key from different project: "+c.get(1)+" vs "+a.databaseId.projectId);if(c.get(3)!==a.databaseId.database)throw new d9(dX,"Tried to deserialize key from different database: "+c.get(3)+" vs "+a.databaseId.database);return new ex(kR(c))}function kN(a,b){return kI(a.databaseId,b)}function kO(a){let b=kK(a);return 4===b.length?eu.emptyPath():kR(b)}function kP(a){return new eu(["projects",a.databaseId.projectId,"databases",a.databaseId.database]).canonicalString()}function kQ(a){return new eu(["projects",a.projectId,"databases",a.database])}function kR(a){return dS(a.length>4&&"documents"===a.get(4),29091,{key:a.toString()}),a.popFirst(5)}function kS(a,b,c){return{name:kL(a,b),fields:c.value.mapValue.fields}}function kT(a,b){return{name:kL(a,b.key),fields:b.data.value.mapValue.fields,updateTime:kC(a,b.version.toTimestamp()),createTime:kC(a,b.createTime.toTimestamp())}}function kU(a,b,c){let d=kM(a,b.name),e=kH(b.updateTime),f=b.createTime?kH(b.createTime):eL.min(),g=new hX({mapValue:{fields:b.fields}}),h=hZ.newFoundDocument(d,e,f,g);return c&&h.setHasCommittedMutations(),c?h.setHasCommittedMutations():h}function kV(a,b){let c;if("targetChange"in b){kx(b.targetChange);let d=kW(b.targetChange.targetChangeType||"NO_CHANGE"),e=b.targetChange.targetIds||[],f=kF(a,b.targetChange.resumeToken),g=b.targetChange.cause;c=new kn(d,e,f,g&&kz(g)||null)}else if("documentChange"in b){kx(b.documentChange);let d=b.documentChange;kx(d.document),kx(d.document.name),kx(d.document.updateTime);let e=kM(a,d.document.name),f=kH(d.document.updateTime),g=d.document.createTime?kH(d.document.createTime):eL.min(),h=new hX({mapValue:{fields:d.document.fields}}),i=hZ.newFoundDocument(e,f,g,h);c=new kl(d.targetIds||[],d.removedTargetIds||[],i.key,i)}else if("documentDelete"in b){kx(b.documentDelete);let d=b.documentDelete;kx(d.document);let e=kM(a,d.document),f=d.readTime?kH(d.readTime):eL.min(),g=hZ.newNoDocument(e,f);c=new kl([],d.removedTargetIds||[],g.key,g)}else if("documentRemove"in b){kx(b.documentRemove);let d=b.documentRemove;kx(d.document);let e=kM(a,d.document);c=new kl([],d.removedTargetIds||[],e,null)}else{if(!("filter"in b))return dQ(11601,{change:b});kx(b.filter);let a=b.filter;kx(a.targetId);let{count:d=0,unchangedNames:e}=a,f=new j7(d,e);c=new km(a.targetId,f)}return c}function kW(a){if("NO_CHANGE"===a)return 0;if("ADD"===a)return 1;if("REMOVE"===a)return 2;if("CURRENT"===a)return 3;if("RESET"===a)return 4;else return dQ(39313,{state:a})}function kX(a){if(!("targetChange"in a))return eL.min();let b=a.targetChange;return b.targetIds&&b.targetIds.length||!b.readTime?eL.min():kH(b.readTime)}function kY(a,b){let c;if(b instanceof jT)c={update:kS(a,b.key,b.value)};else if(b instanceof j0)c={delete:kL(a,b.key)};else if(b instanceof jW)c={update:kS(a,b.key,b.data),updateMask:lC(b.fieldMask)};else{if(!(b instanceof j3))return dQ(16599,{mutationType:b.type});c={verify:kL(a,b.key)}}return b.fieldTransforms.length>0&&(c.updateTransforms=b.fieldTransforms.map(b=>k2(a,b))),b.precondition.isNone||(c.currentDocument=k$(a,b.precondition)),c}function kZ(a,b){let c=b.currentDocument?k_(b.currentDocument):jL.none(),d=b.updateTransforms?b.updateTransforms.map(b=>k3(a,b)):[];if(b.update){kx(b.update.name);let e=kM(a,b.update.name),f=new hX({mapValue:{fields:b.update.fields}});return b.updateMask?new jW(e,f,lD(b.updateMask),c,d):new jT(e,f,c,d)}return b.delete?new j0(kM(a,b.delete),c):b.verify?new j3(kM(a,b.verify),c):dQ(1463,{proto:b})}function k$(a,b){return void 0!==b.updateTime?{updateTime:kG(a,b.updateTime)}:void 0!==b.exists?{exists:b.exists}:dQ(27497)}function k_(a){return void 0!==a.updateTime?jL.updateTime(kH(a.updateTime)):void 0!==a.exists?jL.exists(a.exists):jL.none()}function k0(a,b){let c=a.updateTime?kH(a.updateTime):kH(b);return c.isEqual(eL.min())&&(c=kH(b)),new jK(c,a.transformResults||[])}function k1(a,b){return a&&a.length>0?(dS(void 0!==b,14353),a.map(a=>k0(a,b))):[]}function k2(a,b){let c=b.transform;if(c instanceof jy)return{fieldPath:b.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof jz)return{fieldPath:b.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof jB)return{fieldPath:b.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof jD)return{fieldPath:b.field.canonicalString(),increment:c.operand};throw dQ(20930,{transform:b.transform})}function k3(a,b){let c=null;return"setToServerValue"in b?(dS("REQUEST_TIME"===b.setToServerValue,16630,{proto:b}),c=new jy):"appendMissingElements"in b?c=new jz(b.appendMissingElements.values||[]):"removeAllFromArray"in b?c=new jB(b.removeAllFromArray.values||[]):"increment"in b?c=new jD(a,b.increment):dQ(16584,{proto:b}),new jH(ew.fromServerFormat(b.fieldPath),c)}function k4(a,b){return{documents:[kN(a,b.path)]}}function k5(a){let b=a.documents.length;return dS(1===b,1966,{count:b}),iV(iO(kO(a.documents[0])))}function k6(a,b){let c,d={structuredQuery:{}},e=b.path;null!==b.collectionGroup?(c=e,d.structuredQuery.from=[{collectionId:b.collectionGroup,allDescendants:!0}]):(c=e.popLast(),d.structuredQuery.from=[{collectionId:e.lastSegment()}]),d.parent=kN(a,c);let f=ld(b.filters);f&&(d.structuredQuery.where=f);let g=lg(b.orderBy);g&&(d.structuredQuery.orderBy=g);let h=kA(a,b.limit);return null!==h&&(d.structuredQuery.limit=h),b.startAt&&(d.structuredQuery.startAt=li(b.startAt)),b.endAt&&(d.structuredQuery.endAt=lj(b.endAt)),{queryTarget:d,parent:c}}function k7(a,b,c,d){let{queryTarget:e,parent:f}=k6(a,b),g={},h=[],i=0;return c.forEach(a=>{let b=d?a.alias:`aggregate_${i++}`;g[b]=a.alias,"count"===a.aggregateType?h.push({alias:b,count:{}}):"avg"===a.aggregateType?h.push({alias:b,avg:{field:ls(a.fieldPath)}}):"sum"===a.aggregateType&&h.push({alias:b,sum:{field:ls(a.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:h,structuredQuery:e.structuredQuery},parent:e.parent},aliasMap:g,parent:f}}function k8(a){let b=kO(a.parent),c=a.structuredQuery,d=c.from?c.from.length:0,e=null;if(d>0){dS(1===d,65062);let a=c.from[0];a.allDescendants?e=a.collectionId:b=b.child(a.collectionId)}let f=[];c.where&&(f=le(c.where));let g=[];c.orderBy&&(g=lh(c.orderBy));let h=null;c.limit&&(h=kB(c.limit));let i=null;c.startAt&&(i=lk(c.startAt));let j=null;return c.endAt&&(j=ll(c.endAt)),iN(b,e,g,f,h,"F",i,j)}function k9(a){return iV(k8(a))}function la(a,b){let c=lb(b.purpose);return null==c?null:{"goog-listen-tags":c}}function lb(a){switch(a){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return dQ(28987,{purpose:a})}}function lc(a,b){let c,d=b.target;if((c=iC(d)?{documents:k4(a,d)}:{query:k6(a,d).queryTarget}).targetId=b.targetId,b.resumeToken.approximateByteSize()>0){c.resumeToken=kE(a,b.resumeToken);let d=kA(a,b.expectedCount);null!==d&&(c.expectedCount=d)}else if(b.snapshotVersion.compareTo(eL.min())>0){c.readTime=kC(a,b.snapshotVersion.toTimestamp());let d=kA(a,b.expectedCount);null!==d&&(c.expectedCount=d)}return c}function ld(a){if(0!==a.length)return lw(ia.create(a,"and"))}function le(a){let b=lf(a);return b instanceof ia&&id(b)?b.getFilters():[b]}function lf(a){return void 0!==a.unaryFilter?lz(a):void 0!==a.fieldFilter?lA(a):void 0!==a.compositeFilter?lB(a):dQ(30097,{filter:a})}function lg(a){if(0!==a.length)return a.map(a=>lu(a))}function lh(a){return a.map(a=>lv(a))}function li(a){return{before:a.inclusive,values:a.position}}function lj(a){return{before:!a.inclusive,values:a.position}}function lk(a){let b=!!a.before;return new h_(a.values||[],b)}function ll(a){let b=!a.before;return new h_(a.values||[],b)}function lm(a){return ku[a]}function ln(a){switch(a){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function lo(a){return kv[a]}function lp(a){return kw[a]}function lq(a){switch(a){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return dQ(58110);default:return dQ(50506)}}function lr(a){switch(a){case"AND":return"and";case"OR":return"or";default:return dQ(1026)}}function ls(a){return{fieldPath:a.canonicalString()}}function lt(a){return ew.fromServerFormat(a.fieldPath)}function lu(a){return{field:ls(a.field),direction:lm(a.dir)}}function lv(a){return new h4(lt(a.field),ln(a.direction))}function lw(a){return a instanceof h9?ly(a):a instanceof ia?lx(a):dQ(54877,{filter:a})}function lx(a){let b=a.getFilters().map(a=>lw(a));return 1===b.length?b[0]:{compositeFilter:{op:lp(a.op),filters:b}}}function ly(a){if("=="===a.op){if(hN(a.value))return{unaryFilter:{field:ls(a.field),op:"IS_NAN"}};else if(hM(a.value))return{unaryFilter:{field:ls(a.field),op:"IS_NULL"}}}else if("!="===a.op){if(hN(a.value))return{unaryFilter:{field:ls(a.field),op:"IS_NOT_NAN"}};else if(hM(a.value))return{unaryFilter:{field:ls(a.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ls(a.field),op:lo(a.op),value:a.value}}}function lz(a){switch(a.unaryFilter.op){case"IS_NAN":let b=lt(a.unaryFilter.field);return h9.create(b,"==",{doubleValue:NaN});case"IS_NULL":let c=lt(a.unaryFilter.field);return h9.create(c,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let d=lt(a.unaryFilter.field);return h9.create(d,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let e=lt(a.unaryFilter.field);return h9.create(e,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return dQ(61313);default:return dQ(60726)}}function lA(a){return h9.create(lt(a.fieldFilter.field),lq(a.fieldFilter.op),a.fieldFilter.value)}function lB(a){return ia.create(a.compositeFilter.filters.map(a=>lf(a)),lr(a.compositeFilter.op))}function lC(a){let b=[];return a.fields.forEach(a=>b.push(a.canonicalString())),{fieldPaths:b}}function lD(a){return new gL((a.fieldPaths||[]).map(a=>ew.fromServerFormat(a)))}function lE(a){return a.length>=4&&"projects"===a.get(0)&&"databases"===a.get(2)}class lF{constructor(a,b,c,d,e=eL.min(),f=eL.min(),g=gO.EMPTY_BYTE_STRING,h=null){this.target=a,this.targetId=b,this.purpose=c,this.sequenceNumber=d,this.snapshotVersion=e,this.lastLimboFreeSnapshotVersion=f,this.resumeToken=g,this.expectedCount=h}withSequenceNumber(a){return new lF(this.target,this.targetId,this.purpose,a,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(a,b){return new lF(this.target,this.targetId,this.purpose,this.sequenceNumber,b,this.lastLimboFreeSnapshotVersion,a,null)}withExpectedCount(a){return new lF(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,a)}withLastLimboFreeSnapshotVersion(a){return new lF(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,a,this.resumeToken,this.expectedCount)}}class lG{constructor(a){this.remoteSerializer=a}}function lH(a,b){let c;if(b.document)c=kU(a.remoteSerializer,b.document,!!b.hasCommittedMutations);else if(b.noDocument){let a=ex.fromSegments(b.noDocument.path),d=lM(b.noDocument.readTime);c=hZ.newNoDocument(a,d),b.hasCommittedMutations&&c.setHasCommittedMutations()}else{if(!b.unknownDocument)return dQ(56709);let a=ex.fromSegments(b.unknownDocument.path),d=lM(b.unknownDocument.version);c=hZ.newUnknownDocument(a,d)}return b.readTime&&c.setReadTime(lK(b.readTime)),c}function lI(a,b){let c=b.key,d={prefixPath:c.getCollectionPath().popLast().toArray(),collectionGroup:c.collectionGroup,documentId:c.path.lastSegment(),readTime:lJ(b.readTime),hasCommittedMutations:b.hasCommittedMutations};if(b.isFoundDocument())d.document=kT(a.remoteSerializer,b);else if(b.isNoDocument())d.noDocument={path:c.path.toArray(),readTime:lL(b.version)};else{if(!b.isUnknownDocument())return dQ(57904,{document:b});d.unknownDocument={path:c.path.toArray(),version:lL(b.version)}}return d}function lJ(a){let b=a.toTimestamp();return[b.seconds,b.nanoseconds]}function lK(a){let b=new eK(a[0],a[1]);return eL.fromTimestamp(b)}function lL(a){let b=a.toTimestamp();return{seconds:b.seconds,nanoseconds:b.nanoseconds}}function lM(a){let b=new eK(a.seconds,a.nanoseconds);return eL.fromTimestamp(b)}function lN(a,b,c){let d=c.baseMutations.map(b=>kY(a.remoteSerializer,b)),e=c.mutations.map(b=>kY(a.remoteSerializer,b));return{userId:b,batchId:c.batchId,localWriteTimeMs:c.localWriteTime.toMillis(),baseMutations:d,mutations:e}}function lO(a,b){let c=(b.baseMutations||[]).map(b=>kZ(a.remoteSerializer,b));for(let a=0;a<b.mutations.length-1;++a){let c=b.mutations[a];a+1<b.mutations.length&&void 0!==b.mutations[a+1].transform&&(c.updateTransforms=b.mutations[a+1].transform.fieldTransforms,b.mutations.splice(a+1,1),++a)}let d=b.mutations.map(b=>kZ(a.remoteSerializer,b)),e=eK.fromMillis(b.localWriteTimeMs);return new j4(b.batchId,e,c,d)}function lP(a){let b,c=lM(a.readTime),d=void 0!==a.lastLimboFreeSnapshotVersion?lM(a.lastLimboFreeSnapshotVersion):eL.min();return new lF(b=lR(a.query)?k5(a.query):k9(a.query),a.targetId,"TargetPurposeListen",a.lastListenSequenceNumber,c,d,gO.fromBase64String(a.resumeToken))}function lQ(a,b){let c,d=lL(b.snapshotVersion),e=lL(b.lastLimboFreeSnapshotVersion);c=iC(b.target)?k4(a.remoteSerializer,b.target):k6(a.remoteSerializer,b.target).queryTarget;let f=b.resumeToken.toBase64();return{targetId:b.targetId,canonicalId:iz(b.target),readTime:d,resumeToken:f,lastListenSequenceNumber:b.sequenceNumber,lastLimboFreeSnapshotVersion:e,query:c}}function lR(a){return void 0!==a.documents}function lS(a){return{id:a.bundleId,createTime:lM(a.createTime),version:a.version}}function lT(a){return{bundleId:a.id,createTime:lL(kH(a.createTime)),version:a.version}}function lU(a){return{name:a.name,query:lW(a.bundledQuery),readTime:lM(a.readTime)}}function lV(a){return{name:a.name,readTime:lL(kH(a.readTime)),bundledQuery:a.bundledQuery}}function lW(a){let b=k8({parent:a.parent,structuredQuery:a.structuredQuery});return"LAST"===a.limitType?i$(b,b.limit,"L"):b}function lX(a){return{name:a.name,query:lW(a.bundledQuery),readTime:kH(a.readTime)}}function lY(a){return{id:a.id,version:a.version,createTime:kH(a.createTime)}}function lZ(a,b){return new j6(b.largestBatchId,kZ(a.remoteSerializer,b.overlayMutation))}function l$(a,b,c){let[d,e,f]=l_(b,c.mutation.key);return{userId:b,collectionPath:e,documentId:f,collectionGroup:c.mutation.key.getCollectionGroup(),largestBatchId:c.largestBatchId,overlayMutation:kY(a.remoteSerializer,c.mutation)}}function l_(a,b){let c=b.path.lastSegment();return[a,fo(b.path.popLast()),c]}function l0(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(a=>[a.fieldPath.canonicalString(),a.kind])}}function l1(a,b){let c=b?new eU(b.sequenceNumber,new eX(lM(b.readTime),new ex(fr(b.documentKey)),b.largestBatchId)):eU.empty(),d=a.fields.map(([a,b])=>new eT(ew.fromServerFormat(a),b));return new eO(a.indexId,a.collectionGroup,d,c)}function l2(a,b,c,d){return{indexId:a,uid:b,sequenceNumber:c,readTime:lL(d.readTime),documentKey:fo(d.documentKey.path),largestBatchId:d.largestBatchId}}class l3{getBundleMetadata(a,b){return l4(a).get(b).next(a=>{if(a)return lS(a)})}saveBundleMetadata(a,b){return l4(a).put(lT(b))}getNamedQuery(a,b){return l5(a).get(b).next(a=>{if(a)return lU(a)})}saveNamedQuery(a,b){return l5(a).put(lV(b))}}function l4(a){return gy(a,f0)}function l5(a){return gy(a,f2)}class l6{constructor(a,b){this.serializer=a,this.userId=b}static forUser(a,b){return new l6(a,b.uid||"")}getOverlay(a,b){return l7(a).get(l_(this.userId,b)).next(a=>a?lZ(this.serializer,a):null)}getOverlays(a,b){let c=jh();return e0.forEach(b,b=>this.getOverlay(a,b).next(a=>{null!==a&&c.set(b,a)})).next(()=>c)}saveOverlays(a,b,c){let d=[];return c.forEach((c,e)=>{let f=new j6(b,e);d.push(this.saveOverlay(a,f))}),e0.waitFor(d)}removeOverlaysForBatchId(a,b,c){let d=new Set;b.forEach(a=>d.add(fo(a.getCollectionPath())));let e=[];return d.forEach(b=>{let d=IDBKeyRange.bound([this.userId,b,c],[this.userId,b,c+1],!1,!0);e.push(l7(a).deleteAll(gi,d))}),e0.waitFor(e)}getOverlaysForCollection(a,b,c){let d=jh(),e=fo(b),f=IDBKeyRange.bound([this.userId,e,c],[this.userId,e,1/0],!0);return l7(a).loadAll(gi,f).next(a=>{for(let b of a){let a=lZ(this.serializer,b);d.set(a.getKey(),a)}return d})}getOverlaysForCollectionGroup(a,b,c,d){let e,f=jh(),g=IDBKeyRange.bound([this.userId,b,c],[this.userId,b,1/0],!0);return l7(a).iterate({index:gk,range:g},(a,b,c)=>{let g=lZ(this.serializer,b);f.size()<d||g.largestBatchId===e?(f.set(g.getKey(),g),e=g.largestBatchId):c.done()}).next(()=>f)}saveOverlay(a,b){return l7(a).put(l$(this.serializer,this.userId,b))}}function l7(a){return gy(a,gg)}class l8{globalsStore(a){return gy(a,gm)}getSessionToken(a){return this.globalsStore(a).get("sessionToken").next(a=>{let b=a?.value;return b?gO.fromUint8Array(b):gO.EMPTY_BYTE_STRING})}setSessionToken(a,b){return this.globalsStore(a).put({name:"sessionToken",value:b.toUint8Array()})}}let l9=5,ma=10,mb=13,mc=15,md=20,me=25,mf=30,mg=37,mh=45,mi=50,mj=53,mk=55,ml=60,mm=2;class mn{constructor(){}writeIndexValue(a,b){this.writeIndexValueAux(a,b),b.writeInfinity()}writeIndexValueAux(a,b){if("nullValue"in a)this.writeValueTypeLabel(b,l9);else if("booleanValue"in a)this.writeValueTypeLabel(b,ma),b.writeNumber(+!!a.booleanValue);else if("integerValue"in a)this.writeValueTypeLabel(b,mc),b.writeNumber(gT(a.integerValue));else if("doubleValue"in a){let c=gT(a.doubleValue);isNaN(c)?this.writeValueTypeLabel(b,mb):(this.writeValueTypeLabel(b,mc),g7(c)?b.writeNumber(0):b.writeNumber(c))}else if("timestampValue"in a){let c=a.timestampValue;this.writeValueTypeLabel(b,md),"string"==typeof c&&(c=gS(c)),b.writeString(`${c.seconds||""}`),b.writeNumber(c.nanos||0)}else if("stringValue"in a)this.writeIndexString(a.stringValue,b),this.writeTruncationMarker(b);else if("bytesValue"in a)this.writeValueTypeLabel(b,mf),b.writeBytes(gU(a.bytesValue)),this.writeTruncationMarker(b);else if("referenceValue"in a)this.writeIndexEntityRef(a.referenceValue,b);else if("geoPointValue"in a){let c=a.geoPointValue;this.writeValueTypeLabel(b,mh),b.writeNumber(c.latitude||0),b.writeNumber(c.longitude||0)}else"mapValue"in a?hR(a)?this.writeValueTypeLabel(b,Number.MAX_SAFE_INTEGER):hP(a)?this.writeIndexVector(a.mapValue,b):(this.writeIndexMap(a.mapValue,b),this.writeTruncationMarker(b)):"arrayValue"in a?(this.writeIndexArray(a.arrayValue,b),this.writeTruncationMarker(b)):dQ(19022,{indexValue:a})}writeIndexString(a,b){this.writeValueTypeLabel(b,me),this.writeUnlabeledIndexString(a,b)}writeUnlabeledIndexString(a,b){b.writeString(a)}writeIndexMap(a,b){let c=a.fields||{};for(let a of(this.writeValueTypeLabel(b,mk),Object.keys(c)))this.writeIndexString(a,b),this.writeIndexValueAux(c[a],b)}writeIndexVector(a,b){let c=a.fields||{};this.writeValueTypeLabel(b,mj);let d=hd,e=c[d].arrayValue?.values?.length||0;this.writeValueTypeLabel(b,mc),b.writeNumber(gT(e)),this.writeIndexString(d,b),this.writeIndexValueAux(c[d],b)}writeIndexArray(a,b){let c=a.values||[];for(let a of(this.writeValueTypeLabel(b,mi),c))this.writeIndexValueAux(a,b)}writeIndexEntityRef(a,b){this.writeValueTypeLabel(b,mg),ex.fromName(a).path.forEach(a=>{this.writeValueTypeLabel(b,ml),this.writeUnlabeledIndexString(a,b)})}writeValueTypeLabel(a,b){a.writeNumber(b)}writeTruncationMarker(a){a.writeNumber(mm)}}mn.INSTANCE=new mn;let mo="\uD800",mp="\uDBFF",mq=0,mr=255,ms=1,mt=255,mu=255,mv=0,mw=64,mx=8,my=1024;function mz(a){let b=new DataView(new ArrayBuffer(8));return b.setFloat64(0,a,!1),new Uint8Array(b.buffer)}function mA(a){if(0===a)return 8;let b=0;return a>>4==0&&(b+=4,a<<=4),a>>6==0&&(b+=2,a<<=2),a>>7==0&&(b+=1),b}function mB(a){let b=0;for(let c=0;c<8;++c){let d=mA(255&a[c]);if(b+=d,8!==d)break}return b}function mC(a){return Math.ceil((mw-mB(a))/mx)}class mD{constructor(){this.buffer=new Uint8Array(my),this.position=0}writeBytesAscending(a){let b=a[Symbol.iterator](),c=b.next();for(;!c.done;)this.writeByteAscending(c.value),c=b.next();this.writeSeparatorAscending()}writeBytesDescending(a){let b=a[Symbol.iterator](),c=b.next();for(;!c.done;)this.writeByteDescending(c.value),c=b.next();this.writeSeparatorDescending()}writeUtf8Ascending(a){for(let b of a){let a=b.charCodeAt(0);if(a<128)this.writeByteAscending(a);else if(a<2048)this.writeByteAscending(960|a>>>6),this.writeByteAscending(128|63&a);else if(b<mo||mp<b)this.writeByteAscending(480|a>>>12),this.writeByteAscending(128|63&a>>>6),this.writeByteAscending(128|63&a);else{let a=b.codePointAt(0);this.writeByteAscending(240|a>>>18),this.writeByteAscending(128|63&a>>>12),this.writeByteAscending(128|63&a>>>6),this.writeByteAscending(128|63&a)}}this.writeSeparatorAscending()}writeUtf8Descending(a){for(let b of a){let a=b.charCodeAt(0);if(a<128)this.writeByteDescending(a);else if(a<2048)this.writeByteDescending(960|a>>>6),this.writeByteDescending(128|63&a);else if(b<mo||mp<b)this.writeByteDescending(480|a>>>12),this.writeByteDescending(128|63&a>>>6),this.writeByteDescending(128|63&a);else{let a=b.codePointAt(0);this.writeByteDescending(240|a>>>18),this.writeByteDescending(128|63&a>>>12),this.writeByteDescending(128|63&a>>>6),this.writeByteDescending(128|63&a)}}this.writeSeparatorDescending()}writeNumberAscending(a){let b=this.toOrderedBits(a),c=mC(b);this.ensureAvailable(1+c),this.buffer[this.position++]=255&c;for(let a=b.length-c;a<b.length;++a)this.buffer[this.position++]=255&b[a]}writeNumberDescending(a){let b=this.toOrderedBits(a),c=mC(b);this.ensureAvailable(1+c),this.buffer[this.position++]=~(255&c);for(let a=b.length-c;a<b.length;++a)this.buffer[this.position++]=~(255&b[a])}writeInfinityAscending(){this.writeEscapedByteAscending(mt),this.writeEscapedByteAscending(mu)}writeInfinityDescending(){this.writeEscapedByteDescending(mt),this.writeEscapedByteDescending(mu)}reset(){this.position=0}seed(a){this.ensureAvailable(a.length),this.buffer.set(a,this.position),this.position+=a.length}encodedBytes(){return this.buffer.slice(0,this.position)}toOrderedBits(a){let b=mz(a),c=(128&b[0])!=0;b[0]^=c?255:128;for(let a=1;a<b.length;++a)b[a]^=255*!!c;return b}writeByteAscending(a){let b=255&a;b===mq?(this.writeEscapedByteAscending(mq),this.writeEscapedByteAscending(mr)):b===mt?(this.writeEscapedByteAscending(mt),this.writeEscapedByteAscending(mv)):this.writeEscapedByteAscending(b)}writeByteDescending(a){let b=255&a;b===mq?(this.writeEscapedByteDescending(mq),this.writeEscapedByteDescending(mr)):b===mt?(this.writeEscapedByteDescending(mt),this.writeEscapedByteDescending(mv)):this.writeEscapedByteDescending(a)}writeSeparatorAscending(){this.writeEscapedByteAscending(mq),this.writeEscapedByteAscending(ms)}writeSeparatorDescending(){this.writeEscapedByteDescending(mq),this.writeEscapedByteDescending(ms)}writeEscapedByteAscending(a){this.ensureAvailable(1),this.buffer[this.position++]=a}writeEscapedByteDescending(a){this.ensureAvailable(1),this.buffer[this.position++]=~a}ensureAvailable(a){let b=a+this.position;if(b<=this.buffer.length)return;let c=2*this.buffer.length;c<b&&(c=b);let d=new Uint8Array(c);d.set(this.buffer),this.buffer=d}}class mE{constructor(a){this.orderedCode=a}writeBytes(a){this.orderedCode.writeBytesAscending(a)}writeString(a){this.orderedCode.writeUtf8Ascending(a)}writeNumber(a){this.orderedCode.writeNumberAscending(a)}writeInfinity(){this.orderedCode.writeInfinityAscending()}}class mF{constructor(a){this.orderedCode=a}writeBytes(a){this.orderedCode.writeBytesDescending(a)}writeString(a){this.orderedCode.writeUtf8Descending(a)}writeNumber(a){this.orderedCode.writeNumberDescending(a)}writeInfinity(){this.orderedCode.writeInfinityDescending()}}class mG{constructor(){this.orderedCode=new mD,this.ascending=new mE(this.orderedCode),this.descending=new mF(this.orderedCode)}seed(a){this.orderedCode.seed(a)}forKind(a){return 0===a?this.ascending:this.descending}encodedBytes(){return this.orderedCode.encodedBytes()}reset(){this.orderedCode.reset()}}class mH{constructor(a,b,c,d){this._indexId=a,this._documentKey=b,this._arrayValue=c,this._directionalValue=d}successor(){let a=this._directionalValue.length,b=0===a||255===this._directionalValue[a-1]?a+1:a,c=new Uint8Array(b);return c.set(this._directionalValue,0),b!==a?c.set([0],this._directionalValue.length):++c[c.length-1],new mH(this._indexId,this._documentKey,this._arrayValue,c)}dbIndexEntry(a,b,c){return{indexId:this._indexId,uid:a,arrayValue:mK(this._arrayValue),directionalValue:mK(this._directionalValue),orderedDocumentKey:mK(b),documentKey:c.path.toArray()}}dbIndexEntryKey(a,b,c){let d=this.dbIndexEntry(a,b,c);return[d.indexId,d.uid,d.arrayValue,d.directionalValue,d.orderedDocumentKey,d.documentKey]}}function mI(a,b){let c=a._indexId-b._indexId;return 0!==c||0!==(c=mJ(a._arrayValue,b._arrayValue))||0!==(c=mJ(a._directionalValue,b._directionalValue))?c:ex.comparator(a._documentKey,b._documentKey)}function mJ(a,b){for(let c=0;c<a.length&&c<b.length;++c){let d=a[c]-b[c];if(0!==d)return d}return a.length-b.length}function mK(a){return G()?mM(a):a}function mL(a){return"string"!=typeof a?a:mN(a)}function mM(a){let b="";for(let c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return b}function mN(a){let b=new Uint8Array(a.length);for(let c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b}class mO{constructor(a){for(const b of(this.inequalityFilters=new gH((a,b)=>ew.comparator(a.field,b.field)),this.collectionId=null!=a.collectionGroup?a.collectionGroup:a.path.lastSegment(),this.orderBys=a.orderBy,this.equalityFilters=[],a.filters)){const a=b;a.isInequality()?this.inequalityFilters=this.inequalityFilters.add(a):this.equalityFilters.push(a)}}get hasMultipleInequality(){return this.inequalityFilters.size>1}servedByIndex(a){if(dS(a.collectionGroup===this.collectionId,49279),this.hasMultipleInequality)return!1;let b=eP(a);if(void 0!==b&&!this.hasMatchingEqualityFilter(b))return!1;let c=eQ(a),d=new Set,e=0,f=0;for(;e<c.length;++e)if(this.hasMatchingEqualityFilter(c[e]))d=d.add(c[e].fieldPath.canonicalString());else break;if(e===c.length)return!0;if(this.inequalityFilters.size>0){let a=this.inequalityFilters.getIterator().getNext();if(!d.has(a.field.canonicalString())){let b=c[e];if(!this.matchesFilter(a,b)||!this.matchesOrderBy(this.orderBys[f++],b))return!1}++e}for(;e<c.length;++e){let a=c[e];if(f>=this.orderBys.length||!this.matchesOrderBy(this.orderBys[f++],a))return!1}return!0}buildTargetIndex(){if(this.hasMultipleInequality)return null;let a=new gH(ew.comparator),b=[];for(let c of this.equalityFilters)if(!c.field.isKeyField())if("array-contains"===c.op||"array-contains-any"===c.op)b.push(new eT(c.field,2));else{if(a.has(c.field))continue;a=a.add(c.field),b.push(new eT(c.field,0))}for(let c of this.orderBys)!c.field.isKeyField()&&(a.has(c.field)||(a=a.add(c.field),b.push(new eT(c.field,+("asc"!==c.dir)))));return new eO(eO.UNKNOWN_ID,this.collectionId,b,eU.empty())}hasMatchingEqualityFilter(a){for(let b of this.equalityFilters)if(this.matchesFilter(b,a))return!0;return!1}matchesFilter(a,b){if(void 0===a||!a.field.isEqual(b.fieldPath))return!1;let c="array-contains"===a.op||"array-contains-any"===a.op;return 2===b.kind===c}matchesOrderBy(a,b){return!!a.field.isEqual(b.fieldPath)&&(0===b.kind&&"asc"===a.dir||1===b.kind&&"desc"===a.dir)}}function mP(a){if(dS(a instanceof h9||a instanceof ia,20012),a instanceof h9)if(!(a instanceof iu))return a;else{let b=a.value.arrayValue?.values?.map(b=>h9.create(a.field,"==",b))||[];return ia.create(b,"or")}let b=a.filters.map(a=>mP(a));return ia.create(b,a.op)}function mQ(a){if(0===a.getFilters().length)return[];let b=mV(mP(a));return(dS(mT(b),7391),mR(b)||mS(b))?[b]:b.getFilters()}function mR(a){return a instanceof h9}function mS(a){return a instanceof ia&&id(a)}function mT(a){return mR(a)||mS(a)||mU(a)}function mU(a){if(a instanceof ia&&ic(a)){for(let b of a.getFilters())if(!mR(b)&&!mS(b))return!1;return!0}return!1}function mV(a){if(dS(a instanceof h9||a instanceof ia,34018),a instanceof h9)return a;if(1===a.filters.length)return mV(a.filters[0]);let b=a.filters.map(a=>mV(a)),c=ia.create(b,a.op);return mT(c=m$(c))?c:(dS(c instanceof ia,64498),dS(ib(c),40251),dS(c.filters.length>1,57927),c.filters.reduce((a,b)=>mW(a,b)))}function mW(a,b){let c;return dS(a instanceof h9||a instanceof ia,38388),dS(b instanceof h9||b instanceof ia,25473),m$(c=a instanceof h9?b instanceof h9?mX(a,b):mZ(a,b):b instanceof h9?mZ(b,a):mY(a,b))}function mX(a,b){return ia.create([a,b],"and")}function mY(a,b){if(dS(a.filters.length>0&&b.filters.length>0,48005),ib(a)&&ib(b))return ik(a,b.getFilters());let c=ic(a)?a:b,d=ic(a)?b:a,e=c.filters.map(a=>mW(a,d));return ia.create(e,"or")}function mZ(a,b){if(ib(b))return ik(b,a.getFilters());{let c=b.filters.map(b=>mW(a,b));return ia.create(c,"or")}}function m$(a){if(dS(a instanceof h9||a instanceof ia,11850),a instanceof h9)return a;let b=a.getFilters();if(1===b.length)return m$(b[0]);if(ie(a))return a;let c=b.map(a=>m$(a)),d=[];return(c.forEach(b=>{b instanceof h9?d.push(b):b instanceof ia&&(b.op===a.op?d.push(...b.filters):d.push(b))}),1===d.length)?d[0]:ia.create(d,a.op)}class m_{constructor(){this.collectionParentIndex=new m0}addToCollectionParentIndex(a,b){return this.collectionParentIndex.add(b),e0.resolve()}getCollectionParents(a,b){return e0.resolve(this.collectionParentIndex.getEntries(b))}addFieldIndex(a,b){return e0.resolve()}deleteFieldIndex(a,b){return e0.resolve()}deleteAllFieldIndexes(a){return e0.resolve()}createTargetIndexes(a,b){return e0.resolve()}getDocumentsMatchingTarget(a,b){return e0.resolve(null)}getIndexType(a,b){return e0.resolve(0)}getFieldIndexes(a,b){return e0.resolve([])}getNextCollectionGroupToUpdate(a){return e0.resolve(null)}getMinOffset(a,b){return e0.resolve(eX.min())}getMinOffsetFromCollectionGroup(a,b){return e0.resolve(eX.min())}updateCollectionGroup(a,b,c){return e0.resolve()}updateIndexEntries(a,b){return e0.resolve()}}class m0{constructor(){this.index={}}add(a){let b=a.lastSegment(),c=a.popLast(),d=this.index[b]||new gH(eu.comparator),e=!d.has(c);return this.index[b]=d.add(c),e}has(a){let b=a.lastSegment(),c=a.popLast(),d=this.index[b];return d&&d.has(c)}getEntries(a){return(this.index[a]||new gH(eu.comparator)).toArray()}}let m1="IndexedDbIndexManager",m2=new Uint8Array(0);class m3{constructor(a,b){this.databaseId=b,this.collectionParentsCache=new m0,this.targetToDnfSubTargets=new ja(a=>iz(a),(a,b)=>iB(a,b)),this.uid=a.uid||""}addToCollectionParentIndex(a,b){if(!this.collectionParentsCache.has(b)){let c=b.lastSegment(),d=b.popLast();a.addOnCommittedListener(()=>{this.collectionParentsCache.add(b)});let e={collectionId:c,parent:fo(d)};return m4(a).put(e)}return e0.resolve()}getCollectionParents(a,b){let c=[],d=IDBKeyRange.bound([b,""],[er(b),""],!1,!0);return m4(a).loadAll(d).next(a=>{for(let d of a){if(d.collectionId!==b)break;c.push(fr(d.parent))}return c})}addFieldIndex(a,b){let c=m6(a),d=l0(b);delete d.indexId;let e=c.add(d);if(!b.indexState)return e.next();{let c=m7(a);return e.next(a=>{c.put(l2(a,this.uid,b.indexState.sequenceNumber,b.indexState.offset))})}}deleteFieldIndex(a,b){let c=m6(a),d=m7(a),e=m5(a);return c.delete(b.indexId).next(()=>d.delete(IDBKeyRange.bound([b.indexId],[b.indexId+1],!1,!0))).next(()=>e.delete(IDBKeyRange.bound([b.indexId],[b.indexId+1],!1,!0)))}deleteAllFieldIndexes(a){let b=m6(a),c=m5(a),d=m7(a);return b.deleteAll().next(()=>c.deleteAll()).next(()=>d.deleteAll())}createTargetIndexes(a,b){return e0.forEach(this.getSubTargets(b),b=>this.getIndexType(a,b).next(c=>{if(0===c||1===c){let c=new mO(b).buildTargetIndex();if(null!=c)return this.addFieldIndex(a,c)}}))}getDocumentsMatchingTarget(a,b){let c=m5(a),d=!0,e=new Map;return e0.forEach(this.getSubTargets(b),b=>this.getFieldIndex(a,b).next(a=>{d&&(d=!!a),e.set(b,a)})).next(()=>{if(!d)return e0.resolve(null);{let a=jn(),d=[];return e0.forEach(e,(e,f)=>{dM(m1,`Using index ${eS(e)} to execute ${iz(b)}`);let g=iE(f,e),h=iF(f,e),i=iG(f,e),j=iH(f,e),k=this.encodeBound(e,f,i),l=this.encodeBound(e,f,j),m=this.encodeValues(e,f,h),n=this.generateIndexRanges(e.indexId,g,k,i.inclusive,l,j.inclusive,m);return e0.forEach(n,e=>c.loadFirst(e,b.limit).next(b=>{b.forEach(b=>{let c=ex.fromSegments(b.documentKey);a.has(c)||(a=a.add(c),d.push(c))})}))}).next(()=>d)}})}getSubTargets(a){let b=this.targetToDnfSubTargets.get(a);return b||(b=0===a.filters.length?[a]:mQ(ia.create(a.filters,"and")).map(b=>iy(a.path,a.collectionGroup,a.orderBy,b.getFilters(),a.limit,a.startAt,a.endAt)),this.targetToDnfSubTargets.set(a,b)),b}generateIndexRanges(a,b,c,d,e,f,g){let h=(null!=b?b.length:1)*Math.max(c.length,e.length),i=h/(null!=b?b.length:1),j=[];for(let k=0;k<h;++k){let h=b?this.encodeSingleElement(b[k/i]):m2,l=this.generateLowerBound(a,h,c[k%i],d),m=this.generateUpperBound(a,h,e[k%i],f),n=g.map(b=>this.generateLowerBound(a,h,b,!0));j.push(...this.createRange(l,m,n))}return j}generateLowerBound(a,b,c,d){let e=new mH(a,ex.empty(),b,c);return d?e:e.successor()}generateUpperBound(a,b,c,d){let e=new mH(a,ex.empty(),b,c);return d?e.successor():e}getFieldIndex(a,b){let c=new mO(b),d=null!=b.collectionGroup?b.collectionGroup:b.path.lastSegment();return this.getFieldIndexes(a,d).next(a=>{let b=null;for(let d of a)c.servedByIndex(d)&&(!b||d.fields.length>b.fields.length)&&(b=d);return b})}getIndexType(a,b){let c=2,d=this.getSubTargets(b);return e0.forEach(d,b=>this.getFieldIndex(a,b).next(a=>{a?0!==c&&a.fields.length<iK(b)&&(c=1):c=0})).next(()=>iL(b)&&d.length>1&&2===c?1:c)}encodeDirectionalElements(a,b){let c=new mG;for(let d of eQ(a)){let a=b.data.field(d.fieldPath);if(null==a)return null;let e=c.forKind(d.kind);mn.INSTANCE.writeIndexValue(a,e)}return c.encodedBytes()}encodeSingleElement(a){let b=new mG;return mn.INSTANCE.writeIndexValue(a,b.forKind(0)),b.encodedBytes()}encodeDirectionalKey(a,b){let c=new mG;return mn.INSTANCE.writeIndexValue(hH(this.databaseId,b),c.forKind(eR(a))),c.encodedBytes()}encodeValues(a,b,c){if(null===c)return[];let d=[];d.push(new mG);let e=0;for(let f of eQ(a)){let a=c[e++];for(let c of d)if(this.isInFilter(b,f.fieldPath)&&hL(a))d=this.expandIndexValues(d,f,a);else{let b=c.forKind(f.kind);mn.INSTANCE.writeIndexValue(a,b)}}return this.getEncodedBytes(d)}encodeBound(a,b,c){return this.encodeValues(a,b,c.position)}getEncodedBytes(a){let b=[];for(let c=0;c<a.length;++c)b[c]=a[c].encodedBytes();return b}expandIndexValues(a,b,c){let d=[...a],e=[];for(let a of c.arrayValue.values||[])for(let c of d){let d=new mG;d.seed(c.encodedBytes()),mn.INSTANCE.writeIndexValue(a,d.forKind(b.kind)),e.push(d)}return e}isInFilter(a,b){return!!a.filters.find(a=>a instanceof h9&&a.field.isEqual(b)&&("in"===a.op||"not-in"===a.op))}getFieldIndexes(a,b){let c=m6(a),d=m7(a);return(b?c.loadAll(f6,IDBKeyRange.bound(b,b)):c.loadAll()).next(a=>{let b=[];return e0.forEach(a,a=>d.get([a.indexId,this.uid]).next(c=>{b.push(l1(a,c))})).next(()=>b)})}getNextCollectionGroupToUpdate(a){return this.getFieldIndexes(a).next(a=>0===a.length?null:(a.sort((a,b)=>{let c=a.indexState.sequenceNumber-b.indexState.sequenceNumber;return 0!==c?c:el(a.collectionGroup,b.collectionGroup)}),a[0].collectionGroup))}updateCollectionGroup(a,b,c){let d=m6(a),e=m7(a);return this.getNextSequenceNumber(a).next(a=>d.loadAll(f6,IDBKeyRange.bound(b,b)).next(b=>e0.forEach(b,b=>e.put(l2(b.indexId,this.uid,a,c)))))}updateIndexEntries(a,b){let c=new Map;return e0.forEach(b,(b,d)=>{let e=c.get(b.collectionGroup);return(e?e0.resolve(e):this.getFieldIndexes(a,b.collectionGroup)).next(e=>(c.set(b.collectionGroup,e),e0.forEach(e,c=>this.getExistingIndexEntries(a,b,c).next(b=>{let e=this.computeIndexEntries(d,c);return b.isEqual(e)?e0.resolve():this.updateEntries(a,d,c,b,e)}))))})}addIndexEntry(a,b,c,d){return m5(a).put(d.dbIndexEntry(this.uid,this.encodeDirectionalKey(c,b.key),b.key))}deleteIndexEntry(a,b,c,d){return m5(a).delete(d.dbIndexEntryKey(this.uid,this.encodeDirectionalKey(c,b.key),b.key))}getExistingIndexEntries(a,b,c){let d=m5(a),e=new gH(mI);return d.iterate({index:ge,range:IDBKeyRange.only([c.indexId,this.uid,mK(this.encodeDirectionalKey(c,b))])},(a,d)=>{e=e.add(new mH(c.indexId,b,mL(d.arrayValue),mL(d.directionalValue)))}).next(()=>e)}computeIndexEntries(a,b){let c=new gH(mI),d=this.encodeDirectionalElements(b,a);if(null==d)return c;let e=eP(b);if(null!=e){let f=a.data.field(e.fieldPath);if(hL(f))for(let e of f.arrayValue.values||[])c=c.add(new mH(b.indexId,a.key,this.encodeSingleElement(e),d))}else c=c.add(new mH(b.indexId,a.key,m2,d));return c}updateEntries(a,b,c,d,e){dM(m1,"Updating index entries for document '%s'",b.key);let f=[];return gJ(d,e,mI,d=>{f.push(this.addIndexEntry(a,b,c,d))},d=>{f.push(this.deleteIndexEntry(a,b,c,d))}),e0.waitFor(f)}getNextSequenceNumber(a){let b=1;return m7(a).iterate({index:ga,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(a,c,d)=>{d.done(),b=c.sequenceNumber+1}).next(()=>b)}createRange(a,b,c){c=c.sort((a,b)=>mI(a,b)).filter((a,b,c)=>!b||0!==mI(a,c[b-1]));let d=[];for(let e of(d.push(a),c)){let c=mI(e,a),f=mI(e,b);if(0===c)d[0]=a.successor();else if(c>0&&f<0)d.push(e),d.push(e.successor());else if(f>0)break}d.push(b);let e=[];for(let a=0;a<d.length;a+=2){if(this.isRangeMatchable(d[a],d[a+1]))return[];let b=d[a].dbIndexEntryKey(this.uid,m2,ex.empty()),c=d[a+1].dbIndexEntryKey(this.uid,m2,ex.empty());e.push(IDBKeyRange.bound(b,c))}return e}isRangeMatchable(a,b){return mI(a,b)>0}getMinOffsetFromCollectionGroup(a,b){return this.getFieldIndexes(a,b).next(m8)}getMinOffset(a,b){return e0.mapArray(this.getSubTargets(b),b=>this.getFieldIndex(a,b).next(a=>a||dQ(44426))).next(m8)}}function m4(a){return gy(a,fY)}function m5(a){return gy(a,gc)}function m6(a){return gy(a,f4)}function m7(a){return gy(a,f8)}function m8(a){dS(0!==a.length,28825);let b=a[0].indexState.offset,c=b.largestBatchId;for(let d=1;d<a.length;d++){let e=a[d].indexState.offset;0>eY(e,b)&&(b=e),c<e.largestBatchId&&(c=e.largestBatchId)}return new eX(b.readTime,b.documentKey,c)}function m9(a,b,c){let d=a.store(fx),e=a.store(fF),f=[],g=IDBKeyRange.only(c.batchId),h=0,i=d.iterate({range:g},(a,b,c)=>(h++,c.delete()));f.push(i.next(()=>{dS(1===h,47070,{batchId:c.batchId})}));let j=[];for(let a of c.mutations){let d=fD(b,a.key.path,c.batchId);f.push(e.delete(d)),j.push(a.key)}return e0.waitFor(f).next(()=>j)}function na(a){let b;if(!a)return 0;if(a.document)b=a.document;else if(a.unknownDocument)b=a.unknownDocument;else if(a.noDocument)b=a.noDocument;else throw dQ(14731);return JSON.stringify(b).length}class nb{constructor(a,b,c,d){this.userId=a,this.serializer=b,this.indexManager=c,this.referenceDelegate=d,this.documentKeysByBatchId={}}static forUser(a,b,c,d){return dS(""!==a.uid,64387),new nb(a.isAuthenticated()?a.uid:"",b,c,d)}checkEmpty(a){let b=!0,c=IDBKeyRange.bound([this.userId,-1/0],[this.userId,1/0]);return ne(a).iterate({index:fz,range:c},(a,c,d)=>{b=!1,d.done()}).next(()=>b)}addMutationBatch(a,b,c,d){let e=nf(a),f=ne(a);return f.add({}).next(g=>{dS("number"==typeof g,49019);let h=new j4(g,b,c,d),i=lN(this.serializer,this.userId,h),j=[],k=new gH((a,b)=>el(a.canonicalString(),b.canonicalString()));for(let a of d){let b=fD(this.userId,a.key.path,g);k=k.add(a.key.path.popLast()),j.push(f.put(i)),j.push(e.put(b,fE))}return k.forEach(b=>{j.push(this.indexManager.addToCollectionParentIndex(a,b))}),a.addOnCommittedListener(()=>{this.documentKeysByBatchId[g]=h.keys()}),e0.waitFor(j).next(()=>h)})}lookupMutationBatch(a,b){return ne(a).get(b).next(a=>a?(dS(a.userId===this.userId,48,"Unexpected user for mutation batch",{userId:a.userId,batchId:b}),lO(this.serializer,a)):null)}lookupMutationKeys(a,b){return this.documentKeysByBatchId[b]?e0.resolve(this.documentKeysByBatchId[b]):this.lookupMutationBatch(a,b).next(a=>{if(!a)return null;{let c=a.keys();return this.documentKeysByBatchId[b]=c,c}})}getNextMutationBatchAfterBatchId(a,b){let c=b+1,d=IDBKeyRange.lowerBound([this.userId,c]),e=null;return ne(a).iterate({index:fz,range:d},(a,b,d)=>{b.userId===this.userId&&(dS(b.batchId>=c,47524,{nextBatchId:c}),e=lO(this.serializer,b)),d.done()}).next(()=>e)}getHighestUnacknowledgedBatchId(a){let b=IDBKeyRange.upperBound([this.userId,1/0]),c=g5;return ne(a).iterate({index:fz,range:b,reverse:!0},(a,b,d)=>{c=b.batchId,d.done()}).next(()=>c)}getAllMutationBatches(a){let b=IDBKeyRange.bound([this.userId,g5],[this.userId,1/0]);return ne(a).loadAll(fz,b).next(a=>a.map(a=>lO(this.serializer,a)))}getAllMutationBatchesAffectingDocumentKey(a,b){let c=fC(this.userId,b.path),d=IDBKeyRange.lowerBound(c),e=[];return nf(a).iterate({range:d},(c,d,f)=>{let[g,h,i]=c,j=fr(h);return g===this.userId&&b.path.isEqual(j)?ne(a).get(i).next(a=>{if(!a)throw dQ(61480,{indexKey:c,batchId:i});dS(a.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:a.userId,batchId:i}),e.push(lO(this.serializer,a))}):void f.done()}).next(()=>e)}getAllMutationBatchesAffectingDocumentKeys(a,b){let c=new gH(el),d=[];return b.forEach(b=>{let e=fC(this.userId,b.path),f=IDBKeyRange.lowerBound(e),g=nf(a).iterate({range:f},(a,d,e)=>{let[f,g,h]=a,i=fr(g);f===this.userId&&b.path.isEqual(i)?c=c.add(h):e.done()});d.push(g)}),e0.waitFor(d).next(()=>this.lookupMutationBatches(a,c))}getAllMutationBatchesAffectingQuery(a,b){let c=b.path,d=c.length+1,e=fC(this.userId,c),f=IDBKeyRange.lowerBound(e),g=new gH(el);return nf(a).iterate({range:f},(a,b,e)=>{let[f,h,i]=a,j=fr(h);f===this.userId&&c.isPrefixOf(j)?j.length===d&&(g=g.add(i)):e.done()}).next(()=>this.lookupMutationBatches(a,g))}lookupMutationBatches(a,b){let c=[],d=[];return b.forEach(b=>{d.push(ne(a).get(b).next(a=>{if(null===a)throw dQ(35274,{batchId:b});dS(a.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:a.userId,batchId:b}),c.push(lO(this.serializer,a))}))}),e0.waitFor(d).next(()=>c)}removeMutationBatch(a,b){return m9(a.simpleDbTransaction,this.userId,b).next(c=>(a.addOnCommittedListener(()=>{this.removeCachedMutationKeys(b.batchId)}),e0.forEach(c,b=>this.referenceDelegate.markPotentiallyOrphaned(a,b))))}removeCachedMutationKeys(a){delete this.documentKeysByBatchId[a]}performConsistencyCheck(a){return this.checkEmpty(a).next(b=>{if(!b)return e0.resolve();let c=IDBKeyRange.lowerBound(fB(this.userId)),d=[];return nf(a).iterate({range:c},(a,b,c)=>{if(a[0]!==this.userId)return void c.done();{let b=fr(a[1]);d.push(b)}}).next(()=>{dS(0===d.length,56720,{danglingKeys:d.map(a=>a.canonicalString())})})})}containsKey(a,b){return nc(a,this.userId,b)}getMutationQueueMetadata(a){return ng(a).get(this.userId).next(a=>a||{userId:this.userId,lastAcknowledgedBatchId:g5,lastStreamToken:""})}}function nc(a,b,c){let d=fC(b,c.path),e=d[1],f=IDBKeyRange.lowerBound(d),g=!1;return nf(a).iterate({range:f,keysOnly:!0},(a,c,d)=>{let[f,h,i]=a;f===b&&h===e&&(g=!0),d.done()}).next(()=>g)}function nd(a,b){let c=!1;return ng(a).iterateSerial(d=>nc(a,d,b).next(a=>(a&&(c=!0),e0.resolve(!a)))).next(()=>c)}function ne(a){return gy(a,fx)}function nf(a){return gy(a,fF)}function ng(a){return gy(a,fv)}let nh=2;class ni{constructor(a){this.lastId=a}next(){return this.lastId+=nh,this.lastId}static forTargetCache(){return new ni(2-nh)}static forSyncEngine(){return new ni(1-nh)}}class nj{constructor(a,b){this.referenceDelegate=a,this.serializer=b}allocateTargetId(a){return this.retrieveMetadata(a).next(b=>{let c=new ni(b.highestTargetId);return b.highestTargetId=c.next(),this.saveMetadata(a,b).next(()=>b.highestTargetId)})}getLastRemoteSnapshotVersion(a){return this.retrieveMetadata(a).next(a=>eL.fromTimestamp(new eK(a.lastRemoteSnapshotVersion.seconds,a.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(a){return this.retrieveMetadata(a).next(a=>a.highestListenSequenceNumber)}setTargetsMetadata(a,b,c){return this.retrieveMetadata(a).next(d=>(d.highestListenSequenceNumber=b,c&&(d.lastRemoteSnapshotVersion=c.toTimestamp()),b>d.highestListenSequenceNumber&&(d.highestListenSequenceNumber=b),this.saveMetadata(a,d)))}addTargetData(a,b){return this.saveTargetData(a,b).next(()=>this.retrieveMetadata(a).next(c=>(c.targetCount+=1,this.updateMetadataFromTargetData(b,c),this.saveMetadata(a,c))))}updateTargetData(a,b){return this.saveTargetData(a,b)}removeTargetData(a,b){return this.removeMatchingKeysForTargetId(a,b.targetId).next(()=>nk(a).delete(b.targetId)).next(()=>this.retrieveMetadata(a)).next(b=>(dS(b.targetCount>0,8065),b.targetCount-=1,this.saveMetadata(a,b)))}removeTargets(a,b,c){let d=0,e=[];return nk(a).iterate((f,g)=>{let h=lP(g);h.sequenceNumber<=b&&null===c.get(h.targetId)&&(d++,e.push(this.removeTargetData(a,h)))}).next(()=>e0.waitFor(e)).next(()=>d)}forEachTarget(a,b){return nk(a).iterate((a,c)=>{b(lP(c))})}retrieveMetadata(a){return nl(a).get(fW).next(a=>(dS(null!==a,2888),a))}saveMetadata(a,b){return nl(a).put(fW,b)}saveTargetData(a,b){return nk(a).put(lQ(this.serializer,b))}updateMetadataFromTargetData(a,b){let c=!1;return a.targetId>b.highestTargetId&&(b.highestTargetId=a.targetId,c=!0),a.sequenceNumber>b.highestListenSequenceNumber&&(b.highestListenSequenceNumber=a.sequenceNumber,c=!0),c}getTargetCount(a){return this.retrieveMetadata(a).next(a=>a.targetCount)}getTargetData(a,b){let c=iz(b),d=IDBKeyRange.bound([c,-1/0],[c,1/0]),e=null;return nk(a).iterate({range:d,index:fQ},(a,c,d)=>{let f=lP(c);iB(b,f.target)&&(e=f,d.done())}).next(()=>e)}addMatchingKeys(a,b,c){let d=[],e=nm(a);return b.forEach(b=>{let f=fo(b.path);d.push(e.put({targetId:c,path:f})),d.push(this.referenceDelegate.addReference(a,c,b))}),e0.waitFor(d)}removeMatchingKeys(a,b,c){let d=nm(a);return e0.forEach(b,b=>{let e=fo(b.path);return e0.waitFor([d.delete([c,e]),this.referenceDelegate.removeReference(a,c,b)])})}removeMatchingKeysForTargetId(a,b){let c=nm(a),d=IDBKeyRange.bound([b],[b+1],!1,!0);return c.delete(d)}getMatchingKeysForTargetId(a,b){let c=IDBKeyRange.bound([b],[b+1],!1,!0),d=nm(a),e=jn();return d.iterate({range:c,keysOnly:!0},(a,b,c)=>{let d=new ex(fr(a[1]));e=e.add(d)}).next(()=>e)}containsKey(a,b){let c=fo(b.path),d=IDBKeyRange.bound([c],[er(c)],!1,!0),e=0;return nm(a).iterate({index:fU,keysOnly:!0,range:d},([a,b],c,d)=>{0!==a&&(e++,d.done())}).next(()=>e>0)}getTargetDataForTarget(a,b){return nk(a).get(b).next(a=>a?lP(a):null)}}function nk(a){return gy(a,fO)}function nl(a){return gy(a,fX)}function nm(a){return gy(a,fS)}let nn={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},no=-1,np=0x2800000;class nq{static withCacheSize(a){return new nq(a,nq.DEFAULT_COLLECTION_PERCENTILE,nq.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(a,b,c){this.cacheSizeCollectionThreshold=a,this.percentileToCollect=b,this.maximumSequenceNumbersToCollect=c}}nq.DEFAULT_COLLECTION_PERCENTILE=10,nq.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,nq.DEFAULT=new nq(np,nq.DEFAULT_COLLECTION_PERCENTILE,nq.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),nq.DISABLED=new nq(no,0,0);let nr="LruGarbageCollector",ns=1048576,nt=6e4,nu=3e5;function nv([a,b],[c,d]){let e=el(a,c);return 0===e?el(b,d):e}class nw{constructor(a){this.maxElements=a,this.buffer=new gH(nv),this.previousIndex=0}nextIndex(){return++this.previousIndex}addElement(a){let b=[a,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(b);else{let a=this.buffer.last();0>nv(b,a)&&(this.buffer=this.buffer.delete(a).add(b))}}get maxValue(){return this.buffer.last()[0]}}class nx{constructor(a,b,c){this.garbageCollector=a,this.asyncQueue=b,this.localStore=c,this.gcTask=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==no&&this.scheduleGC(nt)}stop(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)}get started(){return null!==this.gcTask}scheduleGC(a){dM(nr,`Garbage collection scheduled in ${a}ms`),this.gcTask=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",a,async()=>{this.gcTask=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(a){e8(a)?dM(nr,"Ignoring IndexedDB error during garbage collection: ",a):await e_(a)}await this.scheduleGC(nu)})}}class ny{constructor(a,b){this.delegate=a,this.params=b}calculateTargetCount(a,b){return this.delegate.getSequenceNumberCount(a).next(a=>Math.floor(b/100*a))}nthSequenceNumber(a,b){if(0===b)return e0.resolve(fj.INVALID);let c=new nw(b);return this.delegate.forEachTarget(a,a=>c.addElement(a.sequenceNumber)).next(()=>this.delegate.forEachOrphanedDocumentSequenceNumber(a,a=>c.addElement(a))).next(()=>c.maxValue)}removeTargets(a,b,c){return this.delegate.removeTargets(a,b,c)}removeOrphanedDocuments(a,b){return this.delegate.removeOrphanedDocuments(a,b)}collect(a,b){return this.params.cacheSizeCollectionThreshold===no?(dM("LruGarbageCollector","Garbage collection skipped; disabled"),e0.resolve(nn)):this.getCacheSize(a).next(c=>c<this.params.cacheSizeCollectionThreshold?(dM("LruGarbageCollector",`Garbage collection skipped; Cache size ${c} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),nn):this.runGarbageCollection(a,b))}getCacheSize(a){return this.delegate.getCacheSize(a)}runGarbageCollection(a,b){let c,d,e,f,g,h,i,j=Date.now();return this.calculateTargetCount(a,this.params.percentileToCollect).next(b=>(b>this.params.maximumSequenceNumbersToCollect?(dM("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${b}`),d=this.params.maximumSequenceNumbersToCollect):d=b,f=Date.now(),this.nthSequenceNumber(a,d))).next(d=>(c=d,g=Date.now(),this.removeTargets(a,c,b))).next(b=>(e=b,h=Date.now(),this.removeOrphanedDocuments(a,c))).next(a=>(i=Date.now(),dL()<=de.DEBUG&&dM("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${f-j}ms
	Determined least recently used ${d} in ${g-f}ms
	Removed ${e} targets in ${h-g}ms
	Removed ${a} documents in ${i-h}ms
Total Duration: ${i-j}ms`),e0.resolve({didRun:!0,sequenceNumbersCollected:d,targetsRemoved:e,documentsRemoved:a})))}}function nz(a,b){return new ny(a,b)}class nA{constructor(a,b){this.db=a,this.garbageCollector=nz(this,b)}getSequenceNumberCount(a){let b=this.orphanedDocumentCount(a);return this.db.getTargetCache().getTargetCount(a).next(a=>b.next(b=>a+b))}orphanedDocumentCount(a){let b=0;return this.forEachOrphanedDocumentSequenceNumber(a,a=>{b++}).next(()=>b)}forEachTarget(a,b){return this.db.getTargetCache().forEachTarget(a,b)}forEachOrphanedDocumentSequenceNumber(a,b){return this.forEachOrphanedDocument(a,(a,c)=>b(c))}addReference(a,b,c){return nD(a,c)}removeReference(a,b,c){return nD(a,c)}removeTargets(a,b,c){return this.db.getTargetCache().removeTargets(a,b,c)}markPotentiallyOrphaned(a,b){return nD(a,b)}isPinned(a,b){return nd(a,b)}removeOrphanedDocuments(a,b){let c=this.db.getRemoteDocumentCache().newChangeBuffer(),d=[],e=0;return this.forEachOrphanedDocument(a,(f,g)=>{if(g<=b){let b=this.isPinned(a,f).next(b=>{if(!b)return e++,c.getEntry(a,f).next(()=>(c.removeEntry(f,eL.min()),nm(a).delete(nB(f))))});d.push(b)}}).next(()=>e0.waitFor(d)).next(()=>c.apply(a)).next(()=>e)}removeTarget(a,b){let c=b.withSequenceNumber(a.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(a,c)}updateLimboDocument(a,b){return nD(a,b)}forEachOrphanedDocument(a,b){let c,d=nm(a),e=fj.INVALID;return d.iterate({index:fU},([a,d],{path:f,sequenceNumber:g})=>{0===a?(e!==fj.INVALID&&b(new ex(fr(c)),e),e=g,c=f):e=fj.INVALID}).next(()=>{e!==fj.INVALID&&b(new ex(fr(c)),e)})}getCacheSize(a){return this.db.getRemoteDocumentCache().getSize(a)}}function nB(a){return[0,fo(a.path)]}function nC(a,b){return{targetId:0,path:fo(a.path),sequenceNumber:b}}function nD(a,b){return nm(a).put(nC(b,a.currentSequenceNumber))}class nE{constructor(){this.changes=new ja(a=>a.toString(),(a,b)=>a.isEqual(b)),this.changesApplied=!1}addEntry(a){this.assertNotApplied(),this.changes.set(a.key,a)}removeEntry(a,b){this.assertNotApplied(),this.changes.set(a,hZ.newInvalidDocument(a).setReadTime(b))}getEntry(a,b){this.assertNotApplied();let c=this.changes.get(b);return void 0!==c?e0.resolve(c):this.getFromCache(a,b)}getEntries(a,b){return this.getAllFromCache(a,b)}apply(a){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(a)}assertNotApplied(){}}class nF{constructor(a){this.serializer=a}setIndexManager(a){this.indexManager=a}addEntry(a,b,c){return nJ(a).put(c)}removeEntry(a,b,c){return nJ(a).delete(nL(b,c))}updateMetadata(a,b){return this.getMetadata(a).next(c=>(c.byteSize+=b,this.setMetadata(a,c)))}getEntry(a,b){let c=hZ.newInvalidDocument(b);return nJ(a).iterate({index:fI,range:IDBKeyRange.only(nK(b))},(a,d)=>{c=this.maybeDecodeDocument(b,d)}).next(()=>c)}getSizedEntry(a,b){let c={size:0,document:hZ.newInvalidDocument(b)};return nJ(a).iterate({index:fI,range:IDBKeyRange.only(nK(b))},(a,d)=>{c={document:this.maybeDecodeDocument(b,d),size:na(d)}}).next(()=>c)}getEntries(a,b){let c=jc();return this.forEachDbEntry(a,b,(a,b)=>{let d=this.maybeDecodeDocument(a,b);c=c.insert(a,d)}).next(()=>c)}getSizedEntries(a,b){let c=jc(),d=new gD(ex.comparator);return this.forEachDbEntry(a,b,(a,b)=>{let e=this.maybeDecodeDocument(a,b);c=c.insert(a,e),d=d.insert(a,na(b))}).next(()=>({documents:c,sizeMap:d}))}forEachDbEntry(a,b,c){if(b.isEmpty())return e0.resolve();let d=new gH(nN);b.forEach(a=>d=d.add(a));let e=IDBKeyRange.bound(nK(d.first()),nK(d.last())),f=d.getIterator(),g=f.getNext();return nJ(a).iterate({index:fI,range:e},(a,b,d)=>{let e=ex.fromSegments([...b.prefixPath,b.collectionGroup,b.documentId]);for(;g&&0>nN(g,e);)c(g,null),g=f.getNext();g&&g.isEqual(e)&&(c(g,b),g=f.hasNext()?f.getNext():null),g?d.skip(nK(g)):d.done()}).next(()=>{for(;g;)c(g,null),g=f.hasNext()?f.getNext():null})}getDocumentsMatchingQuery(a,b,c,d,e){let f=b.path,g=[f.popLast().toArray(),f.lastSegment(),lJ(c.readTime),c.documentKey.path.isEmpty()?"":c.documentKey.path.lastSegment()],h=[f.popLast().toArray(),f.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return nJ(a).loadAll(IDBKeyRange.bound(g,h,!0)).next(a=>{e?.incrementDocumentReadCount(a.length);let c=jc();for(let e of a){let a=this.maybeDecodeDocument(ex.fromSegments(e.prefixPath.concat(e.collectionGroup,e.documentId)),e);a.isFoundDocument()&&(i2(b,a)||d.has(a.key))&&(c=c.insert(a.key,a))}return c})}getAllFromCollectionGroup(a,b,c,d){let e=jc(),f=nM(b,c),g=nM(b,eX.max());return nJ(a).iterate({index:fK,range:IDBKeyRange.bound(f,g,!0)},(a,b,c)=>{let f=this.maybeDecodeDocument(ex.fromSegments(b.prefixPath.concat(b.collectionGroup,b.documentId)),b);(e=e.insert(f.key,f)).size===d&&c.done()}).next(()=>e)}newChangeBuffer(a){return new nH(this,!!a&&a.trackRemovals)}getSize(a){return this.getMetadata(a).next(a=>a.byteSize)}getMetadata(a){return nI(a).get(fN).next(a=>(dS(!!a,20021),a))}setMetadata(a,b){return nI(a).put(fN,b)}maybeDecodeDocument(a,b){if(b){let a=lH(this.serializer,b);if(!(a.isNoDocument()&&a.version.isEqual(eL.min())))return a}return hZ.newInvalidDocument(a)}}function nG(a){return new nF(a)}class nH extends nE{constructor(a,b){super(),this.documentCache=a,this.trackRemovals=b,this.documentStates=new ja(a=>a.toString(),(a,b)=>a.isEqual(b))}applyChanges(a){let b=[],c=0,d=new gH((a,b)=>el(a.canonicalString(),b.canonicalString()));return this.changes.forEach((e,f)=>{let g=this.documentStates.get(e);if(b.push(this.documentCache.removeEntry(a,e,g.readTime)),f.isValidDocument()){let h=lI(this.documentCache.serializer,f);d=d.add(e.path.popLast());let i=na(h);c+=i-g.size,b.push(this.documentCache.addEntry(a,e,h))}else if(c-=g.size,this.trackRemovals){let c=lI(this.documentCache.serializer,f.convertToNoDocument(eL.min()));b.push(this.documentCache.addEntry(a,e,c))}}),d.forEach(c=>{b.push(this.documentCache.indexManager.addToCollectionParentIndex(a,c))}),b.push(this.documentCache.updateMetadata(a,c)),e0.waitFor(b)}getFromCache(a,b){return this.documentCache.getSizedEntry(a,b).next(a=>(this.documentStates.set(b,{size:a.size,readTime:a.document.readTime}),a.document))}getAllFromCache(a,b){return this.documentCache.getSizedEntries(a,b).next(({documents:a,sizeMap:b})=>(b.forEach((b,c)=>{this.documentStates.set(b,{size:c,readTime:a.get(b).readTime})}),a))}}function nI(a){return gy(a,fM)}function nJ(a){return gy(a,fG)}function nK(a){let b=a.path.toArray();return[b.slice(0,b.length-2),b[b.length-2],b[b.length-1]]}function nL(a,b){let c=a.path.toArray();return[c.slice(0,c.length-2),c[c.length-2],lJ(b),c[c.length-1]]}function nM(a,b){let c=b.documentKey.path.toArray();return[a,lJ(b.readTime),c.slice(0,c.length-2),c.length>0?c[c.length-1]:""]}function nN(a,b){let c=a.path.toArray(),d=b.path.toArray(),e=0;for(let a=0;a<c.length-2&&a<d.length-2;++a)if(e=el(c[a],d[a]))return e;return(e=el(c.length,d.length))||(e=el(c[c.length-2],d[d.length-2]))?e:el(c[c.length-1],d[d.length-1])}let nO=18;class nP{constructor(a,b){this.overlayedDocument=a,this.mutatedFields=b}}class nQ{constructor(a,b,c,d){this.remoteDocumentCache=a,this.mutationQueue=b,this.documentOverlayCache=c,this.indexManager=d}getDocument(a,b){let c=null;return this.documentOverlayCache.getOverlay(a,b).next(d=>(c=d,this.remoteDocumentCache.getEntry(a,b))).next(a=>(null!==c&&jQ(c.mutation,a,gL.empty(),eK.now()),a))}getDocuments(a,b){return this.remoteDocumentCache.getEntries(a,b).next(b=>this.getLocalViewOfDocuments(a,b,jn()).next(()=>b))}getLocalViewOfDocuments(a,b,c=jn()){let d=jh();return this.populateOverlays(a,d,b).next(()=>this.computeViews(a,b,d,c).next(a=>{let b=je();return a.forEach((a,c)=>{b=b.insert(a,c.overlayedDocument)}),b}))}getOverlayedDocuments(a,b){let c=jh();return this.populateOverlays(a,c,b).next(()=>this.computeViews(a,b,c,jn()))}populateOverlays(a,b,c){let d=[];return c.forEach(a=>{b.has(a)||d.push(a)}),this.documentOverlayCache.getOverlays(a,d).next(a=>{a.forEach((a,c)=>{b.set(a,c)})})}computeViews(a,b,c,d){let e=jc(),f=jj(),g=jf();return b.forEach((a,b)=>{let g=c.get(b.key);d.has(b.key)&&(void 0===g||g.mutation instanceof jW)?e=e.insert(b.key,b):void 0!==g?(f.set(b.key,g.mutation.getFieldMask()),jQ(g.mutation,b,g.mutation.getFieldMask(),eK.now())):f.set(b.key,gL.empty())}),this.recalculateAndSaveOverlays(a,e).next(a=>(a.forEach((a,b)=>f.set(a,b)),b.forEach((a,b)=>g.set(a,new nP(b,f.get(a)??null))),g))}recalculateAndSaveOverlays(a,b){let c=jj(),d=new gD((a,b)=>a-b),e=jn();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(a,b).next(a=>{for(let e of a)e.keys().forEach(a=>{let f=b.get(a);if(null===f)return;let g=c.get(a)||gL.empty();g=e.applyToLocalView(f,g),c.set(a,g);let h=(d.get(e.batchId)||jn()).add(a);d=d.insert(e.batchId,h)})}).next(()=>{let f=[],g=d.getReverseIterator();for(;g.hasNext();){let d=g.getNext(),h=d.key,i=d.value,j=ji();i.forEach(a=>{if(!e.has(a)){let d=jO(b.get(a),c.get(a));null!==d&&j.set(a,d),e=e.add(a)}}),f.push(this.documentOverlayCache.saveOverlays(a,h,j))}return e0.waitFor(f)}).next(()=>c)}recalculateAndSaveOverlaysForDocumentKeys(a,b){return this.remoteDocumentCache.getEntries(a,b).next(b=>this.recalculateAndSaveOverlays(a,b))}getDocumentsMatchingQuery(a,b,c,d){return iS(b)?this.getDocumentsMatchingDocumentQuery(a,b.path):iT(b)?this.getDocumentsMatchingCollectionGroupQuery(a,b,c,d):this.getDocumentsMatchingCollectionQuery(a,b,c,d)}getNextDocuments(a,b,c,d){return this.remoteDocumentCache.getAllFromCollectionGroup(a,b,c,d).next(e=>{let f=d-e.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(a,b,c.largestBatchId,d-e.size):e0.resolve(jh()),g=eM,h=e;return f.next(b=>e0.forEach(b,(b,c)=>(g<c.largestBatchId&&(g=c.largestBatchId),e.get(b))?e0.resolve():this.remoteDocumentCache.getEntry(a,b).next(a=>{h=h.insert(b,a)})).next(()=>this.populateOverlays(a,b,e)).next(()=>this.computeViews(a,h,b,jn())).next(a=>({batchId:g,changes:jg(a)})))})}getDocumentsMatchingDocumentQuery(a,b){return this.getDocument(a,new ex(b)).next(a=>{let b=je();return a.isFoundDocument()&&(b=b.insert(a.key,a)),b})}getDocumentsMatchingCollectionGroupQuery(a,b,c,d){let e=b.collectionGroup,f=je();return this.indexManager.getCollectionParents(a,e).next(g=>e0.forEach(g,g=>{let h=iP(b,g.child(e));return this.getDocumentsMatchingCollectionQuery(a,h,c,d).next(a=>{a.forEach((a,b)=>{f=f.insert(a,b)})})}).next(()=>f))}getDocumentsMatchingCollectionQuery(a,b,c,d){let e;return this.documentOverlayCache.getOverlaysForCollection(a,b.path,c.largestBatchId).next(f=>(e=f,this.remoteDocumentCache.getDocumentsMatchingQuery(a,b,c,e,d))).next(a=>{e.forEach((b,c)=>{let d=c.getKey();null===a.get(d)&&(a=a.insert(d,hZ.newInvalidDocument(d)))});let c=je();return a.forEach((a,d)=>{let f=e.get(a);void 0!==f&&jQ(f.mutation,d,gL.empty(),eK.now()),i2(b,d)&&(c=c.insert(a,d))}),c})}}class nR{constructor(a){this.serializer=a,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(a,b){return e0.resolve(this.bundles.get(b))}saveBundleMetadata(a,b){return this.bundles.set(b.id,lY(b)),e0.resolve()}getNamedQuery(a,b){return e0.resolve(this.namedQueries.get(b))}saveNamedQuery(a,b){return this.namedQueries.set(b.name,lX(b)),e0.resolve()}}class nS{constructor(){this.overlays=new gD(ex.comparator),this.overlayByBatchId=new Map}getOverlay(a,b){return e0.resolve(this.overlays.get(b))}getOverlays(a,b){let c=jh();return e0.forEach(b,b=>this.getOverlay(a,b).next(a=>{null!==a&&c.set(b,a)})).next(()=>c)}saveOverlays(a,b,c){return c.forEach((c,d)=>{this.saveOverlay(a,b,d)}),e0.resolve()}removeOverlaysForBatchId(a,b,c){let d=this.overlayByBatchId.get(c);return void 0!==d&&(d.forEach(a=>this.overlays=this.overlays.remove(a)),this.overlayByBatchId.delete(c)),e0.resolve()}getOverlaysForCollection(a,b,c){let d=jh(),e=b.length+1,f=new ex(b.child("")),g=this.overlays.getIteratorFrom(f);for(;g.hasNext();){let a=g.getNext().value,f=a.getKey();if(!b.isPrefixOf(f.path))break;f.path.length===e&&a.largestBatchId>c&&d.set(a.getKey(),a)}return e0.resolve(d)}getOverlaysForCollectionGroup(a,b,c,d){let e=new gD((a,b)=>a-b),f=this.overlays.getIterator();for(;f.hasNext();){let a=f.getNext().value;if(a.getKey().getCollectionGroup()===b&&a.largestBatchId>c){let b=e.get(a.largestBatchId);null===b&&(b=jh(),e=e.insert(a.largestBatchId,b)),b.set(a.getKey(),a)}}let g=jh(),h=e.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach((a,b)=>g.set(a,b)),!(g.size()>=d)););return e0.resolve(g)}saveOverlay(a,b,c){let d=this.overlays.get(c.key);if(null!==d){let a=this.overlayByBatchId.get(d.largestBatchId).delete(c.key);this.overlayByBatchId.set(d.largestBatchId,a)}this.overlays=this.overlays.insert(c.key,new j6(b,c));let e=this.overlayByBatchId.get(b);void 0===e&&(e=jn(),this.overlayByBatchId.set(b,e)),this.overlayByBatchId.set(b,e.add(c.key))}}class nT{constructor(){this.sessionToken=gO.EMPTY_BYTE_STRING}getSessionToken(a){return e0.resolve(this.sessionToken)}setSessionToken(a,b){return this.sessionToken=b,e0.resolve()}}class nU{constructor(){this.refsByKey=new gH(nV.compareByKey),this.refsByTarget=new gH(nV.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(a,b){let c=new nV(a,b);this.refsByKey=this.refsByKey.add(c),this.refsByTarget=this.refsByTarget.add(c)}addReferences(a,b){a.forEach(a=>this.addReference(a,b))}removeReference(a,b){this.removeRef(new nV(a,b))}removeReferences(a,b){a.forEach(a=>this.removeReference(a,b))}removeReferencesForId(a){let b=new ex(new eu([])),c=new nV(b,a),d=new nV(b,a+1),e=[];return this.refsByTarget.forEachInRange([c,d],a=>{this.removeRef(a),e.push(a.key)}),e}removeAllReferences(){this.refsByKey.forEach(a=>this.removeRef(a))}removeRef(a){this.refsByKey=this.refsByKey.delete(a),this.refsByTarget=this.refsByTarget.delete(a)}referencesForId(a){let b=new ex(new eu([])),c=new nV(b,a),d=new nV(b,a+1),e=jn();return this.refsByTarget.forEachInRange([c,d],a=>{e=e.add(a.key)}),e}containsKey(a){let b=new nV(a,0),c=this.refsByKey.firstAfterOrEqual(b);return null!==c&&a.isEqual(c.key)}}class nV{constructor(a,b){this.key=a,this.targetOrBatchId=b}static compareByKey(a,b){return ex.comparator(a.key,b.key)||el(a.targetOrBatchId,b.targetOrBatchId)}static compareByTargetId(a,b){return el(a.targetOrBatchId,b.targetOrBatchId)||ex.comparator(a.key,b.key)}}class nW{constructor(a,b){this.indexManager=a,this.referenceDelegate=b,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new gH(nV.compareByKey)}checkEmpty(a){return e0.resolve(0===this.mutationQueue.length)}addMutationBatch(a,b,c,d){let e=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let f=new j4(e,b,c,d);for(let b of(this.mutationQueue.push(f),d))this.batchesByDocumentKey=this.batchesByDocumentKey.add(new nV(b.key,e)),this.indexManager.addToCollectionParentIndex(a,b.key.path.popLast());return e0.resolve(f)}lookupMutationBatch(a,b){return e0.resolve(this.findMutationBatch(b))}getNextMutationBatchAfterBatchId(a,b){let c=b+1,d=this.indexOfBatchId(c),e=d<0?0:d;return e0.resolve(this.mutationQueue.length>e?this.mutationQueue[e]:null)}getHighestUnacknowledgedBatchId(){return e0.resolve(0===this.mutationQueue.length?g5:this.nextBatchId-1)}getAllMutationBatches(a){return e0.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(a,b){let c=new nV(b,0),d=new nV(b,1/0),e=[];return this.batchesByDocumentKey.forEachInRange([c,d],a=>{let b=this.findMutationBatch(a.targetOrBatchId);e.push(b)}),e0.resolve(e)}getAllMutationBatchesAffectingDocumentKeys(a,b){let c=new gH(el);return b.forEach(a=>{let b=new nV(a,0),d=new nV(a,1/0);this.batchesByDocumentKey.forEachInRange([b,d],a=>{c=c.add(a.targetOrBatchId)})}),e0.resolve(this.findMutationBatches(c))}getAllMutationBatchesAffectingQuery(a,b){let c=b.path,d=c.length+1,e=c;ex.isDocumentKey(e)||(e=e.child(""));let f=new nV(new ex(e),0),g=new gH(el);return this.batchesByDocumentKey.forEachWhile(a=>{let b=a.key.path;return!!c.isPrefixOf(b)&&(b.length===d&&(g=g.add(a.targetOrBatchId)),!0)},f),e0.resolve(this.findMutationBatches(g))}findMutationBatches(a){let b=[];return a.forEach(a=>{let c=this.findMutationBatch(a);null!==c&&b.push(c)}),b}removeMutationBatch(a,b){dS(0===this.indexOfExistingBatchId(b.batchId,"removed"),55003),this.mutationQueue.shift();let c=this.batchesByDocumentKey;return e0.forEach(b.mutations,d=>{let e=new nV(d.key,b.batchId);return c=c.delete(e),this.referenceDelegate.markPotentiallyOrphaned(a,d.key)}).next(()=>{this.batchesByDocumentKey=c})}removeCachedMutationKeys(a){}containsKey(a,b){let c=new nV(b,0),d=this.batchesByDocumentKey.firstAfterOrEqual(c);return e0.resolve(b.isEqual(d&&d.key))}performConsistencyCheck(a){return this.mutationQueue.length,e0.resolve()}indexOfExistingBatchId(a,b){return this.indexOfBatchId(a)}indexOfBatchId(a){return 0===this.mutationQueue.length?0:a-this.mutationQueue[0].batchId}findMutationBatch(a){let b=this.indexOfBatchId(a);return b<0||b>=this.mutationQueue.length?null:this.mutationQueue[b]}}let nX="-9223372036854775808";function nY(){return new gD(ex.comparator)}class nZ{constructor(a){this.sizer=a,this.docs=nY(),this.size=0}setIndexManager(a){this.indexManager=a}addEntry(a,b){let c=b.key,d=this.docs.get(c),e=d?d.size:0,f=this.sizer(b);return this.docs=this.docs.insert(c,{document:b.mutableCopy(),size:f}),this.size+=f-e,this.indexManager.addToCollectionParentIndex(a,c.path.popLast())}removeEntry(a){let b=this.docs.get(a);b&&(this.docs=this.docs.remove(a),this.size-=b.size)}getEntry(a,b){let c=this.docs.get(b);return e0.resolve(c?c.document.mutableCopy():hZ.newInvalidDocument(b))}getEntries(a,b){let c=jc();return b.forEach(a=>{let b=this.docs.get(a);c=c.insert(a,b?b.document.mutableCopy():hZ.newInvalidDocument(a))}),e0.resolve(c)}getDocumentsMatchingQuery(a,b,c,d){let e=jc(),f=b.path,g=new ex(f.child("__id"+nX+"__")),h=this.docs.getIteratorFrom(g);for(;h.hasNext();){let{key:a,value:{document:g}}=h.getNext();if(!f.isPrefixOf(a.path))break;!(a.path.length>f.length+1||0>=eY(eW(g),c))&&(d.has(g.key)||i2(b,g))&&(e=e.insert(g.key,g.mutableCopy()))}return e0.resolve(e)}getAllFromCollectionGroup(a,b,c,d){dQ(9500)}forEachDocumentKey(a,b){return e0.forEach(this.docs,a=>b(a))}newChangeBuffer(a){return new n_(this)}getSize(a){return e0.resolve(this.size)}}function n$(a){return new nZ(a)}class n_ extends nE{constructor(a){super(),this.documentCache=a}applyChanges(a){let b=[];return this.changes.forEach((c,d)=>{d.isValidDocument()?b.push(this.documentCache.addEntry(a,d)):this.documentCache.removeEntry(c)}),e0.waitFor(b)}getFromCache(a,b){return this.documentCache.getEntry(a,b)}getAllFromCache(a,b){return this.documentCache.getEntries(a,b)}}class n0{constructor(a){this.persistence=a,this.targets=new ja(a=>iz(a),iB),this.lastRemoteSnapshotVersion=eL.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new nU,this.targetCount=0,this.targetIdGenerator=ni.forTargetCache()}forEachTarget(a,b){return this.targets.forEach((a,c)=>b(c)),e0.resolve()}getLastRemoteSnapshotVersion(a){return e0.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(a){return e0.resolve(this.highestSequenceNumber)}allocateTargetId(a){return this.highestTargetId=this.targetIdGenerator.next(),e0.resolve(this.highestTargetId)}setTargetsMetadata(a,b,c){return c&&(this.lastRemoteSnapshotVersion=c),b>this.highestSequenceNumber&&(this.highestSequenceNumber=b),e0.resolve()}saveTargetData(a){this.targets.set(a.target,a);let b=a.targetId;b>this.highestTargetId&&(this.targetIdGenerator=new ni(b),this.highestTargetId=b),a.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=a.sequenceNumber)}addTargetData(a,b){return this.saveTargetData(b),this.targetCount+=1,e0.resolve()}updateTargetData(a,b){return this.saveTargetData(b),e0.resolve()}removeTargetData(a,b){return this.targets.delete(b.target),this.references.removeReferencesForId(b.targetId),this.targetCount-=1,e0.resolve()}removeTargets(a,b,c){let d=0,e=[];return this.targets.forEach((f,g)=>{g.sequenceNumber<=b&&null===c.get(g.targetId)&&(this.targets.delete(f),e.push(this.removeMatchingKeysForTargetId(a,g.targetId)),d++)}),e0.waitFor(e).next(()=>d)}getTargetCount(a){return e0.resolve(this.targetCount)}getTargetData(a,b){let c=this.targets.get(b)||null;return e0.resolve(c)}addMatchingKeys(a,b,c){return this.references.addReferences(b,c),e0.resolve()}removeMatchingKeys(a,b,c){this.references.removeReferences(b,c);let d=this.persistence.referenceDelegate,e=[];return d&&b.forEach(b=>{e.push(d.markPotentiallyOrphaned(a,b))}),e0.waitFor(e)}removeMatchingKeysForTargetId(a,b){return this.references.removeReferencesForId(b),e0.resolve()}getMatchingKeysForTargetId(a,b){let c=this.references.referencesForId(b);return e0.resolve(c)}containsKey(a,b){return e0.resolve(this.references.containsKey(b))}}let n1="MemoryPersistence";class n2{constructor(a,b){this.mutationQueues={},this.overlays={},this.listenSequence=new fj(0),this._started=!1,this._started=!0,this.globalsCache=new nT,this.referenceDelegate=a(this),this.targetCache=new n0(this);const c=a=>this.referenceDelegate.documentSize(a);this.indexManager=new m_,this.remoteDocumentCache=n$(c),this.serializer=new lG(b),this.bundleCache=new nR(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(a){return this.indexManager}getDocumentOverlayCache(a){let b=this.overlays[a.toKey()];return b||(b=new nS,this.overlays[a.toKey()]=b),b}getMutationQueue(a,b){let c=this.mutationQueues[a.toKey()];return c||(c=new nW(b,this.referenceDelegate),this.mutationQueues[a.toKey()]=c),c}getGlobalsCache(){return this.globalsCache}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(a,b,c){dM(n1,"Starting transaction:",a);let d=new n3(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),c(d).next(a=>this.referenceDelegate.onTransactionCommitted(d).next(()=>a)).toPromise().then(a=>(d.raiseOnCommittedEvent(),a))}mutationQueuesContainKey(a,b){return e0.or(Object.values(this.mutationQueues).map(c=>()=>c.containsKey(a,b)))}}class n3 extends e${constructor(a){super(),this.currentSequenceNumber=a}}class n4{constructor(a){this.persistence=a,this.localViewReferences=new nU,this._orphanedDocuments=null}static factory(a){return new n4(a)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw dQ(60996)}addReference(a,b,c){return this.localViewReferences.addReference(c,b),this.orphanedDocuments.delete(c.toString()),e0.resolve()}removeReference(a,b,c){return this.localViewReferences.removeReference(c,b),this.orphanedDocuments.add(c.toString()),e0.resolve()}markPotentiallyOrphaned(a,b){return this.orphanedDocuments.add(b.toString()),e0.resolve()}removeTarget(a,b){this.localViewReferences.removeReferencesForId(b.targetId).forEach(a=>this.orphanedDocuments.add(a.toString()));let c=this.persistence.getTargetCache();return c.getMatchingKeysForTargetId(a,b.targetId).next(a=>{a.forEach(a=>this.orphanedDocuments.add(a.toString()))}).next(()=>c.removeTargetData(a,b))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(a){let b=this.persistence.getRemoteDocumentCache().newChangeBuffer();return e0.forEach(this.orphanedDocuments,c=>{let d=ex.fromPath(c);return this.isReferenced(a,d).next(a=>{a||b.removeEntry(d,eL.min())})}).next(()=>(this._orphanedDocuments=null,b.apply(a)))}updateLimboDocument(a,b){return this.isReferenced(a,b).next(a=>{a?this.orphanedDocuments.delete(b.toString()):this.orphanedDocuments.add(b.toString())})}documentSize(a){return 0}isReferenced(a,b){return e0.or([()=>e0.resolve(this.localViewReferences.containsKey(b)),()=>this.persistence.getTargetCache().containsKey(a,b),()=>this.persistence.mutationQueuesContainKey(a,b)])}}class n5{constructor(a,b){this.persistence=a,this.orphanedSequenceNumbers=new ja(a=>fo(a.path),(a,b)=>a.isEqual(b)),this.garbageCollector=nz(this,b)}static factory(a,b){return new n5(a,b)}onTransactionStarted(){}onTransactionCommitted(a){return e0.resolve()}forEachTarget(a,b){return this.persistence.getTargetCache().forEachTarget(a,b)}getSequenceNumberCount(a){let b=this.orphanedDocumentCount(a);return this.persistence.getTargetCache().getTargetCount(a).next(a=>b.next(b=>a+b))}orphanedDocumentCount(a){let b=0;return this.forEachOrphanedDocumentSequenceNumber(a,a=>{b++}).next(()=>b)}forEachOrphanedDocumentSequenceNumber(a,b){return e0.forEach(this.orphanedSequenceNumbers,(c,d)=>this.isPinned(a,c,d).next(a=>a?e0.resolve():b(d)))}removeTargets(a,b,c){return this.persistence.getTargetCache().removeTargets(a,b,c)}removeOrphanedDocuments(a,b){let c=0,d=this.persistence.getRemoteDocumentCache(),e=d.newChangeBuffer();return d.forEachDocumentKey(a,d=>this.isPinned(a,d,b).next(a=>{a||(c++,e.removeEntry(d,eL.min()))})).next(()=>e.apply(a)).next(()=>c)}markPotentiallyOrphaned(a,b){return this.orphanedSequenceNumbers.set(b,a.currentSequenceNumber),e0.resolve()}removeTarget(a,b){let c=b.withSequenceNumber(a.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(a,c)}addReference(a,b,c){return this.orphanedSequenceNumbers.set(c,a.currentSequenceNumber),e0.resolve()}removeReference(a,b,c){return this.orphanedSequenceNumbers.set(c,a.currentSequenceNumber),e0.resolve()}updateLimboDocument(a,b){return this.orphanedSequenceNumbers.set(b,a.currentSequenceNumber),e0.resolve()}documentSize(a){let b=a.key.toString().length;return a.isFoundDocument()&&(b+=hE(a.data.value)),b}isPinned(a,b,c){return e0.or([()=>this.persistence.mutationQueuesContainKey(a,b),()=>this.persistence.getTargetCache().containsKey(a,b),()=>{let a=this.orphanedSequenceNumbers.get(b);return e0.resolve(void 0!==a&&a>c)}])}getCacheSize(a){return this.persistence.getRemoteDocumentCache().getSize(a)}}class n6{constructor(a){this.serializer=a}createOrUpgrade(a,b,c,d){let e=new e3("createOrUpgrade",b);c<1&&d>=1&&(n8(a),n9(a),oe(a),ob(a));let f=e0.resolve();return c<3&&d>=3&&(0!==c&&(of(a),oe(a)),f=f.next(()=>oh(e))),c<4&&d>=4&&(0!==c&&(f=f.next(()=>oa(a,e))),f=f.next(()=>{oi(a)})),c<5&&d>=5&&(f=f.next(()=>this.removeAcknowledgedMutations(e))),c<6&&d>=6&&(f=f.next(()=>(od(a),this.addDocumentGlobal(e)))),c<7&&d>=7&&(f=f.next(()=>this.ensureSequenceNumbers(e))),c<8&&d>=8&&(f=f.next(()=>this.createCollectionParentIndex(a,e))),c<9&&d>=9&&(f=f.next(()=>{og(a)})),c<10&&d>=10&&(f=f.next(()=>this.rewriteCanonicalIds(e))),c<11&&d>=11&&(f=f.next(()=>{oj(a),ok(a)})),c<12&&d>=12&&(f=f.next(()=>{om(a)})),c<13&&d>=13&&(f=f.next(()=>oc(a)).next(()=>this.rewriteRemoteDocumentCache(a,e)).next(()=>a.deleteObjectStore(fs))),c<14&&d>=14&&(f=f.next(()=>this.runOverlayMigration(a,e))),c<15&&d>=15&&(f=f.next(()=>ol(a))),c<16&&d>=16&&(f=f.next(()=>{b.objectStore(f8).clear()}).next(()=>{b.objectStore(gc).clear()})),c<17&&d>=17&&(f=f.next(()=>{on(a)})),c<18&&d>=18&&G()&&(f=f.next(()=>{b.objectStore(f8).clear()}).next(()=>{b.objectStore(gc).clear()})),f}addDocumentGlobal(a){let b=0;return a.store(fs).iterate((a,c)=>{b+=na(c)}).next(()=>{let c={byteSize:b};return a.store(fM).put(fN,c)})}removeAcknowledgedMutations(a){let b=a.store(fv),c=a.store(fx);return b.loadAll().next(b=>e0.forEach(b,b=>{let d=IDBKeyRange.bound([b.userId,g5],[b.userId,b.lastAcknowledgedBatchId]);return c.loadAll(fz,d).next(c=>e0.forEach(c,c=>{dS(c.userId===b.userId,18650,"Cannot process batch from unexpected user",{batchId:c.batchId});let d=lO(this.serializer,c);return m9(a,b.userId,d).next(()=>{})}))}))}ensureSequenceNumbers(a){let b=a.store(fS),c=a.store(fs);return a.store(fX).get(fW).next(a=>{let d=c=>b.put({targetId:0,path:fo(c),sequenceNumber:a.highestListenSequenceNumber}),e=[];return c.iterate((a,c)=>{let f=new eu(a),g=n7(f);e.push(b.get(g).next(a=>a?e0.resolve():d(f)))}).next(()=>e0.waitFor(e))})}createCollectionParentIndex(a,b){a.createObjectStore(fY,{keyPath:fZ});let c=b.store(fY),d=new m0,e=a=>{if(d.add(a)){let b=a.lastSegment(),d=a.popLast();return c.put({collectionId:b,parent:fo(d)})}};return b.store(fs).iterate({keysOnly:!0},(a,b)=>e(new eu(a).popLast())).next(()=>b.store(fF).iterate({keysOnly:!0},([a,b,c],d)=>e(fr(b).popLast())))}rewriteCanonicalIds(a){let b=a.store(fO);return b.iterate((a,c)=>{let d=lP(c),e=lQ(this.serializer,d);return b.put(e)})}rewriteRemoteDocumentCache(a,b){let c=b.store(fs),d=[];return c.iterate((a,c)=>{let e=b.store(fG),f=oo(c).path.toArray(),g={prefixPath:f.slice(0,f.length-2),collectionGroup:f[f.length-2],documentId:f[f.length-1],readTime:c.readTime||[0,0],unknownDocument:c.unknownDocument,noDocument:c.noDocument,document:c.document,hasCommittedMutations:!!c.hasCommittedMutations};d.push(e.put(g))}).next(()=>e0.waitFor(d))}runOverlayMigration(a,b){let c=b.store(fx),d=nG(this.serializer),e=new n2(n4.factory,this.serializer.remoteSerializer);return c.loadAll().next(a=>{let c=new Map;return a.forEach(a=>{let b=c.get(a.userId)??jn();lO(this.serializer,a).keys().forEach(a=>b=b.add(a)),c.set(a.userId,b)}),e0.forEach(c,(a,c)=>{let f=new dG(c),g=l6.forUser(this.serializer,f),h=e.getIndexManager(f);return new nQ(d,nb.forUser(f,this.serializer,h,e.referenceDelegate),g,h).recalculateAndSaveOverlaysForDocumentKeys(new gx(b,fj.INVALID),a).next()})})}}function n7(a){return[0,fo(a)]}function n8(a){a.createObjectStore(ft)}function n9(a){a.createObjectStore(fv,{keyPath:fw}),a.createObjectStore(fx,{keyPath:fy,autoIncrement:!0}).createIndex(fz,fA,{unique:!0}),a.createObjectStore(fF)}function oa(a,b){return b.store(fx).loadAll().next(c=>{a.deleteObjectStore(fx),a.createObjectStore(fx,{keyPath:fy,autoIncrement:!0}).createIndex(fz,fA,{unique:!0});let d=b.store(fx),e=c.map(a=>d.put(a));return e0.waitFor(e)})}function ob(a){a.createObjectStore(fs)}function oc(a){let b=a.createObjectStore(fG,{keyPath:fH});b.createIndex(fI,fJ),b.createIndex(fK,fL)}function od(a){a.createObjectStore(fM)}function oe(a){a.createObjectStore(fS,{keyPath:fT}).createIndex(fU,fV,{unique:!0}),a.createObjectStore(fO,{keyPath:fP}).createIndex(fQ,fR,{unique:!0}),a.createObjectStore(fX)}function of(a){a.deleteObjectStore(fS),a.deleteObjectStore(fO),a.deleteObjectStore(fX)}function og(a){a.objectStoreNames.contains("remoteDocumentChanges")&&a.deleteObjectStore("remoteDocumentChanges")}function oh(a){let b=a.store(fX),c={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:eL.min().toTimestamp(),targetCount:0};return b.put(fW,c)}function oi(a){a.createObjectStore(f$,{keyPath:f_})}function oj(a){a.createObjectStore(f0,{keyPath:f1})}function ok(a){a.createObjectStore(f2,{keyPath:f3})}function ol(a){a.createObjectStore(f4,{keyPath:f5,autoIncrement:!0}).createIndex(f6,f7,{unique:!1}),a.createObjectStore(f8,{keyPath:f9}).createIndex(ga,gb,{unique:!1}),a.createObjectStore(gc,{keyPath:gd}).createIndex(ge,gf,{unique:!1})}function om(a){let b=a.createObjectStore(gg,{keyPath:gh});b.createIndex(gi,gj,{unique:!1}),b.createIndex(gk,gl,{unique:!1})}function on(a){a.createObjectStore(gm,{keyPath:gn})}function oo(a){return a.document?new ex(eu.fromString(a.document.name).popFirst(5)):a.noDocument?ex.fromSegments(a.noDocument.path):a.unknownDocument?ex.fromSegments(a.unknownDocument.path):dQ(36783)}let op="IndexedDbPersistence",oq=18e5,or=5e3,os=4e3,ot="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",ou="This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.",ov="firestore_zombie",ow="main";class ox{constructor(a,b,c,d,e,f,g,h,i,j,k=nO){if(this.allowTabSynchronization=a,this.persistenceKey=b,this.clientId=c,this.queue=e,this.window=f,this.document=g,this.sequenceNumberSyncer=i,this.forceOwningTab=j,this.schemaVersion=k,this.listenSequence=null,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=-1/0,this.primaryStateListener=a=>Promise.resolve(),!ox.isAvailable())throw new d9(d5,ou);this.referenceDelegate=new nA(this,d),this.dbName=b+ow,this.serializer=new lG(h),this.simpleDb=new e4(this.dbName,this.schemaVersion,new n6(this.serializer)),this.globalsCache=new l8,this.targetCache=new nj(this.referenceDelegate,this.serializer),this.remoteDocumentCache=nG(this.serializer),this.bundleCache=new l3,this.window&&this.window.localStorage?this.webStorage=this.window.localStorage:(this.webStorage=null,!1===j&&dN(op,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.updateClientMetadataAndTryBecomePrimary().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new d9(d2,ot);return this.attachVisibilityHandler(),this.attachWindowUnloadHook(),this.scheduleClientMetadataAndPrimaryLeaseRefreshes(),this.runTransaction("getHighestListenSequenceNumber","readonly",a=>this.targetCache.getHighestSequenceNumber(a))}).then(a=>{this.listenSequence=new fj(a,this.sequenceNumberSyncer)}).then(()=>{this._started=!0}).catch(a=>(this.simpleDb&&this.simpleDb.close(),Promise.reject(a)))}setPrimaryStateListener(a){return this.primaryStateListener=async b=>{if(this.started)return a(b)},a(this.isPrimary)}setDatabaseDeletedListener(a){this.simpleDb.setVersionChangeListener(async b=>{null===b.newVersion&&await a()})}setNetworkEnabled(a){this.networkEnabled!==a&&(this.networkEnabled=a,this.queue.enqueueAndForget(async()=>{this.started&&await this.updateClientMetadataAndTryBecomePrimary()}))}updateClientMetadataAndTryBecomePrimary(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",a=>oz(a).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.verifyPrimaryLease(a).next(a=>{a||(this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)))})}).next(()=>this.canActAsPrimary(a)).next(b=>this.isPrimary&&!b?this.releasePrimaryLeaseIfHeld(a).next(()=>!1):!!b&&this.acquireOrExtendPrimaryLease(a).next(()=>!0))).catch(a=>{if(e8(a))return dM(op,"Failed to extend owner lease: ",a),this.isPrimary;if(!this.allowTabSynchronization)throw a;return dM(op,"Releasing owner lease after error during lease refresh",a),!1}).then(a=>{this.isPrimary!==a&&this.queue.enqueueRetryable(()=>this.primaryStateListener(a)),this.isPrimary=a})}verifyPrimaryLease(a){return oy(a).get(fu).next(a=>e0.resolve(this.isLocalClient(a)))}removeClientMetadata(a){return oz(a).delete(this.clientId)}async maybeGarbageCollectMultiClientState(){if(this.isPrimary&&!this.isWithinAge(this.lastGarbageCollectionTime,oq)){this.lastGarbageCollectionTime=Date.now();let a=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",a=>{let b=gy(a,f$);return b.loadAll().next(a=>{let c=this.filterActiveClients(a,oq),d=a.filter(a=>-1===c.indexOf(a));return e0.forEach(d,a=>b.delete(a.clientId)).next(()=>d)})}).catch(()=>[]);if(this.webStorage)for(let b of a)this.webStorage.removeItem(this.zombiedClientLocalStorageKey(b.clientId))}}scheduleClientMetadataAndPrimaryLeaseRefreshes(){this.clientMetadataRefresher=this.queue.enqueueAfterDelay("client_metadata_refresh",os,()=>this.updateClientMetadataAndTryBecomePrimary().then(()=>this.maybeGarbageCollectMultiClientState()).then(()=>this.scheduleClientMetadataAndPrimaryLeaseRefreshes()))}isLocalClient(a){return!!a&&a.ownerId===this.clientId}canActAsPrimary(a){return this.forceOwningTab?e0.resolve(!0):oy(a).get(fu).next(b=>{if(null!==b&&this.isWithinAge(b.leaseTimestampMs,or)&&!this.isClientZombied(b.ownerId)){if(this.isLocalClient(b)&&this.networkEnabled)return!0;if(!this.isLocalClient(b)){if(!b.allowTabSynchronization)throw new d9(d2,ot);return!1}}return!!this.networkEnabled&&!!this.inForeground||oz(a).loadAll().next(a=>void 0===this.filterActiveClients(a,or).find(a=>{if(this.clientId!==a.clientId){let b=!this.networkEnabled&&a.networkEnabled,c=!this.inForeground&&a.inForeground,d=this.networkEnabled===a.networkEnabled;if(b||c&&d)return!0}return!1}))}).next(a=>(this.isPrimary!==a&&dM(op,`Client ${a?"is":"is not"} eligible for a primary lease.`),a))}async shutdown(){this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),await this.simpleDb.runTransaction("shutdown","readwrite",[ft,f$],a=>{let b=new gx(a,fj.INVALID);return this.releasePrimaryLeaseIfHeld(b).next(()=>this.removeClientMetadata(b))}),this.simpleDb.close(),this.removeClientZombiedEntry()}filterActiveClients(a,b){return a.filter(a=>this.isWithinAge(a.updateTimeMs,b)&&!this.isClientZombied(a.clientId))}getActiveClients(){return this.runTransaction("getActiveClients","readonly",a=>oz(a).loadAll().next(a=>this.filterActiveClients(a,oq).map(a=>a.clientId)))}get started(){return this._started}getGlobalsCache(){return this.globalsCache}getMutationQueue(a,b){return nb.forUser(a,this.serializer,b,this.referenceDelegate)}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(a){return new m3(a,this.serializer.remoteSerializer.databaseId)}getDocumentOverlayCache(a){return l6.forUser(this.serializer,a)}getBundleCache(){return this.bundleCache}runTransaction(a,b,c){let d;dM(op,"Starting transaction:",a);let e="readonly"===b?"readonly":"readwrite",f=gw(this.schemaVersion);return this.simpleDb.runTransaction(a,e,f,e=>(d=new gx(e,this.listenSequence?this.listenSequence.next():fj.INVALID),"readwrite-primary"===b)?this.verifyPrimaryLease(d).next(a=>!!a||this.canActAsPrimary(d)).next(b=>{if(!b)throw dN(`Failed to obtain primary lease for action '${a}'.`),this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)),new d9(d2,eZ);return c(d)}).next(a=>this.acquireOrExtendPrimaryLease(d).next(()=>a)):this.verifyAllowTabSynchronization(d).next(()=>c(d))).then(a=>(d.raiseOnCommittedEvent(),a))}verifyAllowTabSynchronization(a){return oy(a).get(fu).next(a=>{if(null!==a&&this.isWithinAge(a.leaseTimestampMs,or)&&!this.isClientZombied(a.ownerId)&&!this.isLocalClient(a)&&!this.forceOwningTab&&(!this.allowTabSynchronization||!a.allowTabSynchronization))throw new d9(d2,ot)})}acquireOrExtendPrimaryLease(a){let b={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return oy(a).put(fu,b)}static isAvailable(){return e4.isAvailable()}releasePrimaryLeaseIfHeld(a){let b=oy(a);return b.get(fu).next(a=>this.isLocalClient(a)?(dM(op,"Releasing primary lease."),b.delete(fu)):e0.resolve())}isWithinAge(a,b){let c=Date.now(),d=c-b,e=c;return!(a<d)&&(!(a>e)||(dN(`Detected an update time that is in the future: ${a} > ${e}`),!1))}attachVisibilityHandler(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=()=>{this.queue.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.updateClientMetadataAndTryBecomePrimary()))},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)}detachVisibilityHandler(){this.documentVisibilityHandler&&(this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)}attachWindowUnloadHook(){"function"==typeof this.window?.addEventListener&&(this.windowUnloadHandler=()=>{this.markClientZombied();let a=/(?:Version|Mobile)\/1[456]/;F()&&(navigator.appVersion.match(a)||navigator.userAgent.match(a))&&this.queue.enterRestrictedMode(!0),this.queue.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.windowUnloadHandler))}detachWindowUnloadHook(){this.windowUnloadHandler&&(this.window.removeEventListener("pagehide",this.windowUnloadHandler),this.windowUnloadHandler=null)}isClientZombied(a){try{let b=this.webStorage?.getItem(this.zombiedClientLocalStorageKey(a))!==null;return dM(op,`Client '${a}' ${b?"is":"is not"} zombied in LocalStorage`),b}catch(a){return dN(op,"Failed to get zombied client id.",a),!1}}markClientZombied(){if(this.webStorage)try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(a){dN("Failed to set zombie client id.",a)}}removeClientZombiedEntry(){if(this.webStorage)try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(a){}}zombiedClientLocalStorageKey(a){return`${ov}_${this.persistenceKey}_${a}`}}function oy(a){return gy(a,ft)}function oz(a){return gy(a,f$)}function oA(a,b){let c=a.projectId;return a.isDefaultDatabase||(c+="."+a.database),"firestore/"+b+"/"+c+"/"}function oB(a,b){if(a.length!==b.length)return!1;for(let c=0;c<a.length;++c)if(a[c]!==b[c])return!1;return!0}let oC="LocalStore",oD=3e8;class oE{constructor(a,b,c,d){this.persistence=a,this.queryEngine=b,this.serializer=d,this.targetDataByTarget=new gD(el),this.targetIdByTarget=new ja(a=>iz(a),iB),this.collectionGroupReadTime=new Map,this.remoteDocuments=a.getRemoteDocumentCache(),this.targetCache=a.getTargetCache(),this.bundleCache=a.getBundleCache(),this.initializeUserComponents(c)}initializeUserComponents(a){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(a),this.indexManager=this.persistence.getIndexManager(a),this.mutationQueue=this.persistence.getMutationQueue(a,this.indexManager),this.localDocuments=new nQ(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(a){return this.persistence.runTransaction("Collect garbage","readwrite-primary",b=>a.collect(b,this.targetDataByTarget))}}function oF(a,b,c,d){return new oE(a,b,c,d)}async function oG(a,b){let c=dT(a);return await c.persistence.runTransaction("Handle user change","readonly",a=>{let d;return c.mutationQueue.getAllMutationBatches(a).next(e=>(d=e,c.initializeUserComponents(b),c.mutationQueue.getAllMutationBatches(a))).next(b=>{let e=[],f=[],g=jn();for(let a of d)for(let b of(e.push(a.batchId),a.mutations))g=g.add(b.key);for(let a of b)for(let b of(f.push(a.batchId),a.mutations))g=g.add(b.key);return c.localDocuments.getDocuments(a,g).next(a=>({affectedDocuments:a,removedBatchIds:e,addedBatchIds:f}))})})}function oH(a,b){let c,d,e=dT(a),f=eK.now(),g=b.reduce((a,b)=>a.add(b.key),jn());return e.persistence.runTransaction("Locally write mutations","readwrite",a=>{let h=jc(),i=jn();return e.remoteDocuments.getEntries(a,g).next(a=>{(h=a).forEach((a,b)=>{b.isValidDocument()||(i=i.add(a))})}).next(()=>e.localDocuments.getOverlayedDocuments(a,h)).next(d=>{c=d;let g=[];for(let a of b){let b=jR(a,c.get(a.key).overlayedDocument);null!=b&&g.push(new jW(a.key,b,hY(b.value.mapValue),jL.exists(!0)))}return e.mutationQueue.addMutationBatch(a,f,g,b)}).next(b=>{d=b;let f=b.applyToLocalDocumentSet(c,i);return e.documentOverlayCache.saveOverlays(a,b.batchId,f)})}).then(()=>({batchId:d.batchId,changes:jg(c)}))}function oI(a,b){let c=dT(a);return c.persistence.runTransaction("Acknowledge batch","readwrite-primary",a=>{let d=b.batch.keys(),e=c.remoteDocuments.newChangeBuffer({trackRemovals:!0});return oV(c,a,b,e).next(()=>e.apply(a)).next(()=>c.mutationQueue.performConsistencyCheck(a)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(a,d,b.batch.batchId)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(a,oJ(b))).next(()=>c.localDocuments.getDocuments(a,d))})}function oJ(a){let b=jn();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(b=b.add(a.batch.mutations[c].key));return b}function oK(a,b){let c=dT(a);return c.persistence.runTransaction("Reject batch","readwrite-primary",a=>{let d;return c.mutationQueue.lookupMutationBatch(a,b).next(b=>(dS(null!==b,37113),d=b.keys(),c.mutationQueue.removeMutationBatch(a,b))).next(()=>c.mutationQueue.performConsistencyCheck(a)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(a,d,b)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(a,d)).next(()=>c.localDocuments.getDocuments(a,d))})}function oL(a){let b=dT(a);return b.persistence.runTransaction("Get last remote snapshot version","readonly",a=>b.targetCache.getLastRemoteSnapshotVersion(a))}function oM(a,b){let c=dT(a),d=b.snapshotVersion,e=c.targetDataByTarget;return c.persistence.runTransaction("Apply remote event","readwrite-primary",a=>{let f=c.remoteDocuments.newChangeBuffer({trackRemovals:!0});e=c.targetDataByTarget;let g=[];b.targetChanges.forEach((f,h)=>{let i=e.get(h);if(!i)return;g.push(c.targetCache.removeMatchingKeys(a,f.removedDocuments,h).next(()=>c.targetCache.addMatchingKeys(a,f.addedDocuments,h)));let j=i.withSequenceNumber(a.currentSequenceNumber);null!==b.targetMismatches.get(h)?j=j.withResumeToken(gO.EMPTY_BYTE_STRING,eL.min()).withLastLimboFreeSnapshotVersion(eL.min()):f.resumeToken.approximateByteSize()>0&&(j=j.withResumeToken(f.resumeToken,d)),e=e.insert(h,j),oO(i,j,f)&&g.push(c.targetCache.updateTargetData(a,j))});let h=jc(),i=jn();if(b.documentUpdates.forEach(d=>{b.resolvedLimboDocuments.has(d)&&g.push(c.persistence.referenceDelegate.updateLimboDocument(a,d))}),g.push(oN(a,f,b.documentUpdates).next(a=>{h=a.changedDocuments,i=a.existenceChangedKeys})),!d.isEqual(eL.min())){let b=c.targetCache.getLastRemoteSnapshotVersion(a).next(b=>c.targetCache.setTargetsMetadata(a,a.currentSequenceNumber,d));g.push(b)}return e0.waitFor(g).next(()=>f.apply(a)).next(()=>c.localDocuments.getLocalViewOfDocuments(a,h,i)).next(()=>h)}).then(a=>(c.targetDataByTarget=e,a))}function oN(a,b,c){let d=jn(),e=jn();return c.forEach(a=>d=d.add(a)),b.getEntries(a,d).next(a=>{let d=jc();return c.forEach((c,f)=>{let g=a.get(c);f.isFoundDocument()!==g.isFoundDocument()&&(e=e.add(c)),f.isNoDocument()&&f.version.isEqual(eL.min())?(b.removeEntry(c,f.readTime),d=d.insert(c,f)):!g.isValidDocument()||f.version.compareTo(g.version)>0||0===f.version.compareTo(g.version)&&g.hasPendingWrites?(b.addEntry(f),d=d.insert(c,f)):dM(oC,"Ignoring outdated watch update for ",c,". Current version:",g.version," Watch version:",f.version)}),{changedDocuments:d,existenceChangedKeys:e}})}function oO(a,b,c){return!!(0===a.resumeToken.approximateByteSize()||b.snapshotVersion.toMicroseconds()-a.snapshotVersion.toMicroseconds()>=oD)||c.addedDocuments.size+c.modifiedDocuments.size+c.removedDocuments.size>0}async function oP(a,b){let c=dT(a);try{await c.persistence.runTransaction("notifyLocalViewChanges","readwrite",a=>e0.forEach(b,b=>e0.forEach(b.addedKeys,d=>c.persistence.referenceDelegate.addReference(a,b.targetId,d)).next(()=>e0.forEach(b.removedKeys,d=>c.persistence.referenceDelegate.removeReference(a,b.targetId,d)))))}catch(a){if(e8(a))dM(oC,"Failed to update sequence numbers: "+a);else throw a}for(let a of b){let b=a.targetId;if(!a.fromCache){let a=c.targetDataByTarget.get(b),d=a.snapshotVersion,e=a.withLastLimboFreeSnapshotVersion(d);c.targetDataByTarget=c.targetDataByTarget.insert(b,e)}}}function oQ(a,b){let c=dT(a);return c.persistence.runTransaction("Get next mutation batch","readonly",a=>(void 0===b&&(b=g5),c.mutationQueue.getNextMutationBatchAfterBatchId(a,b)))}function oR(a,b){let c=dT(a);return c.persistence.runTransaction("Allocate target","readwrite",a=>{let d;return c.targetCache.getTargetData(a,b).next(e=>e?(d=e,e0.resolve(d)):c.targetCache.allocateTargetId(a).next(e=>(d=new lF(b,e,"TargetPurposeListen",a.currentSequenceNumber),c.targetCache.addTargetData(a,d).next(()=>d))))}).then(a=>{let d=c.targetDataByTarget.get(a.targetId);return(null===d||a.snapshotVersion.compareTo(d.snapshotVersion)>0)&&(c.targetDataByTarget=c.targetDataByTarget.insert(a.targetId,a),c.targetIdByTarget.set(b,a.targetId)),a})}function oS(a,b,c){let d=dT(a),e=d.targetIdByTarget.get(c);return void 0!==e?e0.resolve(d.targetDataByTarget.get(e)):d.targetCache.getTargetData(b,c)}async function oT(a,b,c){let d=dT(a),e=d.targetDataByTarget.get(b),f=c?"readwrite":"readwrite-primary";try{c||await d.persistence.runTransaction("Release target",f,a=>d.persistence.referenceDelegate.removeTarget(a,e))}catch(a){if(e8(a))dM(oC,`Failed to update sequence numbers for target ${b}: ${a}`);else throw a}d.targetDataByTarget=d.targetDataByTarget.remove(b),d.targetIdByTarget.delete(e.target)}function oU(a,b,c){let d=dT(a),e=eL.min(),f=jn();return d.persistence.runTransaction("Execute query","readwrite",a=>oS(d,a,iV(b)).next(b=>{if(b)return e=b.lastLimboFreeSnapshotVersion,d.targetCache.getMatchingKeysForTargetId(a,b.targetId).next(a=>{f=a})}).next(()=>d.queryEngine.getDocumentsMatchingQuery(a,b,c?e:eL.min(),c?f:jn())).next(a=>(o_(d,i7(b),a),{documents:a,remoteKeys:f})))}function oV(a,b,c,d){let e=c.batch,f=e.keys(),g=e0.resolve();return f.forEach(a=>{g=g.next(()=>d.getEntry(b,a)).next(b=>{let f=c.docVersions.get(a);dS(null!==f,48541),0>b.version.compareTo(f)&&(e.applyToRemoteDocument(b,c),b.isValidDocument()&&(b.setReadTime(c.commitVersion),d.addEntry(b)))})}),g.next(()=>a.mutationQueue.removeMutationBatch(b,e))}function oW(a,b){let c=dT(a),d=dT(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",a=>d.lookupMutationKeys(a,b).next(b=>b?c.localDocuments.getDocuments(a,b):e0.resolve(null)))}function oX(a,b){dT(dT(a,oE).mutationQueue).removeCachedMutationKeys(b)}function oY(a){return dT(dT(a,oE).persistence).getActiveClients()}function oZ(a,b){let c=dT(a),d=dT(c.targetCache),e=c.targetDataByTarget.get(b);return e?Promise.resolve(e.target):c.persistence.runTransaction("Get target data","readonly",a=>d.getTargetDataForTarget(a,b).next(a=>a?a.target:null))}function o$(a,b){let c=dT(a),d=c.collectionGroupReadTime.get(b)||eL.min();return c.persistence.runTransaction("Get new document changes","readonly",a=>c.remoteDocuments.getAllFromCollectionGroup(a,b,eV(d,eM),Number.MAX_SAFE_INTEGER)).then(a=>(o_(c,b,a),a))}function o_(a,b,c){let d=a.collectionGroupReadTime.get(b)||eL.min();c.forEach((a,b)=>{b.readTime.compareTo(d)>0&&(d=b.readTime)}),a.collectionGroupReadTime.set(b,d)}class o0{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(a){this._documentReadCount+=a}}let o1=100;function o2(){return F()?8:e5(x())>0?6:4}class o3{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=o1,this.relativeIndexReadCostPerDocument=o2()}initialize(a,b){this.localDocumentsView=a,this.indexManager=b,this.initialized=!0}getDocumentsMatchingQuery(a,b,c,d){let e={result:null};return this.performQueryUsingIndex(a,b).next(a=>{e.result=a}).next(()=>{if(!e.result)return this.performQueryUsingRemoteKeys(a,b,d,c).next(a=>{e.result=a})}).next(()=>{if(e.result)return;let c=new o0;return this.executeFullCollectionScan(a,b,c).next(d=>{if(e.result=d,this.indexAutoCreationEnabled)return this.createCacheIndexes(a,b,c,d.size)})}).next(()=>e.result)}createCacheIndexes(a,b,c,d){return c.documentReadCount<this.indexAutoCreationMinCollectionSize?(dL()<=de.DEBUG&&dM("QueryEngine","SDK will not create cache indexes for query:",i1(b),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),e0.resolve()):(dL()<=de.DEBUG&&dM("QueryEngine","Query:",i1(b),"scans",c.documentReadCount,"local documents and returns",d,"documents as results."),c.documentReadCount>this.relativeIndexReadCostPerDocument*d)?(dL()<=de.DEBUG&&dM("QueryEngine","The SDK decides to create cache indexes for query:",i1(b),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(a,iV(b))):e0.resolve()}performQueryUsingIndex(a,b){if(iQ(b))return e0.resolve(null);let c=iV(b);return this.indexManager.getIndexType(a,c).next(d=>0===d?null:(null!==b.limit&&1===d&&(c=iV(b=i$(b,null,"F"))),this.indexManager.getDocumentsMatchingTarget(a,c).next(d=>{let e=jn(...d);return this.localDocumentsView.getDocuments(a,e).next(d=>this.indexManager.getMinOffset(a,c).next(c=>{let f=this.applyQuery(b,d);return this.needsRefill(b,f,e,c.readTime)?this.performQueryUsingIndex(a,i$(b,null,"F")):this.appendRemainingResults(a,f,b,c)}))})))}performQueryUsingRemoteKeys(a,b,c,d){return iQ(b)||d.isEqual(eL.min())?e0.resolve(null):this.localDocumentsView.getDocuments(a,c).next(e=>{let f=this.applyQuery(b,e);return this.needsRefill(b,f,c,d)?e0.resolve(null):(dL()<=de.DEBUG&&dM("QueryEngine","Re-using previous result from %s to execute query: %s",d.toString(),i1(b)),this.appendRemainingResults(a,f,b,eV(d,eM)).next(a=>a))})}applyQuery(a,b){let c=new gH(i8(a));return b.forEach((b,d)=>{i2(a,d)&&(c=c.add(d))}),c}needsRefill(a,b,c,d){if(null===a.limit)return!1;if(c.size!==b.size)return!0;let e="F"===a.limitType?b.last():b.first();return!!e&&(e.hasPendingWrites||e.version.compareTo(d)>0)}executeFullCollectionScan(a,b,c){return dL()<=de.DEBUG&&dM("QueryEngine","Using full collection scan to execute query:",i1(b)),this.localDocumentsView.getDocumentsMatchingQuery(a,b,eX.min(),c)}appendRemainingResults(a,b,c,d){return this.localDocumentsView.getDocumentsMatchingQuery(a,c,d).next(a=>(b.forEach(b=>{a=a.insert(b.key,b)}),a))}}let o4="firestore_clients";function o5(a,b){return`${o4}_${a}_${b}`}let o6="firestore_mutations";function o7(a,b,c){let d=`${o6}_${a}_${c}`;return b.isAuthenticated()&&(d+=`_${b.uid}`),d}let o8="firestore_targets";function o9(a,b){return`${o8}_${a}_${b}`}let pa="firestore_online_state";function pb(a){return`${pa}_${a}`}let pc="firestore_bundle_loaded_v2";function pd(a){return`${pc}_${a}`}let pe="firestore_sequence_number";function pf(a){return`${pe}_${a}`}let pg="SharedClientState";class ph{constructor(a,b,c,d){this.user=a,this.batchId=b,this.state=c,this.error=d}static fromWebStorageEntry(a,b,c){let d,e=JSON.parse(c),f="object"==typeof e&&-1!==["pending","acknowledged","rejected"].indexOf(e.state)&&(void 0===e.error||"object"==typeof e.error);return(f&&e.error&&(f="string"==typeof e.error.message&&"string"==typeof e.error.code)&&(d=new d9(e.error.code,e.error.message)),f)?new ph(a,b,e.state,d):(dN(pg,`Failed to parse mutation state for ID '${b}': ${c}`),null)}toWebStorageJSON(){let a={state:this.state,updateTimeMs:Date.now()};return this.error&&(a.error={code:this.error.code,message:this.error.message}),JSON.stringify(a)}}class pi{constructor(a,b,c){this.targetId=a,this.state=b,this.error=c}static fromWebStorageEntry(a,b){let c,d=JSON.parse(b),e="object"==typeof d&&-1!==["not-current","current","rejected"].indexOf(d.state)&&(void 0===d.error||"object"==typeof d.error);return(e&&d.error&&(e="string"==typeof d.error.message&&"string"==typeof d.error.code)&&(c=new d9(d.error.code,d.error.message)),e)?new pi(a,d.state,c):(dN(pg,`Failed to parse target state for ID '${a}': ${b}`),null)}toWebStorageJSON(){let a={state:this.state,updateTimeMs:Date.now()};return this.error&&(a.error={code:this.error.code,message:this.error.message}),JSON.stringify(a)}}class pj{constructor(a,b){this.clientId=a,this.activeTargetIds=b}static fromWebStorageEntry(a,b){let c=JSON.parse(b),d="object"==typeof c&&c.activeTargetIds instanceof Array,e=jp();for(let a=0;d&&a<c.activeTargetIds.length;++a)d=g8(c.activeTargetIds[a]),e=e.add(c.activeTargetIds[a]);return d?new pj(a,e):(dN(pg,`Failed to parse client data for instance '${a}': ${b}`),null)}}class pk{constructor(a,b){this.clientId=a,this.onlineState=b}static fromWebStorageEntry(a){let b=JSON.parse(a);return"object"==typeof b&&-1!==["Unknown","Online","Offline"].indexOf(b.onlineState)&&"string"==typeof b.clientId?new pk(b.clientId,b.onlineState):(dN(pg,`Failed to parse online state: ${a}`),null)}}class pl{constructor(){this.activeTargetIds=jp()}addQueryTarget(a){this.activeTargetIds=this.activeTargetIds.add(a)}removeQueryTarget(a){this.activeTargetIds=this.activeTargetIds.delete(a)}toWebStorageJSON(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class pm{constructor(a,b,c,d,e){this.window=a,this.queue=b,this.persistenceKey=c,this.localClientId=d,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.storageListener=this.handleWebStorageEvent.bind(this),this.activeClients=new gD(el),this.started=!1,this.earlyEvents=[];const f=c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=e,this.localClientStorageKey=o5(this.persistenceKey,this.localClientId),this.sequenceNumberKey=pf(this.persistenceKey),this.activeClients=this.activeClients.insert(this.localClientId,new pl),this.clientStateKeyRe=RegExp(`^${o4}_${f}_([^_]*)$`),this.mutationBatchKeyRe=RegExp(`^${o6}_${f}_(\\d+)(?:_(.*))?$`),this.queryTargetKeyRe=RegExp(`^${o8}_${f}_(\\d+)$`),this.onlineStateKey=pb(this.persistenceKey),this.bundleLoadedKey=pd(this.persistenceKey),this.window.addEventListener("storage",this.storageListener)}static isAvailable(a){return!!(a&&a.localStorage)}async start(){for(let a of(await this.syncEngine.getActiveClients())){if(a===this.localClientId)continue;let b=this.getItem(o5(this.persistenceKey,a));if(b){let c=pj.fromWebStorageEntry(a,b);c&&(this.activeClients=this.activeClients.insert(c.clientId,c))}}this.persistClientState();let a=this.storage.getItem(this.onlineStateKey);if(a){let b=this.fromWebStorageOnlineState(a);b&&this.handleOnlineStateEvent(b)}for(let a of this.earlyEvents)this.handleWebStorageEvent(a);this.earlyEvents=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(a){this.setItem(this.sequenceNumberKey,JSON.stringify(a))}getAllActiveQueryTargets(){return this.extractActiveQueryTargets(this.activeClients)}isActiveQueryTarget(a){let b=!1;return this.activeClients.forEach((c,d)=>{d.activeTargetIds.has(a)&&(b=!0)}),b}addPendingMutation(a){this.persistMutationState(a,"pending")}updateMutationState(a,b,c){this.persistMutationState(a,b,c),this.removeMutationState(a)}addLocalQueryTarget(a,b=!0){let c="not-current";if(this.isActiveQueryTarget(a)){let b=this.storage.getItem(o9(this.persistenceKey,a));if(b){let d=pi.fromWebStorageEntry(a,b);d&&(c=d.state)}}return b&&this.localClientState.addQueryTarget(a),this.persistClientState(),c}removeLocalQueryTarget(a){this.localClientState.removeQueryTarget(a),this.persistClientState()}isLocalQueryTarget(a){return this.localClientState.activeTargetIds.has(a)}clearQueryState(a){this.removeItem(o9(this.persistenceKey,a))}updateQueryState(a,b,c){this.persistQueryTargetState(a,b,c)}handleUserChange(a,b,c){b.forEach(a=>{this.removeMutationState(a)}),this.currentUser=a,c.forEach(a=>{this.addPendingMutation(a)})}setOnlineState(a){this.persistOnlineState(a)}notifyBundleLoaded(a){this.persistBundleLoadedState(a)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)}getItem(a){let b=this.storage.getItem(a);return dM(pg,"READ",a,b),b}setItem(a,b){dM(pg,"SET",a,b),this.storage.setItem(a,b)}removeItem(a){dM(pg,"REMOVE",a),this.storage.removeItem(a)}handleWebStorageEvent(a){let b=a;if(b.storageArea===this.storage){if(dM(pg,"EVENT",b.key,b.newValue),b.key===this.localClientStorageKey)return void dN("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.queue.enqueueRetryable(async()=>{if(!this.started)return void this.earlyEvents.push(b);if(null!==b.key){if(this.clientStateKeyRe.test(b.key))if(null!=b.newValue){let a=this.fromWebStorageClientState(b.key,b.newValue);if(a)return this.handleClientStateEvent(a.clientId,a)}else{let a=this.fromWebStorageClientStateKey(b.key);return this.handleClientStateEvent(a,null)}else if(this.mutationBatchKeyRe.test(b.key)){if(null!==b.newValue){let a=this.fromWebStorageMutationMetadata(b.key,b.newValue);if(a)return this.handleMutationBatchEvent(a)}}else if(this.queryTargetKeyRe.test(b.key)){if(null!==b.newValue){let a=this.fromWebStorageQueryTargetMetadata(b.key,b.newValue);if(a)return this.handleQueryTargetEvent(a)}}else if(b.key===this.onlineStateKey){if(null!==b.newValue){let a=this.fromWebStorageOnlineState(b.newValue);if(a)return this.handleOnlineStateEvent(a)}}else if(b.key===this.sequenceNumberKey){let a=pn(b.newValue);a!==fj.INVALID&&this.sequenceNumberHandler(a)}else if(b.key===this.bundleLoadedKey){let a=this.fromWebStoreBundleLoadedState(b.newValue);await Promise.all(a.map(a=>this.syncEngine.synchronizeWithChangedDocuments(a)))}}})}}get localClientState(){return this.activeClients.get(this.localClientId)}persistClientState(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())}persistMutationState(a,b,c){let d=new ph(this.currentUser,a,b,c),e=o7(this.persistenceKey,this.currentUser,a);this.setItem(e,d.toWebStorageJSON())}removeMutationState(a){let b=o7(this.persistenceKey,this.currentUser,a);this.removeItem(b)}persistOnlineState(a){let b={clientId:this.localClientId,onlineState:a};this.storage.setItem(this.onlineStateKey,JSON.stringify(b))}persistQueryTargetState(a,b,c){let d=o9(this.persistenceKey,a),e=new pi(a,b,c);this.setItem(d,e.toWebStorageJSON())}persistBundleLoadedState(a){let b=JSON.stringify(Array.from(a));this.setItem(this.bundleLoadedKey,b)}fromWebStorageClientStateKey(a){let b=this.clientStateKeyRe.exec(a);return b?b[1]:null}fromWebStorageClientState(a,b){let c=this.fromWebStorageClientStateKey(a);return pj.fromWebStorageEntry(c,b)}fromWebStorageMutationMetadata(a,b){let c=this.mutationBatchKeyRe.exec(a),d=Number(c[1]),e=void 0!==c[2]?c[2]:null;return ph.fromWebStorageEntry(new dG(e),d,b)}fromWebStorageQueryTargetMetadata(a,b){let c=Number(this.queryTargetKeyRe.exec(a)[1]);return pi.fromWebStorageEntry(c,b)}fromWebStorageOnlineState(a){return pk.fromWebStorageEntry(a)}fromWebStoreBundleLoadedState(a){return JSON.parse(a)}async handleMutationBatchEvent(a){return a.user.uid!==this.currentUser.uid?void dM(pg,`Ignoring mutation for non-active user ${a.user.uid}`):this.syncEngine.applyBatchState(a.batchId,a.state,a.error)}handleQueryTargetEvent(a){return this.syncEngine.applyTargetState(a.targetId,a.state,a.error)}handleClientStateEvent(a,b){let c=b?this.activeClients.insert(a,b):this.activeClients.remove(a),d=this.extractActiveQueryTargets(this.activeClients),e=this.extractActiveQueryTargets(c),f=[],g=[];return e.forEach(a=>{d.has(a)||f.push(a)}),d.forEach(a=>{e.has(a)||g.push(a)}),this.syncEngine.applyActiveTargetsChange(f,g).then(()=>{this.activeClients=c})}handleOnlineStateEvent(a){this.activeClients.get(a.clientId)&&this.onlineStateHandler(a.onlineState)}extractActiveQueryTargets(a){let b=jp();return a.forEach((a,c)=>{b=b.unionWith(c.activeTargetIds)}),b}}function pn(a){let b=fj.INVALID;if(null!=a)try{let c=JSON.parse(a);dS("number"==typeof c,30636,{seqString:a}),b=c}catch(a){dN(pg,"Failed to read sequence number from WebStorage",a)}return b}class po{constructor(){this.localState=new pl,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(a){}updateMutationState(a,b,c){}addLocalQueryTarget(a,b=!0){return b&&this.localState.addQueryTarget(a),this.queryState[a]||"not-current"}updateQueryState(a,b,c){this.queryState[a]=b}removeLocalQueryTarget(a){this.localState.removeQueryTarget(a)}isLocalQueryTarget(a){return this.localState.activeTargetIds.has(a)}clearQueryState(a){delete this.queryState[a]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(a){return this.localState.activeTargetIds.has(a)}start(){return this.localState=new pl,Promise.resolve()}handleUserChange(a,b,c){}setOnlineState(a){}shutdown(){}writeSequenceNumber(a){}notifyBundleLoaded(a){}}class pp{addCallback(a){}shutdown(){}}class pq{constructor(a){this.sendFn=a.sendFn,this.closeFn=a.closeFn}onConnected(a){this.wrappedOnConnected=a}onOpen(a){this.wrappedOnOpen=a}onClose(a){this.wrappedOnClose=a}onMessage(a){this.wrappedOnMessage=a}close(){this.closeFn()}send(a){this.sendFn(a)}callOnConnected(){this.wrappedOnConnected()}callOnOpen(){this.wrappedOnOpen()}callOnClose(a){this.wrappedOnClose(a)}callOnMessage(a){this.wrappedOnMessage(a)}}let pr=null;function ps(){return 0x10000000+Math.round(0x80000000*Math.random())}function pt(){return null===pr?pr=ps():pr++,"0x"+pr.toString(16)}function pu(a){return new Promise((b,c)=>{a((a,d)=>{a?c(a):b(d)})})}let pv="1.9.15",pw="GrpcConnection",px=`gl-node/${process.versions.node} fire/${dH} grpc/${pv}`;function py(a,b,c,d){dS(null===b||"OAuth"===b.type,36936);let e=new dC.Metadata;return b&&b.headers.forEach((a,b)=>e.set(b,a)),c&&c.headers.forEach((a,b)=>e.set(b,a)),d&&e.set("X-Firebase-GMPID",d),e.set("X-Goog-Api-Client",px),e.set("Google-Cloud-Resource-Prefix",a),e.set("x-goog-request-params",a),e}class pz{get shouldResourcePathBeIncludedInRequest(){return!0}constructor(a,b){this.databaseInfo=b,this.cachedStub=null,this.firestore=a.google.firestore.v1,this.databasePath=`projects/${b.databaseId.projectId}/databases/${b.databaseId.database}`}ensureActiveStub(){if(!this.cachedStub){dM(pw,"Creating Firestore stub.");let a=this.databaseInfo.ssl?dC.credentials.createSsl():dC.credentials.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,a)}return this.cachedStub}invokeRPC(a,b,c,d,e){let f=pt(),g=this.ensureActiveStub(),h=py(this.databasePath,d,e,this.databaseInfo.appId),i={database:this.databasePath,...c};return pu(b=>(dM(pw,`RPC '${a}' ${f} invoked with request:`,c),g[a](i,h,(c,d)=>{c?(dM(pw,`RPC '${a}' ${f} failed with error:`,c),b(new d9(ka(c.code),c.message))):(dM(pw,`RPC '${a}' ${f} completed with response:`,d),b(void 0,d))})))}invokeStreamingRPC(a,b,c,d,e,f){let g=pt(),h=[],i=new ea;dM(pw,`RPC '${a}' ${g} invoked (streaming) with request:`,c);let j=this.ensureActiveStub(),k=py(this.databasePath,d,e,this.databaseInfo.appId),l={...c,database:this.databasePath},m=j[a](l,k),n=!1;return m.on("data",b=>{dM(pw,`RPC ${a} ${g} received result:`,b),h.push(b),void 0!==f&&h.length===f&&(n=!0,i.resolve(h))}),m.on("end",()=>{dM(pw,`RPC '${a}' ${g} completed.`),n||(n=!0,i.resolve(h))}),m.on("error",b=>{dM(pw,`RPC '${a}' ${g} failed with error:`,b);let c=ka(b.code);i.reject(new d9(c,b.message))}),i.promise}openStream(a,b,c){let d=pt(),e=this.ensureActiveStub(),f=py(this.databasePath,b,c,this.databaseInfo.appId),g=e[a](f),h=!1,i=a=>{h||(h=!0,j.callOnClose(a),g.end())},j=new pq({sendFn:b=>{if(h)dM(pw,`RPC '${a}' stream ${d} not sending because gRPC stream is closed:`,b);else{dM(pw,`RPC '${a}' stream ${d} sending:`,b);try{g.write(b)}catch(a){throw dN("Failure sending:",b),dN("Error:",a),a}}},closeFn:()=>{dM(pw,`RPC '${a}' stream ${d} closed locally via close().`),i()}}),k=!1;return g.on("data",b=>{h||(dM(pw,`RPC '${a}' stream ${d} received:`,b),k||(j.callOnConnected(),k=!0),j.callOnMessage(b))}),g.on("end",()=>{dM(pw,`RPC '${a}' stream ${d} ended.`),i()}),g.on("error",b=>{h||(dO(pw,`RPC '${a}' stream ${d} error. Code:`,b.code,"Message:",b.message),i(new d9(ka(b.code),b.message)))}),dM(pw,`Opening RPC '${a}' stream ${d} to ${this.databaseInfo.host}`),setTimeout(()=>{j.callOnOpen()},0),j}terminate(){this.cachedStub&&(this.cachedStub.close(),this.cachedStub=void 0)}}let pA={google:{nested:{protobuf:{options:{csharp_namespace:"Google.Protobuf.WellKnownTypes",go_package:"github.com/golang/protobuf/ptypes/wrappers",java_package:"com.google.protobuf",java_outer_classname:"WrappersProto",java_multiple_files:!0,objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Empty:{fields:{}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Any:{fields:{typeUrl:{type:"string",id:1},value:{type:"bytes",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"google.golang.org/genproto/googleapis/firestore/v1;firestore",java_multiple_files:!0,java_outer_classname:"WriteProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"FieldReference",id:1}}},Avg:{fields:{field:{type:"FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api/annotations;annotations",java_multiple_files:!0,java_outer_classname:"HttpProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:0x44f2530,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},selector:{type:"string",id:1},body:{type:"string",id:7},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}};var pB={nested:pA},pC=Object.freeze({__proto__:null,nested:pA,default:pB});let pD={longs:String,enums:String,defaults:!0,oneofs:!1};function pE(){let a=dD.fromJSON(pC,pD);return dC.loadPackageDefinition(a)}function pF(a){return new pz(pE(),a)}function pG(){return new pp}function pH(){return"YES"===process.env.USE_MOCK_PERSISTENCE?window:null}function pI(){return null}function pJ(a){return new ky(a,!1)}let pK="ExponentialBackoff",pL=1e3,pM=1.5,pN=6e4;class pO{constructor(a,b,c=pL,d=pM,e=pN){this.queue=a,this.timerId=b,this.initialDelayMs=c,this.backoffFactor=d,this.maxDelayMs=e,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(a){this.cancel();let b=Math.floor(this.currentBaseMs+this.jitterDelayMs()),c=Math.max(0,Date.now()-this.lastAttemptTime),d=Math.max(0,b-c);d>0&&dM(pK,`Backing off for ${d} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${b} ms, last attempt: ${c} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,d,()=>(this.lastAttemptTime=Date.now(),a())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){null!==this.timerPromise&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}}let pP="PersistentStream",pQ=6e4,pR=1e4;class pS{constructor(a,b,c,d,e,f,g,h){this.queue=a,this.idleTimerId=c,this.healthTimerId=d,this.connection=e,this.authCredentialsProvider=f,this.appCheckCredentialsProvider=g,this.listener=h,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.responseCount=0,this.backoff=new pO(a,b)}isStarted(){return 1===this.state||5===this.state||this.isOpen()}isOpen(){return 2===this.state||3===this.state}start(){(this.responseCount=0,4===this.state)?this.performBackoff():this.auth()}async stop(){this.isStarted()&&await this.close(0)}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,pQ,()=>this.handleIdleCloseTimer()))}sendRequest(a){this.cancelIdleCheck(),this.stream.send(a)}async handleIdleCloseTimer(){if(this.isOpen())return this.close(0)}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}async close(a,b){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,4!==a?this.backoff.reset():b&&b.code===d1?(dN(b.toString()),dN("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):b&&b.code===d0&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=a,await this.listener.onClose(b)}tearDown(){}auth(){this.state=1;let a=this.getCloseGuardedDispatcher(this.closeCount),b=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([a,c])=>{this.closeCount===b&&this.startStream(a,c)},b=>{a(()=>{let a=new d9(dW,"Fetching auth token failed: "+b.message);return this.handleStreamClose(a)})})}startStream(a,b){let c=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(a,b),this.stream.onConnected(()=>{c(()=>this.listener.onConnected())}),this.stream.onOpen(()=>{c(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,pR,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose(a=>{c(()=>this.handleStreamClose(a))}),this.stream.onMessage(a=>{c(()=>1==++this.responseCount?this.onFirst(a):this.onNext(a))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(async()=>{this.state=0,this.start()})}handleStreamClose(a){return dM(pP,`close with error: ${a}`),this.stream=null,this.close(4,a)}getCloseGuardedDispatcher(a){return b=>{this.queue.enqueueAndForget(()=>this.closeCount===a?b():(dM(pP,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class pT extends pS{constructor(a,b,c,d,e,f){super(a,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",b,c,d,f),this.serializer=e}startRpc(a,b){return this.connection.openStream("Listen",a,b)}onFirst(a){return this.onNext(a)}onNext(a){this.backoff.reset();let b=kV(this.serializer,a),c=kX(a);return this.listener.onWatchChange(b,c)}watch(a){let b={};b.database=kP(this.serializer),b.addTarget=lc(this.serializer,a);let c=la(this.serializer,a);c&&(b.labels=c),this.sendRequest(b)}unwatch(a){let b={};b.database=kP(this.serializer),b.removeTarget=a,this.sendRequest(b)}}class pU extends pS{constructor(a,b,c,d,e,f){super(a,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",b,c,d,f),this.serializer=e}get handshakeComplete(){return this.responseCount>0}start(){this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete&&this.writeMutations([])}startRpc(a,b){return this.connection.openStream("Write",a,b)}onFirst(a){return dS(!!a.streamToken,31322),this.lastStreamToken=a.streamToken,dS(!a.writeResults||0===a.writeResults.length,55816),this.listener.onHandshakeComplete()}onNext(a){dS(!!a.streamToken,12678),this.lastStreamToken=a.streamToken,this.backoff.reset();let b=k1(a.writeResults,a.commitTime),c=kH(a.commitTime);return this.listener.onMutationResult(c,b)}writeHandshake(){let a={};a.database=kP(this.serializer),this.sendRequest(a)}writeMutations(a){let b={streamToken:this.lastStreamToken,writes:a.map(a=>kY(this.serializer,a))};this.sendRequest(b)}}class pV{}class pW extends pV{constructor(a,b,c,d){super(),this.authCredentials=a,this.appCheckCredentials=b,this.connection=c,this.serializer=d,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new d9(d2,"The client has already been terminated.")}invokeRPC(a,b,c,d){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([e,f])=>this.connection.invokeRPC(a,kJ(b,c),d,e,f)).catch(a=>{if("FirebaseError"===a.name)throw a.code===d0&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a;throw new d9(dW,a.toString())})}invokeStreamingRPC(a,b,c,d,e){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([f,g])=>this.connection.invokeStreamingRPC(a,kJ(b,c),d,f,g,e)).catch(a=>{if("FirebaseError"===a.name)throw a.code===d0&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a;throw new d9(dW,a.toString())})}terminate(){this.terminated=!0,this.connection.terminate()}}function pX(a,b,c,d){return new pW(a,b,c,d)}async function pY(a,b,c){let d=dT(a),{request:e,aliasMap:f,parent:g}=k7(d.serializer,iW(b),c);d.connection.shouldResourcePathBeIncludedInRequest||delete e.parent;let h=(await d.invokeStreamingRPC("RunAggregationQuery",d.serializer.databaseId,g,e,1)).filter(a=>!!a.result);dS(1===h.length,64727);let i=h[0].result?.aggregateFields;return Object.keys(i).reduce((a,b)=>(a[f[b]]=i[b],a),{})}function pZ(a,b,c){let d=dT(a);return d.verifyInitialized(),new pU(b,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,c)}function p$(a,b,c){let d=dT(a);return d.verifyInitialized(),new pT(b,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,c)}let p_="OnlineStateTracker",p0=1,p1=1e4;class p2{constructor(a,b){this.asyncQueue=a,this.onlineStateHandler=b,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){0===this.watchStreamFailures&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",p1,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${p1/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(a){"Online"===this.state?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=p0&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${p0} times. Most recent error: ${a.toString()}`),this.setAndBroadcast("Offline")))}set(a){this.clearOnlineStateTimer(),this.watchStreamFailures=0,"Online"===a&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(a)}setAndBroadcast(a){a!==this.state&&(this.state=a,this.onlineStateHandler(a))}logClientOfflineWarningIfNecessary(a){let b=`Could not reach Cloud Firestore backend. ${a}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?(dN(b),this.shouldWarnClientIsOffline=!1):dM(p_,b)}clearOnlineStateTimer(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}}let p3="RemoteStore",p4=10;class p5{constructor(a,b,c,d,e){this.localStore=a,this.datastore=b,this.asyncQueue=c,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=e,this.connectivityMonitor.addCallback(a=>{c.enqueueAndForget(async()=>{qg(this)&&(dM(p3,"Restarting streams for network reachability change."),await qA(this))})}),this.onlineStateTracker=new p2(c,d)}}function p6(a,b,c,d,e){return new p5(a,b,c,d,e)}async function p7(a){if(qg(a))for(let b of a.onNetworkStatusChange)await b(!0)}async function p8(a){for(let b of a.onNetworkStatusChange)await b(!1)}async function p9(a){let b=dT(a);dM(p3,"RemoteStore shutting down."),b.offlineCauses.add(5),await p8(b),b.connectivityMonitor.shutdown(),b.onlineStateTracker.set("Unknown")}function qa(a,b){let c=dT(a);!c.listenTargets.has(b.targetId)&&(c.listenTargets.set(b.targetId,b),qf(c)?qe(c):qD(c).isOpen()&&qc(c,b))}function qb(a,b){let c=dT(a),d=qD(c);c.listenTargets.delete(b),d.isOpen()&&qd(c,b),0===c.listenTargets.size&&(d.isOpen()?d.markIdle():qg(c)&&c.onlineStateTracker.set("Unknown"))}function qc(a,b){if(a.watchChangeAggregator.recordPendingTargetRequest(b.targetId),b.resumeToken.approximateByteSize()>0||b.snapshotVersion.compareTo(eL.min())>0){let c=a.remoteSyncer.getRemoteKeysForTarget(b.targetId).size;b=b.withExpectedCount(c)}qD(a).watch(b)}function qd(a,b){a.watchChangeAggregator.recordPendingTargetRequest(b),qD(a).unwatch(b)}function qe(a){a.watchChangeAggregator=new kq({getRemoteKeysForTarget:b=>a.remoteSyncer.getRemoteKeysForTarget(b),getTargetDataForTarget:b=>a.listenTargets.get(b)||null,getDatabaseId:()=>a.datastore.serializer.databaseId}),qD(a).start(),a.onlineStateTracker.handleWatchStreamStart()}function qf(a){return qg(a)&&!qD(a).isStarted()&&a.listenTargets.size>0}function qg(a){return 0===dT(a).offlineCauses.size}function qh(a){a.watchChangeAggregator=void 0}async function qi(a){a.onlineStateTracker.set("Online")}async function qj(a){a.listenTargets.forEach((b,c)=>{qc(a,b)})}async function qk(a,b){qh(a),qf(a)?(a.onlineStateTracker.handleWatchStreamFailure(b),qe(a)):a.onlineStateTracker.set("Unknown")}async function ql(a,b,c){if(a.onlineStateTracker.set("Online"),b instanceof kn&&2===b.state&&b.cause){try{await qp(a,b)}catch(c){dM(p3,"Failed to remove targets %s: %s ",b.targetIds.join(","),c),await qm(a,c)}return}if(b instanceof kl?a.watchChangeAggregator.handleDocumentChange(b):b instanceof km?a.watchChangeAggregator.handleExistenceFilter(b):a.watchChangeAggregator.handleTargetChange(b),!c.isEqual(eL.min()))try{let b=await oL(a.localStore);c.compareTo(b)>=0&&await qo(a,c)}catch(b){dM(p3,"Failed to raise snapshot:",b),await qm(a,b)}}async function qm(a,b,c){if(e8(b))a.offlineCauses.add(1),await p8(a),a.onlineStateTracker.set("Offline"),c||(c=()=>oL(a.localStore)),a.asyncQueue.enqueueRetryable(async()=>{dM(p3,"Retrying IndexedDB access"),await c(),a.offlineCauses.delete(1),await p7(a)});else throw b}function qn(a,b){return b().catch(c=>qm(a,c,b))}function qo(a,b){let c=a.watchChangeAggregator.createRemoteEvent(b);return c.targetChanges.forEach((c,d)=>{if(c.resumeToken.approximateByteSize()>0){let e=a.listenTargets.get(d);e&&a.listenTargets.set(d,e.withResumeToken(c.resumeToken,b))}}),c.targetMismatches.forEach((b,c)=>{let d=a.listenTargets.get(b);d&&(a.listenTargets.set(b,d.withResumeToken(gO.EMPTY_BYTE_STRING,d.snapshotVersion)),qd(a,b),qc(a,new lF(d.target,b,c,d.sequenceNumber)))}),a.remoteSyncer.applyRemoteEvent(c)}async function qp(a,b){let c=b.cause;for(let d of b.targetIds)a.listenTargets.has(d)&&(await a.remoteSyncer.rejectListen(d,c),a.listenTargets.delete(d),a.watchChangeAggregator.removeTarget(d))}async function qq(a){let b=dT(a),c=qE(b),d=b.writePipeline.length>0?b.writePipeline[b.writePipeline.length-1].batchId:g5;for(;qr(b);)try{let a=await oQ(b.localStore,d);if(null===a){0===b.writePipeline.length&&c.markIdle();break}d=a.batchId,qs(b,a)}catch(a){await qm(b,a)}qt(b)&&qu(b)}function qr(a){return qg(a)&&a.writePipeline.length<p4}function qs(a,b){a.writePipeline.push(b);let c=qE(a);c.isOpen()&&c.handshakeComplete&&c.writeMutations(b.mutations)}function qt(a){return qg(a)&&!qE(a).isStarted()&&a.writePipeline.length>0}function qu(a){qE(a).start()}async function qv(a){qE(a).writeHandshake()}async function qw(a){let b=qE(a);for(let c of a.writePipeline)b.writeMutations(c.mutations)}async function qx(a,b,c){let d=a.writePipeline.shift(),e=j5.from(d,b,c);await qn(a,()=>a.remoteSyncer.applySuccessfulWrite(e)),await qq(a)}async function qy(a,b){b&&qE(a).handshakeComplete&&await qz(a,b),qt(a)&&qu(a)}async function qz(a,b){if(j9(b.code)){let c=a.writePipeline.shift();qE(a).inhibitBackoff(),await qn(a,()=>a.remoteSyncer.rejectFailedWrite(c.batchId,b)),await qq(a)}}async function qA(a){let b=dT(a);b.offlineCauses.add(4),await p8(b),b.onlineStateTracker.set("Unknown"),b.offlineCauses.delete(4),await p7(b)}async function qB(a,b){let c=dT(a);c.asyncQueue.verifyOperationInProgress(),dM(p3,"RemoteStore received new credentials");let d=qg(c);c.offlineCauses.add(3),await p8(c),d&&c.onlineStateTracker.set("Unknown"),await c.remoteSyncer.handleCredentialChange(b),c.offlineCauses.delete(3),await p7(c)}async function qC(a,b){let c=dT(a);b?(c.offlineCauses.delete(2),await p7(c)):b||(c.offlineCauses.add(2),await p8(c),c.onlineStateTracker.set("Unknown"))}function qD(a){return a.watchStream||(a.watchStream=p$(a.datastore,a.asyncQueue,{onConnected:qi.bind(null,a),onOpen:qj.bind(null,a),onClose:qk.bind(null,a),onWatchChange:ql.bind(null,a)}),a.onNetworkStatusChange.push(async b=>{b?(a.watchStream.inhibitBackoff(),qf(a)?qe(a):a.onlineStateTracker.set("Unknown")):(await a.watchStream.stop(),qh(a))})),a.watchStream}function qE(a){return a.writeStream||(a.writeStream=pZ(a.datastore,a.asyncQueue,{onConnected:()=>Promise.resolve(),onOpen:qv.bind(null,a),onClose:qy.bind(null,a),onHandshakeComplete:qw.bind(null,a),onMutationResult:qx.bind(null,a)}),a.onNetworkStatusChange.push(async b=>{b?(a.writeStream.inhibitBackoff(),await qq(a)):(await a.writeStream.stop(),a.writePipeline.length>0&&(dM(p3,`Stopping write stream with ${a.writePipeline.length} pending writes`),a.writePipeline=[]))})),a.writeStream}let qF="AsyncQueue";class qG{constructor(a,b,c,d,e){this.asyncQueue=a,this.timerId=b,this.targetTimeMs=c,this.op=d,this.removalCallback=e,this.deferred=new ea,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(a,b,c,d,e){let f=new qG(a,b,Date.now()+c,d,e);return f.start(c),f}start(a){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),a)}skipDelay(){return this.handleDelayElapsed()}cancel(a){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new d9(dV,"Operation cancelled"+(a?": "+a:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(a=>this.deferred.resolve(a))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function qH(a,b){if(dN(qF,`${b}: ${a}`),e8(a))return new d9(d7,`${b}: ${a}`);throw a}class qI{static emptySet(a){return new qI(a.comparator)}constructor(a){a?this.comparator=(b,c)=>a(b,c)||ex.comparator(b.key,c.key):this.comparator=(a,b)=>ex.comparator(a.key,b.key),this.keyedMap=je(),this.sortedSet=new gD(this.comparator)}has(a){return null!=this.keyedMap.get(a)}get(a){return this.keyedMap.get(a)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(a){let b=this.keyedMap.get(a);return b?this.sortedSet.indexOf(b):-1}get size(){return this.sortedSet.size}forEach(a){this.sortedSet.inorderTraversal((b,c)=>(a(b),!1))}add(a){let b=this.delete(a.key);return b.copy(b.keyedMap.insert(a.key,a),b.sortedSet.insert(a,null))}delete(a){let b=this.get(a);return b?this.copy(this.keyedMap.remove(a),this.sortedSet.remove(b)):this}isEqual(a){if(!(a instanceof qI)||this.size!==a.size)return!1;let b=this.sortedSet.getIterator(),c=a.sortedSet.getIterator();for(;b.hasNext();){let a=b.getNext().key,d=c.getNext().key;if(!a.isEqual(d))return!1}return!0}toString(){let a=[];return(this.forEach(b=>{a.push(b.toString())}),0===a.length)?"DocumentSet ()":"DocumentSet (\n  "+a.join("  \n")+"\n)"}copy(a,b){let c=new qI;return c.comparator=this.comparator,c.keyedMap=a,c.sortedSet=b,c}}class qJ{constructor(){this.changeMap=new gD(ex.comparator)}track(a){let b=a.doc.key,c=this.changeMap.get(b);if(!c){this.changeMap=this.changeMap.insert(b,a);return}0!==a.type&&3===c.type?this.changeMap=this.changeMap.insert(b,a):3===a.type&&1!==c.type?this.changeMap=this.changeMap.insert(b,{type:c.type,doc:a.doc}):2===a.type&&2===c.type?this.changeMap=this.changeMap.insert(b,{type:2,doc:a.doc}):2===a.type&&0===c.type?this.changeMap=this.changeMap.insert(b,{type:0,doc:a.doc}):1===a.type&&0===c.type?this.changeMap=this.changeMap.remove(b):1===a.type&&2===c.type?this.changeMap=this.changeMap.insert(b,{type:1,doc:c.doc}):0===a.type&&1===c.type?this.changeMap=this.changeMap.insert(b,{type:2,doc:a.doc}):dQ(63341,{change:a,oldChange:c})}getChanges(){let a=[];return this.changeMap.inorderTraversal((b,c)=>{a.push(c)}),a}}class qK{constructor(a,b,c,d,e,f,g,h,i){this.query=a,this.docs=b,this.oldDocs=c,this.docChanges=d,this.mutatedKeys=e,this.fromCache=f,this.syncStateChanged=g,this.excludesMetadataChanges=h,this.hasCachedResults=i}static fromInitialDocuments(a,b,c,d,e){let f=[];return b.forEach(a=>{f.push({type:0,doc:a})}),new qK(a,b,qI.emptySet(b),f,c,d,!0,!1,e)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(a){if(this.fromCache!==a.fromCache||this.hasCachedResults!==a.hasCachedResults||this.syncStateChanged!==a.syncStateChanged||!this.mutatedKeys.isEqual(a.mutatedKeys)||!i_(this.query,a.query)||!this.docs.isEqual(a.docs)||!this.oldDocs.isEqual(a.oldDocs))return!1;let b=this.docChanges,c=a.docChanges;if(b.length!==c.length)return!1;for(let a=0;a<b.length;a++)if(b[a].type!==c[a].type||!b[a].doc.isEqual(c[a].doc))return!1;return!0}}class qL{constructor(){this.viewSnap=void 0,this.listeners=[]}hasRemoteListeners(){return this.listeners.some(a=>a.listensToRemoteStore())}}function qM(){return new qN}class qN{constructor(){this.queries=qO(),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}terminate(){qU(this,new d9(d3,"Firestore shutting down"))}}function qO(){return new ja(a=>i0(a),i_)}async function qP(a,b){let c=dT(a),d=3,e=b.query,f=c.queries.get(e);f?!f.hasRemoteListeners()&&b.listensToRemoteStore()&&(d=2):(f=new qL,d=+!b.listensToRemoteStore());try{switch(d){case 0:f.viewSnap=await c.onListen(e,!0);break;case 1:f.viewSnap=await c.onListen(e,!1);break;case 2:await c.onFirstRemoteStoreListen(e)}}catch(c){let a=qH(c,`Initialization of query '${i1(b.query)}' failed`);b.onError(a);return}c.queries.set(e,f),f.listeners.push(b),b.applyOnlineStateChange(c.onlineState),f.viewSnap&&b.onViewSnapshot(f.viewSnap)&&qV(c)}async function qQ(a,b){let c=dT(a),d=b.query,e=3,f=c.queries.get(d);if(f){let a=f.listeners.indexOf(b);a>=0&&(f.listeners.splice(a,1),0===f.listeners.length?e=+!b.listensToRemoteStore():!f.hasRemoteListeners()&&b.listensToRemoteStore()&&(e=2))}switch(e){case 0:return c.queries.delete(d),c.onUnlisten(d,!0);case 1:return c.queries.delete(d),c.onUnlisten(d,!1);case 2:return c.onLastRemoteStoreUnlisten(d);default:return}}function qR(a,b){let c=dT(a),d=!1;for(let a of b){let b=a.query,e=c.queries.get(b);if(e){for(let b of e.listeners)b.onViewSnapshot(a)&&(d=!0);e.viewSnap=a}}d&&qV(c)}function qS(a,b,c){let d=dT(a),e=d.queries.get(b);if(e)for(let a of e.listeners)a.onError(c);d.queries.delete(b)}function qT(a,b){let c=dT(a);c.onlineState=b;let d=!1;c.queries.forEach((a,c)=>{for(let a of c.listeners)a.applyOnlineStateChange(b)&&(d=!0)}),d&&qV(c)}function qU(a,b){let c=dT(a),d=c.queries;c.queries=qO(),d.forEach((a,c)=>{for(let a of c.listeners)a.onError(b)})}function qV(a){a.snapshotsInSyncListeners.forEach(a=>{a.next()})}!function(a){a.Default="default",a.Cache="cache"}(di||(di={}));class qW{constructor(a,b,c){this.query=a,this.queryObserver=b,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=c||{}}onViewSnapshot(a){if(!this.options.includeMetadataChanges){let b=[];for(let c of a.docChanges)3!==c.type&&b.push(c);a=new qK(a.query,a.docs,a.oldDocs,b,a.mutatedKeys,a.fromCache,a.syncStateChanged,!0,a.hasCachedResults)}let b=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(a)&&(this.queryObserver.next(a),b=!0):this.shouldRaiseInitialEvent(a,this.onlineState)&&(this.raiseInitialEvent(a),b=!0),this.snap=a,b}onError(a){this.queryObserver.error(a)}applyOnlineStateChange(a){this.onlineState=a;let b=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,a)&&(this.raiseInitialEvent(this.snap),b=!0),b}shouldRaiseInitialEvent(a,b){if(!a.fromCache||!this.listensToRemoteStore())return!0;let c="Offline"!==b;return(!this.options.waitForSyncWhenOnline||!c)&&(!a.docs.isEmpty()||a.hasCachedResults||"Offline"===b)}shouldRaiseEvent(a){if(a.docChanges.length>0)return!0;let b=this.snap&&this.snap.hasPendingWrites!==a.hasPendingWrites;return(!!a.syncStateChanged||!!b)&&!0===this.options.includeMetadataChanges}raiseInitialEvent(a){a=qK.fromInitialDocuments(a.query,a.docs,a.mutatedKeys,a.fromCache,a.hasCachedResults),this.raisedInitialEvent=!0,this.queryObserver.next(a)}listensToRemoteStore(){return this.options.source!==di.Cache}}class qX{constructor(a,b,c,d){this.targetId=a,this.fromCache=b,this.addedKeys=c,this.removedKeys=d}static fromSnapshot(a,b){let c=jn(),d=jn();for(let a of b.docChanges)switch(a.type){case 0:c=c.add(a.doc.key);break;case 1:d=d.add(a.doc.key)}return new qX(a,b.fromCache,c,d)}}class qY{constructor(a){this.key=a}}class qZ{constructor(a){this.key=a}}class q${constructor(a,b){this.query=a,this._syncedDocuments=b,this.syncState=null,this.hasCachedResults=!1,this.current=!1,this.limboDocuments=jn(),this.mutatedKeys=jn(),this.docComparator=i8(a),this.documentSet=new qI(this.docComparator)}get syncedDocuments(){return this._syncedDocuments}computeDocChanges(a,b){let c=b?b.changeSet:new qJ,d=b?b.documentSet:this.documentSet,e=b?b.mutatedKeys:this.mutatedKeys,f=d,g=!1,h="F"===this.query.limitType&&d.size===this.query.limit?d.last():null,i="L"===this.query.limitType&&d.size===this.query.limit?d.first():null;if(a.inorderTraversal((a,b)=>{let j=d.get(a),k=i2(this.query,b)?b:null,l=!!j&&this.mutatedKeys.has(j.key),m=!!k&&(k.hasLocalMutations||this.mutatedKeys.has(k.key)&&k.hasCommittedMutations),n=!1;j&&k?j.data.isEqual(k.data)?l!==m&&(c.track({type:3,doc:k}),n=!0):!this.shouldWaitForSyncedDocument(j,k)&&(c.track({type:2,doc:k}),n=!0,(h&&this.docComparator(k,h)>0||i&&0>this.docComparator(k,i))&&(g=!0)):!j&&k?(c.track({type:0,doc:k}),n=!0):j&&!k&&(c.track({type:1,doc:j}),n=!0,(h||i)&&(g=!0)),n&&(k?(f=f.add(k),e=m?e.add(a):e.delete(a)):(f=f.delete(a),e=e.delete(a)))}),null!==this.query.limit)for(;f.size>this.query.limit;){let a="F"===this.query.limitType?f.last():f.first();f=f.delete(a.key),e=e.delete(a.key),c.track({type:1,doc:a})}return{documentSet:f,changeSet:c,needsRefill:g,mutatedKeys:e}}shouldWaitForSyncedDocument(a,b){return a.hasLocalMutations&&b.hasCommittedMutations&&!b.hasLocalMutations}applyChanges(a,b,c,d){let e=this.documentSet;this.documentSet=a.documentSet,this.mutatedKeys=a.mutatedKeys;let f=a.changeSet.getChanges();f.sort((a,b)=>q_(a.type,b.type)||this.docComparator(a.doc,b.doc)),this.applyTargetChange(c),d=d??!1;let g=b&&!d?this.updateLimboDocuments():[],h=+!!(0===this.limboDocuments.size&&this.current&&!d),i=h!==this.syncState;return(this.syncState=h,0!==f.length||i)?{snapshot:new qK(this.query,a.documentSet,e,f,a.mutatedKeys,0===h,i,!1,!!c&&c.resumeToken.approximateByteSize()>0),limboChanges:g}:{limboChanges:g}}applyOnlineStateChange(a){return this.current&&"Offline"===a?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new qJ,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}}shouldBeInLimbo(a){return!this._syncedDocuments.has(a)&&!!this.documentSet.has(a)&&!this.documentSet.get(a).hasLocalMutations}applyTargetChange(a){a&&(a.addedDocuments.forEach(a=>this._syncedDocuments=this._syncedDocuments.add(a)),a.modifiedDocuments.forEach(a=>{}),a.removedDocuments.forEach(a=>this._syncedDocuments=this._syncedDocuments.delete(a)),this.current=a.current)}updateLimboDocuments(){if(!this.current)return[];let a=this.limboDocuments;this.limboDocuments=jn(),this.documentSet.forEach(a=>{this.shouldBeInLimbo(a.key)&&(this.limboDocuments=this.limboDocuments.add(a.key))});let b=[];return a.forEach(a=>{this.limboDocuments.has(a)||b.push(new qZ(a))}),this.limboDocuments.forEach(c=>{a.has(c)||b.push(new qY(c))}),b}synchronizeWithPersistedState(a){this._syncedDocuments=a.remoteKeys,this.limboDocuments=jn();let b=this.computeDocChanges(a.documents);return this.applyChanges(b,!0)}computeInitialSnapshot(){return qK.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,0===this.syncState,this.hasCachedResults)}}function q_(a,b){let c=a=>{switch(a){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return dQ(20277,{change:a})}};return c(a)-c(b)}let q0="SyncEngine";class q1{constructor(a,b,c){this.query=a,this.targetId=b,this.view=c}}class q2{constructor(a){this.key=a,this.receivedDocument=!1}}class q3{constructor(a,b,c,d,e,f){this.localStore=a,this.remoteStore=b,this.eventManager=c,this.sharedClientState=d,this.currentUser=e,this.maxConcurrentLimboResolutions=f,this.syncEngineListener={},this.queryViewsByQuery=new ja(a=>i0(a),i_),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new gD(ex.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new nU,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=ni.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return!0===this._isPrimaryClient}}function q4(a,b,c,d,e,f,g){let h=new q3(a,b,c,d,e,f);return g&&(h._isPrimaryClient=!0),h}async function q5(a,b,c=!0){let d,e=rE(a),f=e.queryViewsByQuery.get(b);return f?(e.sharedClientState.addLocalQueryTarget(f.targetId),d=f.view.computeInitialSnapshot()):d=await q7(e,b,c,!0),d}async function q6(a,b){let c=rE(a);await q7(c,b,!0,!1)}async function q7(a,b,c,d){let e,f=await oR(a.localStore,iV(b)),g=f.targetId,h=a.sharedClientState.addLocalQueryTarget(g,c);return d&&(e=await q8(a,b,g,"current"===h,f.resumeToken)),a.isPrimaryClient&&c&&qa(a.remoteStore,f),e}async function q8(a,b,c,d,e){a.applyDocChanges=(b,c,d)=>rr(a,b,c,d);let f=await oU(a.localStore,b,!0),g=new q$(b,f.remoteKeys),h=g.computeDocChanges(f.documents),i=kk.createSynthesizedTargetChangeForCurrentChange(c,d&&"Offline"!==a.onlineState,e),j=g.applyChanges(h,a.isPrimaryClient,i);rn(a,c,j.limboChanges);let k=new q1(b,c,g);return a.queryViewsByQuery.set(b,k),a.queriesByTarget.has(c)?a.queriesByTarget.get(c).push(b):a.queriesByTarget.set(c,[b]),j.snapshot}async function q9(a,b,c){let d=dT(a),e=d.queryViewsByQuery.get(b),f=d.queriesByTarget.get(e.targetId);if(f.length>1){d.queriesByTarget.set(e.targetId,f.filter(a=>!i_(a,b))),d.queryViewsByQuery.delete(b);return}d.isPrimaryClient?(d.sharedClientState.removeLocalQueryTarget(e.targetId),d.sharedClientState.isActiveQueryTarget(e.targetId)||await oT(d.localStore,e.targetId,!1).then(()=>{d.sharedClientState.clearQueryState(e.targetId),c&&qb(d.remoteStore,e.targetId),rl(d,e.targetId)}).catch(e_)):(rl(d,e.targetId),await oT(d.localStore,e.targetId,!0))}async function ra(a,b){let c=dT(a),d=c.queryViewsByQuery.get(b),e=c.queriesByTarget.get(d.targetId);c.isPrimaryClient&&1===e.length&&(c.sharedClientState.removeLocalQueryTarget(d.targetId),qb(c.remoteStore,d.targetId))}async function rb(a,b,c){let d=rF(a);try{let a=await oH(d.localStore,b);d.sharedClientState.addPendingMutation(a.batchId),rj(d,a.batchId,c),await rq(d,a.changes),await qq(d.remoteStore)}catch(b){let a=qH(b,"Failed to persist write");c.reject(a)}}async function rc(a,b){let c=dT(a);try{let a=await oM(c.localStore,b);b.targetChanges.forEach((a,b)=>{let d=c.activeLimboResolutionsByTarget.get(b);d&&(dS(a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size<=1,22616),a.addedDocuments.size>0?d.receivedDocument=!0:a.modifiedDocuments.size>0?dS(d.receivedDocument,14607):a.removedDocuments.size>0&&(dS(d.receivedDocument,42227),d.receivedDocument=!1))}),await rq(c,a,b)}catch(a){await e_(a)}}function rd(a,b,c){let d=dT(a);if(d.isPrimaryClient&&0===c||!d.isPrimaryClient&&1===c){let a=[];d.queryViewsByQuery.forEach((c,d)=>{let e=d.view.applyOnlineStateChange(b);e.snapshot&&a.push(e.snapshot)}),qT(d.eventManager,b),a.length&&d.syncEngineListener.onWatchChange(a),d.onlineState=b,d.isPrimaryClient&&d.sharedClientState.setOnlineState(b)}}async function re(a,b,c){let d=dT(a);d.sharedClientState.updateQueryState(b,"rejected",c);let e=d.activeLimboResolutionsByTarget.get(b),f=e&&e.key;if(f){let a=new gD(ex.comparator);a=a.insert(f,hZ.newNoDocument(f,eL.min()));let c=jn().add(f),e=new kj(eL.min(),new Map,new gD(el),a,c);await rc(d,e),d.activeLimboTargetsByKey=d.activeLimboTargetsByKey.remove(f),d.activeLimboResolutionsByTarget.delete(b),rp(d)}else await oT(d.localStore,b,!1).then(()=>rl(d,b,c)).catch(e_)}async function rf(a,b){let c=dT(a),d=b.batch.batchId;try{let a=await oI(c.localStore,b);rk(c,d,null),rh(c,d),c.sharedClientState.updateMutationState(d,"acknowledged"),await rq(c,a)}catch(a){await e_(a)}}async function rg(a,b,c){let d=dT(a);try{let a=await oK(d.localStore,b);rk(d,b,c),rh(d,b),d.sharedClientState.updateMutationState(b,"rejected",c),await rq(d,a)}catch(a){await e_(a)}}function rh(a,b){(a.pendingWritesCallbacks.get(b)||[]).forEach(a=>{a.resolve()}),a.pendingWritesCallbacks.delete(b)}function ri(a,b){a.pendingWritesCallbacks.forEach(a=>{a.forEach(a=>{a.reject(new d9(dV,b))})}),a.pendingWritesCallbacks.clear()}function rj(a,b,c){let d=a.mutationUserCallbacks[a.currentUser.toKey()];d||(d=new gD(el)),d=d.insert(b,c),a.mutationUserCallbacks[a.currentUser.toKey()]=d}function rk(a,b,c){let d=dT(a),e=d.mutationUserCallbacks[d.currentUser.toKey()];if(e){let a=e.get(b);a&&(c?a.reject(c):a.resolve(),e=e.remove(b)),d.mutationUserCallbacks[d.currentUser.toKey()]=e}}function rl(a,b,c=null){for(let d of(a.sharedClientState.removeLocalQueryTarget(b),a.queriesByTarget.get(b)))a.queryViewsByQuery.delete(d),c&&a.syncEngineListener.onWatchError(d,c);a.queriesByTarget.delete(b),a.isPrimaryClient&&a.limboDocumentRefs.removeReferencesForId(b).forEach(b=>{a.limboDocumentRefs.containsKey(b)||rm(a,b)})}function rm(a,b){a.enqueuedLimboResolutions.delete(b.path.canonicalString());let c=a.activeLimboTargetsByKey.get(b);null!==c&&(qb(a.remoteStore,c),a.activeLimboTargetsByKey=a.activeLimboTargetsByKey.remove(b),a.activeLimboResolutionsByTarget.delete(c),rp(a))}function rn(a,b,c){for(let d of c)d instanceof qY?(a.limboDocumentRefs.addReference(d.key,b),ro(a,d)):d instanceof qZ?(dM(q0,"Document no longer in limbo: "+d.key),a.limboDocumentRefs.removeReference(d.key,b),a.limboDocumentRefs.containsKey(d.key)||rm(a,d.key)):dQ(19791,{limboChange:d})}function ro(a,b){let c=b.key,d=c.path.canonicalString();a.activeLimboTargetsByKey.get(c)||a.enqueuedLimboResolutions.has(d)||(dM(q0,"New document in limbo: "+c),a.enqueuedLimboResolutions.add(d),rp(a))}function rp(a){for(;a.enqueuedLimboResolutions.size>0&&a.activeLimboTargetsByKey.size<a.maxConcurrentLimboResolutions;){let b=a.enqueuedLimboResolutions.values().next().value;a.enqueuedLimboResolutions.delete(b);let c=new ex(eu.fromString(b)),d=a.limboTargetIdGenerator.next();a.activeLimboResolutionsByTarget.set(d,new q2(c)),a.activeLimboTargetsByKey=a.activeLimboTargetsByKey.insert(c,d),qa(a.remoteStore,new lF(iV(iO(c.path)),d,"TargetPurposeLimboResolution",fj.INVALID))}}async function rq(a,b,c){let d=dT(a),e=[],f=[],g=[];d.queryViewsByQuery.isEmpty()||(d.queryViewsByQuery.forEach((a,h)=>{g.push(d.applyDocChanges(h,b,c).then(a=>{if((a||c)&&d.isPrimaryClient){let b=a?!a.fromCache:c?.targetChanges.get(h.targetId)?.current;d.sharedClientState.updateQueryState(h.targetId,b?"current":"not-current")}if(a){e.push(a);let b=qX.fromSnapshot(h.targetId,a);f.push(b)}}))}),await Promise.all(g),d.syncEngineListener.onWatchChange(e),await oP(d.localStore,f))}async function rr(a,b,c,d){let e=b.view.computeDocChanges(c);e.needsRefill&&(e=await oU(a.localStore,b.query,!1).then(({documents:a})=>b.view.computeDocChanges(a,e)));let f=d&&d.targetChanges.get(b.targetId),g=d&&null!=d.targetMismatches.get(b.targetId),h=b.view.applyChanges(e,a.isPrimaryClient,f,g);return rn(a,b.targetId,h.limboChanges),h.snapshot}async function rs(a,b){let c=dT(a);if(!c.currentUser.isEqual(b)){dM(q0,"User change. New user:",b.toKey());let a=await oG(c.localStore,b);c.currentUser=b,ri(c,"'waitForPendingWrites' promise is rejected due to a user change."),c.sharedClientState.handleUserChange(b,a.removedBatchIds,a.addedBatchIds),await rq(c,a.affectedDocuments)}}function rt(a,b){let c=dT(a),d=c.activeLimboResolutionsByTarget.get(b);if(d&&d.receivedDocument)return jn().add(d.key);{let a=jn(),d=c.queriesByTarget.get(b);if(!d)return a;for(let b of d){let d=c.queryViewsByQuery.get(b);a=a.unionWith(d.view.syncedDocuments)}return a}}async function ru(a,b){let c=dT(a),d=await oU(c.localStore,b.query,!0),e=b.view.synchronizeWithPersistedState(d);return c.isPrimaryClient&&rn(c,b.targetId,e.limboChanges),e}async function rv(a,b){let c=dT(a);return o$(c.localStore,b).then(a=>rq(c,a))}async function rw(a,b,c,d){let e=dT(a),f=await oW(e.localStore,b);null===f?dM(q0,"Cannot apply mutation batch with id: "+b):("pending"===c?await qq(e.remoteStore):"acknowledged"===c||"rejected"===c?(rk(e,b,d||null),rh(e,b),oX(e.localStore,b)):dQ(6720,"Unknown batchState",{batchState:c}),await rq(e,f))}async function rx(a,b){let c=dT(a);if(rE(c),rF(c),!0===b&&!0!==c._isPrimaryClient){let a=c.sharedClientState.getAllActiveQueryTargets(),b=await rz(c,a.toArray());for(let a of(c._isPrimaryClient=!0,await qC(c.remoteStore,!0),b))qa(c.remoteStore,a)}else if(!1===b&&!1!==c._isPrimaryClient){let a=[],b=Promise.resolve();c.queriesByTarget.forEach((d,e)=>{c.sharedClientState.isLocalQueryTarget(e)?a.push(e):b=b.then(()=>(rl(c,e),oT(c.localStore,e,!0))),qb(c.remoteStore,e)}),await b,await rz(c,a),ry(c),c._isPrimaryClient=!1,await qC(c.remoteStore,!1)}}function ry(a){let b=dT(a);b.activeLimboResolutionsByTarget.forEach((a,c)=>{qb(b.remoteStore,c)}),b.limboDocumentRefs.removeAllReferences(),b.activeLimboResolutionsByTarget=new Map,b.activeLimboTargetsByKey=new gD(ex.comparator)}async function rz(a,b,c){let d=dT(a),e=[],f=[];for(let a of b){let b,c=d.queriesByTarget.get(a);if(c&&0!==c.length)for(let a of(b=await oR(d.localStore,iV(c[0])),c)){let b=d.queryViewsByQuery.get(a),c=await ru(d,b);c.snapshot&&f.push(c.snapshot)}else{let c=await oZ(d.localStore,a);b=await oR(d.localStore,c),await q8(d,rA(c),a,!1,b.resumeToken)}e.push(b)}return d.syncEngineListener.onWatchChange(f),e}function rA(a){return iN(a.path,a.collectionGroup,a.orderBy,a.filters,a.limit,"F",a.startAt,a.endAt)}function rB(a){return oY(dT(a).localStore)}async function rC(a,b,c,d){let e=dT(a);if(e._isPrimaryClient)return void dM(q0,"Ignoring unexpected query state notification.");let f=e.queriesByTarget.get(b);if(f&&f.length>0)switch(c){case"current":case"not-current":{let a=await o$(e.localStore,i7(f[0])),d=kj.createSynthesizedRemoteEventForCurrentChange(b,"current"===c,gO.EMPTY_BYTE_STRING);await rq(e,a,d);break}case"rejected":await oT(e.localStore,b,!0),rl(e,b,d);break;default:dQ(64155,c)}}async function rD(a,b,c){let d=rE(a);if(d._isPrimaryClient){for(let a of b){if(d.queriesByTarget.has(a)&&d.sharedClientState.isActiveQueryTarget(a)){dM(q0,"Adding an already active target "+a);continue}let b=await oZ(d.localStore,a),c=await oR(d.localStore,b);await q8(d,rA(b),c.targetId,!1,c.resumeToken),qa(d.remoteStore,c)}for(let a of c)d.queriesByTarget.has(a)&&await oT(d.localStore,a,!1).then(()=>{qb(d.remoteStore,a),rl(d,a)}).catch(e_)}}function rE(a){let b=dT(a);return b.remoteStore.remoteSyncer.applyRemoteEvent=rc.bind(null,b),b.remoteStore.remoteSyncer.getRemoteKeysForTarget=rt.bind(null,b),b.remoteStore.remoteSyncer.rejectListen=re.bind(null,b),b.syncEngineListener.onWatchChange=qR.bind(null,b.eventManager),b.syncEngineListener.onWatchError=qS.bind(null,b.eventManager),b}function rF(a){let b=dT(a);return b.remoteStore.remoteSyncer.applySuccessfulWrite=rf.bind(null,b),b.remoteStore.remoteSyncer.rejectFailedWrite=rg.bind(null,b),b}class rG{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(a){this.serializer=pJ(a.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(a),this.persistence=this.createPersistence(a),await this.persistence.start(),this.localStore=this.createLocalStore(a),this.gcScheduler=this.createGarbageCollectionScheduler(a,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(a,this.localStore)}createGarbageCollectionScheduler(a,b){return null}createIndexBackfillerScheduler(a,b){return null}createLocalStore(a){return oF(this.persistence,new o3,a.initialUser,this.serializer)}createPersistence(a){return new n2(n4.factory,this.serializer)}createSharedClientState(a){return new po}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}rG.provider={build:()=>new rG};class rH extends rG{constructor(a){super(),this.cacheSizeBytes=a}createGarbageCollectionScheduler(a,b){return dS(this.persistence.referenceDelegate instanceof n5,46915),new nx(this.persistence.referenceDelegate.garbageCollector,a.asyncQueue,b)}createPersistence(a){let b=void 0!==this.cacheSizeBytes?nq.withCacheSize(this.cacheSizeBytes):nq.DEFAULT;return new n2(a=>n5.factory(a,b),this.serializer)}}class rI extends rG{constructor(a,b,c){super(),this.onlineComponentProvider=a,this.cacheSizeBytes=b,this.forceOwnership=c,this.kind="persistent",this.synchronizeTabs=!1}async initialize(a){await super.initialize(a),await this.onlineComponentProvider.initialize(this,a),await rF(this.onlineComponentProvider.syncEngine),await qq(this.onlineComponentProvider.remoteStore),await this.persistence.setPrimaryStateListener(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}createLocalStore(a){return oF(this.persistence,new o3,a.initialUser,this.serializer)}createGarbageCollectionScheduler(a,b){return new nx(this.persistence.referenceDelegate.garbageCollector,a.asyncQueue,b)}createIndexBackfillerScheduler(a,b){let c=new fi(b,this.persistence);return new fh(a.asyncQueue,c)}createPersistence(a){let b=oA(a.databaseInfo.databaseId,a.databaseInfo.persistenceKey),c=void 0!==this.cacheSizeBytes?nq.withCacheSize(this.cacheSizeBytes):nq.DEFAULT;return new ox(this.synchronizeTabs,b,a.clientId,c,a.asyncQueue,pH(),pI(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(a){return new po}}class rJ extends rI{constructor(a,b){super(a,b,!1),this.onlineComponentProvider=a,this.cacheSizeBytes=b,this.synchronizeTabs=!0}async initialize(a){await super.initialize(a);let b=this.onlineComponentProvider.syncEngine;this.sharedClientState instanceof pm&&(this.sharedClientState.syncEngine={applyBatchState:rw.bind(null,b),applyTargetState:rC.bind(null,b),applyActiveTargetsChange:rD.bind(null,b),getActiveClients:rB.bind(null,b),synchronizeWithChangedDocuments:rv.bind(null,b)},await this.sharedClientState.start()),await this.persistence.setPrimaryStateListener(async a=>{await rx(this.onlineComponentProvider.syncEngine,a),this.gcScheduler&&(a&&!this.gcScheduler.started?this.gcScheduler.start():a||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(a&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():a||this.indexBackfillerScheduler.stop())})}createSharedClientState(a){let b=pH();if(!pm.isAvailable(b))throw new d9(d5,"IndexedDB persistence is only available on platforms that support LocalStorage.");let c=oA(a.databaseInfo.databaseId,a.databaseInfo.persistenceKey);return new pm(b,a.asyncQueue,c,a.clientId,a.initialUser)}}class rK{async initialize(a,b){this.localStore||(this.localStore=a.localStore,this.sharedClientState=a.sharedClientState,this.datastore=this.createDatastore(b),this.remoteStore=this.createRemoteStore(b),this.eventManager=this.createEventManager(b),this.syncEngine=this.createSyncEngine(b,!a.synchronizeTabs),this.sharedClientState.onlineStateHandler=a=>rd(this.syncEngine,a,1),this.remoteStore.remoteSyncer.handleCredentialChange=rs.bind(null,this.syncEngine),await qC(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(a){return qM()}createDatastore(a){let b=pJ(a.databaseInfo.databaseId),c=pF(a.databaseInfo);return pX(a.authCredentials,a.appCheckCredentials,c,b)}createRemoteStore(a){return p6(this.localStore,this.datastore,a.asyncQueue,a=>rd(this.syncEngine,a,0),pG())}createSyncEngine(a,b){return q4(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,a.initialUser,a.maxConcurrentLimboResolutions,b)}async terminate(){await p9(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}rK.provider={build:()=>new rK};class rL{constructor(a){this.observer=a,this.muted=!1}next(a){!this.muted&&this.observer.next&&this.scheduleEvent(this.observer.next,a)}error(a){this.muted||(this.observer.error?this.scheduleEvent(this.observer.error,a):dN("Uncaught Error in snapshot listener:",a.toString()))}mute(){this.muted=!0}scheduleEvent(a,b){setTimeout(()=>{this.muted||a(b)},0)}}let rM="FirestoreClient",rN=100,rO=11,rP=20,rQ=22;class rR{constructor(a,b,c,d,e){this.authCredentials=a,this.appCheckCredentials=b,this.asyncQueue=c,this.databaseInfo=d,this.user=dG.UNAUTHENTICATED,this.clientId=ek.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=e,this.authCredentials.start(c,async a=>{dM(rM,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(c,a=>(dM(rM,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:rN}}setCredentialChangeListener(a){this.authCredentialListener=a}setAppCheckTokenChangeListener(a){this.appCheckCredentialListener=a}terminate(){this.asyncQueue.enterRestrictedMode();let a=new ea;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),a.resolve()}catch(c){let b=qH(c,"Failed to shutdown persistence");a.reject(b)}}),a.promise}}async function rS(a,b){a.asyncQueue.verifyOperationInProgress(),dM(rM,"Initializing OfflineComponentProvider");let c=a.configuration;await b.initialize(c);let d=c.initialUser;a.setCredentialChangeListener(async a=>{d.isEqual(a)||(await oG(b.localStore,a),d=a)}),b.persistence.setDatabaseDeletedListener(()=>a.terminate()),a._offlineComponents=b}async function rT(a,b){a.asyncQueue.verifyOperationInProgress();let c=await rV(a);dM(rM,"Initializing OnlineComponentProvider"),await b.initialize(c,a.configuration),a.setCredentialChangeListener(a=>qB(b.remoteStore,a)),a.setAppCheckTokenChangeListener((a,c)=>qB(b.remoteStore,c)),a._onlineComponents=b}function rU(a){return"FirebaseError"===a.name?a.code===d2||a.code===d5:!("undefined"!=typeof DOMException&&a instanceof DOMException)||a.code===rQ||a.code===rP||a.code===rO}async function rV(a){if(!a._offlineComponents)if(a._uninitializedComponentsProvider){dM(rM,"Using user provided OfflineComponentProvider");try{await rS(a,a._uninitializedComponentsProvider._offline)}catch(c){let b=c;if(!rU(b))throw b;dO("Error using user provided cache. Falling back to memory cache: "+b),await rS(a,new rG)}}else dM(rM,"Using default OfflineComponentProvider"),await rS(a,new rH(void 0));return a._offlineComponents}async function rW(a){return a._onlineComponents||(a._uninitializedComponentsProvider?(dM(rM,"Using user provided OnlineComponentProvider"),await rT(a,a._uninitializedComponentsProvider._online)):(dM(rM,"Using default OnlineComponentProvider"),await rT(a,new rK))),a._onlineComponents}function rX(a){return rW(a).then(a=>a.syncEngine)}function rY(a){return rW(a).then(a=>a.datastore)}async function rZ(a){let b=await rW(a),c=b.eventManager;return c.onListen=q5.bind(null,b.syncEngine),c.onUnlisten=q9.bind(null,b.syncEngine),c.onFirstRemoteStoreListen=q6.bind(null,b.syncEngine),c.onLastRemoteStoreUnlisten=ra.bind(null,b.syncEngine),c}function r$(a,b,c={}){let d=new ea;return a.asyncQueue.enqueueAndForget(async()=>r2(await rZ(a),a.asyncQueue,b,c,d)),d.promise}function r_(a,b,c={}){let d=new ea;return a.asyncQueue.enqueueAndForget(async()=>r3(await rZ(a),a.asyncQueue,b,c,d)),d.promise}function r0(a,b,c){let d=new ea;return a.asyncQueue.enqueueAndForget(async()=>{try{let e=await rY(a);d.resolve(pY(e,b,c))}catch(a){d.reject(a)}}),d.promise}function r1(a,b){let c=new ea;return a.asyncQueue.enqueueAndForget(async()=>rb(await rX(a),b,c)),c.promise}function r2(a,b,c,d,e){let f=new rL({next:h=>{f.mute(),b.enqueueAndForget(()=>qQ(a,g));let i=h.docs.has(c);!i&&h.fromCache?e.reject(new d9(d7,"Failed to get document because the client is offline.")):i&&h.fromCache&&d&&"server"===d.source?e.reject(new d9(d7,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):e.resolve(h)},error:a=>e.reject(a)}),g=new qW(iO(c.path),f,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return qP(a,g)}function r3(a,b,c,d,e){let f=new rL({next:c=>{f.mute(),b.enqueueAndForget(()=>qQ(a,g)),c.fromCache&&"server"===d.source?e.reject(new d9(d7,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):e.resolve(c)},error:a=>e.reject(a)}),g=new qW(c,f,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return qP(a,g)}function r4(a,b){return a.timeoutSeconds===b.timeoutSeconds}function r5(a){let b={};return void 0!==a.timeoutSeconds&&(b.timeoutSeconds=a.timeoutSeconds),b}let r6="ComponentProvider",r7=new Map;function r8(a){let b=r7.get(a);b&&(dM(r6,"Removing Datastore"),r7.delete(a),b.terminate())}function r9(a,b,c,d){return new g1(a,b,c,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,r5(d.experimentalLongPollingOptions),d.useFetchStreams,d.isUsingEmulator)}let sa="firestore.googleapis.com",sb=!0,sc=5,sd=30,se=!0;class sf{constructor(a){if(void 0===a.host){if(void 0!==a.ssl)throw new d9(dX,"Can't provide ssl option if host option is not set");this.host=sa,this.ssl=sb}else this.host=a.host,this.ssl=a.ssl??sb;if(this.isUsingEmulator=void 0!==a.emulatorOptions,this.credentials=a.credentials,this.ignoreUndefinedProperties=!!a.ignoreUndefinedProperties,this.localCache=a.localCache,void 0===a.cacheSizeBytes)this.cacheSizeBytes=np;else if(a.cacheSizeBytes!==no&&a.cacheSizeBytes<ns)throw new d9(dX,`cacheSizeBytes must be at least ${ns}`);else this.cacheSizeBytes=a.cacheSizeBytes;ez("experimentalForceLongPolling",a.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",a.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!a.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===a.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=se:this.experimentalAutoDetectLongPolling=!!a.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=r5(a.experimentalLongPollingOptions??{}),sg(this.experimentalLongPollingOptions),this.useFetchStreams=!!a.useFetchStreams}isEqual(a){return this.host===a.host&&this.ssl===a.ssl&&this.credentials===a.credentials&&this.cacheSizeBytes===a.cacheSizeBytes&&this.experimentalForceLongPolling===a.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===a.experimentalAutoDetectLongPolling&&r4(this.experimentalLongPollingOptions,a.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===a.ignoreUndefinedProperties&&this.useFetchStreams===a.useFetchStreams}}function sg(a){if(void 0!==a.timeoutSeconds){if(isNaN(a.timeoutSeconds))throw new d9(dX,`invalid long polling timeout: ${a.timeoutSeconds} (must not be NaN)`);if(a.timeoutSeconds<sc)throw new d9(dX,`invalid long polling timeout: ${a.timeoutSeconds} (minimum allowed value is ${sc})`);if(a.timeoutSeconds>sd)throw new d9(dX,`invalid long polling timeout: ${a.timeoutSeconds} (maximum allowed value is ${sd})`)}}class sh{constructor(a,b,c,d){this._authCredentials=a,this._appCheckCredentials=b,this._databaseId=c,this._app=d,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new sf({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new d9(d2,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(a){if(this._settingsFrozen)throw new d9(d2,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new sf(a),this._emulatorOptions=a.emulatorOptions||{},void 0!==a.credentials&&(this._authCredentials=ei(a.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return r8(this),Promise.resolve()}}class si{constructor(a,b,c){this.converter=b,this._query=c,this.type="query",this.firestore=a}withConverter(a){return new si(this.firestore,a,this._query)}}class sj{constructor(a,b,c){this.converter=b,this._key=c,this.type="document",this.firestore=a}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new sk(this.firestore,this.converter,this._key.path.popLast())}withConverter(a){return new sj(this.firestore,a,this._key)}toJSON(){return{type:sj._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(a,b,c){if(eH(b,sj._jsonSchema))return new sj(a,c||null,new ex(eu.fromString(b.referencePath)))}}sj._jsonSchemaVersion="firestore/documentReference/1.0",sj._jsonSchema={type:eG("string",sj._jsonSchemaVersion),referencePath:eG("string")};class sk extends si{constructor(a,b,c){super(a,b,iO(c)),this._path=c,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let a=this._path.popLast();return a.isEmpty()?null:new sj(this.firestore,null,new ex(a))}withConverter(a){return new sk(this.firestore,a,this._path)}}function sl(a,b,...c){if(a=X(a),ey("collection","path",b),a instanceof sh){let d=eu.fromString(b,...c);return eB(d),new sk(a,null,d)}{if(!(a instanceof sj)&&!(a instanceof sk))throw new d9(dX,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let d=a._path.child(eu.fromString(b,...c));return eB(d),new sk(a.firestore,null,d)}}function sm(a,b,...c){if(a=X(a),1==arguments.length&&(b=ek.newId()),ey("doc","path",b),a instanceof sh){let d=eu.fromString(b,...c);return eA(d),new sj(a,null,new ex(d))}{if(!(a instanceof sj)&&!(a instanceof sk))throw new d9(dX,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let d=a._path.child(eu.fromString(b,...c));return eA(d),new sj(a.firestore,a instanceof sk?a.converter:null,new ex(d))}}let sn="AsyncQueue";class so{constructor(a=Promise.resolve()){this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new pO(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()},this.tail=a}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(a){this.enqueue(a)}enqueueAndForgetEvenWhileRestricted(a){this.verifyNotFailed(),this.enqueueInternal(a)}enterRestrictedMode(a){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=a||!1)}enqueue(a){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let b=new ea;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(a().then(b.resolve,b.reject),b.promise)).then(()=>b.promise)}enqueueRetryable(a){this.enqueueAndForget(()=>(this.retryableOps.push(a),this.retryNextOp()))}async retryNextOp(){if(0!==this.retryableOps.length){try{await this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(a){if(e8(a))dM(sn,"Operation failed with retryable error: "+a);else throw a}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}}enqueueInternal(a){let b=this.tail.then(()=>(this.operationInProgress=!0,a().catch(a=>{throw this.failure=a,this.operationInProgress=!1,dN("INTERNAL UNHANDLED ERROR: ",sp(a)),a}).then(a=>(this.operationInProgress=!1,a))));return this.tail=b,b}enqueueAfterDelay(a,b,c){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(a)>-1&&(b=0);let d=qG.createAndSchedule(this,a,b,c,a=>this.removeDelayedOperation(a));return this.delayedOperations.push(d),d}verifyNotFailed(){this.failure&&dQ(47125,{messageOrStack:sp(this.failure)})}verifyOperationInProgress(){}async drain(){let a;do a=this.tail,await a;while(a!==this.tail)}containsDelayedOperation(a){for(let b of this.delayedOperations)if(b.timerId===a)return!0;return!1}runAllDelayedOperationsUntil(a){return this.drain().then(()=>{for(let b of(this.delayedOperations.sort((a,b)=>a.targetTimeMs-b.targetTimeMs),this.delayedOperations))if(b.skipDelay(),"all"!==a&&b.timerId===a)break;return this.drain()})}skipDelaysForTimerId(a){this.timerIdsToSkip.push(a)}removeDelayedOperation(a){let b=this.delayedOperations.indexOf(a);this.delayedOperations.splice(b,1)}}function sp(a){let b=a.message||"";return a.stack&&(b=a.stack.includes(a.message)?a.stack:a.message+"\n"+a.stack),b}let sq=no;class sr extends sh{constructor(a,b,c,d){super(a,b,c,d),this.type="firestore",this._queue=new so,this._persistenceKey=d?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let a=this._firestoreClient.terminate();this._queue=new so(a),this._firestoreClient=void 0,await a}}}function ss(a,b,c){c||(c=g2);let d=aT(a,"firestore");if(d.isInitialized(c)){let a=d.getImmediate({identifier:c});if(O(d.getOptions(c),b))return a;throw new d9(d2,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(void 0!==b.cacheSizeBytes&&void 0!==b.localCache)throw new d9(dX,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(void 0!==b.cacheSizeBytes&&b.cacheSizeBytes!==sq&&b.cacheSizeBytes<ns)throw new d9(dX,`cacheSizeBytes must be at least ${ns}`);return b.host&&u(b.host)&&v(b.host),d.initialize({options:b,instanceIdentifier:c})}function st(a){if(a._terminated)throw new d9(d2,"The client has already been terminated.");return a._firestoreClient||su(a),a._firestoreClient}function su(a){let b=a._freezeSettings(),c=r9(a._databaseId,a._app?.options.appId||"",a._persistenceKey,b);!a._componentsProvider&&b.localCache?._offlineComponentProvider&&b.localCache?._onlineComponentProvider&&(a._componentsProvider={_offline:b.localCache._offlineComponentProvider,_online:b.localCache._onlineComponentProvider}),a._firestoreClient=new rR(a._authCredentials,a._appCheckCredentials,a._queue,c,a._componentsProvider&&sv(a._componentsProvider))}function sv(a){let b=a?._online.build();return{_offline:a?._offline.build(b),_online:b}}function sw(a,b=!0){dI(a1),aS(new Y("firestore",(a,{instanceIdentifier:c,options:d})=>{let e=a.getProvider("app").getImmediate(),f=new sr(new ed(a.getProvider("auth-internal")),new eh(e,a.getProvider("app-check-internal")),g4(e,c),e);return d={useFetchStreams:b,...d},f._setSettings(d),f},"PUBLIC").setMultipleInstances(!0)),a7(dE,dF,a),a7(dE,dF,"esm2020")}class sx{constructor(a,b,c){this.alias=a,this.aggregateType=b,this.fieldPath=c}}class sy{constructor(a="count",b){this._internalFieldPath=b,this.type="AggregateField",this.aggregateType=a}}class sz{constructor(a,b,c){this._userDataWriter=b,this._data=c,this.type="AggregateQuerySnapshot",this.query=a}data(){return this._userDataWriter.convertObjectMap(this._data)}}class sA{constructor(a){this._byteString=a}static fromBase64String(a){try{return new sA(gO.fromBase64String(a))}catch(a){throw new d9(dX,"Failed to construct data from Base64 string: "+a)}}static fromUint8Array(a){return new sA(gO.fromUint8Array(a))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(a){return this._byteString.isEqual(a._byteString)}toJSON(){return{type:sA._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(a){if(eH(a,sA._jsonSchema))return sA.fromBase64String(a.bytes)}}sA._jsonSchemaVersion="firestore/bytes/1.0",sA._jsonSchema={type:eG("string",sA._jsonSchemaVersion),bytes:eG("string")};class sB{constructor(...a){for(let b=0;b<a.length;++b)if(0===a[b].length)throw new d9(dX,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ew(a)}isEqual(a){return this._internalPath.isEqual(a._internalPath)}}class sC{constructor(a){this._methodName=a}}class sD{constructor(a,b){if(!isFinite(a)||a<-90||a>90)throw new d9(dX,"Latitude must be a number between -90 and 90, but was: "+a);if(!isFinite(b)||b<-180||b>180)throw new d9(dX,"Longitude must be a number between -180 and 180, but was: "+b);this._lat=a,this._long=b}get latitude(){return this._lat}get longitude(){return this._long}isEqual(a){return this._lat===a._lat&&this._long===a._long}_compareTo(a){return el(this._lat,a._lat)||el(this._long,a._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:sD._jsonSchemaVersion}}static fromJSON(a){if(eH(a,sD._jsonSchema))return new sD(a.latitude,a.longitude)}}sD._jsonSchemaVersion="firestore/geoPoint/1.0",sD._jsonSchema={type:eG("string",sD._jsonSchemaVersion),latitude:eG("number"),longitude:eG("number")};class sE{constructor(a){this._values=(a||[]).map(a=>a)}toArray(){return this._values.map(a=>a)}isEqual(a){return oB(this._values,a._values)}toJSON(){return{type:sE._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(a){if(eH(a,sE._jsonSchema)){if(Array.isArray(a.vectorValues)&&a.vectorValues.every(a=>"number"==typeof a))return new sE(a.vectorValues);throw new d9(dX,"Expected 'vectorValues' field to be a number array")}}}sE._jsonSchemaVersion="firestore/vectorValue/1.0",sE._jsonSchema={type:eG("string",sE._jsonSchemaVersion),vectorValues:eG("object")};let sF=/^__.*__$/;class sG{constructor(a,b,c){this.data=a,this.fieldMask=b,this.fieldTransforms=c}toMutation(a,b){return null!==this.fieldMask?new jW(a,this.data,this.fieldMask,b,this.fieldTransforms):new jT(a,this.data,b,this.fieldTransforms)}}class sH{constructor(a,b,c){this.data=a,this.fieldMask=b,this.fieldTransforms=c}toMutation(a,b){return new jW(a,this.data,this.fieldMask,b,this.fieldTransforms)}}function sI(a){switch(a){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw dQ(40011,{dataSource:a})}}class sJ{constructor(a,b,c,d,e,f){this.settings=a,this.databaseId=b,this.serializer=c,this.ignoreUndefinedProperties=d,void 0===e&&this.validatePath(),this.fieldTransforms=e||[],this.fieldMask=f||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(a){return new sJ({...this.settings,...a},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(a){let b=this.path?.child(a),c=this.contextWith({path:b,arrayElement:!1});return c.validatePathSegment(a),c}childContextForFieldPath(a){let b=this.path?.child(a),c=this.contextWith({path:b,arrayElement:!1});return c.validatePath(),c}childContextForArray(a){return this.contextWith({path:void 0,arrayElement:!0})}createError(a){return s0(a,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(a){return void 0!==this.fieldMask.find(b=>a.isPrefixOf(b))||void 0!==this.fieldTransforms.find(b=>a.isPrefixOf(b.field))}validatePath(){if(this.path)for(let a=0;a<this.path.length;a++)this.validatePathSegment(this.path.get(a))}validatePathSegment(a){if(0===a.length)throw this.createError("Document fields must not be empty");if(sI(this.dataSource)&&sF.test(a))throw this.createError('Document fields cannot begin and end with "__"')}}class sK{constructor(a,b,c){this.databaseId=a,this.ignoreUndefinedProperties=b,this.serializer=c||pJ(a)}createContext(a,b,c,d=!1){return new sJ({dataSource:a,methodName:b,targetDoc:c,path:ew.emptyPath(),arrayElement:!1,hasConverter:d},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function sL(a){let b=a._freezeSettings(),c=pJ(a._databaseId);return new sK(a._databaseId,!!b.ignoreUndefinedProperties,c)}function sM(a,b,c,d,e,f={}){let g,h,i=a.createContext(f.merge||f.mergeFields?2:0,b,c,e);sY("Data must be an object, but it was:",i,d);let j=sS(d,i);if(f.merge)g=new gL(i.fieldMask),h=i.fieldTransforms;else if(f.mergeFields){let a=[];for(let d of f.mergeFields){let e=sZ(b,d,c);if(!i.contains(e))throw new d9(dX,`Field '${e}' is specified in your field mask but missing from your input data.`);s1(a,e)||a.push(e)}g=new gL(a),h=i.fieldTransforms.filter(a=>g.covers(a.field))}else g=null,h=i.fieldTransforms;return new sG(new hX(j),g,h)}class sN extends sC{_toFieldTransform(a){if(2===a.dataSource)a.fieldMask.push(a.path);else if(1===a.dataSource)throw a.createError(`${this._methodName}() can only appear at the top level of your update data`);else throw a.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return null}isEqual(a){return a instanceof sN}}function sO(a,b,c,d){let e=a.createContext(1,b,c);sY("Data must be an object, but it was:",e,d);let f=[],g=hX.empty();return gA(d,(a,d)=>{let h=s_(b,a,c);d=X(d);let i=e.childContextForFieldPath(h);if(d instanceof sN)f.push(h);else{let a=sR(d,i);null!=a&&(f.push(h),g.set(h,a))}}),new sH(g,new gL(f),e.fieldTransforms)}function sP(a,b,c,d,e,f){let g=a.createContext(1,b,c),h=[sZ(b,d,c)],i=[e];if(f.length%2!=0)throw new d9(dX,`Function ${b}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let a=0;a<f.length;a+=2)h.push(sZ(b,f[a])),i.push(f[a+1]);let j=[],k=hX.empty();for(let a=h.length-1;a>=0;--a)if(!s1(j,h[a])){let b=h[a],c=i[a];c=X(c);let d=g.childContextForFieldPath(b);if(c instanceof sN)j.push(b);else{let a=sR(c,d);null!=a&&(j.push(b),k.set(b,a))}}return new sH(k,new gL(j),g.fieldTransforms)}function sQ(a,b,c,d=!1){return sR(c,a.createContext(d?4:3,b))}function sR(a,b){if(sX(a=X(a)))return sY("Unsupported field value:",b,a),sS(a,b);if(a instanceof sC)return sU(a,b),null;if(void 0===a&&b.ignoreUndefinedProperties)return null;if(b.path&&b.fieldMask.push(b.path),!(a instanceof Array))return sV(a,b);if(b.settings.arrayElement&&4!==b.dataSource)throw b.createError("Nested arrays are not supported");return sT(a,b)}function sS(a,b){let c={};return gC(a)?b.path&&b.path.length>0&&b.fieldMask.push(b.path):gA(a,(a,d)=>{let e=sR(d,b.childContextForField(a));null!=e&&(c[a]=e)}),{mapValue:{fields:c}}}function sT(a,b){let c=[],d=0;for(let e of a){let a=sR(e,b.childContextForArray(d));null==a&&(a={nullValue:"NULL_VALUE"}),c.push(a),d++}return{arrayValue:{values:c}}}function sU(a,b){if(!sI(b.dataSource))throw b.createError(`${a._methodName}() can only be used with update() and set()`);if(!b.path)throw b.createError(`${a._methodName}() is not currently supported inside arrays`);let c=a._toFieldTransform(b);c&&b.fieldTransforms.push(c)}function sV(a,b){if(null===(a=X(a)))return{nullValue:"NULL_VALUE"};if("number"==typeof a)return js(b.serializer,a);if("boolean"==typeof a)return{booleanValue:a};if("string"==typeof a)return{stringValue:a};if(a instanceof Date){let c=eK.fromDate(a);return{timestampValue:kC(b.serializer,c)}}else if(a instanceof eK){let c=new eK(a.seconds,1e3*Math.floor(a.nanoseconds/1e3));return{timestampValue:kC(b.serializer,c)}}else if(a instanceof sD)return{geoPointValue:{latitude:a.latitude,longitude:a.longitude}};else if(a instanceof sA)return{bytesValue:kE(b.serializer,a._byteString)};else if(a instanceof sj){let c=b.databaseId,d=a.firestore._databaseId;if(!d.isEqual(c))throw b.createError(`Document reference is for database ${d.projectId}/${d.database} but should be for database ${c.projectId}/${c.database}`);return{referenceValue:kI(a.firestore._databaseId||b.databaseId,a._key.path)}}else if(a instanceof sE)return sW(a,b);else throw b.createError(`Unsupported field value: ${eD(a)}`)}function sW(a,b){return{mapValue:{fields:{[g9]:{stringValue:hc},[hd]:{arrayValue:{values:a.toArray().map(a=>{if("number"!=typeof a)throw b.createError("VectorValues must only contain numeric values.");return jq(b.serializer,a)})}}}}}}function sX(a){return"object"==typeof a&&null!==a&&!(a instanceof Array)&&!(a instanceof Date)&&!(a instanceof eK)&&!(a instanceof sD)&&!(a instanceof sA)&&!(a instanceof sj)&&!(a instanceof sC)&&!(a instanceof sE)}function sY(a,b,c){if(!sX(c)||!eC(c)){let d=eD(c);if("an object"===d)throw b.createError(a+" a custom object");throw b.createError(a+" "+d)}}function sZ(a,b,c){if((b=X(b))instanceof sB)return b._internalPath;if("string"==typeof b)return s_(a,b);throw s0("Field path arguments must be of type string or ",a,!1,void 0,c)}let s$=RegExp("[~\\*/\\[\\]]");function s_(a,b,c){if(b.search(s$)>=0)throw s0(`Invalid field path (${b}). Paths must not contain '~', '*', '/', '[', or ']'`,a,!1,void 0,c);try{return new sB(...b.split("."))._internalPath}catch(d){throw s0(`Invalid field path (${b}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,a,!1,void 0,c)}}function s0(a,b,c,d,e){let f=d&&!d.isEmpty(),g=void 0!==e,h=`Function ${b}() called with invalid data`;c&&(h+=" (via `toFirestore()`)"),h+=". ";let i="";return(f||g)&&(i+=" (found",f&&(i+=` in field ${d}`),g&&(i+=` in document ${e}`),i+=")"),new d9(dX,h+a+i)}function s1(a,b){return a.some(a=>a.isEqual(b))}class s2{constructor(a,b,c,d,e){this._firestore=a,this._userDataWriter=b,this._key=c,this._document=d,this._converter=e}get id(){return this._key.path.lastSegment()}get ref(){return new sj(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(!this._converter)return this._userDataWriter.convertValue(this._document.data.value);{let a=new s3(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(a)}}}get(a){if(this._document){let b=this._document.data.field(s4("DocumentSnapshot.get",a));if(null!==b)return this._userDataWriter.convertValue(b)}}}class s3 extends s2{data(){return super.data()}}function s4(a,b){return"string"==typeof b?s_(a,b):b instanceof sB?b._internalPath:b._delegate._internalPath}function s5(a){if("L"===a.limitType&&0===a.explicitOrderBy.length)throw new d9(d5,"limitToLast() queries require specifying at least one orderBy() clause")}class s6{}class s7 extends s6{}function s8(a,b,...c){let d=[];for(let e of(b instanceof s6&&d.push(b),tm(d=d.concat(c)),d))a=e._apply(a);return a}class s9 extends s7{constructor(a,b,c){super(),this._field=a,this._op=b,this._value=c,this.type="where"}static _create(a,b,c){return new s9(a,b,c)}_apply(a){let b=this._parse(a);return tj(a._query,b),new si(a.firestore,a.converter,iY(a._query,b))}_parse(a){let b=sL(a.firestore);return te(a._query,"where",b,a.firestore._databaseId,this._field,this._op,this._value)}}function ta(a,b,c){let d=b,e=s4("where",a);return s9._create(e,d,c)}class tb extends s6{constructor(a,b){super(),this.type=a,this._queryConstraints=b}static _create(a,b){return new tb(a,b)}_parse(a){let b=this._queryConstraints.map(b=>b._parse(a)).filter(a=>a.getFilters().length>0);return 1===b.length?b[0]:ia.create(b,this._getOperator())}_apply(a){let b=this._parse(a);return 0===b.getFilters().length?a:(tk(a._query,b),new si(a.firestore,a.converter,iY(a._query,b)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class tc extends s7{constructor(a,b){super(),this._field=a,this._direction=b,this.type="orderBy"}static _create(a,b){return new tc(a,b)}_apply(a){let b=tf(a._query,this._field,this._direction);return new si(a.firestore,a.converter,iZ(a._query,b))}}function td(a,b="asc"){let c=b,d=s4("orderBy",a);return tc._create(d,c)}function te(a,b,c,d,e,f,g){let h;if(e.isKeyField())if("array-contains"===f||"array-contains-any"===f)throw new d9(dX,`Invalid Query. You can't perform '${f}' queries on documentId().`);else if("in"===f||"not-in"===f){th(g,f);let b=[];for(let c of g)b.push(tg(d,a,c));h={arrayValue:{values:b}}}else h=tg(d,a,g);else("in"===f||"not-in"===f||"array-contains-any"===f)&&th(g,f),h=sQ(c,b,g,"in"===f||"not-in"===f);return h9.create(e,f,h)}function tf(a,b,c){if(null!==a.startAt)throw new d9(dX,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==a.endAt)throw new d9(dX,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new h4(b,c)}function tg(a,b,c){if("string"==typeof(c=X(c))){if(""===c)throw new d9(dX,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!iT(b)&&-1!==c.indexOf("/"))throw new d9(dX,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${c}' contains a '/' character.`);let d=b.path.child(eu.fromString(c));if(!ex.isDocumentKey(d))throw new d9(dX,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${d}' is not because it has an odd number of segments (${d.length}).`);return hH(a,new ex(d))}if(c instanceof sj)return hH(a,c._key);throw new d9(dX,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${eD(c)}.`)}function th(a,b){if(!Array.isArray(a)||0===a.length)throw new d9(dX,`Invalid Query. A non-empty array is required for '${b.toString()}' filters.`)}function ti(a){switch(a){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}function tj(a,b){let c=tl(a.filters,ti(b.op));if(null!==c)if(c===b.op)throw new d9(dX,`Invalid query. You cannot use more than one '${b.op.toString()}' filter.`);else throw new d9(dX,`Invalid query. You cannot use '${b.op.toString()}' filters with '${c.toString()}' filters.`)}function tk(a,b){let c=a;for(let a of b.getFlattenedFilters())tj(c,a),c=iY(c,a)}function tl(a,b){for(let c of a)for(let a of c.getFlattenedFilters())if(b.indexOf(a.op)>=0)return a.op;return null}function tm(a){let b=a.filter(a=>a instanceof tb).length,c=a.filter(a=>a instanceof s9).length;if(b>1||b>0&&c>0)throw new d9(dX,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}class tn{convertValue(a,b="none"){switch(hf(a)){case 0:return null;case 1:return a.booleanValue;case 2:return gT(a.integerValue||a.doubleValue);case 3:return this.convertTimestamp(a.timestampValue);case 4:return this.convertServerTimestamp(a,b);case 5:return a.stringValue;case 6:return this.convertBytes(gU(a.bytesValue));case 7:return this.convertReference(a.referenceValue);case 8:return this.convertGeoPoint(a.geoPointValue);case 9:return this.convertArray(a.arrayValue,b);case 11:return this.convertObject(a.mapValue,b);case 10:return this.convertVectorValue(a.mapValue);default:throw dQ(62114,{value:a})}}convertObject(a,b){return this.convertObjectMap(a.fields,b)}convertObjectMap(a,b="none"){let c={};return gA(a,(a,d)=>{c[a]=this.convertValue(d,b)}),c}convertVectorValue(a){return new sE(a.fields?.[hd].arrayValue?.values?.map(a=>gT(a.doubleValue)))}convertGeoPoint(a){return new sD(gT(a.latitude),gT(a.longitude))}convertArray(a,b){return(a.values||[]).map(a=>this.convertValue(a,b))}convertServerTimestamp(a,b){switch(b){case"previous":let c=g_(a);if(null==c)return null;return this.convertValue(c,b);case"estimate":return this.convertTimestamp(g0(a));default:return null}}convertTimestamp(a){let b=gS(a);return new eK(b.seconds,b.nanos)}convertDocumentKey(a,b){let c=eu.fromString(a);dS(lE(c),9688,{name:a});let d=new g3(c.get(1),c.get(3)),e=new ex(c.popFirst(5));return d.isEqual(b)||dN(`Document ${e} contains a document reference within a different database (${d.projectId}/${d.database}) which is not supported. It will be treated as a reference in the current database (${b.projectId}/${b.database}) instead.`),e}}function to(a,b,c){return a?c&&(c.merge||c.mergeFields)?a.toFirestore(b,c):a.toFirestore(b):b}function tp(){return new sy("count")}let tq=kd();function tr(a){let b=JSON.stringify(a),c=tq.encode(b).byteLength;return`${c}${b}`}tr({metadata:{id:"test-bundle",createTime:{seconds:0x5e0be105,nanos:6},version:1,totalDocuments:1,totalBytes:416}}),tr({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/doc1",readTime:{seconds:5,nanos:6},exists:!0}}),tr({document:{name:"projects/test-project/databases/(default)/documents/collectionId/doc1",createTime:{seconds:1,nanos:2e6},updateTime:{seconds:3,nanos:4e3},fields:{foo:{stringValue:"value"},bar:{integerValue:-42}}}}),tr({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/doc2",readTime:{seconds:5,nanos:6},exists:!0}}),tr({document:{name:"projects/test-project/databases/(default)/documents/collectionId/doc2",createTime:{seconds:1,nanos:2e6},updateTime:{seconds:3,nanos:4e3},fields:{foo:{stringValue:"value1"},bar:{integerValue:42},emptyArray:{arrayValue:{}},emptyMap:{mapValue:{}}}}}),tr({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/nodoc",readTime:{seconds:5,nanos:6},exists:!1}}),tr({namedQuery:{name:"limitQuery",bundledQuery:{parent:"projects/fireeats-97d5e/databases/(default)/documents",structuredQuery:{from:[{collectionId:"node_3.7.5_7Li7XoCjutvNxwD0tpo9"}],orderBy:[{field:{fieldPath:"sort"},direction:"DESCENDING"}],limit:{value:1}},limitType:"FIRST"},readTime:{seconds:0x5ec5a5f3,nanos:191164e3}}}),tr({namedQuery:{name:"limitToLastQuery",bundledQuery:{parent:"projects/fireeats-97d5e/databases/(default)/documents",structuredQuery:{from:[{collectionId:"node_3.7.5_7Li7XoCjutvNxwD0tpo9"}],orderBy:[{field:{fieldPath:"sort"},direction:"ASCENDING"}],limit:{value:1}},limitType:"LAST"},readTime:{seconds:0x5ec5a5f3,nanos:543063e3}}});let ts=1;class tt{constructor(a,b){this.firestore=a,this.bundleId=b,this.documents=new Map,this.namedQueries=new Map,this.latestReadTime=new eK(0,0),this.databaseId=a._databaseId,this.serializer=new ky(this.databaseId,!0),this.userDataReader=new sK(this.databaseId,!0,this.serializer)}addBundleDocument(a,b){let c=this.documents.get(a.documentPath),d=c?.metadata.queries,e=a.readTime,f=c?.metadata.readTime?kD(c.metadata.readTime):null,g=!e&&null==f,h=void 0!==e&&(null==f||f<e);if((g||h)&&this.documents.set(a.documentPath,{document:this.toBundleDocument(a),metadata:{name:kL(this.serializer,a.documentKey),readTime:e?kC(this.serializer,e):void 0,exists:a.documentExists}}),e&&e>this.latestReadTime&&(this.latestReadTime=e),b){let c=this.documents.get(a.documentPath);c.metadata.queries=d||[],c.metadata.queries.push(b)}}addBundleQuery(a){if(this.namedQueries.has(a.name))throw Error(`Query name conflict: ${name} has already been added.`);let b=new eK(0,0);for(let c of a.docBundleDataArray)this.addBundleDocument(c,a.name),c.readTime&&c.readTime>b&&(b=c.readTime);let c=k6(this.serializer,iV(a.query)),d={parent:a.parent,structuredQuery:c.queryTarget.structuredQuery};this.namedQueries.set(a.name,{name:a.name,bundledQuery:d,readTime:kC(this.serializer,b)})}toBundleDocument(a){let b=this.userDataReader.createContext(4,"internal toBundledDocument"),c=sS(a.documentData,b);return{name:kL(this.serializer,a.documentKey),fields:c.mapValue.fields,updateTime:kC(this.serializer,a.versionTime),createTime:kC(this.serializer,a.createdTime)}}lengthPrefixedString(a){let b=JSON.stringify(a),c=tq.encode(b).byteLength;return`${c}${b}`}build(){let a="";for(let b of this.namedQueries.values())a+=this.lengthPrefixedString({namedQuery:b});for(let b of this.documents.values()){let c=b.metadata;a+=this.lengthPrefixedString({documentMetadata:c});let d=b.document;d&&(a+=this.lengthPrefixedString({document:d}))}let b={id:this.bundleId,createTime:kC(this.serializer,this.latestReadTime),version:ts,totalDocuments:this.documents.size,totalBytes:tq.encode(a).length};return this.lengthPrefixedString({metadata:b})+a}}function tu(a,b,c,d){let e=new tt(a,ek.newId());return e.addBundleDocument(tw(d,c,b)),e.build()}function tv(a,b,c,d,e,f,g){let h=[];for(let a=0;a<f.length;a++)h.push(tw(e[a],g[a],f[a]));let i={name:c,query:b,parent:d,docBundleDataArray:h},j=new tt(a,c);return j.addBundleQuery(i),j.build()}function tw(a,b,c){return{documentData:b,documentKey:c.mutableCopy().key,documentPath:a,documentExists:!0,createdTime:c.createTime.toTimestamp(),readTime:c.readTime.toTimestamp(),versionTime:c.version.toTimestamp()}}class tx{constructor(a,b){this.hasPendingWrites=a,this.fromCache=b}isEqual(a){return this.hasPendingWrites===a.hasPendingWrites&&this.fromCache===a.fromCache}}class ty extends s2{constructor(a,b,c,d,e,f){super(a,b,c,d,f),this._firestore=a,this._firestoreImpl=a,this.metadata=e}exists(){return super.exists()}data(a={}){if(this._document){if(!this._converter)return this._userDataWriter.convertValue(this._document.data.value,a.serverTimestamps);{let b=new tz(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(b,a)}}}get(a,b={}){if(this._document){let c=this._document.data.field(s4("DocumentSnapshot.get",a));if(null!==c)return this._userDataWriter.convertValue(c,b.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new d9(d2,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let a=this._document,b={};if(b.type=ty._jsonSchemaVersion,b.bundle="",b.bundleSource="DocumentSnapshot",b.bundleName=this._key.toString(),!a||!a.isValidDocument()||!a.isFoundDocument())return b;let c=this._userDataWriter.convertObjectMap(a.data.value.mapValue.fields,"previous");return b.bundle=tu(this._firestore,a,c,this.ref.path),b}}ty._jsonSchemaVersion="firestore/documentSnapshot/1.0",ty._jsonSchema={type:eG("string",ty._jsonSchemaVersion),bundleSource:eG("string","DocumentSnapshot"),bundleName:eG("string"),bundle:eG("string")};class tz extends ty{data(a={}){return super.data(a)}}class tA{constructor(a,b,c,d){this._firestore=a,this._userDataWriter=b,this._snapshot=d,this.metadata=new tx(d.hasPendingWrites,d.fromCache),this.query=c}get docs(){let a=[];return this.forEach(b=>a.push(b)),a}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(a,b){this._snapshot.docs.forEach(c=>{a.call(b,new tz(this._firestore,this._userDataWriter,c.key,c,new tx(this._snapshot.mutatedKeys.has(c.key),this._snapshot.fromCache),this.query.converter))})}docChanges(a={}){let b=!!a.includeMetadataChanges;if(b&&this._snapshot.excludesMetadataChanges)throw new d9(dX,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===b||(this._cachedChanges=tB(this,b),this._cachedChangesIncludeMetadataChanges=b),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new d9(d2,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let a={};a.type=tA._jsonSchemaVersion,a.bundleSource="QuerySnapshot",a.bundleName=ek.newId();let b=this._firestore._databaseId.database,c=this._firestore._databaseId.projectId,d=`projects/${c}/databases/${b}/documents`,e=[],f=[],g=[];return this.docs.forEach(a=>{null!==a._document&&(e.push(a._document),f.push(this._userDataWriter.convertObjectMap(a._document.data.value.mapValue.fields,"previous")),g.push(a.ref.path))}),a.bundle=tv(this._firestore,this.query._query,a.bundleName,d,g,e,f),a}}function tB(a,b){if(a._snapshot.oldDocs.isEmpty()){let b=0;return a._snapshot.docChanges.map(c=>{let d=new tz(a._firestore,a._userDataWriter,c.doc.key,c.doc,new tx(a._snapshot.mutatedKeys.has(c.doc.key),a._snapshot.fromCache),a.query.converter);return c.doc,{type:"added",doc:d,oldIndex:-1,newIndex:b++}})}{let c=a._snapshot.oldDocs;return a._snapshot.docChanges.filter(a=>b||3!==a.type).map(b=>{let d=new tz(a._firestore,a._userDataWriter,b.doc.key,b.doc,new tx(a._snapshot.mutatedKeys.has(b.doc.key),a._snapshot.fromCache),a.query.converter),e=-1,f=-1;return 0!==b.type&&(e=c.indexOf(b.doc.key),c=c.delete(b.doc.key)),1!==b.type&&(f=(c=c.add(b.doc)).indexOf(b.doc.key)),{type:tC(b.type),doc:d,oldIndex:e,newIndex:f}})}}function tC(a){switch(a){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return dQ(61501,{type:a})}}function tD(a){a=eF(a,sj);let b=eF(a.firestore,sr);return r$(st(b),a._key).then(c=>tK(b,a,c))}tA._jsonSchemaVersion="firestore/querySnapshot/1.0",tA._jsonSchema={type:eG("string",tA._jsonSchemaVersion),bundleSource:eG("string","QuerySnapshot"),bundleName:eG("string"),bundle:eG("string")};class tE extends tn{constructor(a){super(),this.firestore=a}convertBytes(a){return new sA(a)}convertReference(a){let b=this.convertDocumentKey(a,this.firestore._databaseId);return new sj(this.firestore,null,b)}}function tF(a){a=eF(a,si);let b=eF(a.firestore,sr),c=st(b),d=new tE(b);return s5(a._query),r_(c,a._query).then(c=>new tA(b,d,a,c))}function tG(a,b,c){a=eF(a,sj);let d=eF(a.firestore,sr),e=to(a.converter,b,c),f=sM(sL(d),"setDoc",a._key,e,null!==a.converter,c).toMutation(a._key,jL.none());return tJ(d,[f])}function tH(a,b,c,...d){let e;a=eF(a,sj);let f=eF(a.firestore,sr),g=sL(f);return tJ(f,[(e="string"==typeof(b=X(b))||b instanceof sB?sP(g,"updateDoc",a._key,b,c,d):sO(g,"updateDoc",a._key,b)).toMutation(a._key,jL.exists(!0))])}function tI(a){return tJ(eF(a.firestore,sr),[new j0(a._key,jL.none())])}function tJ(a,b){return r1(st(a),b)}function tK(a,b,c){let d=c.docs.get(b._key),e=new tE(a);return new ty(a,e,b._key,d,new tx(c.hasPendingWrites,c.fromCache),b.converter)}function tL(a){return tM(a,{count:tp()})}function tM(a,b){let c=eF(a.firestore,sr),d=st(c),e=gB(b,(a,b)=>new sx(b,a.aggregateType,a._internalFieldPath));return r0(d,a._query,e).then(b=>tN(c,a,b))}function tN(a,b,c){return new sz(b,new tE(a),c)}class tO{constructor(a){let b;this.kind="persistent",a?.tabManager?(a.tabManager._initialize(a),b=a.tabManager):(b=tS(void 0))._initialize(a),this._onlineComponentProvider=b._onlineComponentProvider,this._offlineComponentProvider=b._offlineComponentProvider}toJSON(){return{kind:this.kind}}}function tP(a){return new tO(a)}class tQ{constructor(a){this.forceOwnership=a,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(a){this._onlineComponentProvider=rK.provider,this._offlineComponentProvider={build:b=>new rI(b,a?.cacheSizeBytes,this.forceOwnership)}}}class tR{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(a){this._onlineComponentProvider=rK.provider,this._offlineComponentProvider={build:b=>new rJ(b,a?.cacheSizeBytes)}}}function tS(a){return new tQ(a?.forceOwnership)}function tT(){return new tR}class tU{constructor(a,b){this._firestore=a,this._commitHandler=b,this._mutations=[],this._committed=!1,this._dataReader=sL(a)}set(a,b,c){this._verifyNotCommitted();let d=tV(a,this._firestore),e=to(d.converter,b,c),f=sM(this._dataReader,"WriteBatch.set",d._key,e,null!==d.converter,c);return this._mutations.push(f.toMutation(d._key,jL.none())),this}update(a,b,c,...d){let e;this._verifyNotCommitted();let f=tV(a,this._firestore);return e="string"==typeof(b=X(b))||b instanceof sB?sP(this._dataReader,"WriteBatch.update",f._key,b,c,d):sO(this._dataReader,"WriteBatch.update",f._key,b),this._mutations.push(e.toMutation(f._key,jL.exists(!0))),this}delete(a){this._verifyNotCommitted();let b=tV(a,this._firestore);return this._mutations=this._mutations.concat(new j0(b._key,jL.none())),this}commit(){return(this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0)?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new d9(d2,"A write batch can no longer be used after commit() has been called.")}}function tV(a,b){if((a=X(a)).firestore===b)return a;throw new d9(dX,"Provided document reference is from a different Firestore instance.")}function tW(a){return st(a=eF(a,sr)),new tU(a,b=>tJ(a,b))}new WeakMap,sw("node"),a.s(["collection",()=>sl,"deleteDoc",()=>tI,"doc",()=>sm,"getCountFromServer",()=>tL,"getDoc",()=>tD,"getDocs",()=>tF,"initializeFirestore",()=>ss,"orderBy",()=>td,"persistentLocalCache",()=>tP,"persistentMultipleTabManager",()=>tT,"query",()=>s8,"setDoc",()=>tG,"updateDoc",()=>tH,"where",()=>ta,"writeBatch",()=>tW],55475),a.s([],958);let tX=a2({apiKey:"AIzaSyDeVgouHIFSSZxFnp9LfQ9pxpUod5xkSGU",authDomain:"mini-apps-aac5c.firebaseapp.com",projectId:"mini-apps-aac5c",storageBucket:"mini-apps-aac5c.firebasestorage.app",messagingSenderId:"748775519968",appId:"1:748775519968:web:97e7efd57c1447dbe7c285"}),tY=dp(tX),tZ=ss(tX,{localCache:tP({tabManager:tT()})});a.s(["auth",0,tY,"db",0,tZ],76983)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__462c5d0c._.js.map