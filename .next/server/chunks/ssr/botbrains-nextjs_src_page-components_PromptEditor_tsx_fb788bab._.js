module.exports=[66553,a=>{"use strict";var b=a.i(38121),c=a.i(96821),d=a.i(79646),e=a.i(30502);let f=(0,a.i(24076).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);var g=a.i(74010),h=a.i(6788),i=a.i(70709),j=a.i(54202),k=a.i(98177),l=a.i(92873),m=a.i(9340),n=a.i(68650),o=a.i(87296);function p({label:a,value:d,onChange:e,placeholder:f="Add...",suggestions:g=[],error:h}){let[i,j]=(0,c.useState)(""),[k,l]=(0,c.useState)(!1),p=(0,c.useRef)(null),q=g.filter(a=>!d.includes(a)&&a.toLowerCase().includes(i.toLowerCase())).slice(0,7),r=a=>{let b=a.trim();b&&!d.includes(b)&&e([...d,b]),j(""),l(!1)},s=a=>{e(d.filter((b,c)=>c!==a))};return(0,b.jsxs)("div",{className:"w-full",children:[a&&(0,b.jsx)("label",{className:"block text-sm font-medium text-foreground mb-1.5",children:a}),(0,b.jsxs)("div",{className:`
                    min-h-[42px] px-3 py-1.5
                    bg-transparent
                    rounded-md
                    border transition-colors
                    flex flex-wrap gap-2 items-center
                    ${h?"border-destructive focus-within:ring-1 focus-within:ring-destructive":"border-input focus-within:border-primary focus-within:ring-1 focus-within:ring-primary"}
                `,onClick:()=>p.current?.focus(),children:[(0,b.jsx)(o.AnimatePresence,{mode:"popLayout",children:d.map((a,c)=>(0,b.jsxs)(n.motion.span,{layout:!0,initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},transition:{duration:.15},className:"inline-flex items-center gap-1.5 px-2 py-0.5 bg-secondary rounded text-xs font-medium text-secondary-foreground",children:[(0,b.jsx)("span",{children:a}),(0,b.jsx)("button",{type:"button",onClick:a=>{a.stopPropagation(),s(c)},className:"hover:text-destructive transition-colors focus:outline-none",children:(0,b.jsx)(m.X,{className:"w-3 h-3"})})]},`${a}-${c}`))}),(0,b.jsx)("input",{ref:p,type:"text",value:i,onChange:a=>{j(a.target.value),l(a.target.value.length>0)},onKeyDown:a=>{"Enter"===a.key||","===a.key?(a.preventDefault(),r(i)):"Backspace"===a.key&&!i&&d.length>0&&s(d.length-1)},onBlur:()=>{setTimeout(()=>l(!1),200)},onFocus:()=>i&&l(!0),placeholder:0===d.length?f:"",className:"flex-1 min-w-[120px] bg-transparent border-none outline-none placeholder:text-muted-foreground text-sm text-foreground h-7 p-0"})]}),k&&q.length>0&&(0,b.jsx)("div",{className:"relative",children:(0,b.jsx)("div",{className:"absolute z-10 w-full mt-1 bg-popover rounded-md border border-border shadow-md max-h-48 overflow-y-auto",children:q.map((a,c)=>(0,b.jsx)("button",{type:"button",onClick:()=>r(a),className:"w-full px-3 py-2 text-left text-sm text-popover-foreground hover:bg-muted transition-colors",children:a},c))})}),h&&(0,b.jsx)("p",{className:"mt-1.5 text-xs text-destructive",children:h})]})}var q=a.i(7600),r=a.i(60756),s=a.i(89166),t=a.i(56965);function u({currentPromptId:a,selectedParentId:d,workspaceId:e,onSelect:f}){let[g,i]=(0,c.useState)(!1),[j,k]=(0,c.useState)(""),[l,p]=(0,c.useState)([]),[u,w]=(0,c.useState)(null),[x,y]=(0,c.useState)(!1),[z,A]=(0,c.useState)(null);(0,c.useEffect)(()=>{d?(0,h.getPrompt)(d).then(a=>{a&&w(a)}):w(null)},[d]),(0,c.useEffect)(()=>{g&&B()},[g]);let B=async()=>{y(!0);try{let b=await t.CompositionService.getEligibleParents(a,e);p(b)}catch(a){console.error("Failed to load parent candidates",a)}finally{y(!1)}},C=async b=>{(A(null),a&&await t.CompositionService.detectCircularReference(a,b.id))?A("Cannot select this parent: would create a circular reference"):await t.CompositionService.getPromptDepth(b.id)>=10?A("Cannot select this parent: depth limit exceeded (max 10)"):(f(b.id),w(b),i(!1))},D=l.filter(a=>a.title.toLowerCase().includes(j.toLowerCase())||a.tags.some(a=>a.toLowerCase().includes(j.toLowerCase())));return(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsxs)("label",{className:"text-sm font-medium text-foreground",children:["Parent Prompt ",(0,b.jsx)("span",{className:"text-muted-foreground font-normal text-xs",children:"(Optional)"})]}),u&&(0,b.jsx)("span",{className:"text-[10px] bg-primary/10 text-primary px-1.5 py-0.5 rounded border border-primary/20",children:"Inherits content"})]}),(0,b.jsxs)("div",{onClick:()=>i(!g),className:`
                    w-full min-h-[40px] px-3 py-2 rounded-md border flex items-center justify-between cursor-pointer transition-colors
                    ${g?"border-primary ring-1 ring-primary bg-background":"bg-background border-input hover:border-primary/50"}
                `,children:[u?(0,b.jsxs)("div",{className:"flex items-center gap-2 overflow-hidden",children:[(0,b.jsx)("span",{className:`w-2 h-2 rounded-full bg-${v(u.type)} shrink-0`}),(0,b.jsx)("span",{className:"text-sm text-foreground truncate",children:u.title})]}):(0,b.jsx)("span",{className:"text-sm text-muted-foreground",children:"Search to select a parent prompt..."}),(0,b.jsxs)("div",{className:"flex items-center gap-1 ml-2",children:[u&&(0,b.jsx)("button",{onClick:a=>{a.stopPropagation(),f(null),w(null)},className:"p-1 hover:bg-muted rounded-full text-muted-foreground hover:text-foreground transition-colors",children:(0,b.jsx)(m.X,{size:14})}),(0,b.jsx)("span",{className:"text-muted-foreground/50 text-[10px]",children:"â–¼"})]})]}),(0,b.jsx)(o.AnimatePresence,{children:g&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"fixed inset-0 z-40 bg-transparent",onClick:()=>i(!1)}),(0,b.jsxs)(n.motion.div,{initial:{opacity:0,y:4,scale:.98},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:4,scale:.98},transition:{duration:.1},className:"absolute z-50 top-full left-0 right-0 mt-1 bg-popover border border-border rounded-md shadow-lg overflow-hidden flex flex-col max-h-[300px]",children:[(0,b.jsx)("div",{className:"p-2 border-b border-border sticky top-0 bg-popover z-10",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(q.Search,{size:14,className:"absolute left-2.5 top-1/2 -translate-y-1/2 text-muted-foreground"}),(0,b.jsx)("input",{type:"text",autoFocus:!0,value:j,onChange:a=>k(a.target.value),placeholder:"Type to search...",className:"w-full bg-muted/50 border-none rounded-sm pl-8 pr-3 py-1.5 text-sm text-foreground focus:ring-1 focus:ring-primary outline-none h-8"})]})}),z&&(0,b.jsxs)("div",{className:"mx-2 mt-2 p-2 bg-destructive/10 border border-destructive/20 rounded text-xs text-destructive flex items-center gap-2",children:[(0,b.jsx)(s.AlertCircle,{size:12}),z]}),(0,b.jsx)("div",{className:"overflow-y-auto flex-1 p-1 custom-scrollbar",children:x?(0,b.jsx)("div",{className:"p-4 text-center text-xs text-muted-foreground animate-pulse",children:"Loading..."}):0===D.length?(0,b.jsxs)("div",{className:"p-8 text-center",children:[(0,b.jsx)("p",{className:"text-sm text-foreground font-medium",children:"No prompts found"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:j?`No results for "${j}"`:"This workspace has no other prompts yet."})]}):D.map(a=>(0,b.jsxs)("button",{onClick:()=>C(a),className:`
                                                w-full text-left px-3 py-2 rounded-sm flex items-center justify-between group transition-colors
                                                ${a.id===d?"bg-primary/10":"hover:bg-muted"}
                                            `,children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("div",{className:"text-sm text-foreground font-medium truncate",children:a.title}),(0,b.jsxs)("div",{className:"text-[10px] text-muted-foreground flex items-center gap-2 mt-0.5",children:[(0,b.jsx)("span",{className:`w-1.5 h-1.5 rounded-full bg-${v(a.type)}`}),a.type]})]}),a.id===d&&(0,b.jsx)(r.Check,{size:14,className:"text-primary ml-2 shrink-0"})]},a.id))})]})]})})]})}function v(a){switch(a){case"LLM":return"cyan-400";case"Image":return"violet-400";case"Video":return"amber-400";case"Automation":return"green-400";default:return"gray-400"}}var w=a.i(82386),x=a.i(58972);let y=[{value:"LLM",label:"LLM"},{value:"Image",label:"Image"},{value:"Video",label:"Video"},{value:"Automation",label:"Automation"},{value:"Other",label:"Other"}];function z(){let{id:a}=(0,d.useParams)(),m=(0,d.useRouter)(),n=(0,x.useToast)(),o=(0,g.usePromptStore)(a=>a.createPrompt),q=(0,g.usePromptStore)(a=>a.updatePrompt),r=(0,g.usePromptStore)(a=>a.currentWorkspaceId),s=!a||"new"===a,[t,v]=(0,c.useState)({title:"",type:"LLM",prompt_template:"",variables:[],category:"",tags:[],keywords:[],color_tag:"#00C2FF",version:1,performance:{rating:0,notes:""},examples:[]}),[z,A]=(0,c.useState)(!1);(0,c.useEffect)(()=>{let b=sessionStorage.getItem("promptInitialData");if(b)try{let a=JSON.parse(b);v({...t,...a}),sessionStorage.removeItem("promptInitialData")}catch(a){console.error("Failed to parse initial data:",a)}else!s&&a&&(0,h.getPrompt)(a).then(a=>{a&&v({...a,keywords:a.keywords||[]})})},[a,s]),(0,c.useEffect)(()=>{if(t.prompt_template){let a=(0,w.extractVariables)(t.prompt_template),b=t.variables||[],c=a.map(a=>b.find(b=>b.name===a)||{name:a,type:"text"});v(a=>({...a,variables:c}))}},[t.prompt_template]);let B=async()=>{if(console.log("ðŸ’¾ handleSave called"),!t.title?.trim())return void n.error("Title is required");if(!t.prompt_template?.trim())return void n.error("Prompt template is required");A(!0);try{let b={title:t.title,type:t.type||"LLM",prompt_template:t.prompt_template,variables:t.variables||[],category:t.category||"",tags:t.tags||[],keywords:t.keywords||[],color_tag:t.color_tag||"#00C2FF",version:t.version||1,performance:t.performance||{rating:0,notes:""},examples:t.examples||[],parentId:t.parentId||null,compositionMode:t.compositionMode||"inherit"};s?(await o(b),n.success("Prompt created")):a&&(await q(a,b),n.success("Prompt updated")),m.push("/")}catch(a){console.error("âŒ Save failed with error:",a),n.error("Failed to save")}finally{A(!1)}},C=(a,b)=>{let c=[...t.variables||[]];c[a]={...c[a],...b},v(a=>({...a,variables:c}))};return(0,b.jsxs)("div",{className:"max-w-4xl mx-auto space-y-6 px-8 py-6",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)(i.Button,{variant:"ghost",onClick:()=>m.back(),className:"px-2",children:(0,b.jsx)(f,{className:"w-5 h-5"})}),(0,b.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:s?"New Prompt":"Edit Prompt"})]}),(0,b.jsxs)("div",{className:"bg-card border border-border rounded-lg p-6 space-y-6 shadow-sm",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,b.jsx)("div",{className:"md:col-span-2",children:(0,b.jsx)(j.Input,{label:"Title *",value:t.title,onChange:a=>v({...t,title:a.target.value}),placeholder:"e.g., Blog Post Generator"})}),(0,b.jsx)(l.Select,{label:"Type *",value:t.type,onChange:a=>v({...t,type:a.target.value}),options:y})]}),r&&(0,b.jsx)("div",{className:"border-t border-border pt-6",children:(0,b.jsx)(u,{currentPromptId:"new"===a?null:a||null,selectedParentId:t.parentId||null,workspaceId:r,onSelect:a=>v(b=>({...b,parentId:a}))})}),(0,b.jsx)(k.Textarea,{label:"Prompt Template *",value:t.prompt_template,onChange:a=>v({...t,prompt_template:a.target.value}),placeholder:"Write your prompt here. Use {{variableName}} for dynamic content.",rows:10,mono:!0}),t.variables&&t.variables.length>0&&(0,b.jsxs)("div",{className:"border-t border-border pt-6",children:[(0,b.jsxs)("h3",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide mb-4",children:["Detected Variables (",t.variables.length,")"]}),(0,b.jsx)("div",{className:"space-y-4",children:t.variables.map((a,c)=>(0,b.jsxs)("div",{className:"bg-secondary/30 p-4 rounded-md border border-border space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsx)(j.Input,{label:"Variable Name",value:a.name,disabled:!0,className:"opacity-70"}),(0,b.jsx)(l.Select,{label:"Input Type",value:a.type,onChange:a=>C(c,{type:a.target.value}),options:[{value:"text",label:"Text"},{value:"textarea",label:"Textarea"},{value:"select",label:"Select"}]})]}),(0,b.jsx)(j.Input,{label:"Default Value",value:a.default||"",onChange:a=>C(c,{default:a.target.value}),placeholder:"Optional default value"})]},a.name))})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-6 pt-2",children:[(0,b.jsx)(j.Input,{label:"Category",value:t.category,onChange:a=>v({...t,category:a.target.value}),placeholder:"e.g., Content, Design"}),(0,b.jsx)(p,{label:"Tags",value:t.tags||[],onChange:a=>v({...t,tags:a}),placeholder:"Type a tag..."}),(0,b.jsx)(p,{label:"Keywords",value:t.keywords||[],onChange:a=>v({...t,keywords:a}),placeholder:"Type a keyword..."})]}),(0,b.jsxs)("div",{className:"border-t border-border pt-6 grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,b.jsx)("div",{children:(0,b.jsx)(j.Input,{label:"Version",type:"number",value:t.version,onChange:a=>v({...t,version:parseInt(a.target.value)||1}),min:1})}),(0,b.jsx)("div",{children:(0,b.jsx)(j.Input,{label:"Rating (1-10)",type:"number",value:t.performance?.rating,onChange:a=>v({...t,performance:{...t.performance,rating:parseInt(a.target.value)||0}}),min:0,max:10})}),(0,b.jsx)("div",{className:"md:col-span-3",children:(0,b.jsx)(k.Textarea,{label:"Performance Notes",value:t.performance?.notes,onChange:a=>v({...t,performance:{...t.performance,notes:a.target.value}}),placeholder:"Notes about testing, performance, improvements...",rows:3})})]}),(0,b.jsxs)("div",{className:"flex items-center justify-end gap-3 pt-6 border-t border-border",children:[(0,b.jsx)(i.Button,{variant:"ghost",onClick:()=>m.back(),children:"Cancel"}),(0,b.jsxs)(i.Button,{onClick:B,isLoading:z,children:[(0,b.jsx)(e.Save,{className:"w-4 h-4"}),"Save Prompt"]})]})]})]})}a.s(["PromptEditor",()=>z],66553)}];

//# sourceMappingURL=botbrains-nextjs_src_page-components_PromptEditor_tsx_fb788bab._.js.map