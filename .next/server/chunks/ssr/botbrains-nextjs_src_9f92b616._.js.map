{"version":3,"sources":["../../../../../botbrains-nextjs/src/lib/workspaceStorage.ts","../../../../../botbrains-nextjs/src/store/useProfileStore.ts","../../../../../botbrains-nextjs/src/lib/profileStorage.ts","../../../../../botbrains-nextjs/src/store/useWorkspaceStore.ts","../../../../../botbrains-nextjs/src/services/googleAuth.ts"],"sourcesContent":["import { db } from './firebase';\r\nimport { collection, doc, getDoc, getDocs, setDoc, updateDoc, deleteDoc, query, where, writeBatch } from 'firebase/firestore';\r\nimport type { Workspace, WorkspaceSettings } from '@/types';\r\n\r\nconst COLLECTION = 'workspaces';\r\n\r\n/**\r\n * Generate a unique ID\r\n */\r\nfunction generateId(): string {\r\n    return `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\r\n}\r\n\r\n/**\r\n * Create a new workspace\r\n */\r\nexport async function createWorkspace(\r\n    profileId: string,\r\n    name: string,\r\n    icon: string = 'üíº',\r\n    color: string = '#6366f1',\r\n    description: string = ''\r\n): Promise<Workspace> {\r\n    const now = new Date().toISOString();\r\n    const id = generateId();\r\n\r\n    const workspace: Workspace = {\r\n        id,\r\n        profileId,\r\n        name,\r\n        icon,\r\n        color,\r\n        description,\r\n        settings: {\r\n            autoBackup: true,\r\n            backupFrequency: 'daily',\r\n            viewPreferences: {\r\n                defaultView: 'card',\r\n                sortBy: 'updated',\r\n            },\r\n        },\r\n        isDefault: false,\r\n        created_at: now,\r\n        updated_at: now,\r\n    };\r\n\r\n    await setDoc(doc(db, COLLECTION, id), workspace);\r\n    return workspace;\r\n}\r\n\r\n/**\r\n * Get a workspace by ID\r\n */\r\nexport async function getWorkspace(id: string): Promise<Workspace | undefined> {\r\n    const docRef = doc(db, COLLECTION, id);\r\n    const docSnap = await getDoc(docRef);\r\n\r\n    if (docSnap.exists()) {\r\n        return docSnap.data() as Workspace;\r\n    }\r\n    return undefined;\r\n}\r\n\r\n/**\r\n * Get all workspaces for a profile\r\n */\r\nexport async function getWorkspacesByProfile(profileId: string): Promise<Workspace[]> {\r\n    const q = query(collection(db, COLLECTION), where('profileId', '==', profileId));\r\n    const querySnapshot = await getDocs(q);\r\n    return querySnapshot.docs.map(doc => doc.data() as Workspace);\r\n}\r\n\r\n/**\r\n * Get Default Workspace for a profile\r\n */\r\nexport async function getDefaultWorkspace(profileId: string): Promise<Workspace | undefined> {\r\n    const q = query(\r\n        collection(db, COLLECTION),\r\n        where('profileId', '==', profileId),\r\n        where('isDefault', '==', true)\r\n    );\r\n    const querySnapshot = await getDocs(q);\r\n\r\n    if (!querySnapshot.empty) {\r\n        return querySnapshot.docs[0].data() as Workspace;\r\n    }\r\n    return undefined;\r\n}\r\n\r\n/**\r\n * Update a workspace\r\n */\r\nexport async function updateWorkspace(\r\n    id: string,\r\n    updates: Partial<Omit<Workspace, 'id' | 'profileId' | 'created_at'>>\r\n): Promise<void> {\r\n    const docRef = doc(db, COLLECTION, id);\r\n    await updateDoc(docRef, {\r\n        ...updates,\r\n        updated_at: new Date().toISOString(),\r\n    });\r\n}\r\n\r\n/**\r\n * Update workspace settings\r\n */\r\nexport async function updateWorkspaceSettings(\r\n    id: string,\r\n    settings: Partial<WorkspaceSettings>\r\n): Promise<void> {\r\n    const workspace = await getWorkspace(id);\r\n    if (!workspace) throw new Error('Workspace not found');\r\n\r\n    await updateWorkspace(id, {\r\n        settings: {\r\n            ...workspace.settings,\r\n            ...settings,\r\n        },\r\n    });\r\n}\r\n\r\n/**\r\n * Set a workspace as default\r\n */\r\nexport async function setDefaultWorkspace(id: string): Promise<void> {\r\n    const workspace = await getWorkspace(id);\r\n    if (!workspace) throw new Error('Workspace not found');\r\n\r\n    const batch = writeBatch(db);\r\n\r\n    // Get all workspaces for this profile\r\n    const workspaces = await getWorkspacesByProfile(workspace.profileId);\r\n\r\n    // Set all to non-default\r\n    workspaces.forEach(w => {\r\n        const ref = doc(db, COLLECTION, w.id);\r\n        batch.update(ref, { isDefault: false });\r\n    });\r\n\r\n    // Set target to default\r\n    const targetRef = doc(db, COLLECTION, id);\r\n    batch.update(targetRef, { isDefault: true });\r\n\r\n    await batch.commit();\r\n}\r\n\r\n/**\r\n * Delete a workspace\r\n */\r\nexport async function deleteWorkspace(id: string): Promise<void> {\r\n    // Delete associated data first\r\n    // Note: This is simplified. In a robust system we'd batch or use cloud functions.\r\n\r\n    // Delete prompts\r\n    const promptsQ = query(collection(db, 'prompts'), where('workspaceId', '==', id));\r\n    const promptsSnap = await getDocs(promptsQ);\r\n    promptsSnap.forEach(d => deleteDoc(d.ref));\r\n\r\n    // Delete categories\r\n    const catsQ = query(collection(db, 'categories'), where('workspaceId', '==', id));\r\n    const catsSnap = await getDocs(catsQ);\r\n    catsSnap.forEach(d => deleteDoc(d.ref));\r\n\r\n    // Delete keywords\r\n    const keywordsQ = query(collection(db, 'keywords'), where('workspaceId', '==', id));\r\n    const keywordsSnap = await getDocs(keywordsQ);\r\n    keywordsSnap.forEach(d => deleteDoc(d.ref));\r\n\r\n    // Delete workspace\r\n    await deleteDoc(doc(db, COLLECTION, id));\r\n}\r\n\r\n/**\r\n * Update last backup timestamp\r\n */\r\nexport async function updateLastBackup(id: string): Promise<void> {\r\n    const docRef = doc(db, COLLECTION, id);\r\n    await updateDoc(docRef, {\r\n        lastBackupAt: new Date().toISOString(),\r\n    });\r\n}\r\n","import { create } from 'zustand';\r\nimport type { Profile, ProfilePreferences } from '@/types';\r\nimport {\r\n    getAllProfiles,\r\n    getProfile,\r\n    getProfileByGoogleId,\r\n    createProfile,\r\n    updateProfile,\r\n    updateProfilePreferences,\r\n    deleteProfile,\r\n} from '@/lib/profileStorage';\r\n\r\ninterface ProfileStore {\r\n    // State\r\n    currentProfile: Profile | null;\r\n    profiles: Profile[];\r\n    isAuthenticated: boolean;\r\n    isLoading: boolean;\r\n\r\n    // Actions\r\n    loadProfiles: () => Promise<void>;\r\n    setCurrentProfile: (profile: Profile | null) => void;\r\n    switchProfile: (profileId: string) => Promise<void>;\r\n    createNewProfile: (googleId: string, email: string, name: string, avatar?: string) => Promise<Profile>;\r\n    updateCurrentProfile: (updates: Partial<Omit<Profile, 'id' | 'googleId' | 'created_at'>>) => Promise<void>;\r\n    updatePreferences: (preferences: Partial<ProfilePreferences>) => Promise<void>;\r\n    deleteCurrentProfile: () => Promise<void>;\r\n    logout: () => void;\r\n    getOrCreateProfile: (googleId: string, email: string, name: string, avatar?: string) => Promise<Profile>;\r\n}\r\n\r\nexport const useProfileStore = create<ProfileStore>((set, get) => ({\r\n    // Initial state\r\n    currentProfile: null,\r\n    profiles: [],\r\n    isAuthenticated: false,\r\n    isLoading: false,\r\n\r\n    // Load all profiles\r\n    loadProfiles: async () => {\r\n        set({ isLoading: true });\r\n        try {\r\n            const profiles = await getAllProfiles();\r\n            set({ profiles, isLoading: false });\r\n        } catch (error) {\r\n            console.error('Failed to load profiles:', error);\r\n            set({ isLoading: false });\r\n        }\r\n    },\r\n\r\n    // Set current profile\r\n    setCurrentProfile: (profile) => {\r\n        set({\r\n            currentProfile: profile,\r\n            isAuthenticated: profile !== null,\r\n        });\r\n    },\r\n\r\n    // Switch to a different profile\r\n    switchProfile: async (profileId) => {\r\n        try {\r\n            const profile = await getProfile(profileId);\r\n            if (profile) {\r\n                get().setCurrentProfile(profile);\r\n            } else {\r\n                throw new Error('Profile not found');\r\n            }\r\n        } catch (error) {\r\n            console.error('Failed to switch profile:', error);\r\n            throw error;\r\n        }\r\n    },\r\n\r\n    // Create a new profile\r\n    createNewProfile: async (googleId, email, name, avatar) => {\r\n        try {\r\n            const profile = await createProfile(googleId, email, name, avatar);\r\n            set(state => ({\r\n                profiles: [...state.profiles, profile],\r\n            }));\r\n            return profile;\r\n        } catch (error) {\r\n            console.error('Failed to create profile:', error);\r\n            throw error;\r\n        }\r\n    },\r\n\r\n    // Update current profile\r\n    updateCurrentProfile: async (updates) => {\r\n        const { currentProfile } = get();\r\n        if (!currentProfile) {\r\n            throw new Error('No profile is currently active');\r\n        }\r\n\r\n        try {\r\n            await updateProfile(currentProfile.id, updates);\r\n            const updatedProfile = await getProfile(currentProfile.id);\r\n            if (updatedProfile) {\r\n                set(state => ({\r\n                    currentProfile: updatedProfile,\r\n                    profiles: state.profiles.map(p =>\r\n                        p.id === currentProfile.id ? updatedProfile : p\r\n                    ),\r\n                }));\r\n            }\r\n        } catch (error) {\r\n            console.error('Failed to update profile:', error);\r\n            throw error;\r\n        }\r\n    },\r\n\r\n    // Update preferences\r\n    updatePreferences: async (preferences) => {\r\n        const { currentProfile } = get();\r\n        if (!currentProfile) {\r\n            throw new Error('No profile is currently active');\r\n        }\r\n\r\n        try {\r\n            await updateProfilePreferences(currentProfile.id, preferences);\r\n            const updatedProfile = await getProfile(currentProfile.id);\r\n            if (updatedProfile) {\r\n                set(state => ({\r\n                    currentProfile: updatedProfile,\r\n                    profiles: state.profiles.map(p =>\r\n                        p.id === currentProfile.id ? updatedProfile : p\r\n                    ),\r\n                }));\r\n            }\r\n        } catch (error) {\r\n            console.error('Failed to update preferences:', error);\r\n            throw error;\r\n        }\r\n    },\r\n\r\n    // Delete current profile\r\n    deleteCurrentProfile: async () => {\r\n        const { currentProfile } = get();\r\n        if (!currentProfile) {\r\n            throw new Error('No profile is currently active');\r\n        }\r\n\r\n        try {\r\n            await deleteProfile(currentProfile.id);\r\n            set(state => ({\r\n                currentProfile: null,\r\n                isAuthenticated: false,\r\n                profiles: state.profiles.filter(p => p.id !== currentProfile.id),\r\n            }));\r\n        } catch (error) {\r\n            console.error('Failed to delete profile:', error);\r\n            throw error;\r\n        }\r\n    },\r\n\r\n    // Logout\r\n    logout: () => {\r\n        set({\r\n            currentProfile: null,\r\n            isAuthenticated: false,\r\n        });\r\n    },\r\n\r\n    // Get existing profile or create new one\r\n    getOrCreateProfile: async (googleId, email, name, avatar) => {\r\n        try {\r\n            // Try to find existing profile\r\n            let profile = await getProfileByGoogleId(googleId);\r\n\r\n            if (!profile) {\r\n                // Create new profile\r\n                profile = await get().createNewProfile(googleId, email, name, avatar);\r\n            } else {\r\n                // Update profile list if needed\r\n                const profiles = await getAllProfiles();\r\n                set({ profiles });\r\n            }\r\n\r\n            return profile;\r\n        } catch (error) {\r\n            console.error('Failed to get or create profile:', error);\r\n            throw error;\r\n        }\r\n    },\r\n}));\r\n","import { db } from './firebase';\r\nimport { collection, doc, getDoc, getDocs, setDoc, updateDoc, deleteDoc, query, where, writeBatch } from 'firebase/firestore';\r\nimport type { Profile, ProfilePreferences } from '@/types';\r\n\r\nconst COLLECTION = 'profiles';\r\n\r\n/**\r\n * Generate a unique ID\r\n */\r\nfunction generateId(): string {\r\n    return `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\r\n}\r\n\r\n/**\r\n * Create a new profile\r\n */\r\nexport async function createProfile(\r\n    googleId: string,\r\n    email: string,\r\n    name: string,\r\n    avatar?: string\r\n): Promise<Profile> {\r\n    const now = new Date().toISOString();\r\n    const id = generateId();\r\n\r\n    const profile: Profile = {\r\n        id,\r\n        googleId,\r\n        email,\r\n        name,\r\n        avatar,\r\n        preferences: {\r\n            theme: 'dark',\r\n            language: 'en',\r\n            animations: true,\r\n        },\r\n        created_at: now,\r\n        updated_at: now,\r\n    };\r\n\r\n    await setDoc(doc(db, COLLECTION, id), profile);\r\n    return profile;\r\n}\r\n\r\n/**\r\n * Get a profile by ID\r\n */\r\nexport async function getProfile(id: string): Promise<Profile | undefined> {\r\n    const docRef = doc(db, COLLECTION, id);\r\n    const docSnap = await getDoc(docRef);\r\n\r\n    if (docSnap.exists()) {\r\n        return docSnap.data() as Profile;\r\n    }\r\n    return undefined;\r\n}\r\n\r\n/**\r\n * Get a profile by Google ID\r\n */\r\nexport async function getProfileByGoogleId(googleId: string): Promise<Profile | undefined> {\r\n    const q = query(collection(db, COLLECTION), where('googleId', '==', googleId));\r\n    const querySnapshot = await getDocs(q);\r\n\r\n    if (!querySnapshot.empty) {\r\n        return querySnapshot.docs[0].data() as Profile;\r\n    }\r\n    return undefined;\r\n}\r\n\r\n/**\r\n * Get all profiles\r\n */\r\nexport async function getAllProfiles(): Promise<Profile[]> {\r\n    const querySnapshot = await getDocs(collection(db, COLLECTION));\r\n    return querySnapshot.docs.map(doc => doc.data() as Profile);\r\n}\r\n\r\n/**\r\n * Update a profile\r\n */\r\nexport async function updateProfile(\r\n    id: string,\r\n    updates: Partial<Omit<Profile, 'id' | 'googleId' | 'created_at'>>\r\n): Promise<void> {\r\n    const docRef = doc(db, COLLECTION, id);\r\n    await updateDoc(docRef, {\r\n        ...updates,\r\n        updated_at: new Date().toISOString(),\r\n    });\r\n}\r\n\r\n/**\r\n * Delete a profile\r\n * Note: Firestore doesn't automatically cascade deletes. \r\n * We need to manually delete associated data.\r\n */\r\nexport async function deleteProfile(id: string): Promise<void> {\r\n    const batch = writeBatch(db);\r\n\r\n    // Get all associated workspaces\r\n    const workspacesQuery = query(collection(db, 'workspaces'), where('profileId', '==', id));\r\n    const workspacesSnap = await getDocs(workspacesQuery);\r\n    const workspaceIds = workspacesSnap.docs.map(doc => doc.id);\r\n\r\n    // Delete workspaces\r\n    workspacesSnap.docs.forEach(doc => {\r\n        batch.delete(doc.ref);\r\n    });\r\n\r\n    // Delete prompts, categories, keywords for each workspace\r\n    // Note: Doing this in one batch might hit the 500 ops limit if massive.\r\n    // For a simple migration we do it sequentially if needed, but for now let's try to batch what we can.\r\n    // Ideally we should query ALL items by workspaceId first.\r\n\r\n    for (const workspaceId of workspaceIds) {\r\n        // Delete prompts\r\n        const promptsQ = query(collection(db, 'prompts'), where('workspaceId', '==', workspaceId));\r\n        const promptsSnap = await getDocs(promptsQ);\r\n        promptsSnap.forEach(d => deleteDoc(d.ref)); // Delete individually to avoid complex batch logic for now\r\n\r\n        // Delete categories\r\n        const catsQ = query(collection(db, 'categories'), where('workspaceId', '==', workspaceId));\r\n        const catsSnap = await getDocs(catsQ);\r\n        catsSnap.forEach(d => deleteDoc(d.ref));\r\n\r\n        // Delete keywords\r\n        const keywordsQ = query(collection(db, 'keywords'), where('workspaceId', '==', workspaceId));\r\n        const keywordsSnap = await getDocs(keywordsQ);\r\n        keywordsSnap.forEach(d => deleteDoc(d.ref));\r\n    }\r\n\r\n    // Commit workspace deletes\r\n    await batch.commit();\r\n\r\n    // Finally delete the profile\r\n    await deleteDoc(doc(db, COLLECTION, id));\r\n}\r\n\r\n/**\r\n * Update profile preferences\r\n */\r\nexport async function updateProfilePreferences(\r\n    id: string,\r\n    preferences: Partial<ProfilePreferences>\r\n): Promise<void> {\r\n    const profile = await getProfile(id);\r\n    if (!profile) {\r\n        throw new Error('Profile not found');\r\n    }\r\n\r\n    await updateProfile(id, {\r\n        preferences: {\r\n            ...profile.preferences,\r\n            ...preferences,\r\n        },\r\n    });\r\n}\r\n","import { create } from 'zustand';\r\nimport type { Workspace, WorkspaceSettings } from '@/types';\r\nimport {\r\n    createWorkspace,\r\n    getWorkspace,\r\n    getWorkspacesByProfile,\r\n    getDefaultWorkspace,\r\n    updateWorkspace,\r\n    updateWorkspaceSettings,\r\n    setDefaultWorkspace,\r\n    deleteWorkspace,\r\n    updateLastBackup,\r\n} from '@/lib/workspaceStorage';\r\n\r\ninterface WorkspaceStore {\r\n    // State\r\n    currentWorkspace: Workspace | null;\r\n    workspaces: Workspace[];\r\n    isLoading: boolean;\r\n\r\n    // Actions\r\n    loadWorkspaces: (profileId: string) => Promise<void>;\r\n    setCurrentWorkspace: (workspace: Workspace | null) => void;\r\n    switchWorkspace: (workspaceId: string) => Promise<void>;\r\n    createNewWorkspace: (\r\n        profileId: string,\r\n        name: string,\r\n        icon?: string,\r\n        color?: string,\r\n        description?: string\r\n    ) => Promise<Workspace>;\r\n    updateCurrentWorkspace: (updates: Partial<Omit<Workspace, 'id' | 'profileId' | 'created_at'>>) => Promise<void>;\r\n    updateSettings: (settings: Partial<WorkspaceSettings>) => Promise<void>;\r\n    setAsDefault: (workspaceId: string) => Promise<void>;\r\n    deleteWorkspaceById: (workspaceId: string) => Promise<void>;\r\n    loadDefaultWorkspace: (profileId: string) => Promise<void>;\r\n    markBackupComplete: (workspaceId: string) => Promise<void>;\r\n}\r\n\r\nexport const useWorkspaceStore = create<WorkspaceStore>((set, get) => ({\r\n    // Initial state\r\n    currentWorkspace: null,\r\n    workspaces: [],\r\n    isLoading: false,\r\n\r\n    // Load all workspaces for a profile\r\n    loadWorkspaces: async (profileId) => {\r\n        set({ isLoading: true });\r\n        try {\r\n            const workspaces = await getWorkspacesByProfile(profileId);\r\n            set({ workspaces, isLoading: false });\r\n        } catch (error) {\r\n            console.error('Failed to load workspaces:', error);\r\n            set({ isLoading: false });\r\n        }\r\n    },\r\n\r\n    // Set current workspace\r\n    setCurrentWorkspace: (workspace) => {\r\n        set({ currentWorkspace: workspace });\r\n    },\r\n\r\n    // Switch to a different workspace\r\n    switchWorkspace: async (workspaceId) => {\r\n        try {\r\n            const workspace = await getWorkspace(workspaceId);\r\n            if (workspace) {\r\n                get().setCurrentWorkspace(workspace);\r\n            } else {\r\n                throw new Error('Workspace not found');\r\n            }\r\n        } catch (error) {\r\n            console.error('Failed to switch workspace:', error);\r\n            throw error;\r\n        }\r\n    },\r\n\r\n    // Create a new workspace\r\n    createNewWorkspace: async (profileId, name, icon, color, description) => {\r\n        try {\r\n            const workspace = await createWorkspace(profileId, name, icon, color, description);\r\n            set(state => ({\r\n                workspaces: [...state.workspaces, workspace],\r\n            }));\r\n            return workspace;\r\n        } catch (error) {\r\n            console.error('Failed to create workspace:', error);\r\n            throw error;\r\n        }\r\n    },\r\n\r\n    // Update current workspace\r\n    updateCurrentWorkspace: async (updates) => {\r\n        const { currentWorkspace } = get();\r\n        if (!currentWorkspace) {\r\n            throw new Error('No workspace is currently active');\r\n        }\r\n\r\n        try {\r\n            await updateWorkspace(currentWorkspace.id, updates);\r\n            const updatedWorkspace = await getWorkspace(currentWorkspace.id);\r\n            if (updatedWorkspace) {\r\n                set(state => ({\r\n                    currentWorkspace: updatedWorkspace,\r\n                    workspaces: state.workspaces.map(w =>\r\n                        w.id === currentWorkspace.id ? updatedWorkspace : w\r\n                    ),\r\n                }));\r\n            }\r\n        } catch (error) {\r\n            console.error('Failed to update workspace:', error);\r\n            throw error;\r\n        }\r\n    },\r\n\r\n    // Update workspace settings\r\n    updateSettings: async (settings) => {\r\n        const { currentWorkspace } = get();\r\n        if (!currentWorkspace) {\r\n            throw new Error('No workspace is currently active');\r\n        }\r\n\r\n        try {\r\n            await updateWorkspaceSettings(currentWorkspace.id, settings);\r\n            const updatedWorkspace = await getWorkspace(currentWorkspace.id);\r\n            if (updatedWorkspace) {\r\n                set(state => ({\r\n                    currentWorkspace: updatedWorkspace,\r\n                    workspaces: state.workspaces.map(w =>\r\n                        w.id === currentWorkspace.id ? updatedWorkspace : w\r\n                    ),\r\n                }));\r\n            }\r\n        } catch (error) {\r\n            console.error('Failed to update settings:', error);\r\n            throw error;\r\n        }\r\n    },\r\n\r\n    // Set workspace as default\r\n    setAsDefault: async (workspaceId) => {\r\n        try {\r\n            await setDefaultWorkspace(workspaceId);\r\n            const workspace = await getWorkspace(workspaceId);\r\n            const { currentWorkspace } = get();\r\n\r\n            if (workspace) {\r\n                set(state => ({\r\n                    workspaces: state.workspaces.map(w => ({\r\n                        ...w,\r\n                        isDefault: w.id === workspaceId,\r\n                    })),\r\n                    currentWorkspace: currentWorkspace?.id === workspaceId ? workspace : currentWorkspace,\r\n                }));\r\n            }\r\n        } catch (error) {\r\n            console.error('Failed to set default workspace:', error);\r\n            throw error;\r\n        }\r\n    },\r\n\r\n    // Delete a workspace\r\n    deleteWorkspaceById: async (workspaceId) => {\r\n        try {\r\n            await deleteWorkspace(workspaceId);\r\n            const { currentWorkspace } = get();\r\n\r\n            set(state => ({\r\n                workspaces: state.workspaces.filter(w => w.id !== workspaceId),\r\n                currentWorkspace: currentWorkspace?.id === workspaceId ? null : currentWorkspace,\r\n            }));\r\n        } catch (error) {\r\n            console.error('Failed to delete workspace:', error);\r\n            throw error;\r\n        }\r\n    },\r\n\r\n    // Load default workspace for a profile\r\n    loadDefaultWorkspace: async (profileId) => {\r\n        console.log('üè¢ loadDefaultWorkspace called for profile:', profileId);\r\n        set({ isLoading: true });\r\n        try {\r\n            const workspace = await getDefaultWorkspace(profileId);\r\n            if (workspace) {\r\n                console.log('‚úÖ Found existing default workspace:', workspace.id, workspace.name);\r\n                set({\r\n                    currentWorkspace: workspace,\r\n                    isLoading: false,\r\n                });\r\n            } else {\r\n                console.log('‚ö†Ô∏è  No default workspace found - creating new one');\r\n                // If no default workspace exists, create one AND mark it as default\r\n                const newWorkspace = await createWorkspace(\r\n                    profileId,\r\n                    'My Workspace',\r\n                    'üíº',\r\n                    '#6366f1'\r\n                );\r\n                console.log('üíæ Created new workspace:', newWorkspace.id);\r\n\r\n                // CRITICAL FIX: Mark the newly created workspace as default\r\n                await setDefaultWorkspace(newWorkspace.id);\r\n                console.log('‚úÖ Set new workspace as default');\r\n\r\n                // Fetch the updated workspace with isDefault: true\r\n                const updatedWorkspace = await getWorkspace(newWorkspace.id);\r\n\r\n                set({\r\n                    currentWorkspace: updatedWorkspace || newWorkspace,\r\n                    workspaces: [updatedWorkspace || newWorkspace],\r\n                    isLoading: false,\r\n                });\r\n                console.log('‚úÖ Default workspace loaded:', updatedWorkspace?.id);\r\n            }\r\n        } catch (error) {\r\n            console.error('‚ùå Failed to load default workspace:', error);\r\n            set({ isLoading: false });\r\n        }\r\n    },\r\n\r\n    // Mark backup as complete\r\n    markBackupComplete: async (workspaceId) => {\r\n        try {\r\n            await updateLastBackup(workspaceId);\r\n            const updatedWorkspace = await getWorkspace(workspaceId);\r\n            const { currentWorkspace } = get();\r\n\r\n            if (updatedWorkspace) {\r\n                set(state => ({\r\n                    workspaces: state.workspaces.map(w =>\r\n                        w.id === workspaceId ? updatedWorkspace : w\r\n                    ),\r\n                    currentWorkspace: currentWorkspace?.id === workspaceId ? updatedWorkspace : currentWorkspace,\r\n                }));\r\n            }\r\n        } catch (error) {\r\n            console.error('Failed to mark backup complete:', error);\r\n            throw error;\r\n        }\r\n    },\r\n}));\r\n","import { auth } from '../lib/firebase';\r\nimport { GoogleAuthProvider, signInWithPopup, signOut as firebaseSignOut } from 'firebase/auth';\r\n\r\nconst SCOPES = [\r\n    'https://www.googleapis.com/auth/userinfo.profile',\r\n    'https://www.googleapis.com/auth/userinfo.email',\r\n    'https://www.googleapis.com/auth/drive.file',\r\n];\r\n\r\nclass GoogleAuthService {\r\n    async init(): Promise<void> {\r\n        // Firebase handles initialization automatically\r\n        return Promise.resolve();\r\n    }\r\n\r\n    async signIn(): Promise<any> {\r\n        try {\r\n            const provider = new GoogleAuthProvider();\r\n            SCOPES.forEach(scope => provider.addScope(scope));\r\n\r\n            const result = await signInWithPopup(auth, provider);\r\n            const user = result.user;\r\n\r\n            // Get the Google Access Token (for Drive API)\r\n            const credential = GoogleAuthProvider.credentialFromResult(result);\r\n            const accessToken = credential?.accessToken;\r\n\r\n            if (accessToken) {\r\n                this.storeToken(accessToken);\r\n            }\r\n\r\n            return {\r\n                id: user.uid,\r\n                email: user.email,\r\n                name: user.displayName,\r\n                picture: user.photoURL,\r\n                accessToken: accessToken // Return this for immediate use if needed\r\n            };\r\n        } catch (error: any) {\r\n            console.error('‚ùå Firebase Sign-in Error:', error);\r\n            throw {\r\n                type: 'tokenFailed',\r\n                idpId: 'google',\r\n                error: error.message || 'server_error'\r\n            };\r\n        }\r\n    }\r\n\r\n    async signOut(): Promise<void> {\r\n        try {\r\n            await firebaseSignOut(auth);\r\n            localStorage.removeItem('google_access_token');\r\n            localStorage.removeItem('google_token_expiry');\r\n        } catch (error) {\r\n            console.error('Error signing out:', error);\r\n        }\r\n    }\r\n\r\n    // Helper to store access token manually if we need to pass it to GAPI later\r\n    // Note: Firebase manages its own ID tokens, but for Drive API we need the OAuth access token\r\n    private storeToken(token: string) {\r\n        // Expire in 1 hour (standard Google token life)\r\n        const expiresIn = 3600;\r\n        const expiryDate = new Date().getTime() + expiresIn * 1000;\r\n\r\n        localStorage.setItem('google_access_token', token);\r\n        localStorage.setItem('google_token_expiry', expiryDate.toString());\r\n    }\r\n\r\n    getAccessToken(): string | null {\r\n        const token = localStorage.getItem('google_access_token');\r\n        const expiry = localStorage.getItem('google_token_expiry');\r\n\r\n        if (!token || !expiry) return null;\r\n\r\n        if (new Date().getTime() > parseInt(expiry)) {\r\n            // Token expired. With Firebase, we might need to force a re-auth or use silent upgrade\r\n            // For now, return null to force re-login flow if strictly needed for Drive\r\n            return null;\r\n        }\r\n\r\n        return token;\r\n    }\r\n\r\n    // Helper to wait for Firebase to initialize valid auth state\r\n    private waitForAuth(): Promise<any> {\r\n        return new Promise((resolve) => {\r\n            const unsubscribe = auth.onAuthStateChanged((user) => {\r\n                unsubscribe();\r\n                resolve(user);\r\n            });\r\n        });\r\n    }\r\n\r\n    async isAuthenticated(): Promise<boolean> {\r\n        const user = await this.waitForAuth();\r\n        return !!user;\r\n    }\r\n\r\n    async getCurrentUser(): Promise<any> {\r\n        const user = await this.waitForAuth();\r\n        if (!user) return null;\r\n\r\n        return {\r\n            id: user.uid,\r\n            email: user.email,\r\n            name: user.displayName,\r\n            picture: user.photoURL\r\n        };\r\n    }\r\n}\r\n\r\n// Export singleton instance with the name expected by consumers\r\nexport const googleAuth = new GoogleAuthService();\r\n"],"names":[],"mappings":"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"}